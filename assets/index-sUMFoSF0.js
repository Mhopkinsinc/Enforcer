var _b=o=>{throw TypeError(o)};var Ja=(o,t,e)=>t.has(o)?_b("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e);function mb(o,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in o)){const l=Object.getOwnPropertyDescriptor(s,r);l&&Object.defineProperty(o,r,l.get?l:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=e(r);fetch(r.href,l)}})();function ef(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var $u={exports:{}},Ka={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zm;function yb(){if(zm)return Ka;zm=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,r,l){var h=null;if(l!==void 0&&(h=""+l),r.key!==void 0&&(h=""+r.key),"key"in r){l={};for(var u in r)u!=="key"&&(l[u]=r[u])}else l=r;return r=l.ref,{$$typeof:o,type:s,key:h,ref:r!==void 0?r:null,props:l}}return Ka.Fragment=t,Ka.jsx=e,Ka.jsxs=e,Ka}var Om;function Ab(){return Om||(Om=1,$u.exports=yb()),$u.exports}var ft=Ab(),td={exports:{}},vt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Um;function vb(){if(Um)return vt;Um=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),h=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),A=Symbol.iterator;function x(w){return w===null||typeof w!="object"?null:(w=A&&w[A]||w["@@iterator"],typeof w=="function"?w:null)}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,U={};function R(w,V,st){this.props=w,this.context=V,this.refs=U,this.updater=st||D}R.prototype.isReactComponent={},R.prototype.setState=function(w,V){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,V,"setState")},R.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function C(){}C.prototype=R.prototype;function O(w,V,st){this.props=w,this.context=V,this.refs=U,this.updater=st||D}var G=O.prototype=new C;G.constructor=O,S(G,R.prototype),G.isPureReactComponent=!0;var q=Array.isArray;function et(){}var k={H:null,A:null,T:null,S:null},rt=Object.prototype.hasOwnProperty;function pt(w,V,st){var ot=st.ref;return{$$typeof:o,type:w,key:V,ref:ot!==void 0?ot:null,props:st}}function At(w,V){return pt(w.type,V,w.props)}function bt(w){return typeof w=="object"&&w!==null&&w.$$typeof===o}function Et(w){var V={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(st){return V[st]})}var I=/\/+/g;function K(w,V){return typeof w=="object"&&w!==null&&w.key!=null?Et(""+w.key):V.toString(36)}function X(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(et,et):(w.status="pending",w.then(function(V){w.status==="pending"&&(w.status="fulfilled",w.value=V)},function(V){w.status==="pending"&&(w.status="rejected",w.reason=V)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function E(w,V,st,ot,mt){var Ct=typeof w;(Ct==="undefined"||Ct==="boolean")&&(w=null);var Ut=!1;if(w===null)Ut=!0;else switch(Ct){case"bigint":case"string":case"number":Ut=!0;break;case"object":switch(w.$$typeof){case o:case t:Ut=!0;break;case _:return Ut=w._init,E(Ut(w._payload),V,st,ot,mt)}}if(Ut)return mt=mt(w),Ut=ot===""?"."+K(w,0):ot,q(mt)?(st="",Ut!=null&&(st=Ut.replace(I,"$&/")+"/"),E(mt,V,st,"",function(na){return na})):mt!=null&&(bt(mt)&&(mt=At(mt,st+(mt.key==null||w&&w.key===mt.key?"":(""+mt.key).replace(I,"$&/")+"/")+Ut)),V.push(mt)),1;Ut=0;var Je=ot===""?".":ot+":";if(q(w))for(var de=0;de<w.length;de++)ot=w[de],Ct=Je+K(ot,de),Ut+=E(ot,V,st,Ct,mt);else if(de=x(w),typeof de=="function")for(w=de.call(w),de=0;!(ot=w.next()).done;)ot=ot.value,Ct=Je+K(ot,de++),Ut+=E(ot,V,st,Ct,mt);else if(Ct==="object"){if(typeof w.then=="function")return E(X(w),V,st,ot,mt);throw V=String(w),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Ut}function b(w,V,st){if(w==null)return w;var ot=[],mt=0;return E(w,ot,"","",function(Ct){return V.call(st,Ct,mt++)}),ot}function $(w){if(w._status===-1){var V=w._result;V=V(),V.then(function(st){(w._status===0||w._status===-1)&&(w._status=1,w._result=st)},function(st){(w._status===0||w._status===-1)&&(w._status=2,w._result=st)}),w._status===-1&&(w._status=0,w._result=V)}if(w._status===1)return w._result.default;throw w._result}var it=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)},nt={map:b,forEach:function(w,V,st){b(w,function(){V.apply(this,arguments)},st)},count:function(w){var V=0;return b(w,function(){V++}),V},toArray:function(w){return b(w,function(V){return V})||[]},only:function(w){if(!bt(w))throw Error("React.Children.only expected to receive a single React element child.");return w}};return vt.Activity=y,vt.Children=nt,vt.Component=R,vt.Fragment=e,vt.Profiler=r,vt.PureComponent=O,vt.StrictMode=s,vt.Suspense=f,vt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,vt.__COMPILER_RUNTIME={__proto__:null,c:function(w){return k.H.useMemoCache(w)}},vt.cache=function(w){return function(){return w.apply(null,arguments)}},vt.cacheSignal=function(){return null},vt.cloneElement=function(w,V,st){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var ot=S({},w.props),mt=w.key;if(V!=null)for(Ct in V.key!==void 0&&(mt=""+V.key),V)!rt.call(V,Ct)||Ct==="key"||Ct==="__self"||Ct==="__source"||Ct==="ref"&&V.ref===void 0||(ot[Ct]=V[Ct]);var Ct=arguments.length-2;if(Ct===1)ot.children=st;else if(1<Ct){for(var Ut=Array(Ct),Je=0;Je<Ct;Je++)Ut[Je]=arguments[Je+2];ot.children=Ut}return pt(w.type,mt,ot)},vt.createContext=function(w){return w={$$typeof:h,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:l,_context:w},w},vt.createElement=function(w,V,st){var ot,mt={},Ct=null;if(V!=null)for(ot in V.key!==void 0&&(Ct=""+V.key),V)rt.call(V,ot)&&ot!=="key"&&ot!=="__self"&&ot!=="__source"&&(mt[ot]=V[ot]);var Ut=arguments.length-2;if(Ut===1)mt.children=st;else if(1<Ut){for(var Je=Array(Ut),de=0;de<Ut;de++)Je[de]=arguments[de+2];mt.children=Je}if(w&&w.defaultProps)for(ot in Ut=w.defaultProps,Ut)mt[ot]===void 0&&(mt[ot]=Ut[ot]);return pt(w,Ct,mt)},vt.createRef=function(){return{current:null}},vt.forwardRef=function(w){return{$$typeof:u,render:w}},vt.isValidElement=bt,vt.lazy=function(w){return{$$typeof:_,_payload:{_status:-1,_result:w},_init:$}},vt.memo=function(w,V){return{$$typeof:g,type:w,compare:V===void 0?null:V}},vt.startTransition=function(w){var V=k.T,st={};k.T=st;try{var ot=w(),mt=k.S;mt!==null&&mt(st,ot),typeof ot=="object"&&ot!==null&&typeof ot.then=="function"&&ot.then(et,it)}catch(Ct){it(Ct)}finally{V!==null&&st.types!==null&&(V.types=st.types),k.T=V}},vt.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},vt.use=function(w){return k.H.use(w)},vt.useActionState=function(w,V,st){return k.H.useActionState(w,V,st)},vt.useCallback=function(w,V){return k.H.useCallback(w,V)},vt.useContext=function(w){return k.H.useContext(w)},vt.useDebugValue=function(){},vt.useDeferredValue=function(w,V){return k.H.useDeferredValue(w,V)},vt.useEffect=function(w,V){return k.H.useEffect(w,V)},vt.useEffectEvent=function(w){return k.H.useEffectEvent(w)},vt.useId=function(){return k.H.useId()},vt.useImperativeHandle=function(w,V,st){return k.H.useImperativeHandle(w,V,st)},vt.useInsertionEffect=function(w,V){return k.H.useInsertionEffect(w,V)},vt.useLayoutEffect=function(w,V){return k.H.useLayoutEffect(w,V)},vt.useMemo=function(w,V){return k.H.useMemo(w,V)},vt.useOptimistic=function(w,V){return k.H.useOptimistic(w,V)},vt.useReducer=function(w,V,st){return k.H.useReducer(w,V,st)},vt.useRef=function(w){return k.H.useRef(w)},vt.useState=function(w){return k.H.useState(w)},vt.useSyncExternalStore=function(w,V,st){return k.H.useSyncExternalStore(w,V,st)},vt.useTransition=function(){return k.H.useTransition()},vt.version="19.2.3",vt}var Lm;function sf(){return Lm||(Lm=1,td.exports=vb()),td.exports}var Ps=sf();const xb=ef(Ps);var ed={exports:{}},$a={},id={exports:{}},sd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fm;function bb(){return Fm||(Fm=1,(function(o){function t(E,b){var $=E.length;E.push(b);t:for(;0<$;){var it=$-1>>>1,nt=E[it];if(0<r(nt,b))E[it]=b,E[$]=nt,$=it;else break t}}function e(E){return E.length===0?null:E[0]}function s(E){if(E.length===0)return null;var b=E[0],$=E.pop();if($!==b){E[0]=$;t:for(var it=0,nt=E.length,w=nt>>>1;it<w;){var V=2*(it+1)-1,st=E[V],ot=V+1,mt=E[ot];if(0>r(st,$))ot<nt&&0>r(mt,st)?(E[it]=mt,E[ot]=$,it=ot):(E[it]=st,E[V]=$,it=V);else if(ot<nt&&0>r(mt,$))E[it]=mt,E[ot]=$,it=ot;else break t}}return b}function r(E,b){var $=E.sortIndex-b.sortIndex;return $!==0?$:E.id-b.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;o.unstable_now=function(){return l.now()}}else{var h=Date,u=h.now();o.unstable_now=function(){return h.now()-u}}var f=[],g=[],_=1,y=null,A=3,x=!1,D=!1,S=!1,U=!1,R=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function G(E){for(var b=e(g);b!==null;){if(b.callback===null)s(g);else if(b.startTime<=E)s(g),b.sortIndex=b.expirationTime,t(f,b);else break;b=e(g)}}function q(E){if(S=!1,G(E),!D)if(e(f)!==null)D=!0,et||(et=!0,Et());else{var b=e(g);b!==null&&X(q,b.startTime-E)}}var et=!1,k=-1,rt=5,pt=-1;function At(){return U?!0:!(o.unstable_now()-pt<rt)}function bt(){if(U=!1,et){var E=o.unstable_now();pt=E;var b=!0;try{t:{D=!1,S&&(S=!1,C(k),k=-1),x=!0;var $=A;try{e:{for(G(E),y=e(f);y!==null&&!(y.expirationTime>E&&At());){var it=y.callback;if(typeof it=="function"){y.callback=null,A=y.priorityLevel;var nt=it(y.expirationTime<=E);if(E=o.unstable_now(),typeof nt=="function"){y.callback=nt,G(E),b=!0;break e}y===e(f)&&s(f),G(E)}else s(f);y=e(f)}if(y!==null)b=!0;else{var w=e(g);w!==null&&X(q,w.startTime-E),b=!1}}break t}finally{y=null,A=$,x=!1}b=void 0}}finally{b?Et():et=!1}}}var Et;if(typeof O=="function")Et=function(){O(bt)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,K=I.port2;I.port1.onmessage=bt,Et=function(){K.postMessage(null)}}else Et=function(){R(bt,0)};function X(E,b){k=R(function(){E(o.unstable_now())},b)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(E){E.callback=null},o.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):rt=0<E?Math.floor(1e3/E):5},o.unstable_getCurrentPriorityLevel=function(){return A},o.unstable_next=function(E){switch(A){case 1:case 2:case 3:var b=3;break;default:b=A}var $=A;A=b;try{return E()}finally{A=$}},o.unstable_requestPaint=function(){U=!0},o.unstable_runWithPriority=function(E,b){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var $=A;A=E;try{return b()}finally{A=$}},o.unstable_scheduleCallback=function(E,b,$){var it=o.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?it+$:it):$=it,E){case 1:var nt=-1;break;case 2:nt=250;break;case 5:nt=1073741823;break;case 4:nt=1e4;break;default:nt=5e3}return nt=$+nt,E={id:_++,callback:b,priorityLevel:E,startTime:$,expirationTime:nt,sortIndex:-1},$>it?(E.sortIndex=$,t(g,E),e(f)===null&&E===e(g)&&(S?(C(k),k=-1):S=!0,X(q,$-it))):(E.sortIndex=nt,t(f,E),D||x||(D=!0,et||(et=!0,Et()))),E},o.unstable_shouldYield=At,o.unstable_wrapCallback=function(E){var b=A;return function(){var $=A;A=b;try{return E.apply(this,arguments)}finally{A=$}}}})(sd)),sd}var Nm;function wb(){return Nm||(Nm=1,id.exports=bb()),id.exports}var nd={exports:{}},Ye={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hm;function Cb(){if(Hm)return Ye;Hm=1;var o=sf();function t(f){var g="https://react.dev/errors/"+f;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)g+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(f,g,_){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:y==null?null:""+y,children:f,containerInfo:g,implementation:_}}var h=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,g){if(f==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return Ye.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ye.createPortal=function(f,g){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(t(299));return l(f,g,null,_)},Ye.flushSync=function(f){var g=h.T,_=s.p;try{if(h.T=null,s.p=2,f)return f()}finally{h.T=g,s.p=_,s.d.f()}},Ye.preconnect=function(f,g){typeof f=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,s.d.C(f,g))},Ye.prefetchDNS=function(f){typeof f=="string"&&s.d.D(f)},Ye.preinit=function(f,g){if(typeof f=="string"&&g&&typeof g.as=="string"){var _=g.as,y=u(_,g.crossOrigin),A=typeof g.integrity=="string"?g.integrity:void 0,x=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;_==="style"?s.d.S(f,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:y,integrity:A,fetchPriority:x}):_==="script"&&s.d.X(f,{crossOrigin:y,integrity:A,fetchPriority:x,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},Ye.preinitModule=function(f,g){if(typeof f=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var _=u(g.as,g.crossOrigin);s.d.M(f,{crossOrigin:_,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&s.d.M(f)},Ye.preload=function(f,g){if(typeof f=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var _=g.as,y=u(_,g.crossOrigin);s.d.L(f,_,{crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},Ye.preloadModule=function(f,g){if(typeof f=="string")if(g){var _=u(g.as,g.crossOrigin);s.d.m(f,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:_,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else s.d.m(f)},Ye.requestFormReset=function(f){s.d.r(f)},Ye.unstable_batchedUpdates=function(f,g){return f(g)},Ye.useFormState=function(f,g,_){return h.H.useFormState(f,g,_)},Ye.useFormStatus=function(){return h.H.useHostTransitionStatus()},Ye.version="19.2.3",Ye}var Gm;function Sb(){if(Gm)return nd.exports;Gm=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),nd.exports=Cb(),nd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qm;function Tb(){if(Qm)return $a;Qm=1;var o=wb(),t=sf(),e=Sb();function s(i){var n="https://react.dev/errors/"+i;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+i+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function l(i){var n=i,a=i;if(i.alternate)for(;n.return;)n=n.return;else{i=n;do n=i,(n.flags&4098)!==0&&(a=n.return),i=n.return;while(i)}return n.tag===3?a:null}function h(i){if(i.tag===13){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function u(i){if(i.tag===31){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function f(i){if(l(i)!==i)throw Error(s(188))}function g(i){var n=i.alternate;if(!n){if(n=l(i),n===null)throw Error(s(188));return n!==i?null:i}for(var a=i,c=n;;){var d=a.return;if(d===null)break;var p=d.alternate;if(p===null){if(c=d.return,c!==null){a=c;continue}break}if(d.child===p.child){for(p=d.child;p;){if(p===a)return f(d),i;if(p===c)return f(d),n;p=p.sibling}throw Error(s(188))}if(a.return!==c.return)a=d,c=p;else{for(var m=!1,v=d.child;v;){if(v===a){m=!0,a=d,c=p;break}if(v===c){m=!0,c=d,a=p;break}v=v.sibling}if(!m){for(v=p.child;v;){if(v===a){m=!0,a=p,c=d;break}if(v===c){m=!0,c=p,a=d;break}v=v.sibling}if(!m)throw Error(s(189))}}if(a.alternate!==c)throw Error(s(190))}if(a.tag!==3)throw Error(s(188));return a.stateNode.current===a?i:n}function _(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i;for(i=i.child;i!==null;){if(n=_(i),n!==null)return n;i=i.sibling}return null}var y=Object.assign,A=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),D=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),O=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),et=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),pt=Symbol.for("react.activity"),At=Symbol.for("react.memo_cache_sentinel"),bt=Symbol.iterator;function Et(i){return i===null||typeof i!="object"?null:(i=bt&&i[bt]||i["@@iterator"],typeof i=="function"?i:null)}var I=Symbol.for("react.client.reference");function K(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===I?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case S:return"Fragment";case R:return"Profiler";case U:return"StrictMode";case q:return"Suspense";case et:return"SuspenseList";case pt:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case D:return"Portal";case O:return i.displayName||"Context";case C:return(i._context.displayName||"Context")+".Consumer";case G:var n=i.render;return i=i.displayName,i||(i=n.displayName||n.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case k:return n=i.displayName||null,n!==null?n:K(i.type)||"Memo";case rt:n=i._payload,i=i._init;try{return K(i(n))}catch{}}return null}var X=Array.isArray,E=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,b=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$={pending:!1,data:null,method:null,action:null},it=[],nt=-1;function w(i){return{current:i}}function V(i){0>nt||(i.current=it[nt],it[nt]=null,nt--)}function st(i,n){nt++,it[nt]=i.current,i.current=n}var ot=w(null),mt=w(null),Ct=w(null),Ut=w(null);function Je(i,n){switch(st(Ct,n),st(mt,i),st(ot,null),n.nodeType){case 9:case 11:i=(i=n.documentElement)&&(i=i.namespaceURI)?nm(i):0;break;default:if(i=n.tagName,n=n.namespaceURI)n=nm(n),i=rm(n,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}V(ot),st(ot,i)}function de(){V(ot),V(mt),V(Ct)}function na(i){i.memoizedState!==null&&st(Ut,i);var n=ot.current,a=rm(n,i.type);n!==a&&(st(mt,i),st(ot,a))}function Do(i){mt.current===i&&(V(ot),V(mt)),Ut.current===i&&(V(Ut),qa._currentValue=$)}var zc,kf;function Cn(i){if(zc===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);zc=n&&n[1]||"",kf=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+zc+i+kf}var Oc=!1;function Uc(i,n){if(!i||Oc)return"";Oc=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(Y){var Q=Y}Reflect.construct(i,[],J)}else{try{J.call()}catch(Y){Q=Y}i.call(J.prototype)}}else{try{throw Error()}catch(Y){Q=Y}(J=i())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(Y){if(Y&&Q&&typeof Y.stack=="string")return[Y.stack,Q.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=c.DetermineComponentFrameRoot(),m=p[0],v=p[1];if(m&&v){var T=m.split(`
`),N=v.split(`
`);for(d=c=0;c<T.length&&!T[c].includes("DetermineComponentFrameRoot");)c++;for(;d<N.length&&!N[d].includes("DetermineComponentFrameRoot");)d++;if(c===T.length||d===N.length)for(c=T.length-1,d=N.length-1;1<=c&&0<=d&&T[c]!==N[d];)d--;for(;1<=c&&0<=d;c--,d--)if(T[c]!==N[d]){if(c!==1||d!==1)do if(c--,d--,0>d||T[c]!==N[d]){var j=`
`+T[c].replace(" at new "," at ");return i.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",i.displayName)),j}while(1<=c&&0<=d);break}}}finally{Oc=!1,Error.prepareStackTrace=a}return(a=i?i.displayName||i.name:"")?Cn(a):""}function qA(i,n){switch(i.tag){case 26:case 27:case 5:return Cn(i.type);case 16:return Cn("Lazy");case 13:return i.child!==n&&n!==null?Cn("Suspense Fallback"):Cn("Suspense");case 19:return Cn("SuspenseList");case 0:case 15:return Uc(i.type,!1);case 11:return Uc(i.type.render,!1);case 1:return Uc(i.type,!0);case 31:return Cn("Activity");default:return""}}function zf(i){try{var n="",a=null;do n+=qA(i,a),a=i,i=i.return;while(i);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Lc=Object.prototype.hasOwnProperty,Fc=o.unstable_scheduleCallback,Nc=o.unstable_cancelCallback,XA=o.unstable_shouldYield,ZA=o.unstable_requestPaint,_i=o.unstable_now,WA=o.unstable_getCurrentPriorityLevel,Of=o.unstable_ImmediatePriority,Uf=o.unstable_UserBlockingPriority,Ro=o.unstable_NormalPriority,JA=o.unstable_LowPriority,Lf=o.unstable_IdlePriority,KA=o.log,$A=o.unstable_setDisableYieldValue,ra=null,mi=null;function Qs(i){if(typeof KA=="function"&&$A(i),mi&&typeof mi.setStrictMode=="function")try{mi.setStrictMode(ra,i)}catch{}}var yi=Math.clz32?Math.clz32:iv,tv=Math.log,ev=Math.LN2;function iv(i){return i>>>=0,i===0?32:31-(tv(i)/ev|0)|0}var Mo=256,Po=262144,Bo=4194304;function Sn(i){var n=i&42;if(n!==0)return n;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Io(i,n,a){var c=i.pendingLanes;if(c===0)return 0;var d=0,p=i.suspendedLanes,m=i.pingedLanes;i=i.warmLanes;var v=c&134217727;return v!==0?(c=v&~p,c!==0?d=Sn(c):(m&=v,m!==0?d=Sn(m):a||(a=v&~i,a!==0&&(d=Sn(a))))):(v=c&~p,v!==0?d=Sn(v):m!==0?d=Sn(m):a||(a=c&~i,a!==0&&(d=Sn(a)))),d===0?0:n!==0&&n!==d&&(n&p)===0&&(p=d&-d,a=n&-n,p>=a||p===32&&(a&4194048)!==0)?n:d}function aa(i,n){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&n)===0}function sv(i,n){switch(i){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ff(){var i=Bo;return Bo<<=1,(Bo&62914560)===0&&(Bo=4194304),i}function Hc(i){for(var n=[],a=0;31>a;a++)n.push(i);return n}function oa(i,n){i.pendingLanes|=n,n!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function nv(i,n,a,c,d,p){var m=i.pendingLanes;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=a,i.entangledLanes&=a,i.errorRecoveryDisabledLanes&=a,i.shellSuspendCounter=0;var v=i.entanglements,T=i.expirationTimes,N=i.hiddenUpdates;for(a=m&~a;0<a;){var j=31-yi(a),J=1<<j;v[j]=0,T[j]=-1;var Q=N[j];if(Q!==null)for(N[j]=null,j=0;j<Q.length;j++){var Y=Q[j];Y!==null&&(Y.lane&=-536870913)}a&=~J}c!==0&&Nf(i,c,0),p!==0&&d===0&&i.tag!==0&&(i.suspendedLanes|=p&~(m&~n))}function Nf(i,n,a){i.pendingLanes|=n,i.suspendedLanes&=~n;var c=31-yi(n);i.entangledLanes|=n,i.entanglements[c]=i.entanglements[c]|1073741824|a&261930}function Hf(i,n){var a=i.entangledLanes|=n;for(i=i.entanglements;a;){var c=31-yi(a),d=1<<c;d&n|i[c]&n&&(i[c]|=n),a&=~d}}function Gf(i,n){var a=n&-n;return a=(a&42)!==0?1:Gc(a),(a&(i.suspendedLanes|n))!==0?0:a}function Gc(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Qc(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Qf(){var i=b.p;return i!==0?i:(i=window.event,i===void 0?32:Dm(i.type))}function Vf(i,n){var a=b.p;try{return b.p=i,n()}finally{b.p=a}}var Vs=Math.random().toString(36).slice(2),ke="__reactFiber$"+Vs,si="__reactProps$"+Vs,nr="__reactContainer$"+Vs,Vc="__reactEvents$"+Vs,rv="__reactListeners$"+Vs,av="__reactHandles$"+Vs,Yf="__reactResources$"+Vs,la="__reactMarker$"+Vs;function Yc(i){delete i[ke],delete i[si],delete i[Vc],delete i[rv],delete i[av]}function rr(i){var n=i[ke];if(n)return n;for(var a=i.parentNode;a;){if(n=a[nr]||a[ke]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(i=dm(i);i!==null;){if(a=i[ke])return a;i=dm(i)}return n}i=a,a=i.parentNode}return null}function ar(i){if(i=i[ke]||i[nr]){var n=i.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return i}return null}function ca(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i.stateNode;throw Error(s(33))}function or(i){var n=i[Yf];return n||(n=i[Yf]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Re(i){i[la]=!0}var jf=new Set,qf={};function Tn(i,n){lr(i,n),lr(i+"Capture",n)}function lr(i,n){for(qf[i]=n,i=0;i<n.length;i++)jf.add(n[i])}var ov=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Xf={},Zf={};function lv(i){return Lc.call(Zf,i)?!0:Lc.call(Xf,i)?!1:ov.test(i)?Zf[i]=!0:(Xf[i]=!0,!1)}function ko(i,n,a){if(lv(n))if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":i.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){i.removeAttribute(n);return}}i.setAttribute(n,""+a)}}function zo(i,n,a){if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(n);return}i.setAttribute(n,""+a)}}function fs(i,n,a,c){if(c===null)i.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttributeNS(n,a,""+c)}}function Mi(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Wf(i){var n=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function cv(i,n,a){var c=Object.getOwnPropertyDescriptor(i.constructor.prototype,n);if(!i.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var d=c.get,p=c.set;return Object.defineProperty(i,n,{configurable:!0,get:function(){return d.call(this)},set:function(m){a=""+m,p.call(this,m)}}),Object.defineProperty(i,n,{enumerable:c.enumerable}),{getValue:function(){return a},setValue:function(m){a=""+m},stopTracking:function(){i._valueTracker=null,delete i[n]}}}}function jc(i){if(!i._valueTracker){var n=Wf(i)?"checked":"value";i._valueTracker=cv(i,n,""+i[n])}}function Jf(i){if(!i)return!1;var n=i._valueTracker;if(!n)return!0;var a=n.getValue(),c="";return i&&(c=Wf(i)?i.checked?"true":"false":i.value),i=c,i!==a?(n.setValue(i),!0):!1}function Oo(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var hv=/[\n"\\]/g;function Pi(i){return i.replace(hv,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function qc(i,n,a,c,d,p,m,v){i.name="",m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"?i.type=m:i.removeAttribute("type"),n!=null?m==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+Mi(n)):i.value!==""+Mi(n)&&(i.value=""+Mi(n)):m!=="submit"&&m!=="reset"||i.removeAttribute("value"),n!=null?Xc(i,m,Mi(n)):a!=null?Xc(i,m,Mi(a)):c!=null&&i.removeAttribute("value"),d==null&&p!=null&&(i.defaultChecked=!!p),d!=null&&(i.checked=d&&typeof d!="function"&&typeof d!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?i.name=""+Mi(v):i.removeAttribute("name")}function Kf(i,n,a,c,d,p,m,v){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(i.type=p),n!=null||a!=null){if(!(p!=="submit"&&p!=="reset"||n!=null)){jc(i);return}a=a!=null?""+Mi(a):"",n=n!=null?""+Mi(n):a,v||n===i.value||(i.value=n),i.defaultValue=n}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,i.checked=v?i.checked:!!c,i.defaultChecked=!!c,m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(i.name=m),jc(i)}function Xc(i,n,a){n==="number"&&Oo(i.ownerDocument)===i||i.defaultValue===""+a||(i.defaultValue=""+a)}function cr(i,n,a,c){if(i=i.options,n){n={};for(var d=0;d<a.length;d++)n["$"+a[d]]=!0;for(a=0;a<i.length;a++)d=n.hasOwnProperty("$"+i[a].value),i[a].selected!==d&&(i[a].selected=d),d&&c&&(i[a].defaultSelected=!0)}else{for(a=""+Mi(a),n=null,d=0;d<i.length;d++){if(i[d].value===a){i[d].selected=!0,c&&(i[d].defaultSelected=!0);return}n!==null||i[d].disabled||(n=i[d])}n!==null&&(n.selected=!0)}}function $f(i,n,a){if(n!=null&&(n=""+Mi(n),n!==i.value&&(i.value=n),a==null)){i.defaultValue!==n&&(i.defaultValue=n);return}i.defaultValue=a!=null?""+Mi(a):""}function tp(i,n,a,c){if(n==null){if(c!=null){if(a!=null)throw Error(s(92));if(X(c)){if(1<c.length)throw Error(s(93));c=c[0]}a=c}a==null&&(a=""),n=a}a=Mi(n),i.defaultValue=a,c=i.textContent,c===a&&c!==""&&c!==null&&(i.value=c),jc(i)}function hr(i,n){if(n){var a=i.firstChild;if(a&&a===i.lastChild&&a.nodeType===3){a.nodeValue=n;return}}i.textContent=n}var uv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ep(i,n,a){var c=n.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?c?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="":c?i.setProperty(n,a):typeof a!="number"||a===0||uv.has(n)?n==="float"?i.cssFloat=a:i[n]=(""+a).trim():i[n]=a+"px"}function ip(i,n,a){if(n!=null&&typeof n!="object")throw Error(s(62));if(i=i.style,a!=null){for(var c in a)!a.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?i.setProperty(c,""):c==="float"?i.cssFloat="":i[c]="");for(var d in n)c=n[d],n.hasOwnProperty(d)&&a[d]!==c&&ep(i,d,c)}else for(var p in n)n.hasOwnProperty(p)&&ep(i,p,n[p])}function Zc(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),fv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Uo(i){return fv.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function ps(){}var Wc=null;function Jc(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var ur=null,dr=null;function sp(i){var n=ar(i);if(n&&(i=n.stateNode)){var a=i[si]||null;t:switch(i=n.stateNode,n.type){case"input":if(qc(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),n=a.name,a.type==="radio"&&n!=null){for(a=i;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Pi(""+n)+'"][type="radio"]'),n=0;n<a.length;n++){var c=a[n];if(c!==i&&c.form===i.form){var d=c[si]||null;if(!d)throw Error(s(90));qc(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(n=0;n<a.length;n++)c=a[n],c.form===i.form&&Jf(c)}break t;case"textarea":$f(i,a.value,a.defaultValue);break t;case"select":n=a.value,n!=null&&cr(i,!!a.multiple,n,!1)}}}var Kc=!1;function np(i,n,a){if(Kc)return i(n,a);Kc=!0;try{var c=i(n);return c}finally{if(Kc=!1,(ur!==null||dr!==null)&&(Cl(),ur&&(n=ur,i=dr,dr=ur=null,sp(n),i)))for(n=0;n<i.length;n++)sp(i[n])}}function ha(i,n){var a=i.stateNode;if(a===null)return null;var c=a[si]||null;if(c===null)return null;a=c[n];t:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(i=i.type,c=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!c;break t;default:i=!1}if(i)return null;if(a&&typeof a!="function")throw Error(s(231,n,typeof a));return a}var gs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$c=!1;if(gs)try{var ua={};Object.defineProperty(ua,"passive",{get:function(){$c=!0}}),window.addEventListener("test",ua,ua),window.removeEventListener("test",ua,ua)}catch{$c=!1}var Ys=null,th=null,Lo=null;function rp(){if(Lo)return Lo;var i,n=th,a=n.length,c,d="value"in Ys?Ys.value:Ys.textContent,p=d.length;for(i=0;i<a&&n[i]===d[i];i++);var m=a-i;for(c=1;c<=m&&n[a-c]===d[p-c];c++);return Lo=d.slice(i,1<c?1-c:void 0)}function Fo(i){var n=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&n===13&&(i=13)):i=n,i===10&&(i=13),32<=i||i===13?i:0}function No(){return!0}function ap(){return!1}function ni(i){function n(a,c,d,p,m){this._reactName=a,this._targetInst=d,this.type=c,this.nativeEvent=p,this.target=m,this.currentTarget=null;for(var v in i)i.hasOwnProperty(v)&&(a=i[v],this[v]=a?a(p):p[v]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?No:ap,this.isPropagationStopped=ap,this}return y(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=No)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=No)},persist:function(){},isPersistent:No}),n}var En={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ho=ni(En),da=y({},En,{view:0,detail:0}),pv=ni(da),eh,ih,fa,Go=y({},da,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nh,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==fa&&(fa&&i.type==="mousemove"?(eh=i.screenX-fa.screenX,ih=i.screenY-fa.screenY):ih=eh=0,fa=i),eh)},movementY:function(i){return"movementY"in i?i.movementY:ih}}),op=ni(Go),gv=y({},Go,{dataTransfer:0}),_v=ni(gv),mv=y({},da,{relatedTarget:0}),sh=ni(mv),yv=y({},En,{animationName:0,elapsedTime:0,pseudoElement:0}),Av=ni(yv),vv=y({},En,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),xv=ni(vv),bv=y({},En,{data:0}),lp=ni(bv),wv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tv(i){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(i):(i=Sv[i])?!!n[i]:!1}function nh(){return Tv}var Ev=y({},da,{key:function(i){if(i.key){var n=wv[i.key]||i.key;if(n!=="Unidentified")return n}return i.type==="keypress"?(i=Fo(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Cv[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nh,charCode:function(i){return i.type==="keypress"?Fo(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Fo(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Dv=ni(Ev),Rv=y({},Go,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cp=ni(Rv),Mv=y({},da,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nh}),Pv=ni(Mv),Bv=y({},En,{propertyName:0,elapsedTime:0,pseudoElement:0}),Iv=ni(Bv),kv=y({},Go,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),zv=ni(kv),Ov=y({},En,{newState:0,oldState:0}),Uv=ni(Ov),Lv=[9,13,27,32],rh=gs&&"CompositionEvent"in window,pa=null;gs&&"documentMode"in document&&(pa=document.documentMode);var Fv=gs&&"TextEvent"in window&&!pa,hp=gs&&(!rh||pa&&8<pa&&11>=pa),up=" ",dp=!1;function fp(i,n){switch(i){case"keyup":return Lv.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pp(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var fr=!1;function Nv(i,n){switch(i){case"compositionend":return pp(n);case"keypress":return n.which!==32?null:(dp=!0,up);case"textInput":return i=n.data,i===up&&dp?null:i;default:return null}}function Hv(i,n){if(fr)return i==="compositionend"||!rh&&fp(i,n)?(i=rp(),Lo=th=Ys=null,fr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return hp&&n.locale!=="ko"?null:n.data;default:return null}}var Gv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gp(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n==="input"?!!Gv[i.type]:n==="textarea"}function _p(i,n,a,c){ur?dr?dr.push(c):dr=[c]:ur=c,n=Pl(n,"onChange"),0<n.length&&(a=new Ho("onChange","change",null,a,c),i.push({event:a,listeners:n}))}var ga=null,_a=null;function Qv(i){K_(i,0)}function Qo(i){var n=ca(i);if(Jf(n))return i}function mp(i,n){if(i==="change")return n}var yp=!1;if(gs){var ah;if(gs){var oh="oninput"in document;if(!oh){var Ap=document.createElement("div");Ap.setAttribute("oninput","return;"),oh=typeof Ap.oninput=="function"}ah=oh}else ah=!1;yp=ah&&(!document.documentMode||9<document.documentMode)}function vp(){ga&&(ga.detachEvent("onpropertychange",xp),_a=ga=null)}function xp(i){if(i.propertyName==="value"&&Qo(_a)){var n=[];_p(n,_a,i,Jc(i)),np(Qv,n)}}function Vv(i,n,a){i==="focusin"?(vp(),ga=n,_a=a,ga.attachEvent("onpropertychange",xp)):i==="focusout"&&vp()}function Yv(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Qo(_a)}function jv(i,n){if(i==="click")return Qo(n)}function qv(i,n){if(i==="input"||i==="change")return Qo(n)}function Xv(i,n){return i===n&&(i!==0||1/i===1/n)||i!==i&&n!==n}var Ai=typeof Object.is=="function"?Object.is:Xv;function ma(i,n){if(Ai(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;var a=Object.keys(i),c=Object.keys(n);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var d=a[c];if(!Lc.call(n,d)||!Ai(i[d],n[d]))return!1}return!0}function bp(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function wp(i,n){var a=bp(i);i=0;for(var c;a;){if(a.nodeType===3){if(c=i+a.textContent.length,i<=n&&c>=n)return{node:a,offset:n-i};i=c}t:{for(;a;){if(a.nextSibling){a=a.nextSibling;break t}a=a.parentNode}a=void 0}a=bp(a)}}function Cp(i,n){return i&&n?i===n?!0:i&&i.nodeType===3?!1:n&&n.nodeType===3?Cp(i,n.parentNode):"contains"in i?i.contains(n):i.compareDocumentPosition?!!(i.compareDocumentPosition(n)&16):!1:!1}function Sp(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var n=Oo(i.document);n instanceof i.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)i=n.contentWindow;else break;n=Oo(i.document)}return n}function lh(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n&&(n==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||n==="textarea"||i.contentEditable==="true")}var Zv=gs&&"documentMode"in document&&11>=document.documentMode,pr=null,ch=null,ya=null,hh=!1;function Tp(i,n,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;hh||pr==null||pr!==Oo(c)||(c=pr,"selectionStart"in c&&lh(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),ya&&ma(ya,c)||(ya=c,c=Pl(ch,"onSelect"),0<c.length&&(n=new Ho("onSelect","select",null,n,a),i.push({event:n,listeners:c}),n.target=pr)))}function Dn(i,n){var a={};return a[i.toLowerCase()]=n.toLowerCase(),a["Webkit"+i]="webkit"+n,a["Moz"+i]="moz"+n,a}var gr={animationend:Dn("Animation","AnimationEnd"),animationiteration:Dn("Animation","AnimationIteration"),animationstart:Dn("Animation","AnimationStart"),transitionrun:Dn("Transition","TransitionRun"),transitionstart:Dn("Transition","TransitionStart"),transitioncancel:Dn("Transition","TransitionCancel"),transitionend:Dn("Transition","TransitionEnd")},uh={},Ep={};gs&&(Ep=document.createElement("div").style,"AnimationEvent"in window||(delete gr.animationend.animation,delete gr.animationiteration.animation,delete gr.animationstart.animation),"TransitionEvent"in window||delete gr.transitionend.transition);function Rn(i){if(uh[i])return uh[i];if(!gr[i])return i;var n=gr[i],a;for(a in n)if(n.hasOwnProperty(a)&&a in Ep)return uh[i]=n[a];return i}var Dp=Rn("animationend"),Rp=Rn("animationiteration"),Mp=Rn("animationstart"),Wv=Rn("transitionrun"),Jv=Rn("transitionstart"),Kv=Rn("transitioncancel"),Pp=Rn("transitionend"),Bp=new Map,dh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");dh.push("scrollEnd");function Yi(i,n){Bp.set(i,n),Tn(n,[i])}var Vo=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Bi=[],_r=0,fh=0;function Yo(){for(var i=_r,n=fh=_r=0;n<i;){var a=Bi[n];Bi[n++]=null;var c=Bi[n];Bi[n++]=null;var d=Bi[n];Bi[n++]=null;var p=Bi[n];if(Bi[n++]=null,c!==null&&d!==null){var m=c.pending;m===null?d.next=d:(d.next=m.next,m.next=d),c.pending=d}p!==0&&Ip(a,d,p)}}function jo(i,n,a,c){Bi[_r++]=i,Bi[_r++]=n,Bi[_r++]=a,Bi[_r++]=c,fh|=c,i.lanes|=c,i=i.alternate,i!==null&&(i.lanes|=c)}function ph(i,n,a,c){return jo(i,n,a,c),qo(i)}function Mn(i,n){return jo(i,null,null,n),qo(i)}function Ip(i,n,a){i.lanes|=a;var c=i.alternate;c!==null&&(c.lanes|=a);for(var d=!1,p=i.return;p!==null;)p.childLanes|=a,c=p.alternate,c!==null&&(c.childLanes|=a),p.tag===22&&(i=p.stateNode,i===null||i._visibility&1||(d=!0)),i=p,p=p.return;return i.tag===3?(p=i.stateNode,d&&n!==null&&(d=31-yi(a),i=p.hiddenUpdates,c=i[d],c===null?i[d]=[n]:c.push(n),n.lane=a|536870912),p):null}function qo(i){if(50<Na)throw Na=0,wu=null,Error(s(185));for(var n=i.return;n!==null;)i=n,n=i.return;return i.tag===3?i.stateNode:null}var mr={};function $v(i,n,a,c){this.tag=i,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vi(i,n,a,c){return new $v(i,n,a,c)}function gh(i){return i=i.prototype,!(!i||!i.isReactComponent)}function _s(i,n){var a=i.alternate;return a===null?(a=vi(i.tag,n,i.key,i.mode),a.elementType=i.elementType,a.type=i.type,a.stateNode=i.stateNode,a.alternate=i,i.alternate=a):(a.pendingProps=n,a.type=i.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=i.flags&65011712,a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,n=i.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=i.sibling,a.index=i.index,a.ref=i.ref,a.refCleanup=i.refCleanup,a}function kp(i,n){i.flags&=65011714;var a=i.alternate;return a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),i}function Xo(i,n,a,c,d,p){var m=0;if(c=i,typeof i=="function")gh(i)&&(m=1);else if(typeof i=="string")m=nb(i,a,ot.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case pt:return i=vi(31,a,n,d),i.elementType=pt,i.lanes=p,i;case S:return Pn(a.children,d,p,n);case U:m=8,d|=24;break;case R:return i=vi(12,a,n,d|2),i.elementType=R,i.lanes=p,i;case q:return i=vi(13,a,n,d),i.elementType=q,i.lanes=p,i;case et:return i=vi(19,a,n,d),i.elementType=et,i.lanes=p,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case O:m=10;break t;case C:m=9;break t;case G:m=11;break t;case k:m=14;break t;case rt:m=16,c=null;break t}m=29,a=Error(s(130,i===null?"null":typeof i,"")),c=null}return n=vi(m,a,n,d),n.elementType=i,n.type=c,n.lanes=p,n}function Pn(i,n,a,c){return i=vi(7,i,c,n),i.lanes=a,i}function _h(i,n,a){return i=vi(6,i,null,n),i.lanes=a,i}function zp(i){var n=vi(18,null,null,0);return n.stateNode=i,n}function mh(i,n,a){return n=vi(4,i.children!==null?i.children:[],i.key,n),n.lanes=a,n.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},n}var Op=new WeakMap;function Ii(i,n){if(typeof i=="object"&&i!==null){var a=Op.get(i);return a!==void 0?a:(n={value:i,source:n,stack:zf(n)},Op.set(i,n),n)}return{value:i,source:n,stack:zf(n)}}var yr=[],Ar=0,Zo=null,Aa=0,ki=[],zi=0,js=null,Ki=1,$i="";function ms(i,n){yr[Ar++]=Aa,yr[Ar++]=Zo,Zo=i,Aa=n}function Up(i,n,a){ki[zi++]=Ki,ki[zi++]=$i,ki[zi++]=js,js=i;var c=Ki;i=$i;var d=32-yi(c)-1;c&=~(1<<d),a+=1;var p=32-yi(n)+d;if(30<p){var m=d-d%5;p=(c&(1<<m)-1).toString(32),c>>=m,d-=m,Ki=1<<32-yi(n)+d|a<<d|c,$i=p+i}else Ki=1<<p|a<<d|c,$i=i}function yh(i){i.return!==null&&(ms(i,1),Up(i,1,0))}function Ah(i){for(;i===Zo;)Zo=yr[--Ar],yr[Ar]=null,Aa=yr[--Ar],yr[Ar]=null;for(;i===js;)js=ki[--zi],ki[zi]=null,$i=ki[--zi],ki[zi]=null,Ki=ki[--zi],ki[zi]=null}function Lp(i,n){ki[zi++]=Ki,ki[zi++]=$i,ki[zi++]=js,Ki=n.id,$i=n.overflow,js=i}var ze=null,ee=null,kt=!1,qs=null,Oi=!1,vh=Error(s(519));function Xs(i){var n=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw va(Ii(n,i)),vh}function Fp(i){var n=i.stateNode,a=i.type,c=i.memoizedProps;switch(n[ke]=i,n[si]=c,a){case"dialog":Mt("cancel",n),Mt("close",n);break;case"iframe":case"object":case"embed":Mt("load",n);break;case"video":case"audio":for(a=0;a<Ga.length;a++)Mt(Ga[a],n);break;case"source":Mt("error",n);break;case"img":case"image":case"link":Mt("error",n),Mt("load",n);break;case"details":Mt("toggle",n);break;case"input":Mt("invalid",n),Kf(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Mt("invalid",n);break;case"textarea":Mt("invalid",n),tp(n,c.value,c.defaultValue,c.children)}a=c.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||n.textContent===""+a||c.suppressHydrationWarning===!0||im(n.textContent,a)?(c.popover!=null&&(Mt("beforetoggle",n),Mt("toggle",n)),c.onScroll!=null&&Mt("scroll",n),c.onScrollEnd!=null&&Mt("scrollend",n),c.onClick!=null&&(n.onclick=ps),n=!0):n=!1,n||Xs(i,!0)}function Np(i){for(ze=i.return;ze;)switch(ze.tag){case 5:case 31:case 13:Oi=!1;return;case 27:case 3:Oi=!0;return;default:ze=ze.return}}function vr(i){if(i!==ze)return!1;if(!kt)return Np(i),kt=!0,!1;var n=i.tag,a;if((a=n!==3&&n!==27)&&((a=n===5)&&(a=i.type,a=!(a!=="form"&&a!=="button")||Lu(i.type,i.memoizedProps)),a=!a),a&&ee&&Xs(i),Np(i),n===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));ee=um(i)}else if(n===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));ee=um(i)}else n===27?(n=ee,cn(i.type)?(i=Qu,Qu=null,ee=i):ee=n):ee=ze?Li(i.stateNode.nextSibling):null;return!0}function Bn(){ee=ze=null,kt=!1}function xh(){var i=qs;return i!==null&&(li===null?li=i:li.push.apply(li,i),qs=null),i}function va(i){qs===null?qs=[i]:qs.push(i)}var bh=w(null),In=null,ys=null;function Zs(i,n,a){st(bh,n._currentValue),n._currentValue=a}function As(i){i._currentValue=bh.current,V(bh)}function wh(i,n,a){for(;i!==null;){var c=i.alternate;if((i.childLanes&n)!==n?(i.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),i===a)break;i=i.return}}function Ch(i,n,a,c){var d=i.child;for(d!==null&&(d.return=i);d!==null;){var p=d.dependencies;if(p!==null){var m=d.child;p=p.firstContext;t:for(;p!==null;){var v=p;p=d;for(var T=0;T<n.length;T++)if(v.context===n[T]){p.lanes|=a,v=p.alternate,v!==null&&(v.lanes|=a),wh(p.return,a,i),c||(m=null);break t}p=v.next}}else if(d.tag===18){if(m=d.return,m===null)throw Error(s(341));m.lanes|=a,p=m.alternate,p!==null&&(p.lanes|=a),wh(m,a,i),m=null}else m=d.child;if(m!==null)m.return=d;else for(m=d;m!==null;){if(m===i){m=null;break}if(d=m.sibling,d!==null){d.return=m.return,m=d;break}m=m.return}d=m}}function xr(i,n,a,c){i=null;for(var d=n,p=!1;d!==null;){if(!p){if((d.flags&524288)!==0)p=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var m=d.alternate;if(m===null)throw Error(s(387));if(m=m.memoizedProps,m!==null){var v=d.type;Ai(d.pendingProps.value,m.value)||(i!==null?i.push(v):i=[v])}}else if(d===Ut.current){if(m=d.alternate,m===null)throw Error(s(387));m.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(i!==null?i.push(qa):i=[qa])}d=d.return}i!==null&&Ch(n,i,a,c),n.flags|=262144}function Wo(i){for(i=i.firstContext;i!==null;){if(!Ai(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function kn(i){In=i,ys=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Oe(i){return Hp(In,i)}function Jo(i,n){return In===null&&kn(i),Hp(i,n)}function Hp(i,n){var a=n._currentValue;if(n={context:n,memoizedValue:a,next:null},ys===null){if(i===null)throw Error(s(308));ys=n,i.dependencies={lanes:0,firstContext:n},i.flags|=524288}else ys=ys.next=n;return a}var tx=typeof AbortController<"u"?AbortController:function(){var i=[],n=this.signal={aborted:!1,addEventListener:function(a,c){i.push(c)}};this.abort=function(){n.aborted=!0,i.forEach(function(a){return a()})}},ex=o.unstable_scheduleCallback,ix=o.unstable_NormalPriority,Ae={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Sh(){return{controller:new tx,data:new Map,refCount:0}}function xa(i){i.refCount--,i.refCount===0&&ex(ix,function(){i.controller.abort()})}var ba=null,Th=0,br=0,wr=null;function sx(i,n){if(ba===null){var a=ba=[];Th=0,br=Ru(),wr={status:"pending",value:void 0,then:function(c){a.push(c)}}}return Th++,n.then(Gp,Gp),n}function Gp(){if(--Th===0&&ba!==null){wr!==null&&(wr.status="fulfilled");var i=ba;ba=null,br=0,wr=null;for(var n=0;n<i.length;n++)(0,i[n])()}}function nx(i,n){var a=[],c={status:"pending",value:null,reason:null,then:function(d){a.push(d)}};return i.then(function(){c.status="fulfilled",c.value=n;for(var d=0;d<a.length;d++)(0,a[d])(n)},function(d){for(c.status="rejected",c.reason=d,d=0;d<a.length;d++)(0,a[d])(void 0)}),c}var Qp=E.S;E.S=function(i,n){T_=_i(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&sx(i,n),Qp!==null&&Qp(i,n)};var zn=w(null);function Eh(){var i=zn.current;return i!==null?i:Xt.pooledCache}function Ko(i,n){n===null?st(zn,zn.current):st(zn,n.pool)}function Vp(){var i=Eh();return i===null?null:{parent:Ae._currentValue,pool:i}}var Cr=Error(s(460)),Dh=Error(s(474)),$o=Error(s(542)),tl={then:function(){}};function Yp(i){return i=i.status,i==="fulfilled"||i==="rejected"}function jp(i,n,a){switch(a=i[a],a===void 0?i.push(n):a!==n&&(n.then(ps,ps),n=a),n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Xp(i),i;default:if(typeof n.status=="string")n.then(ps,ps);else{if(i=Xt,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=n,i.status="pending",i.then(function(c){if(n.status==="pending"){var d=n;d.status="fulfilled",d.value=c}},function(c){if(n.status==="pending"){var d=n;d.status="rejected",d.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Xp(i),i}throw Un=n,Cr}}function On(i){try{var n=i._init;return n(i._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Un=a,Cr):a}}var Un=null;function qp(){if(Un===null)throw Error(s(459));var i=Un;return Un=null,i}function Xp(i){if(i===Cr||i===$o)throw Error(s(483))}var Sr=null,wa=0;function el(i){var n=wa;return wa+=1,Sr===null&&(Sr=[]),jp(Sr,i,n)}function Ca(i,n){n=n.props.ref,i.ref=n!==void 0?n:null}function il(i,n){throw n.$$typeof===A?Error(s(525)):(i=Object.prototype.toString.call(n),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)))}function Zp(i){function n(z,P){if(i){var F=z.deletions;F===null?(z.deletions=[P],z.flags|=16):F.push(P)}}function a(z,P){if(!i)return null;for(;P!==null;)n(z,P),P=P.sibling;return null}function c(z){for(var P=new Map;z!==null;)z.key!==null?P.set(z.key,z):P.set(z.index,z),z=z.sibling;return P}function d(z,P){return z=_s(z,P),z.index=0,z.sibling=null,z}function p(z,P,F){return z.index=F,i?(F=z.alternate,F!==null?(F=F.index,F<P?(z.flags|=67108866,P):F):(z.flags|=67108866,P)):(z.flags|=1048576,P)}function m(z){return i&&z.alternate===null&&(z.flags|=67108866),z}function v(z,P,F,Z){return P===null||P.tag!==6?(P=_h(F,z.mode,Z),P.return=z,P):(P=d(P,F),P.return=z,P)}function T(z,P,F,Z){var dt=F.type;return dt===S?j(z,P,F.props.children,Z,F.key):P!==null&&(P.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===rt&&On(dt)===P.type)?(P=d(P,F.props),Ca(P,F),P.return=z,P):(P=Xo(F.type,F.key,F.props,null,z.mode,Z),Ca(P,F),P.return=z,P)}function N(z,P,F,Z){return P===null||P.tag!==4||P.stateNode.containerInfo!==F.containerInfo||P.stateNode.implementation!==F.implementation?(P=mh(F,z.mode,Z),P.return=z,P):(P=d(P,F.children||[]),P.return=z,P)}function j(z,P,F,Z,dt){return P===null||P.tag!==7?(P=Pn(F,z.mode,Z,dt),P.return=z,P):(P=d(P,F),P.return=z,P)}function J(z,P,F){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=_h(""+P,z.mode,F),P.return=z,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case x:return F=Xo(P.type,P.key,P.props,null,z.mode,F),Ca(F,P),F.return=z,F;case D:return P=mh(P,z.mode,F),P.return=z,P;case rt:return P=On(P),J(z,P,F)}if(X(P)||Et(P))return P=Pn(P,z.mode,F,null),P.return=z,P;if(typeof P.then=="function")return J(z,el(P),F);if(P.$$typeof===O)return J(z,Jo(z,P),F);il(z,P)}return null}function Q(z,P,F,Z){var dt=P!==null?P.key:null;if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return dt!==null?null:v(z,P,""+F,Z);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case x:return F.key===dt?T(z,P,F,Z):null;case D:return F.key===dt?N(z,P,F,Z):null;case rt:return F=On(F),Q(z,P,F,Z)}if(X(F)||Et(F))return dt!==null?null:j(z,P,F,Z,null);if(typeof F.then=="function")return Q(z,P,el(F),Z);if(F.$$typeof===O)return Q(z,P,Jo(z,F),Z);il(z,F)}return null}function Y(z,P,F,Z,dt){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return z=z.get(F)||null,v(P,z,""+Z,dt);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case x:return z=z.get(Z.key===null?F:Z.key)||null,T(P,z,Z,dt);case D:return z=z.get(Z.key===null?F:Z.key)||null,N(P,z,Z,dt);case rt:return Z=On(Z),Y(z,P,F,Z,dt)}if(X(Z)||Et(Z))return z=z.get(F)||null,j(P,z,Z,dt,null);if(typeof Z.then=="function")return Y(z,P,F,el(Z),dt);if(Z.$$typeof===O)return Y(z,P,F,Jo(P,Z),dt);il(P,Z)}return null}function lt(z,P,F,Z){for(var dt=null,Lt=null,ut=P,wt=P=0,It=null;ut!==null&&wt<F.length;wt++){ut.index>wt?(It=ut,ut=null):It=ut.sibling;var Ft=Q(z,ut,F[wt],Z);if(Ft===null){ut===null&&(ut=It);break}i&&ut&&Ft.alternate===null&&n(z,ut),P=p(Ft,P,wt),Lt===null?dt=Ft:Lt.sibling=Ft,Lt=Ft,ut=It}if(wt===F.length)return a(z,ut),kt&&ms(z,wt),dt;if(ut===null){for(;wt<F.length;wt++)ut=J(z,F[wt],Z),ut!==null&&(P=p(ut,P,wt),Lt===null?dt=ut:Lt.sibling=ut,Lt=ut);return kt&&ms(z,wt),dt}for(ut=c(ut);wt<F.length;wt++)It=Y(ut,z,wt,F[wt],Z),It!==null&&(i&&It.alternate!==null&&ut.delete(It.key===null?wt:It.key),P=p(It,P,wt),Lt===null?dt=It:Lt.sibling=It,Lt=It);return i&&ut.forEach(function(pn){return n(z,pn)}),kt&&ms(z,wt),dt}function gt(z,P,F,Z){if(F==null)throw Error(s(151));for(var dt=null,Lt=null,ut=P,wt=P=0,It=null,Ft=F.next();ut!==null&&!Ft.done;wt++,Ft=F.next()){ut.index>wt?(It=ut,ut=null):It=ut.sibling;var pn=Q(z,ut,Ft.value,Z);if(pn===null){ut===null&&(ut=It);break}i&&ut&&pn.alternate===null&&n(z,ut),P=p(pn,P,wt),Lt===null?dt=pn:Lt.sibling=pn,Lt=pn,ut=It}if(Ft.done)return a(z,ut),kt&&ms(z,wt),dt;if(ut===null){for(;!Ft.done;wt++,Ft=F.next())Ft=J(z,Ft.value,Z),Ft!==null&&(P=p(Ft,P,wt),Lt===null?dt=Ft:Lt.sibling=Ft,Lt=Ft);return kt&&ms(z,wt),dt}for(ut=c(ut);!Ft.done;wt++,Ft=F.next())Ft=Y(ut,z,wt,Ft.value,Z),Ft!==null&&(i&&Ft.alternate!==null&&ut.delete(Ft.key===null?wt:Ft.key),P=p(Ft,P,wt),Lt===null?dt=Ft:Lt.sibling=Ft,Lt=Ft);return i&&ut.forEach(function(gb){return n(z,gb)}),kt&&ms(z,wt),dt}function jt(z,P,F,Z){if(typeof F=="object"&&F!==null&&F.type===S&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case x:t:{for(var dt=F.key;P!==null;){if(P.key===dt){if(dt=F.type,dt===S){if(P.tag===7){a(z,P.sibling),Z=d(P,F.props.children),Z.return=z,z=Z;break t}}else if(P.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===rt&&On(dt)===P.type){a(z,P.sibling),Z=d(P,F.props),Ca(Z,F),Z.return=z,z=Z;break t}a(z,P);break}else n(z,P);P=P.sibling}F.type===S?(Z=Pn(F.props.children,z.mode,Z,F.key),Z.return=z,z=Z):(Z=Xo(F.type,F.key,F.props,null,z.mode,Z),Ca(Z,F),Z.return=z,z=Z)}return m(z);case D:t:{for(dt=F.key;P!==null;){if(P.key===dt)if(P.tag===4&&P.stateNode.containerInfo===F.containerInfo&&P.stateNode.implementation===F.implementation){a(z,P.sibling),Z=d(P,F.children||[]),Z.return=z,z=Z;break t}else{a(z,P);break}else n(z,P);P=P.sibling}Z=mh(F,z.mode,Z),Z.return=z,z=Z}return m(z);case rt:return F=On(F),jt(z,P,F,Z)}if(X(F))return lt(z,P,F,Z);if(Et(F)){if(dt=Et(F),typeof dt!="function")throw Error(s(150));return F=dt.call(F),gt(z,P,F,Z)}if(typeof F.then=="function")return jt(z,P,el(F),Z);if(F.$$typeof===O)return jt(z,P,Jo(z,F),Z);il(z,F)}return typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint"?(F=""+F,P!==null&&P.tag===6?(a(z,P.sibling),Z=d(P,F),Z.return=z,z=Z):(a(z,P),Z=_h(F,z.mode,Z),Z.return=z,z=Z),m(z)):a(z,P)}return function(z,P,F,Z){try{wa=0;var dt=jt(z,P,F,Z);return Sr=null,dt}catch(ut){if(ut===Cr||ut===$o)throw ut;var Lt=vi(29,ut,null,z.mode);return Lt.lanes=Z,Lt.return=z,Lt}finally{}}}var Ln=Zp(!0),Wp=Zp(!1),Ws=!1;function Rh(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mh(i,n){i=i.updateQueue,n.updateQueue===i&&(n.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Js(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Ks(i,n,a){var c=i.updateQueue;if(c===null)return null;if(c=c.shared,(Nt&2)!==0){var d=c.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),c.pending=n,n=qo(i),Ip(i,null,a),n}return jo(i,c,n,a),qo(i)}function Sa(i,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194048)!==0)){var c=n.lanes;c&=i.pendingLanes,a|=c,n.lanes=a,Hf(i,a)}}function Ph(i,n){var a=i.updateQueue,c=i.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var d=null,p=null;if(a=a.firstBaseUpdate,a!==null){do{var m={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};p===null?d=p=m:p=p.next=m,a=a.next}while(a!==null);p===null?d=p=n:p=p.next=n}else d=p=n;a={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:p,shared:c.shared,callbacks:c.callbacks},i.updateQueue=a;return}i=a.lastBaseUpdate,i===null?a.firstBaseUpdate=n:i.next=n,a.lastBaseUpdate=n}var Bh=!1;function Ta(){if(Bh){var i=wr;if(i!==null)throw i}}function Ea(i,n,a,c){Bh=!1;var d=i.updateQueue;Ws=!1;var p=d.firstBaseUpdate,m=d.lastBaseUpdate,v=d.shared.pending;if(v!==null){d.shared.pending=null;var T=v,N=T.next;T.next=null,m===null?p=N:m.next=N,m=T;var j=i.alternate;j!==null&&(j=j.updateQueue,v=j.lastBaseUpdate,v!==m&&(v===null?j.firstBaseUpdate=N:v.next=N,j.lastBaseUpdate=T))}if(p!==null){var J=d.baseState;m=0,j=N=T=null,v=p;do{var Q=v.lane&-536870913,Y=Q!==v.lane;if(Y?(Bt&Q)===Q:(c&Q)===Q){Q!==0&&Q===br&&(Bh=!0),j!==null&&(j=j.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});t:{var lt=i,gt=v;Q=n;var jt=a;switch(gt.tag){case 1:if(lt=gt.payload,typeof lt=="function"){J=lt.call(jt,J,Q);break t}J=lt;break t;case 3:lt.flags=lt.flags&-65537|128;case 0:if(lt=gt.payload,Q=typeof lt=="function"?lt.call(jt,J,Q):lt,Q==null)break t;J=y({},J,Q);break t;case 2:Ws=!0}}Q=v.callback,Q!==null&&(i.flags|=64,Y&&(i.flags|=8192),Y=d.callbacks,Y===null?d.callbacks=[Q]:Y.push(Q))}else Y={lane:Q,tag:v.tag,payload:v.payload,callback:v.callback,next:null},j===null?(N=j=Y,T=J):j=j.next=Y,m|=Q;if(v=v.next,v===null){if(v=d.shared.pending,v===null)break;Y=v,v=Y.next,Y.next=null,d.lastBaseUpdate=Y,d.shared.pending=null}}while(!0);j===null&&(T=J),d.baseState=T,d.firstBaseUpdate=N,d.lastBaseUpdate=j,p===null&&(d.shared.lanes=0),nn|=m,i.lanes=m,i.memoizedState=J}}function Jp(i,n){if(typeof i!="function")throw Error(s(191,i));i.call(n)}function Kp(i,n){var a=i.callbacks;if(a!==null)for(i.callbacks=null,i=0;i<a.length;i++)Jp(a[i],n)}var Tr=w(null),sl=w(0);function $p(i,n){i=Ds,st(sl,i),st(Tr,n),Ds=i|n.baseLanes}function Ih(){st(sl,Ds),st(Tr,Tr.current)}function kh(){Ds=sl.current,V(Tr),V(sl)}var xi=w(null),Ui=null;function $s(i){var n=i.alternate;st(fe,fe.current&1),st(xi,i),Ui===null&&(n===null||Tr.current!==null||n.memoizedState!==null)&&(Ui=i)}function zh(i){st(fe,fe.current),st(xi,i),Ui===null&&(Ui=i)}function tg(i){i.tag===22?(st(fe,fe.current),st(xi,i),Ui===null&&(Ui=i)):tn()}function tn(){st(fe,fe.current),st(xi,xi.current)}function bi(i){V(xi),Ui===i&&(Ui=null),V(fe)}var fe=w(0);function nl(i){for(var n=i;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Hu(a)||Gu(a)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var vs=0,xt=null,Vt=null,ve=null,rl=!1,Er=!1,Fn=!1,al=0,Da=0,Dr=null,rx=0;function ae(){throw Error(s(321))}function Oh(i,n){if(n===null)return!1;for(var a=0;a<n.length&&a<i.length;a++)if(!Ai(i[a],n[a]))return!1;return!0}function Uh(i,n,a,c,d,p){return vs=p,xt=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,E.H=i===null||i.memoizedState===null?Ug:Kh,Fn=!1,p=a(c,d),Fn=!1,Er&&(p=ig(n,a,c,d)),eg(i),p}function eg(i){E.H=Pa;var n=Vt!==null&&Vt.next!==null;if(vs=0,ve=Vt=xt=null,rl=!1,Da=0,Dr=null,n)throw Error(s(300));i===null||xe||(i=i.dependencies,i!==null&&Wo(i)&&(xe=!0))}function ig(i,n,a,c){xt=i;var d=0;do{if(Er&&(Dr=null),Da=0,Er=!1,25<=d)throw Error(s(301));if(d+=1,ve=Vt=null,i.updateQueue!=null){var p=i.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}E.H=Lg,p=n(a,c)}while(Er);return p}function ax(){var i=E.H,n=i.useState()[0];return n=typeof n.then=="function"?Ra(n):n,i=i.useState()[0],(Vt!==null?Vt.memoizedState:null)!==i&&(xt.flags|=1024),n}function Lh(){var i=al!==0;return al=0,i}function Fh(i,n,a){n.updateQueue=i.updateQueue,n.flags&=-2053,i.lanes&=~a}function Nh(i){if(rl){for(i=i.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}rl=!1}vs=0,ve=Vt=xt=null,Er=!1,Da=al=0,Dr=null}function Ke(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ve===null?xt.memoizedState=ve=i:ve=ve.next=i,ve}function pe(){if(Vt===null){var i=xt.alternate;i=i!==null?i.memoizedState:null}else i=Vt.next;var n=ve===null?xt.memoizedState:ve.next;if(n!==null)ve=n,Vt=i;else{if(i===null)throw xt.alternate===null?Error(s(467)):Error(s(310));Vt=i,i={memoizedState:Vt.memoizedState,baseState:Vt.baseState,baseQueue:Vt.baseQueue,queue:Vt.queue,next:null},ve===null?xt.memoizedState=ve=i:ve=ve.next=i}return ve}function ol(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ra(i){var n=Da;return Da+=1,Dr===null&&(Dr=[]),i=jp(Dr,i,n),n=xt,(ve===null?n.memoizedState:ve.next)===null&&(n=n.alternate,E.H=n===null||n.memoizedState===null?Ug:Kh),i}function ll(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Ra(i);if(i.$$typeof===O)return Oe(i)}throw Error(s(438,String(i)))}function Hh(i){var n=null,a=xt.updateQueue;if(a!==null&&(n=a.memoCache),n==null){var c=xt.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(d){return d.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),a===null&&(a=ol(),xt.updateQueue=a),a.memoCache=n,a=n.data[n.index],a===void 0)for(a=n.data[n.index]=Array(i),c=0;c<i;c++)a[c]=At;return n.index++,a}function xs(i,n){return typeof n=="function"?n(i):n}function cl(i){var n=pe();return Gh(n,Vt,i)}function Gh(i,n,a){var c=i.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=a;var d=i.baseQueue,p=c.pending;if(p!==null){if(d!==null){var m=d.next;d.next=p.next,p.next=m}n.baseQueue=d=p,c.pending=null}if(p=i.baseState,d===null)i.memoizedState=p;else{n=d.next;var v=m=null,T=null,N=n,j=!1;do{var J=N.lane&-536870913;if(J!==N.lane?(Bt&J)===J:(vs&J)===J){var Q=N.revertLane;if(Q===0)T!==null&&(T=T.next={lane:0,revertLane:0,gesture:null,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),J===br&&(j=!0);else if((vs&Q)===Q){N=N.next,Q===br&&(j=!0);continue}else J={lane:0,revertLane:N.revertLane,gesture:null,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},T===null?(v=T=J,m=p):T=T.next=J,xt.lanes|=Q,nn|=Q;J=N.action,Fn&&a(p,J),p=N.hasEagerState?N.eagerState:a(p,J)}else Q={lane:J,revertLane:N.revertLane,gesture:N.gesture,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},T===null?(v=T=Q,m=p):T=T.next=Q,xt.lanes|=J,nn|=J;N=N.next}while(N!==null&&N!==n);if(T===null?m=p:T.next=v,!Ai(p,i.memoizedState)&&(xe=!0,j&&(a=wr,a!==null)))throw a;i.memoizedState=p,i.baseState=m,i.baseQueue=T,c.lastRenderedState=p}return d===null&&(c.lanes=0),[i.memoizedState,c.dispatch]}function Qh(i){var n=pe(),a=n.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=i;var c=a.dispatch,d=a.pending,p=n.memoizedState;if(d!==null){a.pending=null;var m=d=d.next;do p=i(p,m.action),m=m.next;while(m!==d);Ai(p,n.memoizedState)||(xe=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),a.lastRenderedState=p}return[p,c]}function sg(i,n,a){var c=xt,d=pe(),p=kt;if(p){if(a===void 0)throw Error(s(407));a=a()}else a=n();var m=!Ai((Vt||d).memoizedState,a);if(m&&(d.memoizedState=a,xe=!0),d=d.queue,jh(ag.bind(null,c,d,i),[i]),d.getSnapshot!==n||m||ve!==null&&ve.memoizedState.tag&1){if(c.flags|=2048,Rr(9,{destroy:void 0},rg.bind(null,c,d,a,n),null),Xt===null)throw Error(s(349));p||(vs&127)!==0||ng(c,n,a)}return a}function ng(i,n,a){i.flags|=16384,i={getSnapshot:n,value:a},n=xt.updateQueue,n===null?(n=ol(),xt.updateQueue=n,n.stores=[i]):(a=n.stores,a===null?n.stores=[i]:a.push(i))}function rg(i,n,a,c){n.value=a,n.getSnapshot=c,og(n)&&lg(i)}function ag(i,n,a){return a(function(){og(n)&&lg(i)})}function og(i){var n=i.getSnapshot;i=i.value;try{var a=n();return!Ai(i,a)}catch{return!0}}function lg(i){var n=Mn(i,2);n!==null&&ci(n,i,2)}function Vh(i){var n=Ke();if(typeof i=="function"){var a=i;if(i=a(),Fn){Qs(!0);try{a()}finally{Qs(!1)}}}return n.memoizedState=n.baseState=i,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:i},n}function cg(i,n,a,c){return i.baseState=a,Gh(i,Vt,typeof c=="function"?c:xs)}function ox(i,n,a,c,d){if(dl(i))throw Error(s(485));if(i=n.action,i!==null){var p={payload:d,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(m){p.listeners.push(m)}};E.T!==null?a(!0):p.isTransition=!1,c(p),a=n.pending,a===null?(p.next=n.pending=p,hg(n,p)):(p.next=a.next,n.pending=a.next=p)}}function hg(i,n){var a=n.action,c=n.payload,d=i.state;if(n.isTransition){var p=E.T,m={};E.T=m;try{var v=a(d,c),T=E.S;T!==null&&T(m,v),ug(i,n,v)}catch(N){Yh(i,n,N)}finally{p!==null&&m.types!==null&&(p.types=m.types),E.T=p}}else try{p=a(d,c),ug(i,n,p)}catch(N){Yh(i,n,N)}}function ug(i,n,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(c){dg(i,n,c)},function(c){return Yh(i,n,c)}):dg(i,n,a)}function dg(i,n,a){n.status="fulfilled",n.value=a,fg(n),i.state=a,n=i.pending,n!==null&&(a=n.next,a===n?i.pending=null:(a=a.next,n.next=a,hg(i,a)))}function Yh(i,n,a){var c=i.pending;if(i.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=a,fg(n),n=n.next;while(n!==c)}i.action=null}function fg(i){i=i.listeners;for(var n=0;n<i.length;n++)(0,i[n])()}function pg(i,n){return n}function gg(i,n){if(kt){var a=Xt.formState;if(a!==null){t:{var c=xt;if(kt){if(ee){e:{for(var d=ee,p=Oi;d.nodeType!==8;){if(!p){d=null;break e}if(d=Li(d.nextSibling),d===null){d=null;break e}}p=d.data,d=p==="F!"||p==="F"?d:null}if(d){ee=Li(d.nextSibling),c=d.data==="F!";break t}}Xs(c)}c=!1}c&&(n=a[0])}}return a=Ke(),a.memoizedState=a.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pg,lastRenderedState:n},a.queue=c,a=kg.bind(null,xt,c),c.dispatch=a,c=Vh(!1),p=Jh.bind(null,xt,!1,c.queue),c=Ke(),d={state:n,dispatch:null,action:i,pending:null},c.queue=d,a=ox.bind(null,xt,d,p,a),d.dispatch=a,c.memoizedState=i,[n,a,!1]}function _g(i){var n=pe();return mg(n,Vt,i)}function mg(i,n,a){if(n=Gh(i,n,pg)[0],i=cl(xs)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=Ra(n)}catch(m){throw m===Cr?$o:m}else c=n;n=pe();var d=n.queue,p=d.dispatch;return a!==n.memoizedState&&(xt.flags|=2048,Rr(9,{destroy:void 0},lx.bind(null,d,a),null)),[c,p,i]}function lx(i,n){i.action=n}function yg(i){var n=pe(),a=Vt;if(a!==null)return mg(n,a,i);pe(),n=n.memoizedState,a=pe();var c=a.queue.dispatch;return a.memoizedState=i,[n,c,!1]}function Rr(i,n,a,c){return i={tag:i,create:a,deps:c,inst:n,next:null},n=xt.updateQueue,n===null&&(n=ol(),xt.updateQueue=n),a=n.lastEffect,a===null?n.lastEffect=i.next=i:(c=a.next,a.next=i,i.next=c,n.lastEffect=i),i}function Ag(){return pe().memoizedState}function hl(i,n,a,c){var d=Ke();xt.flags|=i,d.memoizedState=Rr(1|n,{destroy:void 0},a,c===void 0?null:c)}function ul(i,n,a,c){var d=pe();c=c===void 0?null:c;var p=d.memoizedState.inst;Vt!==null&&c!==null&&Oh(c,Vt.memoizedState.deps)?d.memoizedState=Rr(n,p,a,c):(xt.flags|=i,d.memoizedState=Rr(1|n,p,a,c))}function vg(i,n){hl(8390656,8,i,n)}function jh(i,n){ul(2048,8,i,n)}function cx(i){xt.flags|=4;var n=xt.updateQueue;if(n===null)n=ol(),xt.updateQueue=n,n.events=[i];else{var a=n.events;a===null?n.events=[i]:a.push(i)}}function xg(i){var n=pe().memoizedState;return cx({ref:n,nextImpl:i}),function(){if((Nt&2)!==0)throw Error(s(440));return n.impl.apply(void 0,arguments)}}function bg(i,n){return ul(4,2,i,n)}function wg(i,n){return ul(4,4,i,n)}function Cg(i,n){if(typeof n=="function"){i=i();var a=n(i);return function(){typeof a=="function"?a():n(null)}}if(n!=null)return i=i(),n.current=i,function(){n.current=null}}function Sg(i,n,a){a=a!=null?a.concat([i]):null,ul(4,4,Cg.bind(null,n,i),a)}function qh(){}function Tg(i,n){var a=pe();n=n===void 0?null:n;var c=a.memoizedState;return n!==null&&Oh(n,c[1])?c[0]:(a.memoizedState=[i,n],i)}function Eg(i,n){var a=pe();n=n===void 0?null:n;var c=a.memoizedState;if(n!==null&&Oh(n,c[1]))return c[0];if(c=i(),Fn){Qs(!0);try{i()}finally{Qs(!1)}}return a.memoizedState=[c,n],c}function Xh(i,n,a){return a===void 0||(vs&1073741824)!==0&&(Bt&261930)===0?i.memoizedState=n:(i.memoizedState=a,i=D_(),xt.lanes|=i,nn|=i,a)}function Dg(i,n,a,c){return Ai(a,n)?a:Tr.current!==null?(i=Xh(i,a,c),Ai(i,n)||(xe=!0),i):(vs&42)===0||(vs&1073741824)!==0&&(Bt&261930)===0?(xe=!0,i.memoizedState=a):(i=D_(),xt.lanes|=i,nn|=i,n)}function Rg(i,n,a,c,d){var p=b.p;b.p=p!==0&&8>p?p:8;var m=E.T,v={};E.T=v,Jh(i,!1,n,a);try{var T=d(),N=E.S;if(N!==null&&N(v,T),T!==null&&typeof T=="object"&&typeof T.then=="function"){var j=nx(T,c);Ma(i,n,j,Si(i))}else Ma(i,n,c,Si(i))}catch(J){Ma(i,n,{then:function(){},status:"rejected",reason:J},Si())}finally{b.p=p,m!==null&&v.types!==null&&(m.types=v.types),E.T=m}}function hx(){}function Zh(i,n,a,c){if(i.tag!==5)throw Error(s(476));var d=Mg(i).queue;Rg(i,d,n,$,a===null?hx:function(){return Pg(i),a(c)})}function Mg(i){var n=i.memoizedState;if(n!==null)return n;n={memoizedState:$,baseState:$,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:$},next:null};var a={};return n.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:a},next:null},i.memoizedState=n,i=i.alternate,i!==null&&(i.memoizedState=n),n}function Pg(i){var n=Mg(i);n.next===null&&(n=i.alternate.memoizedState),Ma(i,n.next.queue,{},Si())}function Wh(){return Oe(qa)}function Bg(){return pe().memoizedState}function Ig(){return pe().memoizedState}function ux(i){for(var n=i.return;n!==null;){switch(n.tag){case 24:case 3:var a=Si();i=Js(a);var c=Ks(n,i,a);c!==null&&(ci(c,n,a),Sa(c,n,a)),n={cache:Sh()},i.payload=n;return}n=n.return}}function dx(i,n,a){var c=Si();a={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},dl(i)?zg(n,a):(a=ph(i,n,a,c),a!==null&&(ci(a,i,c),Og(a,n,c)))}function kg(i,n,a){var c=Si();Ma(i,n,a,c)}function Ma(i,n,a,c){var d={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(dl(i))zg(n,d);else{var p=i.alternate;if(i.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var m=n.lastRenderedState,v=p(m,a);if(d.hasEagerState=!0,d.eagerState=v,Ai(v,m))return jo(i,n,d,0),Xt===null&&Yo(),!1}catch{}finally{}if(a=ph(i,n,d,c),a!==null)return ci(a,i,c),Og(a,n,c),!0}return!1}function Jh(i,n,a,c){if(c={lane:2,revertLane:Ru(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},dl(i)){if(n)throw Error(s(479))}else n=ph(i,a,c,2),n!==null&&ci(n,i,2)}function dl(i){var n=i.alternate;return i===xt||n!==null&&n===xt}function zg(i,n){Er=rl=!0;var a=i.pending;a===null?n.next=n:(n.next=a.next,a.next=n),i.pending=n}function Og(i,n,a){if((a&4194048)!==0){var c=n.lanes;c&=i.pendingLanes,a|=c,n.lanes=a,Hf(i,a)}}var Pa={readContext:Oe,use:ll,useCallback:ae,useContext:ae,useEffect:ae,useImperativeHandle:ae,useLayoutEffect:ae,useInsertionEffect:ae,useMemo:ae,useReducer:ae,useRef:ae,useState:ae,useDebugValue:ae,useDeferredValue:ae,useTransition:ae,useSyncExternalStore:ae,useId:ae,useHostTransitionStatus:ae,useFormState:ae,useActionState:ae,useOptimistic:ae,useMemoCache:ae,useCacheRefresh:ae};Pa.useEffectEvent=ae;var Ug={readContext:Oe,use:ll,useCallback:function(i,n){return Ke().memoizedState=[i,n===void 0?null:n],i},useContext:Oe,useEffect:vg,useImperativeHandle:function(i,n,a){a=a!=null?a.concat([i]):null,hl(4194308,4,Cg.bind(null,n,i),a)},useLayoutEffect:function(i,n){return hl(4194308,4,i,n)},useInsertionEffect:function(i,n){hl(4,2,i,n)},useMemo:function(i,n){var a=Ke();n=n===void 0?null:n;var c=i();if(Fn){Qs(!0);try{i()}finally{Qs(!1)}}return a.memoizedState=[c,n],c},useReducer:function(i,n,a){var c=Ke();if(a!==void 0){var d=a(n);if(Fn){Qs(!0);try{a(n)}finally{Qs(!1)}}}else d=n;return c.memoizedState=c.baseState=d,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:d},c.queue=i,i=i.dispatch=dx.bind(null,xt,i),[c.memoizedState,i]},useRef:function(i){var n=Ke();return i={current:i},n.memoizedState=i},useState:function(i){i=Vh(i);var n=i.queue,a=kg.bind(null,xt,n);return n.dispatch=a,[i.memoizedState,a]},useDebugValue:qh,useDeferredValue:function(i,n){var a=Ke();return Xh(a,i,n)},useTransition:function(){var i=Vh(!1);return i=Rg.bind(null,xt,i.queue,!0,!1),Ke().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,n,a){var c=xt,d=Ke();if(kt){if(a===void 0)throw Error(s(407));a=a()}else{if(a=n(),Xt===null)throw Error(s(349));(Bt&127)!==0||ng(c,n,a)}d.memoizedState=a;var p={value:a,getSnapshot:n};return d.queue=p,vg(ag.bind(null,c,p,i),[i]),c.flags|=2048,Rr(9,{destroy:void 0},rg.bind(null,c,p,a,n),null),a},useId:function(){var i=Ke(),n=Xt.identifierPrefix;if(kt){var a=$i,c=Ki;a=(c&~(1<<32-yi(c)-1)).toString(32)+a,n="_"+n+"R_"+a,a=al++,0<a&&(n+="H"+a.toString(32)),n+="_"}else a=rx++,n="_"+n+"r_"+a.toString(32)+"_";return i.memoizedState=n},useHostTransitionStatus:Wh,useFormState:gg,useActionState:gg,useOptimistic:function(i){var n=Ke();n.memoizedState=n.baseState=i;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=a,n=Jh.bind(null,xt,!0,a),a.dispatch=n,[i,n]},useMemoCache:Hh,useCacheRefresh:function(){return Ke().memoizedState=ux.bind(null,xt)},useEffectEvent:function(i){var n=Ke(),a={impl:i};return n.memoizedState=a,function(){if((Nt&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}},Kh={readContext:Oe,use:ll,useCallback:Tg,useContext:Oe,useEffect:jh,useImperativeHandle:Sg,useInsertionEffect:bg,useLayoutEffect:wg,useMemo:Eg,useReducer:cl,useRef:Ag,useState:function(){return cl(xs)},useDebugValue:qh,useDeferredValue:function(i,n){var a=pe();return Dg(a,Vt.memoizedState,i,n)},useTransition:function(){var i=cl(xs)[0],n=pe().memoizedState;return[typeof i=="boolean"?i:Ra(i),n]},useSyncExternalStore:sg,useId:Bg,useHostTransitionStatus:Wh,useFormState:_g,useActionState:_g,useOptimistic:function(i,n){var a=pe();return cg(a,Vt,i,n)},useMemoCache:Hh,useCacheRefresh:Ig};Kh.useEffectEvent=xg;var Lg={readContext:Oe,use:ll,useCallback:Tg,useContext:Oe,useEffect:jh,useImperativeHandle:Sg,useInsertionEffect:bg,useLayoutEffect:wg,useMemo:Eg,useReducer:Qh,useRef:Ag,useState:function(){return Qh(xs)},useDebugValue:qh,useDeferredValue:function(i,n){var a=pe();return Vt===null?Xh(a,i,n):Dg(a,Vt.memoizedState,i,n)},useTransition:function(){var i=Qh(xs)[0],n=pe().memoizedState;return[typeof i=="boolean"?i:Ra(i),n]},useSyncExternalStore:sg,useId:Bg,useHostTransitionStatus:Wh,useFormState:yg,useActionState:yg,useOptimistic:function(i,n){var a=pe();return Vt!==null?cg(a,Vt,i,n):(a.baseState=i,[i,a.queue.dispatch])},useMemoCache:Hh,useCacheRefresh:Ig};Lg.useEffectEvent=xg;function $h(i,n,a,c){n=i.memoizedState,a=a(c,n),a=a==null?n:y({},n,a),i.memoizedState=a,i.lanes===0&&(i.updateQueue.baseState=a)}var tu={enqueueSetState:function(i,n,a){i=i._reactInternals;var c=Si(),d=Js(c);d.payload=n,a!=null&&(d.callback=a),n=Ks(i,d,c),n!==null&&(ci(n,i,c),Sa(n,i,c))},enqueueReplaceState:function(i,n,a){i=i._reactInternals;var c=Si(),d=Js(c);d.tag=1,d.payload=n,a!=null&&(d.callback=a),n=Ks(i,d,c),n!==null&&(ci(n,i,c),Sa(n,i,c))},enqueueForceUpdate:function(i,n){i=i._reactInternals;var a=Si(),c=Js(a);c.tag=2,n!=null&&(c.callback=n),n=Ks(i,c,a),n!==null&&(ci(n,i,a),Sa(n,i,a))}};function Fg(i,n,a,c,d,p,m){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(c,p,m):n.prototype&&n.prototype.isPureReactComponent?!ma(a,c)||!ma(d,p):!0}function Ng(i,n,a,c){i=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,c),n.state!==i&&tu.enqueueReplaceState(n,n.state,null)}function Nn(i,n){var a=n;if("ref"in n){a={};for(var c in n)c!=="ref"&&(a[c]=n[c])}if(i=i.defaultProps){a===n&&(a=y({},a));for(var d in i)a[d]===void 0&&(a[d]=i[d])}return a}function Hg(i){Vo(i)}function Gg(i){console.error(i)}function Qg(i){Vo(i)}function fl(i,n){try{var a=i.onUncaughtError;a(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function Vg(i,n,a){try{var c=i.onCaughtError;c(a.value,{componentStack:a.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function eu(i,n,a){return a=Js(a),a.tag=3,a.payload={element:null},a.callback=function(){fl(i,n)},a}function Yg(i){return i=Js(i),i.tag=3,i}function jg(i,n,a,c){var d=a.type.getDerivedStateFromError;if(typeof d=="function"){var p=c.value;i.payload=function(){return d(p)},i.callback=function(){Vg(n,a,c)}}var m=a.stateNode;m!==null&&typeof m.componentDidCatch=="function"&&(i.callback=function(){Vg(n,a,c),typeof d!="function"&&(rn===null?rn=new Set([this]):rn.add(this));var v=c.stack;this.componentDidCatch(c.value,{componentStack:v!==null?v:""})})}function fx(i,n,a,c,d){if(a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=a.alternate,n!==null&&xr(n,a,d,!0),a=xi.current,a!==null){switch(a.tag){case 31:case 13:return Ui===null?Sl():a.alternate===null&&oe===0&&(oe=3),a.flags&=-257,a.flags|=65536,a.lanes=d,c===tl?a.flags|=16384:(n=a.updateQueue,n===null?a.updateQueue=new Set([c]):n.add(c),Tu(i,c,d)),!1;case 22:return a.flags|=65536,c===tl?a.flags|=16384:(n=a.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},a.updateQueue=n):(a=n.retryQueue,a===null?n.retryQueue=new Set([c]):a.add(c)),Tu(i,c,d)),!1}throw Error(s(435,a.tag))}return Tu(i,c,d),Sl(),!1}if(kt)return n=xi.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=d,c!==vh&&(i=Error(s(422),{cause:c}),va(Ii(i,a)))):(c!==vh&&(n=Error(s(423),{cause:c}),va(Ii(n,a))),i=i.current.alternate,i.flags|=65536,d&=-d,i.lanes|=d,c=Ii(c,a),d=eu(i.stateNode,c,d),Ph(i,d),oe!==4&&(oe=2)),!1;var p=Error(s(520),{cause:c});if(p=Ii(p,a),Fa===null?Fa=[p]:Fa.push(p),oe!==4&&(oe=2),n===null)return!0;c=Ii(c,a),a=n;do{switch(a.tag){case 3:return a.flags|=65536,i=d&-d,a.lanes|=i,i=eu(a.stateNode,c,i),Ph(a,i),!1;case 1:if(n=a.type,p=a.stateNode,(a.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(rn===null||!rn.has(p))))return a.flags|=65536,d&=-d,a.lanes|=d,d=Yg(d),jg(d,i,a,c),Ph(a,d),!1}a=a.return}while(a!==null);return!1}var iu=Error(s(461)),xe=!1;function Ue(i,n,a,c){n.child=i===null?Wp(n,null,a,c):Ln(n,i.child,a,c)}function qg(i,n,a,c,d){a=a.render;var p=n.ref;if("ref"in c){var m={};for(var v in c)v!=="ref"&&(m[v]=c[v])}else m=c;return kn(n),c=Uh(i,n,a,m,p,d),v=Lh(),i!==null&&!xe?(Fh(i,n,d),bs(i,n,d)):(kt&&v&&yh(n),n.flags|=1,Ue(i,n,c,d),n.child)}function Xg(i,n,a,c,d){if(i===null){var p=a.type;return typeof p=="function"&&!gh(p)&&p.defaultProps===void 0&&a.compare===null?(n.tag=15,n.type=p,Zg(i,n,p,c,d)):(i=Xo(a.type,null,c,n,n.mode,d),i.ref=n.ref,i.return=n,n.child=i)}if(p=i.child,!hu(i,d)){var m=p.memoizedProps;if(a=a.compare,a=a!==null?a:ma,a(m,c)&&i.ref===n.ref)return bs(i,n,d)}return n.flags|=1,i=_s(p,c),i.ref=n.ref,i.return=n,n.child=i}function Zg(i,n,a,c,d){if(i!==null){var p=i.memoizedProps;if(ma(p,c)&&i.ref===n.ref)if(xe=!1,n.pendingProps=c=p,hu(i,d))(i.flags&131072)!==0&&(xe=!0);else return n.lanes=i.lanes,bs(i,n,d)}return su(i,n,a,c,d)}function Wg(i,n,a,c){var d=c.children,p=i!==null?i.memoizedState:null;if(i===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(p=p!==null?p.baseLanes|a:a,i!==null){for(c=n.child=i.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;c=d&~p}else c=0,n.child=null;return Jg(i,n,p,a,c)}if((a&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},i!==null&&Ko(n,p!==null?p.cachePool:null),p!==null?$p(n,p):Ih(),tg(n);else return c=n.lanes=536870912,Jg(i,n,p!==null?p.baseLanes|a:a,a,c)}else p!==null?(Ko(n,p.cachePool),$p(n,p),tn(),n.memoizedState=null):(i!==null&&Ko(n,null),Ih(),tn());return Ue(i,n,d,a),n.child}function Ba(i,n){return i!==null&&i.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Jg(i,n,a,c,d){var p=Eh();return p=p===null?null:{parent:Ae._currentValue,pool:p},n.memoizedState={baseLanes:a,cachePool:p},i!==null&&Ko(n,null),Ih(),tg(n),i!==null&&xr(i,n,c,!0),n.childLanes=d,null}function pl(i,n){return n=_l({mode:n.mode,children:n.children},i.mode),n.ref=i.ref,i.child=n,n.return=i,n}function Kg(i,n,a){return Ln(n,i.child,null,a),i=pl(n,n.pendingProps),i.flags|=2,bi(n),n.memoizedState=null,i}function px(i,n,a){var c=n.pendingProps,d=(n.flags&128)!==0;if(n.flags&=-129,i===null){if(kt){if(c.mode==="hidden")return i=pl(n,c),n.lanes=536870912,Ba(null,i);if(zh(n),(i=ee)?(i=hm(i,Oi),i=i!==null&&i.data==="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:js!==null?{id:Ki,overflow:$i}:null,retryLane:536870912,hydrationErrors:null},a=zp(i),a.return=n,n.child=a,ze=n,ee=null)):i=null,i===null)throw Xs(n);return n.lanes=536870912,null}return pl(n,c)}var p=i.memoizedState;if(p!==null){var m=p.dehydrated;if(zh(n),d)if(n.flags&256)n.flags&=-257,n=Kg(i,n,a);else if(n.memoizedState!==null)n.child=i.child,n.flags|=128,n=null;else throw Error(s(558));else if(xe||xr(i,n,a,!1),d=(a&i.childLanes)!==0,xe||d){if(c=Xt,c!==null&&(m=Gf(c,a),m!==0&&m!==p.retryLane))throw p.retryLane=m,Mn(i,m),ci(c,i,m),iu;Sl(),n=Kg(i,n,a)}else i=p.treeContext,ee=Li(m.nextSibling),ze=n,kt=!0,qs=null,Oi=!1,i!==null&&Lp(n,i),n=pl(n,c),n.flags|=4096;return n}return i=_s(i.child,{mode:c.mode,children:c.children}),i.ref=n.ref,n.child=i,i.return=n,i}function gl(i,n){var a=n.ref;if(a===null)i!==null&&i.ref!==null&&(n.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(s(284));(i===null||i.ref!==a)&&(n.flags|=4194816)}}function su(i,n,a,c,d){return kn(n),a=Uh(i,n,a,c,void 0,d),c=Lh(),i!==null&&!xe?(Fh(i,n,d),bs(i,n,d)):(kt&&c&&yh(n),n.flags|=1,Ue(i,n,a,d),n.child)}function $g(i,n,a,c,d,p){return kn(n),n.updateQueue=null,a=ig(n,c,a,d),eg(i),c=Lh(),i!==null&&!xe?(Fh(i,n,p),bs(i,n,p)):(kt&&c&&yh(n),n.flags|=1,Ue(i,n,a,p),n.child)}function t_(i,n,a,c,d){if(kn(n),n.stateNode===null){var p=mr,m=a.contextType;typeof m=="object"&&m!==null&&(p=Oe(m)),p=new a(c,p),n.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=tu,n.stateNode=p,p._reactInternals=n,p=n.stateNode,p.props=c,p.state=n.memoizedState,p.refs={},Rh(n),m=a.contextType,p.context=typeof m=="object"&&m!==null?Oe(m):mr,p.state=n.memoizedState,m=a.getDerivedStateFromProps,typeof m=="function"&&($h(n,a,m,c),p.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(m=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),m!==p.state&&tu.enqueueReplaceState(p,p.state,null),Ea(n,c,p,d),Ta(),p.state=n.memoizedState),typeof p.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(i===null){p=n.stateNode;var v=n.memoizedProps,T=Nn(a,v);p.props=T;var N=p.context,j=a.contextType;m=mr,typeof j=="object"&&j!==null&&(m=Oe(j));var J=a.getDerivedStateFromProps;j=typeof J=="function"||typeof p.getSnapshotBeforeUpdate=="function",v=n.pendingProps!==v,j||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(v||N!==m)&&Ng(n,p,c,m),Ws=!1;var Q=n.memoizedState;p.state=Q,Ea(n,c,p,d),Ta(),N=n.memoizedState,v||Q!==N||Ws?(typeof J=="function"&&($h(n,a,J,c),N=n.memoizedState),(T=Ws||Fg(n,a,T,c,Q,N,m))?(j||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(n.flags|=4194308)):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=N),p.props=c,p.state=N,p.context=m,c=T):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{p=n.stateNode,Mh(i,n),m=n.memoizedProps,j=Nn(a,m),p.props=j,J=n.pendingProps,Q=p.context,N=a.contextType,T=mr,typeof N=="object"&&N!==null&&(T=Oe(N)),v=a.getDerivedStateFromProps,(N=typeof v=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(m!==J||Q!==T)&&Ng(n,p,c,T),Ws=!1,Q=n.memoizedState,p.state=Q,Ea(n,c,p,d),Ta();var Y=n.memoizedState;m!==J||Q!==Y||Ws||i!==null&&i.dependencies!==null&&Wo(i.dependencies)?(typeof v=="function"&&($h(n,a,v,c),Y=n.memoizedState),(j=Ws||Fg(n,a,j,c,Q,Y,T)||i!==null&&i.dependencies!==null&&Wo(i.dependencies))?(N||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(c,Y,T),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(c,Y,T)),typeof p.componentDidUpdate=="function"&&(n.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof p.componentDidUpdate!="function"||m===i.memoizedProps&&Q===i.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||m===i.memoizedProps&&Q===i.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=Y),p.props=c,p.state=Y,p.context=T,c=j):(typeof p.componentDidUpdate!="function"||m===i.memoizedProps&&Q===i.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||m===i.memoizedProps&&Q===i.memoizedState||(n.flags|=1024),c=!1)}return p=c,gl(i,n),c=(n.flags&128)!==0,p||c?(p=n.stateNode,a=c&&typeof a.getDerivedStateFromError!="function"?null:p.render(),n.flags|=1,i!==null&&c?(n.child=Ln(n,i.child,null,d),n.child=Ln(n,null,a,d)):Ue(i,n,a,d),n.memoizedState=p.state,i=n.child):i=bs(i,n,d),i}function e_(i,n,a,c){return Bn(),n.flags|=256,Ue(i,n,a,c),n.child}var nu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ru(i){return{baseLanes:i,cachePool:Vp()}}function au(i,n,a){return i=i!==null?i.childLanes&~a:0,n&&(i|=Ci),i}function i_(i,n,a){var c=n.pendingProps,d=!1,p=(n.flags&128)!==0,m;if((m=p)||(m=i!==null&&i.memoizedState===null?!1:(fe.current&2)!==0),m&&(d=!0,n.flags&=-129),m=(n.flags&32)!==0,n.flags&=-33,i===null){if(kt){if(d?$s(n):tn(),(i=ee)?(i=hm(i,Oi),i=i!==null&&i.data!=="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:js!==null?{id:Ki,overflow:$i}:null,retryLane:536870912,hydrationErrors:null},a=zp(i),a.return=n,n.child=a,ze=n,ee=null)):i=null,i===null)throw Xs(n);return Gu(i)?n.lanes=32:n.lanes=536870912,null}var v=c.children;return c=c.fallback,d?(tn(),d=n.mode,v=_l({mode:"hidden",children:v},d),c=Pn(c,d,a,null),v.return=n,c.return=n,v.sibling=c,n.child=v,c=n.child,c.memoizedState=ru(a),c.childLanes=au(i,m,a),n.memoizedState=nu,Ba(null,c)):($s(n),ou(n,v))}var T=i.memoizedState;if(T!==null&&(v=T.dehydrated,v!==null)){if(p)n.flags&256?($s(n),n.flags&=-257,n=lu(i,n,a)):n.memoizedState!==null?(tn(),n.child=i.child,n.flags|=128,n=null):(tn(),v=c.fallback,d=n.mode,c=_l({mode:"visible",children:c.children},d),v=Pn(v,d,a,null),v.flags|=2,c.return=n,v.return=n,c.sibling=v,n.child=c,Ln(n,i.child,null,a),c=n.child,c.memoizedState=ru(a),c.childLanes=au(i,m,a),n.memoizedState=nu,n=Ba(null,c));else if($s(n),Gu(v)){if(m=v.nextSibling&&v.nextSibling.dataset,m)var N=m.dgst;m=N,c=Error(s(419)),c.stack="",c.digest=m,va({value:c,source:null,stack:null}),n=lu(i,n,a)}else if(xe||xr(i,n,a,!1),m=(a&i.childLanes)!==0,xe||m){if(m=Xt,m!==null&&(c=Gf(m,a),c!==0&&c!==T.retryLane))throw T.retryLane=c,Mn(i,c),ci(m,i,c),iu;Hu(v)||Sl(),n=lu(i,n,a)}else Hu(v)?(n.flags|=192,n.child=i.child,n=null):(i=T.treeContext,ee=Li(v.nextSibling),ze=n,kt=!0,qs=null,Oi=!1,i!==null&&Lp(n,i),n=ou(n,c.children),n.flags|=4096);return n}return d?(tn(),v=c.fallback,d=n.mode,T=i.child,N=T.sibling,c=_s(T,{mode:"hidden",children:c.children}),c.subtreeFlags=T.subtreeFlags&65011712,N!==null?v=_s(N,v):(v=Pn(v,d,a,null),v.flags|=2),v.return=n,c.return=n,c.sibling=v,n.child=c,Ba(null,c),c=n.child,v=i.child.memoizedState,v===null?v=ru(a):(d=v.cachePool,d!==null?(T=Ae._currentValue,d=d.parent!==T?{parent:T,pool:T}:d):d=Vp(),v={baseLanes:v.baseLanes|a,cachePool:d}),c.memoizedState=v,c.childLanes=au(i,m,a),n.memoizedState=nu,Ba(i.child,c)):($s(n),a=i.child,i=a.sibling,a=_s(a,{mode:"visible",children:c.children}),a.return=n,a.sibling=null,i!==null&&(m=n.deletions,m===null?(n.deletions=[i],n.flags|=16):m.push(i)),n.child=a,n.memoizedState=null,a)}function ou(i,n){return n=_l({mode:"visible",children:n},i.mode),n.return=i,i.child=n}function _l(i,n){return i=vi(22,i,null,n),i.lanes=0,i}function lu(i,n,a){return Ln(n,i.child,null,a),i=ou(n,n.pendingProps.children),i.flags|=2,n.memoizedState=null,i}function s_(i,n,a){i.lanes|=n;var c=i.alternate;c!==null&&(c.lanes|=n),wh(i.return,n,a)}function cu(i,n,a,c,d,p){var m=i.memoizedState;m===null?i.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:d,treeForkCount:p}:(m.isBackwards=n,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=a,m.tailMode=d,m.treeForkCount=p)}function n_(i,n,a){var c=n.pendingProps,d=c.revealOrder,p=c.tail;c=c.children;var m=fe.current,v=(m&2)!==0;if(v?(m=m&1|2,n.flags|=128):m&=1,st(fe,m),Ue(i,n,c,a),c=kt?Aa:0,!v&&i!==null&&(i.flags&128)!==0)t:for(i=n.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&s_(i,a,n);else if(i.tag===19)s_(i,a,n);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break t;for(;i.sibling===null;){if(i.return===null||i.return===n)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(d){case"forwards":for(a=n.child,d=null;a!==null;)i=a.alternate,i!==null&&nl(i)===null&&(d=a),a=a.sibling;a=d,a===null?(d=n.child,n.child=null):(d=a.sibling,a.sibling=null),cu(n,!1,d,a,p,c);break;case"backwards":case"unstable_legacy-backwards":for(a=null,d=n.child,n.child=null;d!==null;){if(i=d.alternate,i!==null&&nl(i)===null){n.child=d;break}i=d.sibling,d.sibling=a,a=d,d=i}cu(n,!0,a,null,p,c);break;case"together":cu(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function bs(i,n,a){if(i!==null&&(n.dependencies=i.dependencies),nn|=n.lanes,(a&n.childLanes)===0)if(i!==null){if(xr(i,n,a,!1),(a&n.childLanes)===0)return null}else return null;if(i!==null&&n.child!==i.child)throw Error(s(153));if(n.child!==null){for(i=n.child,a=_s(i,i.pendingProps),n.child=a,a.return=n;i.sibling!==null;)i=i.sibling,a=a.sibling=_s(i,i.pendingProps),a.return=n;a.sibling=null}return n.child}function hu(i,n){return(i.lanes&n)!==0?!0:(i=i.dependencies,!!(i!==null&&Wo(i)))}function gx(i,n,a){switch(n.tag){case 3:Je(n,n.stateNode.containerInfo),Zs(n,Ae,i.memoizedState.cache),Bn();break;case 27:case 5:na(n);break;case 4:Je(n,n.stateNode.containerInfo);break;case 10:Zs(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,zh(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?($s(n),n.flags|=128,null):(a&n.child.childLanes)!==0?i_(i,n,a):($s(n),i=bs(i,n,a),i!==null?i.sibling:null);$s(n);break;case 19:var d=(i.flags&128)!==0;if(c=(a&n.childLanes)!==0,c||(xr(i,n,a,!1),c=(a&n.childLanes)!==0),d){if(c)return n_(i,n,a);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),st(fe,fe.current),c)break;return null;case 22:return n.lanes=0,Wg(i,n,a,n.pendingProps);case 24:Zs(n,Ae,i.memoizedState.cache)}return bs(i,n,a)}function r_(i,n,a){if(i!==null)if(i.memoizedProps!==n.pendingProps)xe=!0;else{if(!hu(i,a)&&(n.flags&128)===0)return xe=!1,gx(i,n,a);xe=(i.flags&131072)!==0}else xe=!1,kt&&(n.flags&1048576)!==0&&Up(n,Aa,n.index);switch(n.lanes=0,n.tag){case 16:t:{var c=n.pendingProps;if(i=On(n.elementType),n.type=i,typeof i=="function")gh(i)?(c=Nn(i,c),n.tag=1,n=t_(null,n,i,c,a)):(n.tag=0,n=su(null,n,i,c,a));else{if(i!=null){var d=i.$$typeof;if(d===G){n.tag=11,n=qg(null,n,i,c,a);break t}else if(d===k){n.tag=14,n=Xg(null,n,i,c,a);break t}}throw n=K(i)||i,Error(s(306,n,""))}}return n;case 0:return su(i,n,n.type,n.pendingProps,a);case 1:return c=n.type,d=Nn(c,n.pendingProps),t_(i,n,c,d,a);case 3:t:{if(Je(n,n.stateNode.containerInfo),i===null)throw Error(s(387));c=n.pendingProps;var p=n.memoizedState;d=p.element,Mh(i,n),Ea(n,c,null,a);var m=n.memoizedState;if(c=m.cache,Zs(n,Ae,c),c!==p.cache&&Ch(n,[Ae],a,!0),Ta(),c=m.element,p.isDehydrated)if(p={element:c,isDehydrated:!1,cache:m.cache},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){n=e_(i,n,c,a);break t}else if(c!==d){d=Ii(Error(s(424)),n),va(d),n=e_(i,n,c,a);break t}else{switch(i=n.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(ee=Li(i.firstChild),ze=n,kt=!0,qs=null,Oi=!0,a=Wp(n,null,c,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(Bn(),c===d){n=bs(i,n,a);break t}Ue(i,n,c,a)}n=n.child}return n;case 26:return gl(i,n),i===null?(a=_m(n.type,null,n.pendingProps,null))?n.memoizedState=a:kt||(a=n.type,i=n.pendingProps,c=Bl(Ct.current).createElement(a),c[ke]=n,c[si]=i,Le(c,a,i),Re(c),n.stateNode=c):n.memoizedState=_m(n.type,i.memoizedProps,n.pendingProps,i.memoizedState),null;case 27:return na(n),i===null&&kt&&(c=n.stateNode=fm(n.type,n.pendingProps,Ct.current),ze=n,Oi=!0,d=ee,cn(n.type)?(Qu=d,ee=Li(c.firstChild)):ee=d),Ue(i,n,n.pendingProps.children,a),gl(i,n),i===null&&(n.flags|=4194304),n.child;case 5:return i===null&&kt&&((d=c=ee)&&(c=Yx(c,n.type,n.pendingProps,Oi),c!==null?(n.stateNode=c,ze=n,ee=Li(c.firstChild),Oi=!1,d=!0):d=!1),d||Xs(n)),na(n),d=n.type,p=n.pendingProps,m=i!==null?i.memoizedProps:null,c=p.children,Lu(d,p)?c=null:m!==null&&Lu(d,m)&&(n.flags|=32),n.memoizedState!==null&&(d=Uh(i,n,ax,null,null,a),qa._currentValue=d),gl(i,n),Ue(i,n,c,a),n.child;case 6:return i===null&&kt&&((i=a=ee)&&(a=jx(a,n.pendingProps,Oi),a!==null?(n.stateNode=a,ze=n,ee=null,i=!0):i=!1),i||Xs(n)),null;case 13:return i_(i,n,a);case 4:return Je(n,n.stateNode.containerInfo),c=n.pendingProps,i===null?n.child=Ln(n,null,c,a):Ue(i,n,c,a),n.child;case 11:return qg(i,n,n.type,n.pendingProps,a);case 7:return Ue(i,n,n.pendingProps,a),n.child;case 8:return Ue(i,n,n.pendingProps.children,a),n.child;case 12:return Ue(i,n,n.pendingProps.children,a),n.child;case 10:return c=n.pendingProps,Zs(n,n.type,c.value),Ue(i,n,c.children,a),n.child;case 9:return d=n.type._context,c=n.pendingProps.children,kn(n),d=Oe(d),c=c(d),n.flags|=1,Ue(i,n,c,a),n.child;case 14:return Xg(i,n,n.type,n.pendingProps,a);case 15:return Zg(i,n,n.type,n.pendingProps,a);case 19:return n_(i,n,a);case 31:return px(i,n,a);case 22:return Wg(i,n,a,n.pendingProps);case 24:return kn(n),c=Oe(Ae),i===null?(d=Eh(),d===null&&(d=Xt,p=Sh(),d.pooledCache=p,p.refCount++,p!==null&&(d.pooledCacheLanes|=a),d=p),n.memoizedState={parent:c,cache:d},Rh(n),Zs(n,Ae,d)):((i.lanes&a)!==0&&(Mh(i,n),Ea(n,null,null,a),Ta()),d=i.memoizedState,p=n.memoizedState,d.parent!==c?(d={parent:c,cache:c},n.memoizedState=d,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=d),Zs(n,Ae,c)):(c=p.cache,Zs(n,Ae,c),c!==d.cache&&Ch(n,[Ae],a,!0))),Ue(i,n,n.pendingProps.children,a),n.child;case 29:throw n.pendingProps}throw Error(s(156,n.tag))}function ws(i){i.flags|=4}function uu(i,n,a,c,d){if((n=(i.mode&32)!==0)&&(n=!1),n){if(i.flags|=16777216,(d&335544128)===d)if(i.stateNode.complete)i.flags|=8192;else if(B_())i.flags|=8192;else throw Un=tl,Dh}else i.flags&=-16777217}function a_(i,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!xm(n))if(B_())i.flags|=8192;else throw Un=tl,Dh}function ml(i,n){n!==null&&(i.flags|=4),i.flags&16384&&(n=i.tag!==22?Ff():536870912,i.lanes|=n,Ir|=n)}function Ia(i,n){if(!kt)switch(i.tailMode){case"hidden":n=i.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?i.tail=null:a.sibling=null;break;case"collapsed":a=i.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?n||i.tail===null?i.tail=null:i.tail.sibling=null:c.sibling=null}}function ie(i){var n=i.alternate!==null&&i.alternate.child===i.child,a=0,c=0;if(n)for(var d=i.child;d!==null;)a|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=i,d=d.sibling;else for(d=i.child;d!==null;)a|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=i,d=d.sibling;return i.subtreeFlags|=c,i.childLanes=a,n}function _x(i,n,a){var c=n.pendingProps;switch(Ah(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ie(n),null;case 1:return ie(n),null;case 3:return a=n.stateNode,c=null,i!==null&&(c=i.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),As(Ae),de(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(i===null||i.child===null)&&(vr(n)?ws(n):i===null||i.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,xh())),ie(n),null;case 26:var d=n.type,p=n.memoizedState;return i===null?(ws(n),p!==null?(ie(n),a_(n,p)):(ie(n),uu(n,d,null,c,a))):p?p!==i.memoizedState?(ws(n),ie(n),a_(n,p)):(ie(n),n.flags&=-16777217):(i=i.memoizedProps,i!==c&&ws(n),ie(n),uu(n,d,i,c,a)),null;case 27:if(Do(n),a=Ct.current,d=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&ws(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return ie(n),null}i=ot.current,vr(n)?Fp(n):(i=fm(d,c,a),n.stateNode=i,ws(n))}return ie(n),null;case 5:if(Do(n),d=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&ws(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return ie(n),null}if(p=ot.current,vr(n))Fp(n);else{var m=Bl(Ct.current);switch(p){case 1:p=m.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:p=m.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":p=m.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":p=m.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":p=m.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof c.is=="string"?m.createElement("select",{is:c.is}):m.createElement("select"),c.multiple?p.multiple=!0:c.size&&(p.size=c.size);break;default:p=typeof c.is=="string"?m.createElement(d,{is:c.is}):m.createElement(d)}}p[ke]=n,p[si]=c;t:for(m=n.child;m!==null;){if(m.tag===5||m.tag===6)p.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===n)break t;for(;m.sibling===null;){if(m.return===null||m.return===n)break t;m=m.return}m.sibling.return=m.return,m=m.sibling}n.stateNode=p;t:switch(Le(p,d,c),d){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break t;case"img":c=!0;break t;default:c=!1}c&&ws(n)}}return ie(n),uu(n,n.type,i===null?null:i.memoizedProps,n.pendingProps,a),null;case 6:if(i&&n.stateNode!=null)i.memoizedProps!==c&&ws(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(s(166));if(i=Ct.current,vr(n)){if(i=n.stateNode,a=n.memoizedProps,c=null,d=ze,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}i[ke]=n,i=!!(i.nodeValue===a||c!==null&&c.suppressHydrationWarning===!0||im(i.nodeValue,a)),i||Xs(n,!0)}else i=Bl(i).createTextNode(c),i[ke]=n,n.stateNode=i}return ie(n),null;case 31:if(a=n.memoizedState,i===null||i.memoizedState!==null){if(c=vr(n),a!==null){if(i===null){if(!c)throw Error(s(318));if(i=n.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(557));i[ke]=n}else Bn(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;ie(n),i=!1}else a=xh(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=a),i=!0;if(!i)return n.flags&256?(bi(n),n):(bi(n),null);if((n.flags&128)!==0)throw Error(s(558))}return ie(n),null;case 13:if(c=n.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(d=vr(n),c!==null&&c.dehydrated!==null){if(i===null){if(!d)throw Error(s(318));if(d=n.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));d[ke]=n}else Bn(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;ie(n),d=!1}else d=xh(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=d),d=!0;if(!d)return n.flags&256?(bi(n),n):(bi(n),null)}return bi(n),(n.flags&128)!==0?(n.lanes=a,n):(a=c!==null,i=i!==null&&i.memoizedState!==null,a&&(c=n.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==d&&(c.flags|=2048)),a!==i&&a&&(n.child.flags|=8192),ml(n,n.updateQueue),ie(n),null);case 4:return de(),i===null&&Iu(n.stateNode.containerInfo),ie(n),null;case 10:return As(n.type),ie(n),null;case 19:if(V(fe),c=n.memoizedState,c===null)return ie(n),null;if(d=(n.flags&128)!==0,p=c.rendering,p===null)if(d)Ia(c,!1);else{if(oe!==0||i!==null&&(i.flags&128)!==0)for(i=n.child;i!==null;){if(p=nl(i),p!==null){for(n.flags|=128,Ia(c,!1),i=p.updateQueue,n.updateQueue=i,ml(n,i),n.subtreeFlags=0,i=a,a=n.child;a!==null;)kp(a,i),a=a.sibling;return st(fe,fe.current&1|2),kt&&ms(n,c.treeForkCount),n.child}i=i.sibling}c.tail!==null&&_i()>bl&&(n.flags|=128,d=!0,Ia(c,!1),n.lanes=4194304)}else{if(!d)if(i=nl(p),i!==null){if(n.flags|=128,d=!0,i=i.updateQueue,n.updateQueue=i,ml(n,i),Ia(c,!0),c.tail===null&&c.tailMode==="hidden"&&!p.alternate&&!kt)return ie(n),null}else 2*_i()-c.renderingStartTime>bl&&a!==536870912&&(n.flags|=128,d=!0,Ia(c,!1),n.lanes=4194304);c.isBackwards?(p.sibling=n.child,n.child=p):(i=c.last,i!==null?i.sibling=p:n.child=p,c.last=p)}return c.tail!==null?(i=c.tail,c.rendering=i,c.tail=i.sibling,c.renderingStartTime=_i(),i.sibling=null,a=fe.current,st(fe,d?a&1|2:a&1),kt&&ms(n,c.treeForkCount),i):(ie(n),null);case 22:case 23:return bi(n),kh(),c=n.memoizedState!==null,i!==null?i.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(a&536870912)!==0&&(n.flags&128)===0&&(ie(n),n.subtreeFlags&6&&(n.flags|=8192)):ie(n),a=n.updateQueue,a!==null&&ml(n,a.retryQueue),a=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==a&&(n.flags|=2048),i!==null&&V(zn),null;case 24:return a=null,i!==null&&(a=i.memoizedState.cache),n.memoizedState.cache!==a&&(n.flags|=2048),As(Ae),ie(n),null;case 25:return null;case 30:return null}throw Error(s(156,n.tag))}function mx(i,n){switch(Ah(n),n.tag){case 1:return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 3:return As(Ae),de(),i=n.flags,(i&65536)!==0&&(i&128)===0?(n.flags=i&-65537|128,n):null;case 26:case 27:case 5:return Do(n),null;case 31:if(n.memoizedState!==null){if(bi(n),n.alternate===null)throw Error(s(340));Bn()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 13:if(bi(n),i=n.memoizedState,i!==null&&i.dehydrated!==null){if(n.alternate===null)throw Error(s(340));Bn()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 19:return V(fe),null;case 4:return de(),null;case 10:return As(n.type),null;case 22:case 23:return bi(n),kh(),i!==null&&V(zn),i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 24:return As(Ae),null;case 25:return null;default:return null}}function o_(i,n){switch(Ah(n),n.tag){case 3:As(Ae),de();break;case 26:case 27:case 5:Do(n);break;case 4:de();break;case 31:n.memoizedState!==null&&bi(n);break;case 13:bi(n);break;case 19:V(fe);break;case 10:As(n.type);break;case 22:case 23:bi(n),kh(),i!==null&&V(zn);break;case 24:As(Ae)}}function ka(i,n){try{var a=n.updateQueue,c=a!==null?a.lastEffect:null;if(c!==null){var d=c.next;a=d;do{if((a.tag&i)===i){c=void 0;var p=a.create,m=a.inst;c=p(),m.destroy=c}a=a.next}while(a!==d)}}catch(v){Qt(n,n.return,v)}}function en(i,n,a){try{var c=n.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var p=d.next;c=p;do{if((c.tag&i)===i){var m=c.inst,v=m.destroy;if(v!==void 0){m.destroy=void 0,d=n;var T=a,N=v;try{N()}catch(j){Qt(d,T,j)}}}c=c.next}while(c!==p)}}catch(j){Qt(n,n.return,j)}}function l_(i){var n=i.updateQueue;if(n!==null){var a=i.stateNode;try{Kp(n,a)}catch(c){Qt(i,i.return,c)}}}function c_(i,n,a){a.props=Nn(i.type,i.memoizedProps),a.state=i.memoizedState;try{a.componentWillUnmount()}catch(c){Qt(i,n,c)}}function za(i,n){try{var a=i.ref;if(a!==null){switch(i.tag){case 26:case 27:case 5:var c=i.stateNode;break;case 30:c=i.stateNode;break;default:c=i.stateNode}typeof a=="function"?i.refCleanup=a(c):a.current=c}}catch(d){Qt(i,n,d)}}function ts(i,n){var a=i.ref,c=i.refCleanup;if(a!==null)if(typeof c=="function")try{c()}catch(d){Qt(i,n,d)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(d){Qt(i,n,d)}else a.current=null}function h_(i){var n=i.type,a=i.memoizedProps,c=i.stateNode;try{t:switch(n){case"button":case"input":case"select":case"textarea":a.autoFocus&&c.focus();break t;case"img":a.src?c.src=a.src:a.srcSet&&(c.srcset=a.srcSet)}}catch(d){Qt(i,i.return,d)}}function du(i,n,a){try{var c=i.stateNode;Fx(c,i.type,a,n),c[si]=n}catch(d){Qt(i,i.return,d)}}function u_(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&cn(i.type)||i.tag===4}function fu(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||u_(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&cn(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function pu(i,n,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(i,n):(n=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,n.appendChild(i),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=ps));else if(c!==4&&(c===27&&cn(i.type)&&(a=i.stateNode,n=null),i=i.child,i!==null))for(pu(i,n,a),i=i.sibling;i!==null;)pu(i,n,a),i=i.sibling}function yl(i,n,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?a.insertBefore(i,n):a.appendChild(i);else if(c!==4&&(c===27&&cn(i.type)&&(a=i.stateNode),i=i.child,i!==null))for(yl(i,n,a),i=i.sibling;i!==null;)yl(i,n,a),i=i.sibling}function d_(i){var n=i.stateNode,a=i.memoizedProps;try{for(var c=i.type,d=n.attributes;d.length;)n.removeAttributeNode(d[0]);Le(n,c,a),n[ke]=i,n[si]=a}catch(p){Qt(i,i.return,p)}}var Cs=!1,be=!1,gu=!1,f_=typeof WeakSet=="function"?WeakSet:Set,Me=null;function yx(i,n){if(i=i.containerInfo,Ou=Fl,i=Sp(i),lh(i)){if("selectionStart"in i)var a={start:i.selectionStart,end:i.selectionEnd};else t:{a=(a=i.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var d=c.anchorOffset,p=c.focusNode;c=c.focusOffset;try{a.nodeType,p.nodeType}catch{a=null;break t}var m=0,v=-1,T=-1,N=0,j=0,J=i,Q=null;e:for(;;){for(var Y;J!==a||d!==0&&J.nodeType!==3||(v=m+d),J!==p||c!==0&&J.nodeType!==3||(T=m+c),J.nodeType===3&&(m+=J.nodeValue.length),(Y=J.firstChild)!==null;)Q=J,J=Y;for(;;){if(J===i)break e;if(Q===a&&++N===d&&(v=m),Q===p&&++j===c&&(T=m),(Y=J.nextSibling)!==null)break;J=Q,Q=J.parentNode}J=Y}a=v===-1||T===-1?null:{start:v,end:T}}else a=null}a=a||{start:0,end:0}}else a=null;for(Uu={focusedElem:i,selectionRange:a},Fl=!1,Me=n;Me!==null;)if(n=Me,i=n.child,(n.subtreeFlags&1028)!==0&&i!==null)i.return=n,Me=i;else for(;Me!==null;){switch(n=Me,p=n.alternate,i=n.flags,n.tag){case 0:if((i&4)!==0&&(i=n.updateQueue,i=i!==null?i.events:null,i!==null))for(a=0;a<i.length;a++)d=i[a],d.ref.impl=d.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&p!==null){i=void 0,a=n,d=p.memoizedProps,p=p.memoizedState,c=a.stateNode;try{var lt=Nn(a.type,d);i=c.getSnapshotBeforeUpdate(lt,p),c.__reactInternalSnapshotBeforeUpdate=i}catch(gt){Qt(a,a.return,gt)}}break;case 3:if((i&1024)!==0){if(i=n.stateNode.containerInfo,a=i.nodeType,a===9)Nu(i);else if(a===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Nu(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=n.sibling,i!==null){i.return=n.return,Me=i;break}Me=n.return}}function p_(i,n,a){var c=a.flags;switch(a.tag){case 0:case 11:case 15:Ts(i,a),c&4&&ka(5,a);break;case 1:if(Ts(i,a),c&4)if(i=a.stateNode,n===null)try{i.componentDidMount()}catch(m){Qt(a,a.return,m)}else{var d=Nn(a.type,n.memoizedProps);n=n.memoizedState;try{i.componentDidUpdate(d,n,i.__reactInternalSnapshotBeforeUpdate)}catch(m){Qt(a,a.return,m)}}c&64&&l_(a),c&512&&za(a,a.return);break;case 3:if(Ts(i,a),c&64&&(i=a.updateQueue,i!==null)){if(n=null,a.child!==null)switch(a.child.tag){case 27:case 5:n=a.child.stateNode;break;case 1:n=a.child.stateNode}try{Kp(i,n)}catch(m){Qt(a,a.return,m)}}break;case 27:n===null&&c&4&&d_(a);case 26:case 5:Ts(i,a),n===null&&c&4&&h_(a),c&512&&za(a,a.return);break;case 12:Ts(i,a);break;case 31:Ts(i,a),c&4&&m_(i,a);break;case 13:Ts(i,a),c&4&&y_(i,a),c&64&&(i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(a=Ex.bind(null,a),qx(i,a))));break;case 22:if(c=a.memoizedState!==null||Cs,!c){n=n!==null&&n.memoizedState!==null||be,d=Cs;var p=be;Cs=c,(be=n)&&!p?Es(i,a,(a.subtreeFlags&8772)!==0):Ts(i,a),Cs=d,be=p}break;case 30:break;default:Ts(i,a)}}function g_(i){var n=i.alternate;n!==null&&(i.alternate=null,g_(n)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(n=i.stateNode,n!==null&&Yc(n)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var ne=null,ri=!1;function Ss(i,n,a){for(a=a.child;a!==null;)__(i,n,a),a=a.sibling}function __(i,n,a){if(mi&&typeof mi.onCommitFiberUnmount=="function")try{mi.onCommitFiberUnmount(ra,a)}catch{}switch(a.tag){case 26:be||ts(a,n),Ss(i,n,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:be||ts(a,n);var c=ne,d=ri;cn(a.type)&&(ne=a.stateNode,ri=!1),Ss(i,n,a),Va(a.stateNode),ne=c,ri=d;break;case 5:be||ts(a,n);case 6:if(c=ne,d=ri,ne=null,Ss(i,n,a),ne=c,ri=d,ne!==null)if(ri)try{(ne.nodeType===9?ne.body:ne.nodeName==="HTML"?ne.ownerDocument.body:ne).removeChild(a.stateNode)}catch(p){Qt(a,n,p)}else try{ne.removeChild(a.stateNode)}catch(p){Qt(a,n,p)}break;case 18:ne!==null&&(ri?(i=ne,lm(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,a.stateNode),Hr(i)):lm(ne,a.stateNode));break;case 4:c=ne,d=ri,ne=a.stateNode.containerInfo,ri=!0,Ss(i,n,a),ne=c,ri=d;break;case 0:case 11:case 14:case 15:en(2,a,n),be||en(4,a,n),Ss(i,n,a);break;case 1:be||(ts(a,n),c=a.stateNode,typeof c.componentWillUnmount=="function"&&c_(a,n,c)),Ss(i,n,a);break;case 21:Ss(i,n,a);break;case 22:be=(c=be)||a.memoizedState!==null,Ss(i,n,a),be=c;break;default:Ss(i,n,a)}}function m_(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Hr(i)}catch(a){Qt(n,n.return,a)}}}function y_(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Hr(i)}catch(a){Qt(n,n.return,a)}}function Ax(i){switch(i.tag){case 31:case 13:case 19:var n=i.stateNode;return n===null&&(n=i.stateNode=new f_),n;case 22:return i=i.stateNode,n=i._retryCache,n===null&&(n=i._retryCache=new f_),n;default:throw Error(s(435,i.tag))}}function Al(i,n){var a=Ax(i);n.forEach(function(c){if(!a.has(c)){a.add(c);var d=Dx.bind(null,i,c);c.then(d,d)}})}function ai(i,n){var a=n.deletions;if(a!==null)for(var c=0;c<a.length;c++){var d=a[c],p=i,m=n,v=m;t:for(;v!==null;){switch(v.tag){case 27:if(cn(v.type)){ne=v.stateNode,ri=!1;break t}break;case 5:ne=v.stateNode,ri=!1;break t;case 3:case 4:ne=v.stateNode.containerInfo,ri=!0;break t}v=v.return}if(ne===null)throw Error(s(160));__(p,m,d),ne=null,ri=!1,p=d.alternate,p!==null&&(p.return=null),d.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)A_(n,i),n=n.sibling}var ji=null;function A_(i,n){var a=i.alternate,c=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:ai(n,i),oi(i),c&4&&(en(3,i,i.return),ka(3,i),en(5,i,i.return));break;case 1:ai(n,i),oi(i),c&512&&(be||a===null||ts(a,a.return)),c&64&&Cs&&(i=i.updateQueue,i!==null&&(c=i.callbacks,c!==null&&(a=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=a===null?c:a.concat(c))));break;case 26:var d=ji;if(ai(n,i),oi(i),c&512&&(be||a===null||ts(a,a.return)),c&4){var p=a!==null?a.memoizedState:null;if(c=i.memoizedState,a===null)if(c===null)if(i.stateNode===null){t:{c=i.type,a=i.memoizedProps,d=d.ownerDocument||d;e:switch(c){case"title":p=d.getElementsByTagName("title")[0],(!p||p[la]||p[ke]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=d.createElement(c),d.head.insertBefore(p,d.querySelector("head > title"))),Le(p,c,a),p[ke]=i,Re(p),c=p;break t;case"link":var m=Am("link","href",d).get(c+(a.href||""));if(m){for(var v=0;v<m.length;v++)if(p=m[v],p.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&p.getAttribute("rel")===(a.rel==null?null:a.rel)&&p.getAttribute("title")===(a.title==null?null:a.title)&&p.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){m.splice(v,1);break e}}p=d.createElement(c),Le(p,c,a),d.head.appendChild(p);break;case"meta":if(m=Am("meta","content",d).get(c+(a.content||""))){for(v=0;v<m.length;v++)if(p=m[v],p.getAttribute("content")===(a.content==null?null:""+a.content)&&p.getAttribute("name")===(a.name==null?null:a.name)&&p.getAttribute("property")===(a.property==null?null:a.property)&&p.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&p.getAttribute("charset")===(a.charSet==null?null:a.charSet)){m.splice(v,1);break e}}p=d.createElement(c),Le(p,c,a),d.head.appendChild(p);break;default:throw Error(s(468,c))}p[ke]=i,Re(p),c=p}i.stateNode=c}else vm(d,i.type,i.stateNode);else i.stateNode=ym(d,c,i.memoizedProps);else p!==c?(p===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):p.count--,c===null?vm(d,i.type,i.stateNode):ym(d,c,i.memoizedProps)):c===null&&i.stateNode!==null&&du(i,i.memoizedProps,a.memoizedProps)}break;case 27:ai(n,i),oi(i),c&512&&(be||a===null||ts(a,a.return)),a!==null&&c&4&&du(i,i.memoizedProps,a.memoizedProps);break;case 5:if(ai(n,i),oi(i),c&512&&(be||a===null||ts(a,a.return)),i.flags&32){d=i.stateNode;try{hr(d,"")}catch(lt){Qt(i,i.return,lt)}}c&4&&i.stateNode!=null&&(d=i.memoizedProps,du(i,d,a!==null?a.memoizedProps:d)),c&1024&&(gu=!0);break;case 6:if(ai(n,i),oi(i),c&4){if(i.stateNode===null)throw Error(s(162));c=i.memoizedProps,a=i.stateNode;try{a.nodeValue=c}catch(lt){Qt(i,i.return,lt)}}break;case 3:if(zl=null,d=ji,ji=Il(n.containerInfo),ai(n,i),ji=d,oi(i),c&4&&a!==null&&a.memoizedState.isDehydrated)try{Hr(n.containerInfo)}catch(lt){Qt(i,i.return,lt)}gu&&(gu=!1,v_(i));break;case 4:c=ji,ji=Il(i.stateNode.containerInfo),ai(n,i),oi(i),ji=c;break;case 12:ai(n,i),oi(i);break;case 31:ai(n,i),oi(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,Al(i,c)));break;case 13:ai(n,i),oi(i),i.child.flags&8192&&i.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(xl=_i()),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,Al(i,c)));break;case 22:d=i.memoizedState!==null;var T=a!==null&&a.memoizedState!==null,N=Cs,j=be;if(Cs=N||d,be=j||T,ai(n,i),be=j,Cs=N,oi(i),c&8192)t:for(n=i.stateNode,n._visibility=d?n._visibility&-2:n._visibility|1,d&&(a===null||T||Cs||be||Hn(i)),a=null,n=i;;){if(n.tag===5||n.tag===26){if(a===null){T=a=n;try{if(p=T.stateNode,d)m=p.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none";else{v=T.stateNode;var J=T.memoizedProps.style,Q=J!=null&&J.hasOwnProperty("display")?J.display:null;v.style.display=Q==null||typeof Q=="boolean"?"":(""+Q).trim()}}catch(lt){Qt(T,T.return,lt)}}}else if(n.tag===6){if(a===null){T=n;try{T.stateNode.nodeValue=d?"":T.memoizedProps}catch(lt){Qt(T,T.return,lt)}}}else if(n.tag===18){if(a===null){T=n;try{var Y=T.stateNode;d?cm(Y,!0):cm(T.stateNode,!1)}catch(lt){Qt(T,T.return,lt)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===i)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break t;for(;n.sibling===null;){if(n.return===null||n.return===i)break t;a===n&&(a=null),n=n.return}a===n&&(a=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=i.updateQueue,c!==null&&(a=c.retryQueue,a!==null&&(c.retryQueue=null,Al(i,a))));break;case 19:ai(n,i),oi(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,Al(i,c)));break;case 30:break;case 21:break;default:ai(n,i),oi(i)}}function oi(i){var n=i.flags;if(n&2){try{for(var a,c=i.return;c!==null;){if(u_(c)){a=c;break}c=c.return}if(a==null)throw Error(s(160));switch(a.tag){case 27:var d=a.stateNode,p=fu(i);yl(i,p,d);break;case 5:var m=a.stateNode;a.flags&32&&(hr(m,""),a.flags&=-33);var v=fu(i);yl(i,v,m);break;case 3:case 4:var T=a.stateNode.containerInfo,N=fu(i);pu(i,N,T);break;default:throw Error(s(161))}}catch(j){Qt(i,i.return,j)}i.flags&=-3}n&4096&&(i.flags&=-4097)}function v_(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var n=i;v_(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),i=i.sibling}}function Ts(i,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)p_(i,n.alternate,n),n=n.sibling}function Hn(i){for(i=i.child;i!==null;){var n=i;switch(n.tag){case 0:case 11:case 14:case 15:en(4,n,n.return),Hn(n);break;case 1:ts(n,n.return);var a=n.stateNode;typeof a.componentWillUnmount=="function"&&c_(n,n.return,a),Hn(n);break;case 27:Va(n.stateNode);case 26:case 5:ts(n,n.return),Hn(n);break;case 22:n.memoizedState===null&&Hn(n);break;case 30:Hn(n);break;default:Hn(n)}i=i.sibling}}function Es(i,n,a){for(a=a&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,d=i,p=n,m=p.flags;switch(p.tag){case 0:case 11:case 15:Es(d,p,a),ka(4,p);break;case 1:if(Es(d,p,a),c=p,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(N){Qt(c,c.return,N)}if(c=p,d=c.updateQueue,d!==null){var v=c.stateNode;try{var T=d.shared.hiddenCallbacks;if(T!==null)for(d.shared.hiddenCallbacks=null,d=0;d<T.length;d++)Jp(T[d],v)}catch(N){Qt(c,c.return,N)}}a&&m&64&&l_(p),za(p,p.return);break;case 27:d_(p);case 26:case 5:Es(d,p,a),a&&c===null&&m&4&&h_(p),za(p,p.return);break;case 12:Es(d,p,a);break;case 31:Es(d,p,a),a&&m&4&&m_(d,p);break;case 13:Es(d,p,a),a&&m&4&&y_(d,p);break;case 22:p.memoizedState===null&&Es(d,p,a),za(p,p.return);break;case 30:break;default:Es(d,p,a)}n=n.sibling}}function _u(i,n){var a=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),i=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(i=n.memoizedState.cachePool.pool),i!==a&&(i!=null&&i.refCount++,a!=null&&xa(a))}function mu(i,n){i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&xa(i))}function qi(i,n,a,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)x_(i,n,a,c),n=n.sibling}function x_(i,n,a,c){var d=n.flags;switch(n.tag){case 0:case 11:case 15:qi(i,n,a,c),d&2048&&ka(9,n);break;case 1:qi(i,n,a,c);break;case 3:qi(i,n,a,c),d&2048&&(i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&xa(i)));break;case 12:if(d&2048){qi(i,n,a,c),i=n.stateNode;try{var p=n.memoizedProps,m=p.id,v=p.onPostCommit;typeof v=="function"&&v(m,n.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(T){Qt(n,n.return,T)}}else qi(i,n,a,c);break;case 31:qi(i,n,a,c);break;case 13:qi(i,n,a,c);break;case 23:break;case 22:p=n.stateNode,m=n.alternate,n.memoizedState!==null?p._visibility&2?qi(i,n,a,c):Oa(i,n):p._visibility&2?qi(i,n,a,c):(p._visibility|=2,Mr(i,n,a,c,(n.subtreeFlags&10256)!==0||!1)),d&2048&&_u(m,n);break;case 24:qi(i,n,a,c),d&2048&&mu(n.alternate,n);break;default:qi(i,n,a,c)}}function Mr(i,n,a,c,d){for(d=d&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var p=i,m=n,v=a,T=c,N=m.flags;switch(m.tag){case 0:case 11:case 15:Mr(p,m,v,T,d),ka(8,m);break;case 23:break;case 22:var j=m.stateNode;m.memoizedState!==null?j._visibility&2?Mr(p,m,v,T,d):Oa(p,m):(j._visibility|=2,Mr(p,m,v,T,d)),d&&N&2048&&_u(m.alternate,m);break;case 24:Mr(p,m,v,T,d),d&&N&2048&&mu(m.alternate,m);break;default:Mr(p,m,v,T,d)}n=n.sibling}}function Oa(i,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var a=i,c=n,d=c.flags;switch(c.tag){case 22:Oa(a,c),d&2048&&_u(c.alternate,c);break;case 24:Oa(a,c),d&2048&&mu(c.alternate,c);break;default:Oa(a,c)}n=n.sibling}}var Ua=8192;function Pr(i,n,a){if(i.subtreeFlags&Ua)for(i=i.child;i!==null;)b_(i,n,a),i=i.sibling}function b_(i,n,a){switch(i.tag){case 26:Pr(i,n,a),i.flags&Ua&&i.memoizedState!==null&&rb(a,ji,i.memoizedState,i.memoizedProps);break;case 5:Pr(i,n,a);break;case 3:case 4:var c=ji;ji=Il(i.stateNode.containerInfo),Pr(i,n,a),ji=c;break;case 22:i.memoizedState===null&&(c=i.alternate,c!==null&&c.memoizedState!==null?(c=Ua,Ua=16777216,Pr(i,n,a),Ua=c):Pr(i,n,a));break;default:Pr(i,n,a)}}function w_(i){var n=i.alternate;if(n!==null&&(i=n.child,i!==null)){n.child=null;do n=i.sibling,i.sibling=null,i=n;while(i!==null)}}function La(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var c=n[a];Me=c,S_(c,i)}w_(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)C_(i),i=i.sibling}function C_(i){switch(i.tag){case 0:case 11:case 15:La(i),i.flags&2048&&en(9,i,i.return);break;case 3:La(i);break;case 12:La(i);break;case 22:var n=i.stateNode;i.memoizedState!==null&&n._visibility&2&&(i.return===null||i.return.tag!==13)?(n._visibility&=-3,vl(i)):La(i);break;default:La(i)}}function vl(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var c=n[a];Me=c,S_(c,i)}w_(i)}for(i=i.child;i!==null;){switch(n=i,n.tag){case 0:case 11:case 15:en(8,n,n.return),vl(n);break;case 22:a=n.stateNode,a._visibility&2&&(a._visibility&=-3,vl(n));break;default:vl(n)}i=i.sibling}}function S_(i,n){for(;Me!==null;){var a=Me;switch(a.tag){case 0:case 11:case 15:en(8,a,n);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var c=a.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:xa(a.memoizedState.cache)}if(c=a.child,c!==null)c.return=a,Me=c;else t:for(a=i;Me!==null;){c=Me;var d=c.sibling,p=c.return;if(g_(c),c===a){Me=null;break t}if(d!==null){d.return=p,Me=d;break t}Me=p}}}var vx={getCacheForType:function(i){var n=Oe(Ae),a=n.data.get(i);return a===void 0&&(a=i(),n.data.set(i,a)),a},cacheSignal:function(){return Oe(Ae).controller.signal}},xx=typeof WeakMap=="function"?WeakMap:Map,Nt=0,Xt=null,Rt=null,Bt=0,Gt=0,wi=null,sn=!1,Br=!1,yu=!1,Ds=0,oe=0,nn=0,Gn=0,Au=0,Ci=0,Ir=0,Fa=null,li=null,vu=!1,xl=0,T_=0,bl=1/0,wl=null,rn=null,Te=0,an=null,kr=null,Rs=0,xu=0,bu=null,E_=null,Na=0,wu=null;function Si(){return(Nt&2)!==0&&Bt!==0?Bt&-Bt:E.T!==null?Ru():Qf()}function D_(){if(Ci===0)if((Bt&536870912)===0||kt){var i=Po;Po<<=1,(Po&3932160)===0&&(Po=262144),Ci=i}else Ci=536870912;return i=xi.current,i!==null&&(i.flags|=32),Ci}function ci(i,n,a){(i===Xt&&(Gt===2||Gt===9)||i.cancelPendingCommit!==null)&&(zr(i,0),on(i,Bt,Ci,!1)),oa(i,a),((Nt&2)===0||i!==Xt)&&(i===Xt&&((Nt&2)===0&&(Gn|=a),oe===4&&on(i,Bt,Ci,!1)),es(i))}function R_(i,n,a){if((Nt&6)!==0)throw Error(s(327));var c=!a&&(n&127)===0&&(n&i.expiredLanes)===0||aa(i,n),d=c?Cx(i,n):Su(i,n,!0),p=c;do{if(d===0){Br&&!c&&on(i,n,0,!1);break}else{if(a=i.current.alternate,p&&!bx(a)){d=Su(i,n,!1),p=!1;continue}if(d===2){if(p=n,i.errorRecoveryDisabledLanes&p)var m=0;else m=i.pendingLanes&-536870913,m=m!==0?m:m&536870912?536870912:0;if(m!==0){n=m;t:{var v=i;d=Fa;var T=v.current.memoizedState.isDehydrated;if(T&&(zr(v,m).flags|=256),m=Su(v,m,!1),m!==2){if(yu&&!T){v.errorRecoveryDisabledLanes|=p,Gn|=p,d=4;break t}p=li,li=d,p!==null&&(li===null?li=p:li.push.apply(li,p))}d=m}if(p=!1,d!==2)continue}}if(d===1){zr(i,0),on(i,n,0,!0);break}t:{switch(c=i,p=d,p){case 0:case 1:throw Error(s(345));case 4:if((n&4194048)!==n)break;case 6:on(c,n,Ci,!sn);break t;case 2:li=null;break;case 3:case 5:break;default:throw Error(s(329))}if((n&62914560)===n&&(d=xl+300-_i(),10<d)){if(on(c,n,Ci,!sn),Io(c,0,!0)!==0)break t;Rs=n,c.timeoutHandle=am(M_.bind(null,c,a,li,wl,vu,n,Ci,Gn,Ir,sn,p,"Throttled",-0,0),d);break t}M_(c,a,li,wl,vu,n,Ci,Gn,Ir,sn,p,null,-0,0)}}break}while(!0);es(i)}function M_(i,n,a,c,d,p,m,v,T,N,j,J,Q,Y){if(i.timeoutHandle=-1,J=n.subtreeFlags,J&8192||(J&16785408)===16785408){J={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ps},b_(n,p,J);var lt=(p&62914560)===p?xl-_i():(p&4194048)===p?T_-_i():0;if(lt=ab(J,lt),lt!==null){Rs=p,i.cancelPendingCommit=lt(L_.bind(null,i,n,p,a,c,d,m,v,T,j,J,null,Q,Y)),on(i,p,m,!N);return}}L_(i,n,p,a,c,d,m,v,T)}function bx(i){for(var n=i;;){var a=n.tag;if((a===0||a===11||a===15)&&n.flags&16384&&(a=n.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var c=0;c<a.length;c++){var d=a[c],p=d.getSnapshot;d=d.value;try{if(!Ai(p(),d))return!1}catch{return!1}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function on(i,n,a,c){n&=~Au,n&=~Gn,i.suspendedLanes|=n,i.pingedLanes&=~n,c&&(i.warmLanes|=n),c=i.expirationTimes;for(var d=n;0<d;){var p=31-yi(d),m=1<<p;c[p]=-1,d&=~m}a!==0&&Nf(i,a,n)}function Cl(){return(Nt&6)===0?(Ha(0),!1):!0}function Cu(){if(Rt!==null){if(Gt===0)var i=Rt.return;else i=Rt,ys=In=null,Nh(i),Sr=null,wa=0,i=Rt;for(;i!==null;)o_(i.alternate,i),i=i.return;Rt=null}}function zr(i,n){var a=i.timeoutHandle;a!==-1&&(i.timeoutHandle=-1,Gx(a)),a=i.cancelPendingCommit,a!==null&&(i.cancelPendingCommit=null,a()),Rs=0,Cu(),Xt=i,Rt=a=_s(i.current,null),Bt=n,Gt=0,wi=null,sn=!1,Br=aa(i,n),yu=!1,Ir=Ci=Au=Gn=nn=oe=0,li=Fa=null,vu=!1,(n&8)!==0&&(n|=n&32);var c=i.entangledLanes;if(c!==0)for(i=i.entanglements,c&=n;0<c;){var d=31-yi(c),p=1<<d;n|=i[d],c&=~p}return Ds=n,Yo(),a}function P_(i,n){xt=null,E.H=Pa,n===Cr||n===$o?(n=qp(),Gt=3):n===Dh?(n=qp(),Gt=4):Gt=n===iu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,wi=n,Rt===null&&(oe=1,fl(i,Ii(n,i.current)))}function B_(){var i=xi.current;return i===null?!0:(Bt&4194048)===Bt?Ui===null:(Bt&62914560)===Bt||(Bt&536870912)!==0?i===Ui:!1}function I_(){var i=E.H;return E.H=Pa,i===null?Pa:i}function k_(){var i=E.A;return E.A=vx,i}function Sl(){oe=4,sn||(Bt&4194048)!==Bt&&xi.current!==null||(Br=!0),(nn&134217727)===0&&(Gn&134217727)===0||Xt===null||on(Xt,Bt,Ci,!1)}function Su(i,n,a){var c=Nt;Nt|=2;var d=I_(),p=k_();(Xt!==i||Bt!==n)&&(wl=null,zr(i,n)),n=!1;var m=oe;t:do try{if(Gt!==0&&Rt!==null){var v=Rt,T=wi;switch(Gt){case 8:Cu(),m=6;break t;case 3:case 2:case 9:case 6:xi.current===null&&(n=!0);var N=Gt;if(Gt=0,wi=null,Or(i,v,T,N),a&&Br){m=0;break t}break;default:N=Gt,Gt=0,wi=null,Or(i,v,T,N)}}wx(),m=oe;break}catch(j){P_(i,j)}while(!0);return n&&i.shellSuspendCounter++,ys=In=null,Nt=c,E.H=d,E.A=p,Rt===null&&(Xt=null,Bt=0,Yo()),m}function wx(){for(;Rt!==null;)z_(Rt)}function Cx(i,n){var a=Nt;Nt|=2;var c=I_(),d=k_();Xt!==i||Bt!==n?(wl=null,bl=_i()+500,zr(i,n)):Br=aa(i,n);t:do try{if(Gt!==0&&Rt!==null){n=Rt;var p=wi;e:switch(Gt){case 1:Gt=0,wi=null,Or(i,n,p,1);break;case 2:case 9:if(Yp(p)){Gt=0,wi=null,O_(n);break}n=function(){Gt!==2&&Gt!==9||Xt!==i||(Gt=7),es(i)},p.then(n,n);break t;case 3:Gt=7;break t;case 4:Gt=5;break t;case 7:Yp(p)?(Gt=0,wi=null,O_(n)):(Gt=0,wi=null,Or(i,n,p,7));break;case 5:var m=null;switch(Rt.tag){case 26:m=Rt.memoizedState;case 5:case 27:var v=Rt;if(m?xm(m):v.stateNode.complete){Gt=0,wi=null;var T=v.sibling;if(T!==null)Rt=T;else{var N=v.return;N!==null?(Rt=N,Tl(N)):Rt=null}break e}}Gt=0,wi=null,Or(i,n,p,5);break;case 6:Gt=0,wi=null,Or(i,n,p,6);break;case 8:Cu(),oe=6;break t;default:throw Error(s(462))}}Sx();break}catch(j){P_(i,j)}while(!0);return ys=In=null,E.H=c,E.A=d,Nt=a,Rt!==null?0:(Xt=null,Bt=0,Yo(),oe)}function Sx(){for(;Rt!==null&&!XA();)z_(Rt)}function z_(i){var n=r_(i.alternate,i,Ds);i.memoizedProps=i.pendingProps,n===null?Tl(i):Rt=n}function O_(i){var n=i,a=n.alternate;switch(n.tag){case 15:case 0:n=$g(a,n,n.pendingProps,n.type,void 0,Bt);break;case 11:n=$g(a,n,n.pendingProps,n.type.render,n.ref,Bt);break;case 5:Nh(n);default:o_(a,n),n=Rt=kp(n,Ds),n=r_(a,n,Ds)}i.memoizedProps=i.pendingProps,n===null?Tl(i):Rt=n}function Or(i,n,a,c){ys=In=null,Nh(n),Sr=null,wa=0;var d=n.return;try{if(fx(i,d,n,a,Bt)){oe=1,fl(i,Ii(a,i.current)),Rt=null;return}}catch(p){if(d!==null)throw Rt=d,p;oe=1,fl(i,Ii(a,i.current)),Rt=null;return}n.flags&32768?(kt||c===1?i=!0:Br||(Bt&536870912)!==0?i=!1:(sn=i=!0,(c===2||c===9||c===3||c===6)&&(c=xi.current,c!==null&&c.tag===13&&(c.flags|=16384))),U_(n,i)):Tl(n)}function Tl(i){var n=i;do{if((n.flags&32768)!==0){U_(n,sn);return}i=n.return;var a=_x(n.alternate,n,Ds);if(a!==null){Rt=a;return}if(n=n.sibling,n!==null){Rt=n;return}Rt=n=i}while(n!==null);oe===0&&(oe=5)}function U_(i,n){do{var a=mx(i.alternate,i);if(a!==null){a.flags&=32767,Rt=a;return}if(a=i.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!n&&(i=i.sibling,i!==null)){Rt=i;return}Rt=i=a}while(i!==null);oe=6,Rt=null}function L_(i,n,a,c,d,p,m,v,T){i.cancelPendingCommit=null;do El();while(Te!==0);if((Nt&6)!==0)throw Error(s(327));if(n!==null){if(n===i.current)throw Error(s(177));if(p=n.lanes|n.childLanes,p|=fh,nv(i,a,p,m,v,T),i===Xt&&(Rt=Xt=null,Bt=0),kr=n,an=i,Rs=a,xu=p,bu=d,E_=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,Rx(Ro,function(){return Q_(),null})):(i.callbackNode=null,i.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=E.T,E.T=null,d=b.p,b.p=2,m=Nt,Nt|=4;try{yx(i,n,a)}finally{Nt=m,b.p=d,E.T=c}}Te=1,F_(),N_(),H_()}}function F_(){if(Te===1){Te=0;var i=an,n=kr,a=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||a){a=E.T,E.T=null;var c=b.p;b.p=2;var d=Nt;Nt|=4;try{A_(n,i);var p=Uu,m=Sp(i.containerInfo),v=p.focusedElem,T=p.selectionRange;if(m!==v&&v&&v.ownerDocument&&Cp(v.ownerDocument.documentElement,v)){if(T!==null&&lh(v)){var N=T.start,j=T.end;if(j===void 0&&(j=N),"selectionStart"in v)v.selectionStart=N,v.selectionEnd=Math.min(j,v.value.length);else{var J=v.ownerDocument||document,Q=J&&J.defaultView||window;if(Q.getSelection){var Y=Q.getSelection(),lt=v.textContent.length,gt=Math.min(T.start,lt),jt=T.end===void 0?gt:Math.min(T.end,lt);!Y.extend&&gt>jt&&(m=jt,jt=gt,gt=m);var z=wp(v,gt),P=wp(v,jt);if(z&&P&&(Y.rangeCount!==1||Y.anchorNode!==z.node||Y.anchorOffset!==z.offset||Y.focusNode!==P.node||Y.focusOffset!==P.offset)){var F=J.createRange();F.setStart(z.node,z.offset),Y.removeAllRanges(),gt>jt?(Y.addRange(F),Y.extend(P.node,P.offset)):(F.setEnd(P.node,P.offset),Y.addRange(F))}}}}for(J=[],Y=v;Y=Y.parentNode;)Y.nodeType===1&&J.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<J.length;v++){var Z=J[v];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}Fl=!!Ou,Uu=Ou=null}finally{Nt=d,b.p=c,E.T=a}}i.current=n,Te=2}}function N_(){if(Te===2){Te=0;var i=an,n=kr,a=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||a){a=E.T,E.T=null;var c=b.p;b.p=2;var d=Nt;Nt|=4;try{p_(i,n.alternate,n)}finally{Nt=d,b.p=c,E.T=a}}Te=3}}function H_(){if(Te===4||Te===3){Te=0,ZA();var i=an,n=kr,a=Rs,c=E_;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Te=5:(Te=0,kr=an=null,G_(i,i.pendingLanes));var d=i.pendingLanes;if(d===0&&(rn=null),Qc(a),n=n.stateNode,mi&&typeof mi.onCommitFiberRoot=="function")try{mi.onCommitFiberRoot(ra,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=E.T,d=b.p,b.p=2,E.T=null;try{for(var p=i.onRecoverableError,m=0;m<c.length;m++){var v=c[m];p(v.value,{componentStack:v.stack})}}finally{E.T=n,b.p=d}}(Rs&3)!==0&&El(),es(i),d=i.pendingLanes,(a&261930)!==0&&(d&42)!==0?i===wu?Na++:(Na=0,wu=i):Na=0,Ha(0)}}function G_(i,n){(i.pooledCacheLanes&=n)===0&&(n=i.pooledCache,n!=null&&(i.pooledCache=null,xa(n)))}function El(){return F_(),N_(),H_(),Q_()}function Q_(){if(Te!==5)return!1;var i=an,n=xu;xu=0;var a=Qc(Rs),c=E.T,d=b.p;try{b.p=32>a?32:a,E.T=null,a=bu,bu=null;var p=an,m=Rs;if(Te=0,kr=an=null,Rs=0,(Nt&6)!==0)throw Error(s(331));var v=Nt;if(Nt|=4,C_(p.current),x_(p,p.current,m,a),Nt=v,Ha(0,!1),mi&&typeof mi.onPostCommitFiberRoot=="function")try{mi.onPostCommitFiberRoot(ra,p)}catch{}return!0}finally{b.p=d,E.T=c,G_(i,n)}}function V_(i,n,a){n=Ii(a,n),n=eu(i.stateNode,n,2),i=Ks(i,n,2),i!==null&&(oa(i,2),es(i))}function Qt(i,n,a){if(i.tag===3)V_(i,i,a);else for(;n!==null;){if(n.tag===3){V_(n,i,a);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(rn===null||!rn.has(c))){i=Ii(a,i),a=Yg(2),c=Ks(n,a,2),c!==null&&(jg(a,c,n,i),oa(c,2),es(c));break}}n=n.return}}function Tu(i,n,a){var c=i.pingCache;if(c===null){c=i.pingCache=new xx;var d=new Set;c.set(n,d)}else d=c.get(n),d===void 0&&(d=new Set,c.set(n,d));d.has(a)||(yu=!0,d.add(a),i=Tx.bind(null,i,n,a),n.then(i,i))}function Tx(i,n,a){var c=i.pingCache;c!==null&&c.delete(n),i.pingedLanes|=i.suspendedLanes&a,i.warmLanes&=~a,Xt===i&&(Bt&a)===a&&(oe===4||oe===3&&(Bt&62914560)===Bt&&300>_i()-xl?(Nt&2)===0&&zr(i,0):Au|=a,Ir===Bt&&(Ir=0)),es(i)}function Y_(i,n){n===0&&(n=Ff()),i=Mn(i,n),i!==null&&(oa(i,n),es(i))}function Ex(i){var n=i.memoizedState,a=0;n!==null&&(a=n.retryLane),Y_(i,a)}function Dx(i,n){var a=0;switch(i.tag){case 31:case 13:var c=i.stateNode,d=i.memoizedState;d!==null&&(a=d.retryLane);break;case 19:c=i.stateNode;break;case 22:c=i.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(n),Y_(i,a)}function Rx(i,n){return Fc(i,n)}var Dl=null,Ur=null,Eu=!1,Rl=!1,Du=!1,ln=0;function es(i){i!==Ur&&i.next===null&&(Ur===null?Dl=Ur=i:Ur=Ur.next=i),Rl=!0,Eu||(Eu=!0,Px())}function Ha(i,n){if(!Du&&Rl){Du=!0;do for(var a=!1,c=Dl;c!==null;){if(i!==0){var d=c.pendingLanes;if(d===0)var p=0;else{var m=c.suspendedLanes,v=c.pingedLanes;p=(1<<31-yi(42|i)+1)-1,p&=d&~(m&~v),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(a=!0,Z_(c,p))}else p=Bt,p=Io(c,c===Xt?p:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(p&3)===0||aa(c,p)||(a=!0,Z_(c,p));c=c.next}while(a);Du=!1}}function Mx(){j_()}function j_(){Rl=Eu=!1;var i=0;ln!==0&&Hx()&&(i=ln);for(var n=_i(),a=null,c=Dl;c!==null;){var d=c.next,p=q_(c,n);p===0?(c.next=null,a===null?Dl=d:a.next=d,d===null&&(Ur=a)):(a=c,(i!==0||(p&3)!==0)&&(Rl=!0)),c=d}Te!==0&&Te!==5||Ha(i),ln!==0&&(ln=0)}function q_(i,n){for(var a=i.suspendedLanes,c=i.pingedLanes,d=i.expirationTimes,p=i.pendingLanes&-62914561;0<p;){var m=31-yi(p),v=1<<m,T=d[m];T===-1?((v&a)===0||(v&c)!==0)&&(d[m]=sv(v,n)):T<=n&&(i.expiredLanes|=v),p&=~v}if(n=Xt,a=Bt,a=Io(i,i===n?a:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c=i.callbackNode,a===0||i===n&&(Gt===2||Gt===9)||i.cancelPendingCommit!==null)return c!==null&&c!==null&&Nc(c),i.callbackNode=null,i.callbackPriority=0;if((a&3)===0||aa(i,a)){if(n=a&-a,n===i.callbackPriority)return n;switch(c!==null&&Nc(c),Qc(a)){case 2:case 8:a=Uf;break;case 32:a=Ro;break;case 268435456:a=Lf;break;default:a=Ro}return c=X_.bind(null,i),a=Fc(a,c),i.callbackPriority=n,i.callbackNode=a,n}return c!==null&&c!==null&&Nc(c),i.callbackPriority=2,i.callbackNode=null,2}function X_(i,n){if(Te!==0&&Te!==5)return i.callbackNode=null,i.callbackPriority=0,null;var a=i.callbackNode;if(El()&&i.callbackNode!==a)return null;var c=Bt;return c=Io(i,i===Xt?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c===0?null:(R_(i,c,n),q_(i,_i()),i.callbackNode!=null&&i.callbackNode===a?X_.bind(null,i):null)}function Z_(i,n){if(El())return null;R_(i,n,!0)}function Px(){Qx(function(){(Nt&6)!==0?Fc(Of,Mx):j_()})}function Ru(){if(ln===0){var i=br;i===0&&(i=Mo,Mo<<=1,(Mo&261888)===0&&(Mo=256)),ln=i}return ln}function W_(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Uo(""+i)}function J_(i,n){var a=n.ownerDocument.createElement("input");return a.name=n.name,a.value=n.value,i.id&&a.setAttribute("form",i.id),n.parentNode.insertBefore(a,n),i=new FormData(i),a.parentNode.removeChild(a),i}function Bx(i,n,a,c,d){if(n==="submit"&&a&&a.stateNode===d){var p=W_((d[si]||null).action),m=c.submitter;m&&(n=(n=m[si]||null)?W_(n.formAction):m.getAttribute("formAction"),n!==null&&(p=n,m=null));var v=new Ho("action","action",null,c,d);i.push({event:v,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(ln!==0){var T=m?J_(d,m):new FormData(d);Zh(a,{pending:!0,data:T,method:d.method,action:p},null,T)}}else typeof p=="function"&&(v.preventDefault(),T=m?J_(d,m):new FormData(d),Zh(a,{pending:!0,data:T,method:d.method,action:p},p,T))},currentTarget:d}]})}}for(var Mu=0;Mu<dh.length;Mu++){var Pu=dh[Mu],Ix=Pu.toLowerCase(),kx=Pu[0].toUpperCase()+Pu.slice(1);Yi(Ix,"on"+kx)}Yi(Dp,"onAnimationEnd"),Yi(Rp,"onAnimationIteration"),Yi(Mp,"onAnimationStart"),Yi("dblclick","onDoubleClick"),Yi("focusin","onFocus"),Yi("focusout","onBlur"),Yi(Wv,"onTransitionRun"),Yi(Jv,"onTransitionStart"),Yi(Kv,"onTransitionCancel"),Yi(Pp,"onTransitionEnd"),lr("onMouseEnter",["mouseout","mouseover"]),lr("onMouseLeave",["mouseout","mouseover"]),lr("onPointerEnter",["pointerout","pointerover"]),lr("onPointerLeave",["pointerout","pointerover"]),Tn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Tn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Tn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Tn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Tn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Tn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ga="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ga));function K_(i,n){n=(n&4)!==0;for(var a=0;a<i.length;a++){var c=i[a],d=c.event;c=c.listeners;t:{var p=void 0;if(n)for(var m=c.length-1;0<=m;m--){var v=c[m],T=v.instance,N=v.currentTarget;if(v=v.listener,T!==p&&d.isPropagationStopped())break t;p=v,d.currentTarget=N;try{p(d)}catch(j){Vo(j)}d.currentTarget=null,p=T}else for(m=0;m<c.length;m++){if(v=c[m],T=v.instance,N=v.currentTarget,v=v.listener,T!==p&&d.isPropagationStopped())break t;p=v,d.currentTarget=N;try{p(d)}catch(j){Vo(j)}d.currentTarget=null,p=T}}}}function Mt(i,n){var a=n[Vc];a===void 0&&(a=n[Vc]=new Set);var c=i+"__bubble";a.has(c)||($_(n,i,2,!1),a.add(c))}function Bu(i,n,a){var c=0;n&&(c|=4),$_(a,i,c,n)}var Ml="_reactListening"+Math.random().toString(36).slice(2);function Iu(i){if(!i[Ml]){i[Ml]=!0,jf.forEach(function(a){a!=="selectionchange"&&(zx.has(a)||Bu(a,!1,i),Bu(a,!0,i))});var n=i.nodeType===9?i:i.ownerDocument;n===null||n[Ml]||(n[Ml]=!0,Bu("selectionchange",!1,n))}}function $_(i,n,a,c){switch(Dm(n)){case 2:var d=cb;break;case 8:d=hb;break;default:d=Xu}a=d.bind(null,n,a,i),d=void 0,!$c||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),c?d!==void 0?i.addEventListener(n,a,{capture:!0,passive:d}):i.addEventListener(n,a,!0):d!==void 0?i.addEventListener(n,a,{passive:d}):i.addEventListener(n,a,!1)}function ku(i,n,a,c,d){var p=c;if((n&1)===0&&(n&2)===0&&c!==null)t:for(;;){if(c===null)return;var m=c.tag;if(m===3||m===4){var v=c.stateNode.containerInfo;if(v===d)break;if(m===4)for(m=c.return;m!==null;){var T=m.tag;if((T===3||T===4)&&m.stateNode.containerInfo===d)return;m=m.return}for(;v!==null;){if(m=rr(v),m===null)return;if(T=m.tag,T===5||T===6||T===26||T===27){c=p=m;continue t}v=v.parentNode}}c=c.return}np(function(){var N=p,j=Jc(a),J=[];t:{var Q=Bp.get(i);if(Q!==void 0){var Y=Ho,lt=i;switch(i){case"keypress":if(Fo(a)===0)break t;case"keydown":case"keyup":Y=Dv;break;case"focusin":lt="focus",Y=sh;break;case"focusout":lt="blur",Y=sh;break;case"beforeblur":case"afterblur":Y=sh;break;case"click":if(a.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=op;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=_v;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=Pv;break;case Dp:case Rp:case Mp:Y=Av;break;case Pp:Y=Iv;break;case"scroll":case"scrollend":Y=pv;break;case"wheel":Y=zv;break;case"copy":case"cut":case"paste":Y=xv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=cp;break;case"toggle":case"beforetoggle":Y=Uv}var gt=(n&4)!==0,jt=!gt&&(i==="scroll"||i==="scrollend"),z=gt?Q!==null?Q+"Capture":null:Q;gt=[];for(var P=N,F;P!==null;){var Z=P;if(F=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||F===null||z===null||(Z=ha(P,z),Z!=null&&gt.push(Qa(P,Z,F))),jt)break;P=P.return}0<gt.length&&(Q=new Y(Q,lt,null,a,j),J.push({event:Q,listeners:gt}))}}if((n&7)===0){t:{if(Q=i==="mouseover"||i==="pointerover",Y=i==="mouseout"||i==="pointerout",Q&&a!==Wc&&(lt=a.relatedTarget||a.fromElement)&&(rr(lt)||lt[nr]))break t;if((Y||Q)&&(Q=j.window===j?j:(Q=j.ownerDocument)?Q.defaultView||Q.parentWindow:window,Y?(lt=a.relatedTarget||a.toElement,Y=N,lt=lt?rr(lt):null,lt!==null&&(jt=l(lt),gt=lt.tag,lt!==jt||gt!==5&&gt!==27&&gt!==6)&&(lt=null)):(Y=null,lt=N),Y!==lt)){if(gt=op,Z="onMouseLeave",z="onMouseEnter",P="mouse",(i==="pointerout"||i==="pointerover")&&(gt=cp,Z="onPointerLeave",z="onPointerEnter",P="pointer"),jt=Y==null?Q:ca(Y),F=lt==null?Q:ca(lt),Q=new gt(Z,P+"leave",Y,a,j),Q.target=jt,Q.relatedTarget=F,Z=null,rr(j)===N&&(gt=new gt(z,P+"enter",lt,a,j),gt.target=F,gt.relatedTarget=jt,Z=gt),jt=Z,Y&&lt)e:{for(gt=Ox,z=Y,P=lt,F=0,Z=z;Z;Z=gt(Z))F++;Z=0;for(var dt=P;dt;dt=gt(dt))Z++;for(;0<F-Z;)z=gt(z),F--;for(;0<Z-F;)P=gt(P),Z--;for(;F--;){if(z===P||P!==null&&z===P.alternate){gt=z;break e}z=gt(z),P=gt(P)}gt=null}else gt=null;Y!==null&&tm(J,Q,Y,gt,!1),lt!==null&&jt!==null&&tm(J,jt,lt,gt,!0)}}t:{if(Q=N?ca(N):window,Y=Q.nodeName&&Q.nodeName.toLowerCase(),Y==="select"||Y==="input"&&Q.type==="file")var Lt=mp;else if(gp(Q))if(yp)Lt=qv;else{Lt=Yv;var ut=Vv}else Y=Q.nodeName,!Y||Y.toLowerCase()!=="input"||Q.type!=="checkbox"&&Q.type!=="radio"?N&&Zc(N.elementType)&&(Lt=mp):Lt=jv;if(Lt&&(Lt=Lt(i,N))){_p(J,Lt,a,j);break t}ut&&ut(i,Q,N),i==="focusout"&&N&&Q.type==="number"&&N.memoizedProps.value!=null&&Xc(Q,"number",Q.value)}switch(ut=N?ca(N):window,i){case"focusin":(gp(ut)||ut.contentEditable==="true")&&(pr=ut,ch=N,ya=null);break;case"focusout":ya=ch=pr=null;break;case"mousedown":hh=!0;break;case"contextmenu":case"mouseup":case"dragend":hh=!1,Tp(J,a,j);break;case"selectionchange":if(Zv)break;case"keydown":case"keyup":Tp(J,a,j)}var wt;if(rh)t:{switch(i){case"compositionstart":var It="onCompositionStart";break t;case"compositionend":It="onCompositionEnd";break t;case"compositionupdate":It="onCompositionUpdate";break t}It=void 0}else fr?fp(i,a)&&(It="onCompositionEnd"):i==="keydown"&&a.keyCode===229&&(It="onCompositionStart");It&&(hp&&a.locale!=="ko"&&(fr||It!=="onCompositionStart"?It==="onCompositionEnd"&&fr&&(wt=rp()):(Ys=j,th="value"in Ys?Ys.value:Ys.textContent,fr=!0)),ut=Pl(N,It),0<ut.length&&(It=new lp(It,i,null,a,j),J.push({event:It,listeners:ut}),wt?It.data=wt:(wt=pp(a),wt!==null&&(It.data=wt)))),(wt=Fv?Nv(i,a):Hv(i,a))&&(It=Pl(N,"onBeforeInput"),0<It.length&&(ut=new lp("onBeforeInput","beforeinput",null,a,j),J.push({event:ut,listeners:It}),ut.data=wt)),Bx(J,i,N,a,j)}K_(J,n)})}function Qa(i,n,a){return{instance:i,listener:n,currentTarget:a}}function Pl(i,n){for(var a=n+"Capture",c=[];i!==null;){var d=i,p=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||p===null||(d=ha(i,a),d!=null&&c.unshift(Qa(i,d,p)),d=ha(i,n),d!=null&&c.push(Qa(i,d,p))),i.tag===3)return c;i=i.return}return[]}function Ox(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function tm(i,n,a,c,d){for(var p=n._reactName,m=[];a!==null&&a!==c;){var v=a,T=v.alternate,N=v.stateNode;if(v=v.tag,T!==null&&T===c)break;v!==5&&v!==26&&v!==27||N===null||(T=N,d?(N=ha(a,p),N!=null&&m.unshift(Qa(a,N,T))):d||(N=ha(a,p),N!=null&&m.push(Qa(a,N,T)))),a=a.return}m.length!==0&&i.push({event:n,listeners:m})}var Ux=/\r\n?/g,Lx=/\u0000|\uFFFD/g;function em(i){return(typeof i=="string"?i:""+i).replace(Ux,`
`).replace(Lx,"")}function im(i,n){return n=em(n),em(i)===n}function Yt(i,n,a,c,d,p){switch(a){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||hr(i,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&hr(i,""+c);break;case"className":zo(i,"class",c);break;case"tabIndex":zo(i,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":zo(i,a,c);break;case"style":ip(i,c,p);break;case"data":if(n!=="object"){zo(i,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||a!=="href")){i.removeAttribute(a);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(a);break}c=Uo(""+c),i.setAttribute(a,c);break;case"action":case"formAction":if(typeof c=="function"){i.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(a==="formAction"?(n!=="input"&&Yt(i,n,"name",d.name,d,null),Yt(i,n,"formEncType",d.formEncType,d,null),Yt(i,n,"formMethod",d.formMethod,d,null),Yt(i,n,"formTarget",d.formTarget,d,null)):(Yt(i,n,"encType",d.encType,d,null),Yt(i,n,"method",d.method,d,null),Yt(i,n,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(a);break}c=Uo(""+c),i.setAttribute(a,c);break;case"onClick":c!=null&&(i.onclick=ps);break;case"onScroll":c!=null&&Mt("scroll",i);break;case"onScrollEnd":c!=null&&Mt("scrollend",i);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(d.children!=null)throw Error(s(60));i.innerHTML=a}}break;case"multiple":i.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":i.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){i.removeAttribute("xlink:href");break}a=Uo(""+c),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,""+c):i.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,""):i.removeAttribute(a);break;case"capture":case"download":c===!0?i.setAttribute(a,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,c):i.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?i.setAttribute(a,c):i.removeAttribute(a);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?i.removeAttribute(a):i.setAttribute(a,c);break;case"popover":Mt("beforetoggle",i),Mt("toggle",i),ko(i,"popover",c);break;case"xlinkActuate":fs(i,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":fs(i,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":fs(i,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":fs(i,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":fs(i,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":fs(i,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":fs(i,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":fs(i,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":fs(i,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":ko(i,"is",c);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=dv.get(a)||a,ko(i,a,c))}}function zu(i,n,a,c,d,p){switch(a){case"style":ip(i,c,p);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(d.children!=null)throw Error(s(60));i.innerHTML=a}}break;case"children":typeof c=="string"?hr(i,c):(typeof c=="number"||typeof c=="bigint")&&hr(i,""+c);break;case"onScroll":c!=null&&Mt("scroll",i);break;case"onScrollEnd":c!=null&&Mt("scrollend",i);break;case"onClick":c!=null&&(i.onclick=ps);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qf.hasOwnProperty(a))t:{if(a[0]==="o"&&a[1]==="n"&&(d=a.endsWith("Capture"),n=a.slice(2,d?a.length-7:void 0),p=i[si]||null,p=p!=null?p[a]:null,typeof p=="function"&&i.removeEventListener(n,p,d),typeof c=="function")){typeof p!="function"&&p!==null&&(a in i?i[a]=null:i.hasAttribute(a)&&i.removeAttribute(a)),i.addEventListener(n,c,d);break t}a in i?i[a]=c:c===!0?i.setAttribute(a,""):ko(i,a,c)}}}function Le(i,n,a){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mt("error",i),Mt("load",i);var c=!1,d=!1,p;for(p in a)if(a.hasOwnProperty(p)){var m=a[p];if(m!=null)switch(p){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Yt(i,n,p,m,a,null)}}d&&Yt(i,n,"srcSet",a.srcSet,a,null),c&&Yt(i,n,"src",a.src,a,null);return;case"input":Mt("invalid",i);var v=p=m=d=null,T=null,N=null;for(c in a)if(a.hasOwnProperty(c)){var j=a[c];if(j!=null)switch(c){case"name":d=j;break;case"type":m=j;break;case"checked":T=j;break;case"defaultChecked":N=j;break;case"value":p=j;break;case"defaultValue":v=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(s(137,n));break;default:Yt(i,n,c,j,a,null)}}Kf(i,p,v,T,N,m,d,!1);return;case"select":Mt("invalid",i),c=m=p=null;for(d in a)if(a.hasOwnProperty(d)&&(v=a[d],v!=null))switch(d){case"value":p=v;break;case"defaultValue":m=v;break;case"multiple":c=v;default:Yt(i,n,d,v,a,null)}n=p,a=m,i.multiple=!!c,n!=null?cr(i,!!c,n,!1):a!=null&&cr(i,!!c,a,!0);return;case"textarea":Mt("invalid",i),p=d=c=null;for(m in a)if(a.hasOwnProperty(m)&&(v=a[m],v!=null))switch(m){case"value":c=v;break;case"defaultValue":d=v;break;case"children":p=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(s(91));break;default:Yt(i,n,m,v,a,null)}tp(i,c,d,p);return;case"option":for(T in a)if(a.hasOwnProperty(T)&&(c=a[T],c!=null))switch(T){case"selected":i.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:Yt(i,n,T,c,a,null)}return;case"dialog":Mt("beforetoggle",i),Mt("toggle",i),Mt("cancel",i),Mt("close",i);break;case"iframe":case"object":Mt("load",i);break;case"video":case"audio":for(c=0;c<Ga.length;c++)Mt(Ga[c],i);break;case"image":Mt("error",i),Mt("load",i);break;case"details":Mt("toggle",i);break;case"embed":case"source":case"link":Mt("error",i),Mt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(N in a)if(a.hasOwnProperty(N)&&(c=a[N],c!=null))switch(N){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Yt(i,n,N,c,a,null)}return;default:if(Zc(n)){for(j in a)a.hasOwnProperty(j)&&(c=a[j],c!==void 0&&zu(i,n,j,c,a,void 0));return}}for(v in a)a.hasOwnProperty(v)&&(c=a[v],c!=null&&Yt(i,n,v,c,a,null))}function Fx(i,n,a,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,p=null,m=null,v=null,T=null,N=null,j=null;for(Y in a){var J=a[Y];if(a.hasOwnProperty(Y)&&J!=null)switch(Y){case"checked":break;case"value":break;case"defaultValue":T=J;default:c.hasOwnProperty(Y)||Yt(i,n,Y,null,c,J)}}for(var Q in c){var Y=c[Q];if(J=a[Q],c.hasOwnProperty(Q)&&(Y!=null||J!=null))switch(Q){case"type":p=Y;break;case"name":d=Y;break;case"checked":N=Y;break;case"defaultChecked":j=Y;break;case"value":m=Y;break;case"defaultValue":v=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(137,n));break;default:Y!==J&&Yt(i,n,Q,Y,c,J)}}qc(i,m,v,T,N,j,p,d);return;case"select":Y=m=v=Q=null;for(p in a)if(T=a[p],a.hasOwnProperty(p)&&T!=null)switch(p){case"value":break;case"multiple":Y=T;default:c.hasOwnProperty(p)||Yt(i,n,p,null,c,T)}for(d in c)if(p=c[d],T=a[d],c.hasOwnProperty(d)&&(p!=null||T!=null))switch(d){case"value":Q=p;break;case"defaultValue":v=p;break;case"multiple":m=p;default:p!==T&&Yt(i,n,d,p,c,T)}n=v,a=m,c=Y,Q!=null?cr(i,!!a,Q,!1):!!c!=!!a&&(n!=null?cr(i,!!a,n,!0):cr(i,!!a,a?[]:"",!1));return;case"textarea":Y=Q=null;for(v in a)if(d=a[v],a.hasOwnProperty(v)&&d!=null&&!c.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:Yt(i,n,v,null,c,d)}for(m in c)if(d=c[m],p=a[m],c.hasOwnProperty(m)&&(d!=null||p!=null))switch(m){case"value":Q=d;break;case"defaultValue":Y=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(s(91));break;default:d!==p&&Yt(i,n,m,d,c,p)}$f(i,Q,Y);return;case"option":for(var lt in a)if(Q=a[lt],a.hasOwnProperty(lt)&&Q!=null&&!c.hasOwnProperty(lt))switch(lt){case"selected":i.selected=!1;break;default:Yt(i,n,lt,null,c,Q)}for(T in c)if(Q=c[T],Y=a[T],c.hasOwnProperty(T)&&Q!==Y&&(Q!=null||Y!=null))switch(T){case"selected":i.selected=Q&&typeof Q!="function"&&typeof Q!="symbol";break;default:Yt(i,n,T,Q,c,Y)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var gt in a)Q=a[gt],a.hasOwnProperty(gt)&&Q!=null&&!c.hasOwnProperty(gt)&&Yt(i,n,gt,null,c,Q);for(N in c)if(Q=c[N],Y=a[N],c.hasOwnProperty(N)&&Q!==Y&&(Q!=null||Y!=null))switch(N){case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(s(137,n));break;default:Yt(i,n,N,Q,c,Y)}return;default:if(Zc(n)){for(var jt in a)Q=a[jt],a.hasOwnProperty(jt)&&Q!==void 0&&!c.hasOwnProperty(jt)&&zu(i,n,jt,void 0,c,Q);for(j in c)Q=c[j],Y=a[j],!c.hasOwnProperty(j)||Q===Y||Q===void 0&&Y===void 0||zu(i,n,j,Q,c,Y);return}}for(var z in a)Q=a[z],a.hasOwnProperty(z)&&Q!=null&&!c.hasOwnProperty(z)&&Yt(i,n,z,null,c,Q);for(J in c)Q=c[J],Y=a[J],!c.hasOwnProperty(J)||Q===Y||Q==null&&Y==null||Yt(i,n,J,Q,c,Y)}function sm(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Nx(){if(typeof performance.getEntriesByType=="function"){for(var i=0,n=0,a=performance.getEntriesByType("resource"),c=0;c<a.length;c++){var d=a[c],p=d.transferSize,m=d.initiatorType,v=d.duration;if(p&&v&&sm(m)){for(m=0,v=d.responseEnd,c+=1;c<a.length;c++){var T=a[c],N=T.startTime;if(N>v)break;var j=T.transferSize,J=T.initiatorType;j&&sm(J)&&(T=T.responseEnd,m+=j*(T<v?1:(v-N)/(T-N)))}if(--c,n+=8*(p+m)/(d.duration/1e3),i++,10<i)break}}if(0<i)return n/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Ou=null,Uu=null;function Bl(i){return i.nodeType===9?i:i.ownerDocument}function nm(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function rm(i,n){if(i===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&n==="foreignObject"?0:i}function Lu(i,n){return i==="textarea"||i==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Fu=null;function Hx(){var i=window.event;return i&&i.type==="popstate"?i===Fu?!1:(Fu=i,!0):(Fu=null,!1)}var am=typeof setTimeout=="function"?setTimeout:void 0,Gx=typeof clearTimeout=="function"?clearTimeout:void 0,om=typeof Promise=="function"?Promise:void 0,Qx=typeof queueMicrotask=="function"?queueMicrotask:typeof om<"u"?function(i){return om.resolve(null).then(i).catch(Vx)}:am;function Vx(i){setTimeout(function(){throw i})}function cn(i){return i==="head"}function lm(i,n){var a=n,c=0;do{var d=a.nextSibling;if(i.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"||a==="/&"){if(c===0){i.removeChild(d),Hr(n);return}c--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")c++;else if(a==="html")Va(i.ownerDocument.documentElement);else if(a==="head"){a=i.ownerDocument.head,Va(a);for(var p=a.firstChild;p;){var m=p.nextSibling,v=p.nodeName;p[la]||v==="SCRIPT"||v==="STYLE"||v==="LINK"&&p.rel.toLowerCase()==="stylesheet"||a.removeChild(p),p=m}}else a==="body"&&Va(i.ownerDocument.body);a=d}while(a);Hr(n)}function cm(i,n){var a=i;i=0;do{var c=a.nextSibling;if(a.nodeType===1?n?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(n?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),c&&c.nodeType===8)if(a=c.data,a==="/$"){if(i===0)break;i--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||i++;a=c}while(a)}function Nu(i){var n=i.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var a=n;switch(n=n.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Nu(a),Yc(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}i.removeChild(a)}}function Yx(i,n,a,c){for(;i.nodeType===1;){var d=a;if(i.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(c){if(!i[la])switch(n){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(p=i.getAttribute("rel"),p==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(p!==d.rel||i.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||i.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||i.getAttribute("title")!==(d.title==null?null:d.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(p=i.getAttribute("src"),(p!==(d.src==null?null:d.src)||i.getAttribute("type")!==(d.type==null?null:d.type)||i.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&p&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(n==="input"&&i.type==="hidden"){var p=d.name==null?null:""+d.name;if(d.type==="hidden"&&i.getAttribute("name")===p)return i}else return i;if(i=Li(i.nextSibling),i===null)break}return null}function jx(i,n,a){if(n==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=Li(i.nextSibling),i===null))return null;return i}function hm(i,n){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!n||(i=Li(i.nextSibling),i===null))return null;return i}function Hu(i){return i.data==="$?"||i.data==="$~"}function Gu(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function qx(i,n){var a=i.ownerDocument;if(i.data==="$~")i._reactRetry=n;else if(i.data!=="$?"||a.readyState!=="loading")n();else{var c=function(){n(),a.removeEventListener("DOMContentLoaded",c)};a.addEventListener("DOMContentLoaded",c),i._reactRetry=c}}function Li(i){for(;i!=null;i=i.nextSibling){var n=i.nodeType;if(n===1||n===3)break;if(n===8){if(n=i.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return i}var Qu=null;function um(i){i=i.nextSibling;for(var n=0;i;){if(i.nodeType===8){var a=i.data;if(a==="/$"||a==="/&"){if(n===0)return Li(i.nextSibling);n--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||n++}i=i.nextSibling}return null}function dm(i){i=i.previousSibling;for(var n=0;i;){if(i.nodeType===8){var a=i.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(n===0)return i;n--}else a!=="/$"&&a!=="/&"||n++}i=i.previousSibling}return null}function fm(i,n,a){switch(n=Bl(a),i){case"html":if(i=n.documentElement,!i)throw Error(s(452));return i;case"head":if(i=n.head,!i)throw Error(s(453));return i;case"body":if(i=n.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function Va(i){for(var n=i.attributes;n.length;)i.removeAttributeNode(n[0]);Yc(i)}var Fi=new Map,pm=new Set;function Il(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Ms=b.d;b.d={f:Xx,r:Zx,D:Wx,C:Jx,L:Kx,m:$x,X:eb,S:tb,M:ib};function Xx(){var i=Ms.f(),n=Cl();return i||n}function Zx(i){var n=ar(i);n!==null&&n.tag===5&&n.type==="form"?Pg(n):Ms.r(i)}var Lr=typeof document>"u"?null:document;function gm(i,n,a){var c=Lr;if(c&&typeof n=="string"&&n){var d=Pi(n);d='link[rel="'+i+'"][href="'+d+'"]',typeof a=="string"&&(d+='[crossorigin="'+a+'"]'),pm.has(d)||(pm.add(d),i={rel:i,crossOrigin:a,href:n},c.querySelector(d)===null&&(n=c.createElement("link"),Le(n,"link",i),Re(n),c.head.appendChild(n)))}}function Wx(i){Ms.D(i),gm("dns-prefetch",i,null)}function Jx(i,n){Ms.C(i,n),gm("preconnect",i,n)}function Kx(i,n,a){Ms.L(i,n,a);var c=Lr;if(c&&i&&n){var d='link[rel="preload"][as="'+Pi(n)+'"]';n==="image"&&a&&a.imageSrcSet?(d+='[imagesrcset="'+Pi(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(d+='[imagesizes="'+Pi(a.imageSizes)+'"]')):d+='[href="'+Pi(i)+'"]';var p=d;switch(n){case"style":p=Fr(i);break;case"script":p=Nr(i)}Fi.has(p)||(i=y({rel:"preload",href:n==="image"&&a&&a.imageSrcSet?void 0:i,as:n},a),Fi.set(p,i),c.querySelector(d)!==null||n==="style"&&c.querySelector(Ya(p))||n==="script"&&c.querySelector(ja(p))||(n=c.createElement("link"),Le(n,"link",i),Re(n),c.head.appendChild(n)))}}function $x(i,n){Ms.m(i,n);var a=Lr;if(a&&i){var c=n&&typeof n.as=="string"?n.as:"script",d='link[rel="modulepreload"][as="'+Pi(c)+'"][href="'+Pi(i)+'"]',p=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=Nr(i)}if(!Fi.has(p)&&(i=y({rel:"modulepreload",href:i},n),Fi.set(p,i),a.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(ja(p)))return}c=a.createElement("link"),Le(c,"link",i),Re(c),a.head.appendChild(c)}}}function tb(i,n,a){Ms.S(i,n,a);var c=Lr;if(c&&i){var d=or(c).hoistableStyles,p=Fr(i);n=n||"default";var m=d.get(p);if(!m){var v={loading:0,preload:null};if(m=c.querySelector(Ya(p)))v.loading=5;else{i=y({rel:"stylesheet",href:i,"data-precedence":n},a),(a=Fi.get(p))&&Vu(i,a);var T=m=c.createElement("link");Re(T),Le(T,"link",i),T._p=new Promise(function(N,j){T.onload=N,T.onerror=j}),T.addEventListener("load",function(){v.loading|=1}),T.addEventListener("error",function(){v.loading|=2}),v.loading|=4,kl(m,n,c)}m={type:"stylesheet",instance:m,count:1,state:v},d.set(p,m)}}}function eb(i,n){Ms.X(i,n);var a=Lr;if(a&&i){var c=or(a).hoistableScripts,d=Nr(i),p=c.get(d);p||(p=a.querySelector(ja(d)),p||(i=y({src:i,async:!0},n),(n=Fi.get(d))&&Yu(i,n),p=a.createElement("script"),Re(p),Le(p,"link",i),a.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(d,p))}}function ib(i,n){Ms.M(i,n);var a=Lr;if(a&&i){var c=or(a).hoistableScripts,d=Nr(i),p=c.get(d);p||(p=a.querySelector(ja(d)),p||(i=y({src:i,async:!0,type:"module"},n),(n=Fi.get(d))&&Yu(i,n),p=a.createElement("script"),Re(p),Le(p,"link",i),a.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(d,p))}}function _m(i,n,a,c){var d=(d=Ct.current)?Il(d):null;if(!d)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(n=Fr(a.href),a=or(d).hoistableStyles,c=a.get(n),c||(c={type:"style",instance:null,count:0,state:null},a.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){i=Fr(a.href);var p=or(d).hoistableStyles,m=p.get(i);if(m||(d=d.ownerDocument||d,m={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(i,m),(p=d.querySelector(Ya(i)))&&!p._p&&(m.instance=p,m.state.loading=5),Fi.has(i)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Fi.set(i,a),p||sb(d,i,a,m.state))),n&&c===null)throw Error(s(528,""));return m}if(n&&c!==null)throw Error(s(529,""));return null;case"script":return n=a.async,a=a.src,typeof a=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Nr(a),a=or(d).hoistableScripts,c=a.get(n),c||(c={type:"script",instance:null,count:0,state:null},a.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function Fr(i){return'href="'+Pi(i)+'"'}function Ya(i){return'link[rel="stylesheet"]['+i+"]"}function mm(i){return y({},i,{"data-precedence":i.precedence,precedence:null})}function sb(i,n,a,c){i.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=i.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),Le(n,"link",a),Re(n),i.head.appendChild(n))}function Nr(i){return'[src="'+Pi(i)+'"]'}function ja(i){return"script[async]"+i}function ym(i,n,a){if(n.count++,n.instance===null)switch(n.type){case"style":var c=i.querySelector('style[data-href~="'+Pi(a.href)+'"]');if(c)return n.instance=c,Re(c),c;var d=y({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return c=(i.ownerDocument||i).createElement("style"),Re(c),Le(c,"style",d),kl(c,a.precedence,i),n.instance=c;case"stylesheet":d=Fr(a.href);var p=i.querySelector(Ya(d));if(p)return n.state.loading|=4,n.instance=p,Re(p),p;c=mm(a),(d=Fi.get(d))&&Vu(c,d),p=(i.ownerDocument||i).createElement("link"),Re(p);var m=p;return m._p=new Promise(function(v,T){m.onload=v,m.onerror=T}),Le(p,"link",c),n.state.loading|=4,kl(p,a.precedence,i),n.instance=p;case"script":return p=Nr(a.src),(d=i.querySelector(ja(p)))?(n.instance=d,Re(d),d):(c=a,(d=Fi.get(p))&&(c=y({},a),Yu(c,d)),i=i.ownerDocument||i,d=i.createElement("script"),Re(d),Le(d,"link",c),i.head.appendChild(d),n.instance=d);case"void":return null;default:throw Error(s(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,kl(c,a.precedence,i));return n.instance}function kl(i,n,a){for(var c=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,p=d,m=0;m<c.length;m++){var v=c[m];if(v.dataset.precedence===n)p=v;else if(p!==d)break}p?p.parentNode.insertBefore(i,p.nextSibling):(n=a.nodeType===9?a.head:a,n.insertBefore(i,n.firstChild))}function Vu(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.title==null&&(i.title=n.title)}function Yu(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.integrity==null&&(i.integrity=n.integrity)}var zl=null;function Am(i,n,a){if(zl===null){var c=new Map,d=zl=new Map;d.set(a,c)}else d=zl,c=d.get(a),c||(c=new Map,d.set(a,c));if(c.has(i))return c;for(c.set(i,null),a=a.getElementsByTagName(i),d=0;d<a.length;d++){var p=a[d];if(!(p[la]||p[ke]||i==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var m=p.getAttribute(n)||"";m=i+m;var v=c.get(m);v?v.push(p):c.set(m,[p])}}return c}function vm(i,n,a){i=i.ownerDocument||i,i.head.insertBefore(a,n==="title"?i.querySelector("head > title"):null)}function nb(i,n,a){if(a===1||n.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return i=n.disabled,typeof n.precedence=="string"&&i==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function xm(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function rb(i,n,a,c){if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var d=Fr(c.href),p=n.querySelector(Ya(d));if(p){n=p._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(i.count++,i=Ol.bind(i),n.then(i,i)),a.state.loading|=4,a.instance=p,Re(p);return}p=n.ownerDocument||n,c=mm(c),(d=Fi.get(d))&&Vu(c,d),p=p.createElement("link"),Re(p);var m=p;m._p=new Promise(function(v,T){m.onload=v,m.onerror=T}),Le(p,"link",c),a.instance=p}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(a,n),(n=a.state.preload)&&(a.state.loading&3)===0&&(i.count++,a=Ol.bind(i),n.addEventListener("load",a),n.addEventListener("error",a))}}var ju=0;function ab(i,n){return i.stylesheets&&i.count===0&&Ll(i,i.stylesheets),0<i.count||0<i.imgCount?function(a){var c=setTimeout(function(){if(i.stylesheets&&Ll(i,i.stylesheets),i.unsuspend){var p=i.unsuspend;i.unsuspend=null,p()}},6e4+n);0<i.imgBytes&&ju===0&&(ju=62500*Nx());var d=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&Ll(i,i.stylesheets),i.unsuspend)){var p=i.unsuspend;i.unsuspend=null,p()}},(i.imgBytes>ju?50:800)+n);return i.unsuspend=a,function(){i.unsuspend=null,clearTimeout(c),clearTimeout(d)}}:null}function Ol(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ll(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Ul=null;function Ll(i,n){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Ul=new Map,n.forEach(ob,i),Ul=null,Ol.call(i))}function ob(i,n){if(!(n.state.loading&4)){var a=Ul.get(i);if(a)var c=a.get(null);else{a=new Map,Ul.set(i,a);for(var d=i.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<d.length;p++){var m=d[p];(m.nodeName==="LINK"||m.getAttribute("media")!=="not all")&&(a.set(m.dataset.precedence,m),c=m)}c&&a.set(null,c)}d=n.instance,m=d.getAttribute("data-precedence"),p=a.get(m)||c,p===c&&a.set(null,d),a.set(m,d),this.count++,c=Ol.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),p?p.parentNode.insertBefore(d,p.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(d,i.firstChild)),n.state.loading|=4}}var qa={$$typeof:O,Provider:null,Consumer:null,_currentValue:$,_currentValue2:$,_threadCount:0};function lb(i,n,a,c,d,p,m,v,T){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Hc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hc(0),this.hiddenUpdates=Hc(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=p,this.onRecoverableError=m,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=T,this.incompleteTransitions=new Map}function bm(i,n,a,c,d,p,m,v,T,N,j,J){return i=new lb(i,n,a,m,T,N,j,J,v),n=1,p===!0&&(n|=24),p=vi(3,null,null,n),i.current=p,p.stateNode=i,n=Sh(),n.refCount++,i.pooledCache=n,n.refCount++,p.memoizedState={element:c,isDehydrated:a,cache:n},Rh(p),i}function wm(i){return i?(i=mr,i):mr}function Cm(i,n,a,c,d,p){d=wm(d),c.context===null?c.context=d:c.pendingContext=d,c=Js(n),c.payload={element:a},p=p===void 0?null:p,p!==null&&(c.callback=p),a=Ks(i,c,n),a!==null&&(ci(a,i,n),Sa(a,i,n))}function Sm(i,n){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var a=i.retryLane;i.retryLane=a!==0&&a<n?a:n}}function qu(i,n){Sm(i,n),(i=i.alternate)&&Sm(i,n)}function Tm(i){if(i.tag===13||i.tag===31){var n=Mn(i,67108864);n!==null&&ci(n,i,67108864),qu(i,67108864)}}function Em(i){if(i.tag===13||i.tag===31){var n=Si();n=Gc(n);var a=Mn(i,n);a!==null&&ci(a,i,n),qu(i,n)}}var Fl=!0;function cb(i,n,a,c){var d=E.T;E.T=null;var p=b.p;try{b.p=2,Xu(i,n,a,c)}finally{b.p=p,E.T=d}}function hb(i,n,a,c){var d=E.T;E.T=null;var p=b.p;try{b.p=8,Xu(i,n,a,c)}finally{b.p=p,E.T=d}}function Xu(i,n,a,c){if(Fl){var d=Zu(c);if(d===null)ku(i,n,c,Nl,a),Rm(i,c);else if(db(d,i,n,a,c))c.stopPropagation();else if(Rm(i,c),n&4&&-1<ub.indexOf(i)){for(;d!==null;){var p=ar(d);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var m=Sn(p.pendingLanes);if(m!==0){var v=p;for(v.pendingLanes|=2,v.entangledLanes|=2;m;){var T=1<<31-yi(m);v.entanglements[1]|=T,m&=~T}es(p),(Nt&6)===0&&(bl=_i()+500,Ha(0))}}break;case 31:case 13:v=Mn(p,2),v!==null&&ci(v,p,2),Cl(),qu(p,2)}if(p=Zu(c),p===null&&ku(i,n,c,Nl,a),p===d)break;d=p}d!==null&&c.stopPropagation()}else ku(i,n,c,null,a)}}function Zu(i){return i=Jc(i),Wu(i)}var Nl=null;function Wu(i){if(Nl=null,i=rr(i),i!==null){var n=l(i);if(n===null)i=null;else{var a=n.tag;if(a===13){if(i=h(n),i!==null)return i;i=null}else if(a===31){if(i=u(n),i!==null)return i;i=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;i=null}else n!==i&&(i=null)}}return Nl=i,null}function Dm(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(WA()){case Of:return 2;case Uf:return 8;case Ro:case JA:return 32;case Lf:return 268435456;default:return 32}default:return 32}}var Ju=!1,hn=null,un=null,dn=null,Xa=new Map,Za=new Map,fn=[],ub="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rm(i,n){switch(i){case"focusin":case"focusout":hn=null;break;case"dragenter":case"dragleave":un=null;break;case"mouseover":case"mouseout":dn=null;break;case"pointerover":case"pointerout":Xa.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Za.delete(n.pointerId)}}function Wa(i,n,a,c,d,p){return i===null||i.nativeEvent!==p?(i={blockedOn:n,domEventName:a,eventSystemFlags:c,nativeEvent:p,targetContainers:[d]},n!==null&&(n=ar(n),n!==null&&Tm(n)),i):(i.eventSystemFlags|=c,n=i.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),i)}function db(i,n,a,c,d){switch(n){case"focusin":return hn=Wa(hn,i,n,a,c,d),!0;case"dragenter":return un=Wa(un,i,n,a,c,d),!0;case"mouseover":return dn=Wa(dn,i,n,a,c,d),!0;case"pointerover":var p=d.pointerId;return Xa.set(p,Wa(Xa.get(p)||null,i,n,a,c,d)),!0;case"gotpointercapture":return p=d.pointerId,Za.set(p,Wa(Za.get(p)||null,i,n,a,c,d)),!0}return!1}function Mm(i){var n=rr(i.target);if(n!==null){var a=l(n);if(a!==null){if(n=a.tag,n===13){if(n=h(a),n!==null){i.blockedOn=n,Vf(i.priority,function(){Em(a)});return}}else if(n===31){if(n=u(a),n!==null){i.blockedOn=n,Vf(i.priority,function(){Em(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){i.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Hl(i){if(i.blockedOn!==null)return!1;for(var n=i.targetContainers;0<n.length;){var a=Zu(i.nativeEvent);if(a===null){a=i.nativeEvent;var c=new a.constructor(a.type,a);Wc=c,a.target.dispatchEvent(c),Wc=null}else return n=ar(a),n!==null&&Tm(n),i.blockedOn=a,!1;n.shift()}return!0}function Pm(i,n,a){Hl(i)&&a.delete(n)}function fb(){Ju=!1,hn!==null&&Hl(hn)&&(hn=null),un!==null&&Hl(un)&&(un=null),dn!==null&&Hl(dn)&&(dn=null),Xa.forEach(Pm),Za.forEach(Pm)}function Gl(i,n){i.blockedOn===n&&(i.blockedOn=null,Ju||(Ju=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,fb)))}var Ql=null;function Bm(i){Ql!==i&&(Ql=i,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Ql===i&&(Ql=null);for(var n=0;n<i.length;n+=3){var a=i[n],c=i[n+1],d=i[n+2];if(typeof c!="function"){if(Wu(c||a)===null)continue;break}var p=ar(a);p!==null&&(i.splice(n,3),n-=3,Zh(p,{pending:!0,data:d,method:a.method,action:c},c,d))}}))}function Hr(i){function n(T){return Gl(T,i)}hn!==null&&Gl(hn,i),un!==null&&Gl(un,i),dn!==null&&Gl(dn,i),Xa.forEach(n),Za.forEach(n);for(var a=0;a<fn.length;a++){var c=fn[a];c.blockedOn===i&&(c.blockedOn=null)}for(;0<fn.length&&(a=fn[0],a.blockedOn===null);)Mm(a),a.blockedOn===null&&fn.shift();if(a=(i.ownerDocument||i).$$reactFormReplay,a!=null)for(c=0;c<a.length;c+=3){var d=a[c],p=a[c+1],m=d[si]||null;if(typeof p=="function")m||Bm(a);else if(m){var v=null;if(p&&p.hasAttribute("formAction")){if(d=p,m=p[si]||null)v=m.formAction;else if(Wu(d)!==null)continue}else v=m.action;typeof v=="function"?a[c+1]=v:(a.splice(c,3),c-=3),Bm(a)}}}function Im(){function i(p){p.canIntercept&&p.info==="react-transition"&&p.intercept({handler:function(){return new Promise(function(m){return d=m})},focusReset:"manual",scroll:"manual"})}function n(){d!==null&&(d(),d=null),c||setTimeout(a,20)}function a(){if(!c&&!navigation.transition){var p=navigation.currentEntry;p&&p.url!=null&&navigation.navigate(p.url,{state:p.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,d=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(a,100),function(){c=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),d!==null&&(d(),d=null)}}}function Ku(i){this._internalRoot=i}Vl.prototype.render=Ku.prototype.render=function(i){var n=this._internalRoot;if(n===null)throw Error(s(409));var a=n.current,c=Si();Cm(a,c,i,n,null,null)},Vl.prototype.unmount=Ku.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var n=i.containerInfo;Cm(i.current,2,null,i,null,null),Cl(),n[nr]=null}};function Vl(i){this._internalRoot=i}Vl.prototype.unstable_scheduleHydration=function(i){if(i){var n=Qf();i={blockedOn:null,target:i,priority:n};for(var a=0;a<fn.length&&n!==0&&n<fn[a].priority;a++);fn.splice(a,0,i),a===0&&Mm(i)}};var km=t.version;if(km!=="19.2.3")throw Error(s(527,km,"19.2.3"));b.findDOMNode=function(i){var n=i._reactInternals;if(n===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=g(n),i=i!==null?_(i):null,i=i===null?null:i.stateNode,i};var pb={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:E,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yl.isDisabled&&Yl.supportsFiber)try{ra=Yl.inject(pb),mi=Yl}catch{}}return $a.createRoot=function(i,n){if(!r(i))throw Error(s(299));var a=!1,c="",d=Hg,p=Gg,m=Qg;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(d=n.onUncaughtError),n.onCaughtError!==void 0&&(p=n.onCaughtError),n.onRecoverableError!==void 0&&(m=n.onRecoverableError)),n=bm(i,1,!1,null,null,a,c,null,d,p,m,Im),i[nr]=n.current,Iu(i),new Ku(n)},$a.hydrateRoot=function(i,n,a){if(!r(i))throw Error(s(299));var c=!1,d="",p=Hg,m=Gg,v=Qg,T=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(p=a.onUncaughtError),a.onCaughtError!==void 0&&(m=a.onCaughtError),a.onRecoverableError!==void 0&&(v=a.onRecoverableError),a.formState!==void 0&&(T=a.formState)),n=bm(i,1,!0,n,a??null,c,d,T,p,m,v,Im),n.context=wm(null),a=n.current,c=Si(),c=Gc(c),d=Js(c),d.callback=null,Ks(a,d,c),a=c,n.current.lanes=a,oa(n,a),es(n),i[nr]=n.current,Iu(i),new Vl(n)},$a.version="19.2.3",$a}var Vm;function Eb(){if(Vm)return ed.exports;Vm=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),ed.exports=Tb(),ed.exports}var Db=Eb();const Rb=ef(Db);/*! excalibur - 0.31.0 - 2025-9-26
https://github.com/excaliburjs/Excalibur
Copyright (c) 2025 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
Licensed BSD-2-Clause
@preserve */function j0(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(o){window.setInterval(o,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise((s,r)=>{t.call(this,e,s,r)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1),typeof window<"u"&&!window.requestIdleCallback&&(window.requestIdleCallback=window.requestIdleCallback||function(o){const t=Date.now();return setTimeout(function(){o({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(o){clearTimeout(o)})}const nf=class ss{static useCanvasGraphicsContext(){ss.enable("use-canvas-context")}static useLegacyImageRenderer(){ss.enable("use-legacy-image-renderer")}static freeze(){ss._FROZEN=!0}static _reset(){ss._FROZEN=!1,ss._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");ss._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");ss._FLAGS[t]=!1}static isEnabled(t){return!!ss._FLAGS[t]}static show(){return Object.keys(ss._FLAGS)}};nf._FROZEN=!1;nf._FLAGS={};let $l=nf;function Jr(o,t){return{type:o,value:t}}class xn{constructor(){this._isCompleted=!1,this.promise=new Promise((t,e)=>{this._resolver=t,this._rejecter=e})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}class re{constructor(){this._paused=!1,this._empty=!0,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0,this._empty=!0}on(t,e){var s;return this._empty=!1,this._listeners[t]=(s=this._listeners[t])!=null?s:[],this._listeners[t].push(e),{close:()=>this.off(t,e)}}once(t,e){var s;return this._empty=!1,this._listenersOnce[t]=(s=this._listenersOnce[t])!=null?s:[],this._listenersOnce[t].push(e),{close:()=>this.off(t,e)}}off(t,e){var s,r;if(e){const l=(s=this._listeners[t])==null?void 0:s.filter(u=>u!==e);this._listeners[t]=l;const h=(r=this._listenersOnce[t])==null?void 0:r.filter(u=>u!==e);this._listenersOnce[t]=h}else delete this._listeners[t]}emit(t,e){if(this._empty||this._paused)return;const s=this._listeners[t];if(s)for(let l=0;l<s.length;l++)s[l](e);const r=this._listenersOnce[t];if(this._listenersOnce[t]=[],r)for(let l=0;l<r.length;l++)r[l](e);for(let l=0;l<this._pipes.length;l++)this._pipes[l].emit(t,e)}pipe(t){if(this===t)throw Error("Cannot pipe to self");return this._empty=!1,this._pipes.push(t),{close:()=>{const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}}}unpipe(t){const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var fo=(o=>(o.Canvas="Canvas",o.Document="Document",o))(fo||{}),me=(o=>(o.ShortestPath="shortest-path",o.LongestPath="longest-path",o.Clockwise="clockwise",o.CounterClockwise="counter-clockwise",o))(me||{});const rd=4294967295,Mb=Date.now();let Pb=0;class q0{constructor(t){this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Mb+Pb++)>>>0,this._seed=this._mt[0];for(let e=1;e<this._n;e++){const s=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((s&4294901760)>>>16)<<16)+this._f*(s&65535)+e>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,s=0;for(;s<this._n-this._m;s++)e=this._mt[s]&this._upperMask|this._mt[s+1]&this._lowerMask,this._mt[s]=this._mt[s+this._m]^e>>>1^t[e&1]&rd;for(;s<this._n-1;s++)e=this._mt[s]&this._upperMask|this._mt[s+1]&this._lowerMask,this._mt[s]=this._mt[s+(this._m-this._n)]^e>>>1^t[e&1]&rd;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[e&1]&rd,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,s=!1){return s?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const s=new Array(e);let r=0;const l=t.slice(0);for(;r<e;){const h=this.integer(0,l.length-1);s[r++]=l[h],l.splice(h,1)}return s}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const s=new Array(e);for(let r=0;r<e;r++)s[r]=this.pickOne(t);return s}shuffle(t){const e=t.slice(0);let s;for(let r=0;r<e.length-2;r++){const l=this.integer(r,e.length-1);s=e[r],e[r]=e[l],e[l]=s}return e}range(t,e,s){const r=new Array(t);for(let l=0;l<t;l++)r[l]=this.integer(e,s);return r}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}get seed(){return this._seed}}const Ge=Math.PI*2;function $t(o){return o===0?0:o<0?-1:1}function Pt(o,t,e){return Math.min(Math.max(t,o),e)}function Bb(o,t,e){return Math.abs(o-t)<e}function An(o){let t=o;if(o>=Ge)for(;t>=Ge;)t-=Ge;if(o<0)for(;t<0;)t+=Ge;return t}function Ib(o){return 180/Math.PI*o}const X0=class Zt{constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}static get Zero(){return new Zt(0,0)}static get One(){return new Zt(1,1)}static get Half(){return new Zt(.5,.5)}static get Up(){return new Zt(0,-1)}static get Down(){return new Zt(0,1)}static get Left(){return new Zt(-1,0)}static get Right(){return new Zt(1,0)}static fromAngle(t){return new Zt(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new Zt(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new Zt(Math.max(t.x,e.x),Math.max(t.y,e.y))}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=Zt.EQUALS_EPSILON){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}squareDistance(t){t||(t=Zt.Zero);const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}clampMagnitude(t){const e=this.magnitude,s=Pt(e,0,t);return this.magnitude=s,this}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}get magnitude(){return this.distance()}set magnitude(t){this.normalize().scale(t,this)}normalize(){const t=this.distance();return t===0?Zt.Zero:new Zt(this.x/t,this.y/t)}average(t){return this.add(t).scale(.5)}scale(t,e){const s=e||new Zt(0,0);return t instanceof Zt?(s.x=this.x*t.x,s.y=this.y*t.y):(s.x=this.x*t,s.y=this.y*t),s}add(t,e){return e?(e.x=this.x+t.x,e.y=this.y+t.y,e):new Zt(this.x+t.x,this.y+t.y)}sub(t,e){const s=e||new Zt(0,0),r=this.x-t.x,l=this.y-t.y;return s.x=r,s.y=l,s}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof Zt)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new Zt(t*this.y,-t*this.x)}static cross(t,e){return new Zt(-t*e.y,t*e.x)}perpendicular(){return new Zt(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return An(Math.atan2(this.y,this.x))}angleBetween(t,e){const s=this.toAngle(),r=An(t);let l=0,h=0;switch(r>s?l=r-s:l=(Ge-s+r)%Ge,h=(l-Ge)%Ge,e){case me.ShortestPath:return Math.abs(l)<Math.abs(h)?l:h;case me.LongestPath:return Math.abs(l)>Math.abs(h)?l:h;case me.Clockwise:return l;case me.CounterClockwise:return h}}rotate(t,e,s){const r=s||new Zt(0,0);e||(e=new Zt(0,0));const l=Math.sin(t),h=Math.cos(t),u=h*(this.x-e.x)-l*(this.y-e.y)+e.x,f=l*(this.x-e.x)+h*(this.y-e.y)+e.y;return r.x=u,r.y=f,r}clone(t){const e=t??new Zt(0,0);return e.x=this.x,e.y=this.y,e}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}lerp(t,e){e=Pt(e,0,1);const s=new Zt(0,0);return s.x=this.x+(t.x-this.x)*e,s.y=this.y+(t.y-this.y)*e,s}};X0.EQUALS_EPSILON=.001;let B=X0;function L(o,t){return new B(o,t)}class tt{constructor(t,e,s,r){this.r=t,this.g=e,this.b=s,this.a=r??1}static fromRGB(t,e,s,r){return new tt(t,e,s,r)}static fromRGBString(t){const e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let s=null;if(s=t.match(e)){const r=parseInt(s[1],10),l=parseInt(s[2],10),h=parseInt(s[3],10);let u=1;return s[4]&&(u=parseFloat(s[4])),new tt(r,l,h,u)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let s=null;if(s=t.match(e)){const r=parseInt(s[1],16),l=parseInt(s[2],16),h=parseInt(s[3],16);let u=1;return s[4]&&(u=parseInt(s[4],16)/255),new tt(r,l,h,u)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,s,r=1){return new Xi(t,e,s,r).toRGBA()}lighten(t=.1){const e=Xi.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=Xi.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=Xi.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=Xi.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,s=t.g/255*this.g/255*255,r=t.b/255*this.b/255*255,l=t.a*this.a;return new tt(e,s,r,l)}screen(t){const e=t.invert(),s=t.invert();return e.multiply(s).invert()}invert(){return new tt(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,s=(t.g+this.g)/2,r=(t.b+this.b)/2,l=(t.a+this.a)/2;return new tt(e,s,r,l)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=Math.max(Math.round(t),0).toString(16);return e.length===1?"0"+e:e}toHex(){let t="#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b);return this.a!==1&&(t+=this._componentToHex(this.a*255)),t}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return Xi.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(t){const e=t||new tt(this.r,this.g,this.b,this.a);return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e}static get Black(){return tt.fromHex("#000000")}static get White(){return tt.fromHex("#FFFFFF")}static get Gray(){return tt.fromHex("#808080")}static get LightGray(){return tt.fromHex("#D3D3D3")}static get DarkGray(){return tt.fromHex("#A9A9A9")}static get Yellow(){return tt.fromHex("#FFFF00")}static get Orange(){return tt.fromHex("#FFA500")}static get Red(){return tt.fromHex("#FF0000")}static get Vermilion(){return tt.fromHex("#FF5B31")}static get Rose(){return tt.fromHex("#FF007F")}static get Pink(){return tt.fromHex("#FFC0CB")}static get Magenta(){return tt.fromHex("#FF00FF")}static get Violet(){return tt.fromHex("#7F00FF")}static get Purple(){return tt.fromHex("#800080")}static get Blue(){return tt.fromHex("#0000FF")}static get Azure(){return tt.fromHex("#007FFF")}static get Cyan(){return tt.fromHex("#00FFFF")}static get Viridian(){return tt.fromHex("#59978F")}static get Teal(){return tt.fromHex("#008080")}static get Green(){return tt.fromHex("#00FF00")}static get Chartreuse(){return tt.fromHex("#7FFF00")}static get Transparent(){return tt.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return tt.fromHex("#176BAA")}static get Brown(){return tt.fromHex("#964B00")}}class Xi{constructor(t,e,s,r){this.h=t,this.s=e,this.l=s,this.a=r}static hue2rgb(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}static fromRGBA(t,e,s,r){t/=255,e/=255,s/=255;const l=Math.max(t,e,s),h=Math.min(t,e,s);let u,f;const g=(l+h)/2;if(l===h)u=f=0;else{const _=l-h;switch(f=g>.5?_/(2-l-h):_/(l+h),l){case t:u=(e-s)/_+(e<s?6:0);break;case e:u=(s-t)/_+2;break;case s:u=(t-e)/_+4;break}u/=6}return new Xi(u,f,g,r)}toRGBA(){let t,e,s;if(this.s===0)t=e=s=this.l;else{const r=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,l=2*this.l-r;t=Xi.hue2rgb(l,r,this.h+1/3),e=Xi.hue2rgb(l,r,this.h),s=Xi.hue2rgb(l,r,this.h-1/3)}return new tt(t*255,e*255,s*255,this.a)}toString(){const t=this.h.toFixed(0),e=this.s.toFixed(0),s=this.l.toFixed(0),r=this.a.toFixed(0);return`hsla(${t}, ${e}, ${s}, ${r})`}}var rf=(o=>(o[o.Debug=0]="Debug",o[o.Info=1]="Info",o[o.Warn=2]="Warn",o[o.Error=3]="Error",o[o.Fatal=4]="Fatal",o))(rf||{});const Z0=class Bs{constructor(){if(this._appenders=[],this.defaultLevel=1,this._logOnceSet=new Set,Bs._INSTANCE)throw new Error("Logger is a singleton");return Bs._INSTANCE=this,Bs._INSTANCE.addAppender(new kb),Bs._INSTANCE}static getInstance(){return Bs._INSTANCE==null&&(Bs._INSTANCE=new Bs),Bs._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){t==null&&(t=this.defaultLevel);const s=this._appenders.length;for(let r=0;r<s;r++)t>=this.defaultLevel&&this._appenders[r].log(t,e)}_logOnce(t,e){const s=t+e.join("+");this._logOnceSet.has(s)||(this._logOnceSet.add(s),this._log(t,e))}debug(...t){this._log(0,t)}debugOnce(...t){this._logOnce(0,t)}info(...t){this._log(1,t)}infoOnce(...t){this._logOnce(1,t)}warn(...t){this._log(2,t)}warnOnce(...t){this._logOnce(2,t)}error(...t){this._log(3,t)}errorOnce(...t){this._logOnce(3,t)}fatal(...t){this._log(4,t)}fatalOnce(...t){this._logOnce(4,t)}};Z0._INSTANCE=null;let yt=Z0;class kb{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const s=[];s.unshift.apply(s,e),s.unshift("["+rf[t]+"] : "),t<2?console.log.apply?console.log.apply(console,s):console.log(s.join(" ")):t<3?console.warn.apply?console.warn.apply(console,s):console.warn(s.join(" ")):console.error.apply?console.error.apply(console,s):console.error(s.join(" "))}}var _t=(o=>(o.PreventCollision="PreventCollision",o.Passive="Passive",o.Active="Active",o.Fixed="Fixed",o))(_t||{}),pi=(o=>(o.World="world",o.Screen="screen",o))(pi||{});class Di{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,e,s,r,l,h){const u=new Di;return u.data[0]=2/(e-t),u.data[1]=0,u.data[2]=0,u.data[3]=0,u.data[4]=0,u.data[5]=2/(r-s),u.data[6]=0,u.data[7]=0,u.data[8]=0,u.data[9]=0,u.data[10]=-2/(h-l),u.data[11]=0,u.data[12]=-(e+t)/(e-t),u.data[13]=-(r+s)/(r-s),u.data[14]=-(h+l)/(h-l),u.data[15]=1,u}clone(t){const e=t||new Di;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e.data[6]=this.data[6],e.data[7]=this.data[7],e.data[8]=this.data[8],e.data[9]=this.data[9],e.data[10]=this.data[10],e.data[11]=this.data[11],e.data[12]=this.data[12],e.data[13]=this.data[13],e.data[14]=this.data[14],e.data[15]=this.data[15],e}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const e=new Di;return e.data=t,e}static identity(){const t=new Di;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const s=Di.identity();return s.data[12]=t,s.data[13]=e,s}static scale(t,e){const s=Di.identity();return s.data[0]=t,s.data[5]=e,s.data[10]=1,s.data[15]=1,s}static rotation(t){const e=Di.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof B){const s=e||new B(0,0),r=t,l=r.x*this.data[0]+r.y*this.data[4]+this.data[12],h=r.x*this.data[1]+r.y*this.data[5]+this.data[13];return s.x=l,s.y=h,s}else{const s=e||new Di,r=t,l=this.data[0],h=this.data[1],u=this.data[2],f=this.data[3],g=this.data[4],_=this.data[5],y=this.data[6],A=this.data[7],x=this.data[8],D=this.data[9],S=this.data[10],U=this.data[11],R=this.data[12],C=this.data[13],O=this.data[14],G=this.data[15],q=r.data[0],et=r.data[1],k=r.data[2],rt=r.data[3],pt=r.data[4],At=r.data[5],bt=r.data[6],Et=r.data[7],I=r.data[8],K=r.data[9],X=r.data[10],E=r.data[11],b=r.data[12],$=r.data[13],it=r.data[14],nt=r.data[15];s.data[0]=l*q+g*et+x*k+R*rt,s.data[1]=h*q+_*et+D*k+C*rt,s.data[2]=u*q+y*et+S*k+O*rt,s.data[3]=f*q+A*et+U*k+G*rt,s.data[4]=l*pt+g*At+x*bt+R*Et,s.data[5]=h*pt+_*At+D*bt+C*Et,s.data[6]=u*pt+y*At+S*bt+O*Et,s.data[7]=f*pt+A*At+U*bt+G*Et,s.data[8]=l*I+g*K+x*X+R*E,s.data[9]=h*I+_*K+D*X+C*E,s.data[10]=u*I+y*K+S*X+O*E,s.data[11]=f*I+A*K+U*X+G*E,s.data[12]=l*b+g*$+x*it+R*nt,s.data[13]=h*b+_*$+D*it+C*nt,s.data[14]=u*b+y*$+S*it+O*nt,s.data[15]=f*b+A*$+U*it+G*nt;const w=this.getScale();return s._scaleSignX=$t(w.x)*$t(s._scaleSignX),s._scaleSignY=$t(w.y)*$t(s._scaleSignY),s}}translate(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3],u=this.data[4],f=this.data[5],g=this.data[6],_=this.data[7],y=this.data[8],A=this.data[9],x=this.data[10],D=this.data[11],S=this.data[12],U=this.data[13],R=this.data[14],C=this.data[15],O=0,G=1;return this.data[12]=s*t+u*e+y*O+S*G,this.data[13]=r*t+f*e+A*O+U*G,this.data[14]=l*t+g*e+x*O+R*G,this.data[15]=h*t+_*e+D*O+C*G,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return L(this.data[12],this.data[13])}rotate(t){const e=this.data[0],s=this.data[1],r=this.data[2],l=this.data[3],h=this.data[4],u=this.data[5],f=this.data[6],g=this.data[7],_=Math.sin(t),y=Math.cos(t);return this.data[0]=y*e+_*h,this.data[1]=y*s+_*u,this.data[2]=y*r+_*f,this.data[3]=y*l+_*g,this.data[4]=y*h-_*e,this.data[5]=y*u-_*s,this.data[6]=y*f-_*r,this.data[7]=y*g-_*l,this}scale(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3],u=this.data[4],f=this.data[5],g=this.data[6],_=this.data[7];return this.data[0]=s*t,this.data[1]=r*t,this.data[2]=l*t,this.data[3]=h*t,this.data[4]=u*e,this.data[5]=f*e,this.data[6]=g*e,this.data[7]=_*e,this}setRotation(t){const e=this.getScale(),s=Math.sin(t),r=Math.cos(t);this.data[0]=r*e.x,this.data[1]=s*e.y,this.data[4]=-s*e.x,this.data[5]=r*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return An(t)}getScaleX(){const t=L(this.data[0],this.data[4]).magnitude;return this._scaleSignX*t}getScaleY(){const t=L(this.data[1],this.data[5]).magnitude;return this._scaleSignY*t}getScale(){return L(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=$t(t);const e=L(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=$t(t);const e=L(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const s=1/this.getBasisDeterminant(),r=this.data[0],l=this.data[4],h=this.data[1],u=this.data[5],f=t||Di.identity();f.data[0]=u*s,f.data[1]=-h*s,f.data[4]=-l*s,f.data[5]=r*s;const g=this.data[12],_=this.data[13];return f.data[12]=-(g*f.data[0]+_*f.data[4]),f.data[13]=-(g*f.data[1]+_*f.data[5]),f}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class _e{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new _e;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,e){const s=_e.identity();return s.data[4]=t,s.data[5]=e,s}static scale(t,e){const s=_e.identity();return s.data[0]=t,s.data[3]=e,s._scale[0]=t,s._scale[1]=e,s}static rotation(t){const e=_e.identity();return e.data[0]=Math.cos(t),e.data[1]=Math.sin(t),e.data[2]=-Math.sin(t),e.data[3]=Math.cos(t),e}setPosition(t,e){this.data[4]=t,this.data[5]=e}getPosition(){return L(this.data[4],this.data[5])}rotate(t){const e=this.data[0],s=this.data[1],r=this.data[2],l=this.data[3],h=Math.sin(t),u=Math.cos(t);return this.data[0]=u*e+h*r,this.data[1]=u*s+h*l,this.data[2]=u*r-h*e,this.data[3]=u*l-h*s,this}translate(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3],u=this.data[4],f=this.data[5];return this.data[4]=s*t+l*e+u,this.data[5]=r*t+h*e+f,this}scale(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3];return this.data[0]=s*t,this.data[1]=r*t,this.data[2]=l*e,this.data[3]=h*e,this._scale[0]=t,this._scale[1]=e,this._scaleSignX=$t(t),this._scaleSignY=$t(e),this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const e=this.determinant();let s=e;e!==0&&(s=1/e);const r=this.data[0],l=this.data[2],h=this.data[1],u=this.data[3],f=t||_e.identity();f.data[0]=u*s,f.data[1]=-h*s,f.data[2]=-l*s,f.data[3]=r*s;const g=this.data[4],_=this.data[5];return f.data[4]=-(g*f.data[0]+_*f.data[2]),f.data[5]=-(g*f.data[1]+_*f.data[3]),f}multiply(t,e){if(t instanceof B){const s=e||new B(0,0),r=t,l=r.x*this.data[0]+r.y*this.data[2]+this.data[4],h=r.x*this.data[1]+r.y*this.data[3]+this.data[5];return s.x=l,s.y=h,s}else{const s=e||new _e,r=t,l=this.data[0],h=this.data[1],u=this.data[2],f=this.data[3],g=this.data[4],_=this.data[5],y=r.data[0],A=r.data[1],x=r.data[2],D=r.data[3],S=r.data[4],U=r.data[5];s.data[0]=l*y+u*A,s.data[1]=h*y+f*A,s.data[2]=l*x+u*D,s.data[3]=h*x+f*D,s.data[4]=l*S+u*U+g,s.data[5]=h*S+f*U+_;const R=this._scaleSignX,C=this._scaleSignY;return s._scaleSignX=R*$t(s._scaleSignX),s._scaleSignY=C*$t(s._scaleSignY),s}}multiplyQuadInPlace(t){const e=t[0]*this.data[0]+t[1]*this.data[2]+this.data[4],s=t[0]*this.data[1]+t[1]*this.data[3]+this.data[5];t[0]=e,t[1]=s;const r=t[2]*this.data[0]+t[3]*this.data[2]+this.data[4],l=t[2]*this.data[1]+t[3]*this.data[3]+this.data[5];t[2]=r,t[3]=l;const h=t[4]*this.data[0]+t[5]*this.data[2]+this.data[4],u=t[4]*this.data[1]+t[5]*this.data[3]+this.data[5];t[4]=h,t[5]=u;const f=t[6]*this.data[0]+t[7]*this.data[2]+this.data[4],g=t[6]*this.data[1]+t[7]*this.data[3]+this.data[5];t[6]=f,t[7]=g}to4x4(){const t=new Di;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const e=this.getScale(),s=Math.sin(t),r=Math.cos(t);this.data[0]=r*e.x,this.data[1]=s*e.y,this.data[2]=-s*e.x,this.data[3]=r*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return An(t)}getScaleX(){const t=this.data[0]*this.data[0]+this.data[2]*this.data[2];return t===1?this._scaleSignX:this._scaleSignX*Math.sqrt(t)}getScaleY(){const t=this.data[1]*this.data[1]+this.data[3]*this.data[3];return t===1?this._scaleSignY:this._scaleSignY*Math.sqrt(t)}getScale(){return L(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=$t(t);const e=L(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[2]=e.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=$t(t);const e=L(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[3]=e.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const e=t||new _e;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e._scaleSignX=this._scaleSignX,e._scaleSignY=this._scaleSignY,e}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class Ym extends B{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class yn extends B{constructor(t,e){super(t.x,t.y),this.original=t,this.change=e}get x(){return this._x=this.original.x}set x(t){t!==this._x&&(this.change(t,this._y),this._x=this.original.x=t)}get y(){return this._y=this.original.y}set y(t){t!==this._y&&(this.change(this._x,t),this._y=this.original.y=t)}setTo(t,e){this.x=t,this.y=e}}class bn{constructor(){this._parent=null,this._children=[],this._pos=new yn(L(0,0),()=>{this.flagDirty()}),this._globalPos=new Ym({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:e}=this.parent.inverse.multiply(L(t,this.pos.y));this.pos.x=e}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:e}=this.parent.inverse.multiply(L(this.pos.x,t));this.pos.y=e}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}}),this._rotation=0,this._scale=new yn(L(1,1),()=>{this.flagDirty()}),this._globalScale=new Ym({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.scale.x=t/e}else this.scale.x=t},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.scale.y=t/e}else this.scale.y=t}}),this._z=0,this._isDirty=!1,this._isInverseDirty=!1,this._matrix=_e.identity(),this._inverse=_e.identity(),this._scratch=_e.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const e=this._parent._children.indexOf(this);e>-1&&this._parent._children.splice(e,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){this._pos.x=t.x,this._pos.y=t.y}get pos(){return this._pos}set globalPos(t){let e=t.clone();this.parent&&(e=this.parent.inverse.multiply(t)),e.equals(this._pos)||(this._pos=e,this.flagDirty())}get globalPos(){return this._globalPos}set rotation(t){const e=An(t);e!==this._rotation&&this.flagDirty(),this._rotation=e}get rotation(){return this._rotation}set globalRotation(t){let e=0;this.parent&&(e=this.parent.globalRotation);const s=An(t+e);s!==this._rotation&&this.flagDirty(),this._rotation=s}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){this._scale.x=t.x,this._scale.y=t.y}get scale(){return this._scale}set globalScale(t){let e=L(1,1);this.parent&&(e=this.parent.globalScale),this.scale=t.scale(L(1/e.x,1/e.y))}get globalScale(){return this._globalScale}set z(t){this._z=t,this.flagDirty()}get z(){return this._z}set globalZ(t){this.parent?this.z=t-this.parent.globalZ:this.z=t}get globalZ(){return this.parent?this.z+this.parent.globalZ:this.z}get matrix(){return this._isDirty&&(this.parent===null?this._calculateMatrix().clone(this._matrix):this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this.matrix.inverse(this._inverse),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return this._scratch.data[0]=Math.cos(this._rotation),this._scratch.data[1]=Math.sin(this._rotation),this._scratch.data[2]=-Math.sin(this._rotation),this._scratch.data[3]=Math.cos(this.rotation),this._scratch.data[4]=this._pos.x,this._scratch.data[5]=this._pos.y,this._scratch.scale(this._scale.x,this._scale.y),this._scratch}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,e,s){this._pos.x=t.x,this._pos.y=t.y,this._rotation=An(e),this._scale.x=s.x,this._scale.y=s.y,this.flagDirty()}isMirrored(){const t=$t(this.scale.x)>>>31,e=$t(this.scale.y)>>>31;return!!(t^e)}clone(t){const e=t??new bn;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.flagDirty(),e}cloneWithParent(t){const e=t??new bn;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.parent=this.parent,e.flagDirty(),e}toString(){return this.matrix.toString()}}function zb(o){return!!o&&!!o.prototype&&!!o.prototype.constructor}function Ob(o){return!!(o!=null&&o.clone)}class Ji{constructor(){this.owner=void 0}clone(){const t=new this.constructor;for(const e in this)if(this.hasOwnProperty(e)){const s=this[e];Ob(s)&&e!=="owner"&&e!=="clone"?t[e]=s.clone():t[e]=s}return t}}class di{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);e!==-1&&this.subscriptions.splice(e,1)}notifyAll(t){const e=this.observers.length;for(let r=0;r<e;r++)this.observers[r].notify(t);const s=this.subscriptions.length;for(let r=0;r<s;r++)this.subscriptions[r](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class at extends Ji{constructor(){super(...arguments),this._logger=yt.getInstance(),this._parentComponent=null,this._transform=new bn,this._addChildTransform=t=>{const e=t.get(at);e&&(e._transform.parent=this._transform,e._parentComponent=this)},this.zIndexChanged$=new di,this._coordPlane=pi.World}get(){return this._transform}onAdd(t){for(const e of t.children)this._addChildTransform(e);t.childrenAdded$.subscribe(e=>this._addChildTransform(e)),t.childrenRemoved$.subscribe(e=>{const s=e.get(at);s&&(s._transform.parent=null,s._parentComponent=null)})}onRemove(t){this._transform.parent=null,this._parentComponent=null}get z(){return this._transform.z}set z(t){const e=this._transform.z;this._transform.z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get globalZ(){return this._transform.globalZ}set globalZ(t){this._transform.globalZ=t}get coordPlane(){return this._parentComponent?this._parentComponent.coordPlane:this._coordPlane}set coordPlane(t){var e;this._parentComponent?this._logger.warn(`Cannot set coordinate plane on child entity ${(e=this.owner)==null?void 0:e.name}, children inherit their coordinate plane from their parents.`):this._coordPlane=t}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}clone(){const t=new at;return t._transform=this._transform.clone(),t}}class qt extends Ji{constructor(){super(...arguments),this.vel=B.Zero,this.maxVel=B.One.scaleEqual(1/0),this.acc=B.Zero,this.scaleFactor=B.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}const Zn=class{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t)){const r=this._GROUPS.get(t);if(r.mask===e)return r;throw new Error(`Collision group ${t} already exists with a different mask!`)}const s=new Kr(t,this._CURRENT_BIT,e!==void 0?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,s),s}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}};Zn._STARTING_BIT=1;Zn._MAX_GROUPS=32;Zn._CURRENT_GROUP=1;Zn._CURRENT_BIT=Zn._STARTING_BIT;Zn._GROUPS=new Map;let ad=Zn;const xd=class{constructor(t,e,s){this._name=t,this._category=e,this._mask=s}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){const e=this.category&t.mask,s=this.mask&t.category;return e!==0&&s!==0}invert(){const t=ad.create("~("+this.name+")",~this.mask|0);return t._category=~this.category,t}static combine(t){const e=t.map(l=>l.name).join("+"),r=~t.reduce((l,h)=>h.category|l,0);return ad.create(e,r)}static collidesWith(t){const e=`collidesWith(${t.map(r=>r.name).join("+")})`,s=t.reduce((r,l)=>l.category|r,0);return ad.create(e,s)}toString(){return`
category: ${this.category.toString(2).padStart(32,"0")}
mask:     ${(this.mask>>>0).toString(2).padStart(32,"0")}
    `}};xd.All=new xd("Collide with all groups",-1,-1);let Kr=xd;class Dt{constructor(){this.other=null,this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class W0 extends Dt{constructor(t){super(),this.self=t,this.target=t}}class Ub extends Dt{constructor(t){super(),this.self=t,this.target=t}}class Lb extends Dt{constructor(t){super(),this.self=t,this.target=t}}class Fb extends Dt{constructor(t){super(),this.self=t,this.target=t}}class Nb extends Dt{constructor(t){super(),this.self=t,this.target=t}}class wc extends Dt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class Cc extends Dt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class Hb extends Dt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class Gb extends Dt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class Qb extends Dt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class Vb extends Dt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class ea extends Dt{constructor(t,e,s){super(),this.engine=t,this.elapsed=e,this.self=s,this.target=s}}class ia extends Dt{constructor(t,e,s){super(),this.engine=t,this.elapsed=e,this.self=s,this.target=s}}class Yb extends Dt{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class jb extends Dt{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class qb extends Dt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Xb extends Dt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Zb extends Dt{constructor(t,e,s,r){super(),this.button=t,this.index=e,this.value=s,this.self=r,this.target=r}}class Wb extends Dt{constructor(t,e,s){super(),this.axis=t,this.value=e,this.self=s,this.target=s}}class Jb extends Dt{constructor(t){super(),this.self=t,this.target=t}}class Kb extends Dt{constructor(t){super(),this.self=t,this.target=t}}class po extends Dt{constructor(t,e,s,r,l){super(),this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l,this.target=t}}class go extends Dt{constructor(t,e,s,r,l){super(),this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l,this.target=t}}class jm{constructor(t,e,s,r){this.self=t,this.other=e,this.side=s,this.contact=r}}class qm{constructor(t,e,s,r){this.self=t,this.other=e,this.side=s,this.lastContact=r}}class Xm{constructor(t,e,s,r,l){this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l}}class Zm{constructor(t,e,s,r,l){this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l}}class bd extends Dt{constructor(t,e,s,r){super(),this.self=t,this.other=e,this.side=s,this.contact=r,this.target=t}}class wd extends Dt{constructor(t,e,s,r){super(),this.self=t,this.other=e,this.side=s,this.lastContact=r,this.target=t}}class Sc extends Dt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class $b extends Dt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class tw extends Dt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class ew extends Dt{constructor(t){super(),this.self=t,this.target=t}}class iw extends Dt{constructor(t){super(),this.self=t,this.target=t}}class sw extends Dt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class nw extends Dt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class rw extends Dt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class aw extends Dt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class ow extends Dt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class lw extends Dt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}function cw(o){if(o.length===0)throw new Error("Cannot find minIndex of array.length == 0");let t=o[0],e=0;for(let s=1;s<o.length;s++)o[s]<t&&(t=o[s],e=s);return e}function jl(o){if(o&&o.getBoundingClientRect){const t=o.getBoundingClientRect();return L(t.x+window.scrollX,t.y+window.scrollY)}return B.Zero}function Co(o,t){let e=-1;return(e=t.indexOf(o))>-1?(t.splice(e,1),!0):!1}function hw(o,t){for(let e=0;e<o.length;e++)if(o[e]===t)return!0;return!1}function uw(o){throw new Error(o)}function Cd(o,t){var e;const s=new xn;return((e=t==null?void 0:t.schedule.bind(t))!=null?e:setTimeout)(()=>{s.resolve()},o),s.promise}function dw(o,t){const e={};for(const s in o)t.includes(s)||(e[s]=o[s]);return e}function od(o){return o&&typeof o=="object"&&!Array.isArray(o)}function Sd(o,...t){if(!t.length)return o;const e=t.shift();if(od(o)&&od(e))for(const s in e)od(e[s])?(o[s]||Object.assign(o,{[s]:{}}),Sd(o[s],e[s])):Object.assign(o,{[s]:e[s]});return Sd(o,...t)}const J0=class Td{constructor(t,e){this.id=Td._ID++,this.name=`Entity#${this.id}`,this.events=new re,this._tags=new Set,this.componentAdded$=new di,this.componentRemoved$=new di,this.tagAdded$=new di,this.tagRemoved$=new di,this.components=new Map,this.componentValues=[],this._componentsToRemove=[],this.scene=null,this.isActive=!0,this._parent=null,this.childrenAdded$=new di,this.childrenRemoved$=new di,this._children=[],this._isInitialized=!1,this._isAdded=!1;let s,r;if(Array.isArray(t))s=t,r=e;else if(t&&typeof t=="object"){const{components:l,name:h}=t;s=l??[],r=h}if(r&&(this.name=r),s)for(const l of s)this.addComponent(l)}get active(){return this.isActive}set active(t){this.isActive=t}kill(){this.isActive&&(this.isActive=!1,this.unparent()),this.emit("kill",new W0(this))}isKilled(){return!this.isActive}get tags(){return this._tags}hasTag(t){return this._tags.has(t)}addTag(t){return this._tags.add(t),this.tagAdded$.notifyAll(t),this}removeTag(t){return this._tags.delete(t),this.tagRemoved$.notifyAll(t),this}get types(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}hasAll(t){for(let e=0;e<t.length;e++)if(!this.components.has(t[e]))return!1;return!0}hasAllTags(t){for(let e=0;e<t.length;e++)if(!this.tags.has(t[e]))return!1;return!0}get(t){return this.components.get(t)}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(Co(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const s=e.pop();s&&(e=e.concat(s.children),t=t.concat(s.children))}return t}clone(){const t=new Td;for(const e of this.types){const s=this.get(e);s&&t.addComponent(s.clone())}for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const s of t.getComponents())this.addComponent(s.clone(),e);for(const s of t.children)this.addChild(s.clone().addTemplate(s));return this}_getClassHierarchyRoot(t){var e,s;let r=t,l=(e=Object.getPrototypeOf(r.prototype))==null?void 0:e.constructor;for(;l&&l!==Object&&l!==Ji;)r=l,l=(s=Object.getPrototypeOf(r.prototype))==null?void 0:s.constructor;return r}addComponent(t,e=!1){if(this.has(t.constructor))if(e)this.removeComponent(t.constructor,!0);else return this;if(t.dependencies&&t.dependencies.length)for(const r of t.dependencies)this.addComponent(new r);t.owner=this;const s=this._getClassHierarchyRoot(t.constructor);return this.components.set(s,t),this.components.set(t.constructor,t),this.componentValues.push(t),t.onAdd&&t.onAdd(this),this.componentAdded$.notifyAll(t),this}removeComponent(t,e=!1){let s;if(zb(t)?s=t:s=t.constructor,e){const r=this.components.get(s);if(r){this.componentRemoved$.notifyAll(r),r.owner=void 0,r.onRemove&&r.onRemove(this);const h=this.componentValues.indexOf(r);h>-1&&this.componentValues.splice(h,1)}const l=this._getClassHierarchyRoot(s);this.components.delete(l),this.components.delete(s)}else this._componentsToRemove.push(s);return this}clearComponents(){const t=this.types;for(const e of t)this.removeComponent(e)}processComponentRemoval(){for(const t of this._componentsToRemove)this.removeComponent(t,!0);this._componentsToRemove.length=0}has(t){return this.components.has(t)}get isInitialized(){return this._isInitialized}get isAdded(){return this._isAdded}_initialize(t){this.isInitialized||(this.onInitialize(t),this.events.emit("initialize",new Sc(t,this)),this._isInitialized=!0)}_add(t){!this.isAdded&&this.isActive&&(this.onAdd(t),this.events.emit("add",new ow(t,this)),this._isAdded=!0)}_remove(t){this.isAdded&&!this.isActive&&(this.onRemove(t),this.events.emit("remove",new lw(t,this)),this._isAdded=!1)}_preupdate(t,e){this.events.emit("preupdate",new ea(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new ia(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onAdd(t){}onRemove(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e);for(const s of this.children)s.update(t,e);this._postupdate(t,e),this._remove(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}};J0._ID=0;let Fs=J0;class fw{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._childAddedHandlerMap=new Map,this._childRemovedHandlerMap=new Map,this._createChildAddedHandler=()=>e=>{this.addEntity(e)},this._createChildRemovedHandler=()=>e=>{this.removeEntity(e,!1)},this._entitiesToRemove=[]}updateEntities(t,e){for(let s=0;s<this.entities.length;s++){const r=this.entities[s];r.update(t.engine,e),r.isActive||this.removeEntity(r)}}findEntitiesForRemoval(){for(let t=0;t<this.entities.length;t++){const e=this.entities[t];e.isActive||this.removeEntity(e)}}addEntity(t){if(t.isActive=!0,t.scene=this._world.scene,t&&!this._entityIndex[t.id]){this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.children.forEach(r=>{r.scene=t.scene,this.addEntity(r)});const e=this._createChildAddedHandler();this._childAddedHandlerMap.set(t,e);const s=this._createChildRemovedHandler();this._childRemovedHandlerMap.set(t,s),t.childrenAdded$.subscribe(e),t.childrenRemoved$.subscribe(s)}}removeEntity(t,e=!0){var s,r;let l=0;t instanceof Fs?l=t.id:l=t;const h=this._entityIndex[l];if(h&&h.isActive&&(h.isActive=!1),h&&e){this._entitiesToRemove.push(h);return}if(delete this._entityIndex[l],h){h.scene=null,Co(h,this.entities),this._world.queryManager.removeEntity(h),h.children.forEach(g=>{g.scene=null,this.removeEntity(g,e)});const u=this._childAddedHandlerMap.get(h);u&&(h.childrenAdded$.unsubscribe(u),this._childAddedHandlerMap.delete(h));const f=this._childRemovedHandlerMap.get(h);f&&(h.childrenRemoved$.unsubscribe(f),this._childRemovedHandlerMap.delete(h)),(r=(s=this._world)==null?void 0:s.scene)!=null&&r.engine&&this._world.scene.engine.stats.currFrame.actors.killed++}}processEntityRemovals(){for(let t=0;t<this._entitiesToRemove.length;t++){const e=this._entitiesToRemove[t];e.isActive||this.removeEntity(e,!1)}this._entitiesToRemove.length=0}processComponentRemovals(){for(let t=0;t<this.entities.length;t++)this.entities[t].processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(e=>e.name===t)}clear(){for(let t=this.entities.length-1;t>=0;t--)this.removeEntity(this.entities[t])}}class ns{constructor(t){this.entities=[],this.entityAdded$=new di,this.entityRemoved$=new di,this.filter={components:{all:new Set,any:new Set,not:new Set},tags:{all:new Set,any:new Set,not:new Set}};var e,s,r,l,h,u,f,g,_,y,A,x;Array.isArray(t)&&(t={components:{all:t}}),this.filter.components.all=new Set((s=(e=t.components)==null?void 0:e.all)!=null?s:[]),this.filter.components.any=new Set((l=(r=t.components)==null?void 0:r.any)!=null?l:[]),this.filter.components.not=new Set((u=(h=t.components)==null?void 0:h.not)!=null?u:[]),this.filter.tags.all=new Set((g=(f=t.tags)==null?void 0:f.all)!=null?g:[]),this.filter.tags.any=new Set((y=(_=t.tags)==null?void 0:_.any)!=null?y:[]),this.filter.tags.not=new Set((x=(A=t.tags)==null?void 0:A.not)!=null?x:[]),this.id=ns.createId(t)}static createId(t){var e,s,r,l,h,u,f,g,_,y,A,x;Array.isArray(t)&&(t={components:{all:t}});const D=(e=t.components)!=null&&e.any?`any_${ns.hashComponents(new Set((s=t.components)==null?void 0:s.any))}`:"",S=(r=t.components)!=null&&r.all?`all_${ns.hashComponents(new Set((l=t.components)==null?void 0:l.all))}`:"",U=(h=t.components)!=null&&h.not?`not_${ns.hashComponents(new Set((u=t.components)==null?void 0:u.not))}`:"",R=(f=t.tags)!=null&&f.any?`any_${ns.hashTags(new Set((g=t.tags)==null?void 0:g.any))}`:"",C=(_=t.tags)!=null&&_.all?`all_${ns.hashTags(new Set((y=t.tags)==null?void 0:y.all))}`:"",O=(A=t.tags)!=null&&A.not?`not_${ns.hashTags(new Set((x=t.tags)==null?void 0:x.not))}`:"";return[D,S,U,R,C,O].filter(Boolean).join("-")}static hashTags(t){return Array.from(t).map(e=>`t_${e}`).sort().join("-")}static hashComponents(t){return Array.from(t).map(e=>`c_${e.name}`).sort().join("-")}matches(t){for(const e of this.filter.components.all)if(!t.has(e))return!1;if(this.filter.components.any.size>0){let e=!1;for(const s of this.filter.components.any)if(t.has(s)){e=!0;break}if(!e)return!1}for(const e of this.filter.components.not)if(t.has(e))return!1;for(const e of this.filter.tags.all)if(!t.hasTag(e))return!1;if(this.filter.tags.any.size>0){let e=!1;for(const s of this.filter.tags.any)if(t.hasTag(s)){e=!0;break}if(!e)return!1}for(const e of this.filter.tags.not)if(t.hasTag(e))return!1;return!0}checkAndAdd(t){return this.matches(t)&&!this.entities.includes(t)?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class dc{constructor(t){if(this.requiredTags=t,this.tags=new Set,this.entities=[],this.entityAdded$=new di,this.entityRemoved$=new di,t.length===0)throw new Error("Cannot create tag query without tags");for(const e of t)this.tags.add(e);this.id=dc.createId(t)}static createId(t){return t.slice().sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAllTags(Array.from(this.tags))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class pw{constructor(t){this._world=t,this._queries=new Map,this._addComponentHandlers=new Map,this._removeComponentHandlers=new Map,this._componentToQueriesIndex=new Map,this._tagQueries=new Map,this._addTagHandlers=new Map,this._removeTagHandlers=new Map,this._tagToQueriesIndex=new Map,this._createAddComponentHandler=e=>s=>{this.addComponent(e,s)},this._createRemoveComponentHandler=e=>s=>{this.removeComponent(e,s)},this._createAddTagHandler=e=>s=>{this.addTag(e,s)},this._createRemoveTagHandler=e=>s=>{this.removeTag(e,s)}}createQuery(t){const e=ns.createId(t);if(this._queries.has(e))return this._queries.get(e);const s=new ns(t);this._queries.set(s.id,s);for(const r of[...s.filter.components.all,...s.filter.components.any,...s.filter.components.not]){const l=this._componentToQueriesIndex.get(r);l?l.push(s):this._componentToQueriesIndex.set(r,[s])}for(const r of this._world.entities)this.addEntity(r);return s}createTagQuery(t){const e=dc.createId(t);if(this._tagQueries.has(e))return this._tagQueries.get(e);const s=new dc(t);this._tagQueries.set(s.id,s);for(const r of t){const l=this._tagToQueriesIndex.get(r);l?l.push(s):this._tagToQueriesIndex.set(r,[s])}for(const r of this._world.entities)this.addEntity(r);return s}addEntity(t){const e=this._addComponentHandlers.get(t),s=this._removeComponentHandlers.get(t),r=e??this._createAddComponentHandler(t),l=s??this._createRemoveComponentHandler(t);this._addComponentHandlers.set(t,r),this._removeComponentHandlers.set(t,l);const h=this._addTagHandlers.get(t),u=this._removeTagHandlers.get(t),f=h??this._createAddTagHandler(t),g=u??this._createRemoveTagHandler(t);this._addTagHandlers.set(t,f),this._removeTagHandlers.set(t,g);for(const _ of this._queries.values())_.checkAndAdd(t);for(const _ of this._tagQueries.values())_.checkAndAdd(t);t.componentAdded$.subscribe(r),t.componentRemoved$.subscribe(l),t.tagAdded$.subscribe(f),t.tagRemoved$.subscribe(g)}removeEntity(t){const e=this._addComponentHandlers.get(t),s=this._removeComponentHandlers.get(t);for(const h of this._queries.values())h.removeEntity(t);e&&(t.componentAdded$.unsubscribe(e),this._addComponentHandlers.delete(t)),s&&(t.componentRemoved$.unsubscribe(s),this._removeComponentHandlers.delete(t));const r=this._addTagHandlers.get(t),l=this._removeTagHandlers.get(t);for(const h of this._tagQueries.values())h.removeEntity(t);r&&(t.tagAdded$.unsubscribe(r),this._addTagHandlers.delete(t)),l&&(t.tagRemoved$.unsubscribe(l),this._removeTagHandlers.delete(t))}addComponent(t,e){var s;const r=(s=this._componentToQueriesIndex.get(e.constructor))!=null?s:[];for(const l of r)l.checkAndAdd(t)}removeComponent(t,e){var s;const r=(s=this._componentToQueriesIndex.get(e.constructor))!=null?s:[];for(const l of r)l.removeEntity(t)}addTag(t,e){var s;const r=(s=this._tagToQueriesIndex.get(e))!=null?s:[];for(const l of r)l.checkAndAdd(t)}removeTag(t,e){var s;const r=(s=this._tagToQueriesIndex.get(e))!=null?s:[];for(const l of r)l.removeEntity(t)}}const Ns={Higher:-5,Average:0,Lower:5,Lowest:1/0};var Qi=(o=>(o.Update="update",o.Draw="draw",o))(Qi||{});class Vi{}Vi.priority=Ns.Average;function gw(o){var t,e;return!!(o!=null&&o.prototype)&&!!((e=(t=o==null?void 0:o.prototype)==null?void 0:t.constructor)!=null&&e.name)}class _w{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(e=>e instanceof t)}addSystem(t){let e;t instanceof Vi?e=t:e=new t(this._world),this.systems.push(e),this.systems.sort((s,r)=>s.constructor.priority-r.constructor.priority),this.initialized&&e.initialize&&e.initialize(this._world,this._world.scene)}removeSystem(t){Co(t,this.systems)}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world,this._world.scene)}}updateSystems(t,e,s){const r=this.systems.filter(l=>l.systemType===t);for(const l of r)l.preupdate&&l.preupdate(e,s);for(const l of r)l.update(s);for(const l of r)l.postupdate&&l.postupdate(e,s)}clear(){for(let t=this.systems.length-1;t>=0;t--)this.removeSystem(this.systems[t])}}class mw{constructor(t){this.scene=t,this._logger=yt.getInstance(),this.queryManager=new pw(this),this.entityManager=new fw(this),this.systemManager=new _w(this)}query(t){return this.queryManager.createQuery(t)}queryTags(t){return this.queryManager.createTagQuery(t)}update(t,e){t===Qi.Update&&this.entityManager.updateEntities(this.scene,e),this.systemManager.updateSystems(t,this.scene,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){if(t instanceof Fs){this.entityManager.addEntity(t);return}if(t instanceof Vi||gw(t)){this.systemManager.addSystem(t);return}this._logger.warn(`Could not add entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get(t){return this.systemManager.get(t)}remove(t,e=!0){if(t instanceof Fs){this.entityManager.removeEntity(t,e);return}if(t instanceof Vi){this.systemManager.removeSystem(t);return}this._logger.warn(`Could not remove entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get entities(){return this.entityManager.entities}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}var Jt=(o=>(o.None="None",o.Top="Top",o.Bottom="Bottom",o.Left="Left",o.Right="Right",o))(Jt||{});(o=>{function t(s){return s==="Top"?"Bottom":s==="Bottom"?"Top":s==="Left"?"Right":s==="Right"?"Left":"None"}o.getOpposite=t;function e(s){return Math.abs(s.x)>=Math.abs(s.y)?s.x<=0?"Left":"Right":s.y<=0?"Top":"Bottom"}o.fromDirection=e})(Jt||(Jt={}));const K0=class je{constructor(t=0,e=0,s=0,r=0){this._points=[],typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=e,this.right=s,this.bottom=r)}clone(t){const e=t||new je(0,0,0,0);return e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e}reset(){this.left=0,this.top=0,this.bottom=0,this.right=0}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?Jt.Right:Jt.Left:t.y<0?Jt.Bottom:Jt.Top:Jt.None}static fromPoints(t){let e=1/0,s=1/0,r=-1/0,l=-1/0;for(let h=0;h<t.length;h++)t[h].x<e&&(e=t[h].x),t[h].x>r&&(r=t[h].x),t[h].y<s&&(s=t[h].y),t[h].y>l&&(l=t[h].y);return new je(e,s,r,l)}static fromDimension(t,e,s=B.Half,r=B.Zero){return new je(-t*s.x+r.x,-e*s.y+r.y,t-t*s.x+r.x,e-e*s.y+r.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new B((this.left+this.right)/2,(this.top+this.bottom)/2)}get topLeft(){return new B(this.left,this.top)}get bottomRight(){return new B(this.right,this.bottom)}get topRight(){return new B(this.right,this.top)}get bottomLeft(){return new B(this.left,this.bottom)}translate(t){return new je(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=B.Zero){const s=this.getPoints().map(r=>r.rotate(t,e));return je.fromPoints(s)}scale(t,e=B.Zero){const s=this.translate(e);return new je(s.left*t.x,s.top*t.y,s.right*t.x,s.bottom*t.y)}transform(t){const e=t.data[0]*this.left,s=t.data[1]*this.left,r=t.data[0]*this.right,l=t.data[1]*this.right,h=t.data[2]*this.top,u=t.data[3]*this.top,f=t.data[2]*this.bottom,g=t.data[3]*this.bottom,_=t.getPosition(),y=Math.min(e,r)+Math.min(h,f)+_.x,A=Math.min(s,l)+Math.min(u,g)+_.y,x=Math.max(e,r)+Math.max(h,f)+_.x,D=Math.max(s,l)+Math.max(u,g)+_.y;return new je({left:y,top:A,right:x,bottom:D})}getPerimeter(){const t=this.width,e=this.height;return 2*(t+e)}getPoints(){return(this._left!==this.left||this._right!==this.right||this._top!==this.top||this._bottom!==this.bottom)&&(this._points.length=0,this._points.push(new B(this.left,this.top)),this._points.push(new B(this.right,this.top)),this._points.push(new B(this.right,this.bottom)),this._points.push(new B(this.left,this.bottom)),this._left=this.left,this._right=this.right,this._top=this.top,this._bottom=this.bottom),this._points}rayCast(t,e=1/0){let s,r;const l=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,h=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,u=(this.left-t.pos.x)*l,f=(this.right-t.pos.x)*l;r=Math.min(u,f),s=Math.max(u,f);const g=(this.top-t.pos.y)*h,_=(this.bottom-t.pos.y)*h;return r=Math.max(r,Math.min(g,_)),s=Math.min(s,Math.max(g,_)),s>=0&&s>=r&&r<e}rayCastTime(t,e=1/0){let s,r;const l=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,h=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,u=(this.left-t.pos.x)*l,f=(this.right-t.pos.x)*l;r=Math.min(u,f),s=Math.max(u,f);const g=(this.top-t.pos.y)*h,_=(this.bottom-t.pos.y)*h;return r=Math.max(r,Math.min(g,_)),s=Math.min(s,Math.max(g,_)),s>=0&&s>=r&&r<e?r:-1}contains(t){return t instanceof B?this.left<=t.x&&this.top<=t.y&&t.y<=this.bottom&&t.x<=this.right:t instanceof je?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t,e){const s=e||new je(0,0,0,0),r=Math.min(this.left,t.left),l=Math.min(this.top,t.top),h=Math.max(this.right,t.right),u=Math.max(this.bottom,t.bottom);return s.left=r,s.top=l,s.right=h,s.bottom=u,s}get dimensions(){return new B(this.width,this.height)}overlaps(t,e){const s=e||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const r=this.combine(t);return r.width+s<t.width+this.width&&r.height+s<t.height+this.height}intersect(t){if(this.bottom<=t.top||t.bottom<=this.top||this.right<=t.left||t.right<=this.left)return null;const e=this.bottom-t.top;je._SCRATCH_INTERSECT[0]=e;const s=t.bottom-this.top;je._SCRATCH_INTERSECT[1]=s;const r=this.right-t.left;je._SCRATCH_INTERSECT[2]=r;const l=t.right-this.left;je._SCRATCH_INTERSECT[3]=l;const h=cw(je._SCRATCH_INTERSECT);switch(h){case 0:return new B(0,-e);case 1:return new B(0,s);case 2:return new B(-r,0);case 3:return new B(l,0);default:const u=h;throw new Error(`Unreachable index: [${u}] on bounding box intersection!`)}}intersectWithSide(t){const e=this.intersect(t);return je.getSideFromIntersection(e)}draw(t,e=tt.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}};K0._SCRATCH_INTERSECT=[0,0,0,0];let Tt=K0;class ti{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=ti.calculatePairHash(t.id,e.id)}static canCollide(t,e){var s,r;if(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions())return!1;const l=(s=t==null?void 0:t.owner)==null?void 0:s.get(Kt),h=(r=e==null?void 0:e.owner)==null?void 0:r.get(Kt);return!(!l||!h||!l.group.canCollide(h.group)||l.collisionType===_t.Fixed&&h.collisionType===_t.Fixed||h.collisionType===_t.PreventCollision||l.collisionType===_t.PreventCollision||!l.isActive||!h.isActive)}get canCollide(){const t=this.colliderA,e=this.colliderB;return ti.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class Tc{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class Wm{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new Tt,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class $0{constructor(t,e=new Tt(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this._config=t,this.worldBounds=e,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const e=t.bounds;let s=this.root;for(;!s.isLeaf();){const u=s.left,f=s.right,g=s.bounds.getPerimeter(),y=s.bounds.combine(e).getPerimeter(),A=2*y,x=2*(y-g);let D=0;const S=e.combine(u.bounds);let U,R;u.isLeaf()?D=S.getPerimeter()+x:(R=u.bounds.getPerimeter(),U=S.getPerimeter(),D=U-R+x);let C=0;const O=e.combine(f.bounds);if(f.isLeaf()?C=O.getPerimeter()+x:(R=f.bounds.getPerimeter(),U=O.getPerimeter(),C=U-R+x),A<D&&A<C)break;D<C?s=u:s=f}const r=s.parent,l=new Wm(r);l.bounds=e.combine(s.bounds),l.height=s.height+1,r!==null?(r.left===s?r.left=l:r.right=l,l.left=s,l.right=t,s.parent=l,t.parent=l):(l.left=s,l.right=t,s.parent=l,t.parent=l,this.root=l);let h=t.parent;for(;h;){if(h=this._balance(h),!h.left)throw new Error("Parent of current leaf cannot have a null left child"+h);if(!h.right)throw new Error("Parent of current leaf cannot have a null right child"+h);h.height=1+Math.max(h.left.height,h.right.height),h.bounds=h.left.bounds.combine(h.right.bounds),h=h.parent}}_remove(t){if(t===this.root){this.root=null;return}const e=t.parent,s=e.parent;let r;if(e.left===t?r=e.right:r=e.left,s){s.left===e?s.left=r:s.right=r,r.parent=s;let l=s;for(;l;)l=this._balance(l),l.bounds=l.left.bounds.combine(l.right.bounds),l.height=1+Math.max(l.left.height,l.right.height),l=l.parent}else this.root=r,r.parent=null}trackCollider(t){const e=new Wm;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const s=this.nodes[t.id.value];if(!s)return!1;const r=t.bounds;if(!this.worldBounds.contains(r))return yt.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(s.bounds.contains(r))return!1;if(this._remove(s),r.left-=this._config.boundsPadding,r.top-=this._config.boundsPadding,r.right+=this._config.boundsPadding,r.bottom+=this._config.boundsPadding,t.owner){const l=(e=t.owner)==null?void 0:e.get(Kt);if(l){const h=l.vel.x*32/1e3*this._config.velocityMultiplier,u=l.vel.y*32/1e3*this._config.velocityMultiplier;h<0?r.left+=h:r.right+=h,u<0?r.top+=u:r.bottom+=u}}return s.bounds=r,this._insert(s),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,s=t.right,r=t,l=e,h=s,u=e.left,f=e.right,g=s.left,_=s.right,y=h.height-l.height;if(y>1)return h.left=r,h.parent=r.parent,r.parent=h,h.parent?h.parent.left===r?h.parent.left=h:h.parent.right=h:this.root=h,g.height>_.height?(h.right=g,r.right=_,_.parent=r,r.bounds=l.bounds.combine(_.bounds),h.bounds=r.bounds.combine(g.bounds),r.height=1+Math.max(l.height,_.height),h.height=1+Math.max(r.height,g.height)):(h.right=_,r.right=g,g.parent=r,r.bounds=l.bounds.combine(g.bounds),h.bounds=r.bounds.combine(_.bounds),r.height=1+Math.max(l.height,g.height),h.height=1+Math.max(r.height,_.height)),h;if(y<-1){if(l.left=r,l.parent=r.parent,r.parent=l,l.parent)if(l.parent.left===r)l.parent.left=l;else{if(l.parent.right!==r)throw"Error rotating Dynamic Tree";l.parent.right=l}else this.root=l;return u.height>f.height?(l.right=u,r.left=f,f.parent=r,r.bounds=h.bounds.combine(f.bounds),l.bounds=r.bounds.combine(u.bounds),r.height=1+Math.max(h.height,f.height),l.height=1+Math.max(r.height,u.height)):(l.right=f,r.left=u,u.parent=r,r.bounds=h.bounds.combine(u.bounds),l.bounds=r.bounds.combine(f.bounds),r.height=1+Math.max(h.height,u.height),l.height=1+Math.max(r.height,f.height)),l}return t}getHeight(){return this.root===null?0:this.root.height}query(t,e){const s=t.bounds,r=l=>{if(l&&l.bounds.overlaps(s))if(l.isLeaf()&&l.data!==t){if(e.call(t,l.data))return!0}else return r(l.left)||r(l.right);return!1};r(this.root)}rayCastQuery(t,e=1/0,s){const r=l=>{if(l&&l.bounds.rayCast(t,e))if(l.isLeaf()){if(s.call(t,l.data))return!0}else return r(l.left)||r(l.right);return!1};r(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=s=>{s&&(s.isLeaf()?s.bounds.draw(t,tt.Green):s.bounds.draw(t,tt.White),s.left&&e(s.left),s.right&&e(s.right))};e(this.root)}}class qr{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&e.cross(this.dir)!==0)return-1;const s=this.dir.cross(t.getSlope());if(s===0)return-1;const r=e.cross(t.getSlope())/s;if(r>=0){const l=e.cross(this.dir)/s/t.getLength();if(l>=0&&l<=1)return r}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class Ed{constructor(t){this._config=t,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[],this._dynamicCollisionTree=new $0(t.dynamicTree)}getColliders(){return this._colliders}query(t){const e=[];return t instanceof Tt?this._dynamicCollisionTree.query({id:Jr("collider",-1),owner:null,bounds:t},s=>(e.push(s),!1)):this._dynamicCollisionTree.query({id:Jr("collider",-1),owner:null,bounds:new Tt(t.x,t.y,t.x,t.y)},s=>(e.push(s),!1)),e}rayCast(t,e){var s,r,l;const h=[],u=(s=e==null?void 0:e.maxDistance)!=null?s:1/0,f=e==null?void 0:e.collisionGroup,g=f?f.category:(r=e==null?void 0:e.collisionMask)!=null?r:Kr.All.category,_=(l=e==null?void 0:e.searchAllColliders)!=null?l:!1;return this._dynamicCollisionTree.rayCastQuery(t,u,y=>{const x=y.owner.get(Kt);if(e!=null&&e.ignoreCollisionGroupAll&&x.group===Kr.All)return!1;const D=(g&x.group.category)!==0;if(x!=null&&x.group&&!D)return!1;const S=y.rayCast(t,u);if(S){if(e!=null&&e.filter){if(e.filter(S)&&(h.push(S),!_))return!0}else if(h.push(S),!_)return!0}return!1}),h}track(t){if(!t){yt.getInstance().warn("Cannot track null collider");return}if(t instanceof Qe){const e=t.getColliders();for(const s of e)s.owner=t.owner,this._colliders.push(s),this._dynamicCollisionTree.trackCollider(s)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){yt.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof Qe){const e=t.getColliders();for(const s of e){const r=this._colliders.indexOf(s);r!==-1&&this._colliders.splice(r,1),this._dynamicCollisionTree.untrackCollider(s)}}else{const e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,e){const s=ti.calculatePairHash(t.id,e.id);return this._pairs.has(s)}broadphase(t,e,s){const r=e/1e3,l=t.filter(u=>{var f,g;const _=(f=u.owner)==null?void 0:f.get(Kt);return((g=u.owner)==null?void 0:g.isActive)&&_.collisionType!==_t.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let h;for(let u=0,f=l.length;u<f;u++)h=l[u],this._dynamicCollisionTree.query(h,g=>{if(!this._pairExists(h,g)&&ti.canCollide(h,g)){const _=new ti(h,g);this._pairs.add(_.id),this._collisionPairCache.push(_)}return!1});if(s&&(s.physics.pairs=this._collisionPairCache.length),this._config.continuous.checkForFastBodies)for(const u of l){const f=u.owner.get(Kt);if((f==null?void 0:f.collisionType)!==_t.Active)continue;const g=f.vel.magnitude*r+f.acc.magnitude*.5*r*r,_=Math.min(u.bounds.height,u.bounds.width);if(this._config.continuous.disableMinimumSpeedForFastBody||g>_/2){s&&s.physics.fastBodies++;const y=f.globalPos.sub(f.oldPos),A=u.center,x=u.getFurthestPoint(f.vel),D=x.sub(y),S=new qr(D,f.vel);S.pos=S.pos.add(S.dir.scale(-2*this._config.continuous.surfaceEpsilon));let U,R=new B(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(S,g+this._config.continuous.surfaceEpsilon*2,C=>{if(!this._pairExists(u,C)&&ti.canCollide(u,C)){const O=C.rayCast(S,g+this._config.continuous.surfaceEpsilon*10);if(O){const G=O.point.sub(D);G.magnitude<R.magnitude&&(R=G,U=C)}}return!1}),U&&B.isValid(R)){const C=new ti(u,U);this._pairs.has(C.id)||(this._pairs.add(C.id),this._collisionPairCache.push(C));const O=A.sub(x);f.globalPos=D.add(O).add(R).add(S.dir.scale(10*this._config.continuous.surfaceEpsilon)),u.update(f.transform.get()),s&&s.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let s=[];for(let r=0;r<t.length;r++){const l=t[r].collide();if(s=s.concat(l),e&&l.length>0)for(const h of l)e.physics.contacts.set(h.id,h)}return e&&(e.physics.collisions+=s.length),s}update(t){let e=0;const s=t.length;for(let r=0;r<s;r++)this._dynamicCollisionTree.updateCollider(t[r])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}const ty=class ey{constructor(){this.id=Jr("collider",ey._ID++),this.composite=null,this.events=new re,this.offset=B.Zero}touching(t){const e=this.collide(t);return!!(e&&e.length>0)}};ty._ID=0;let Ec=ty;var af=(o=>(o.Arcade="arcade",o.Realistic="realistic",o))(af||{}),Wn=(o=>(o.None="none",o.VerticalFirst="vertical-first",o.HorizontalFirst="horizontal-first",o))(Wn||{});const iy={vertical:1,horizontal:2},sy={horizontal:1,vertical:2},ny={horizontal:0,vertical:0};var fc=(o=>(o.DynamicTree="dynamic-tree",o.SparseHashGrid="sparse-hash-grid",o))(fc||{});const vn=()=>({enabled:!0,gravity:L(0,0).clone(),solver:af.Arcade,substep:1,colliders:{compositeStrategy:"together"},continuous:{checkForFastBodies:!0,disableMinimumSpeedForFastBody:!1,surfaceEpsilon:.1},bodies:{canSleepByDefault:!1,sleepEpsilon:.07,wakeThreshold:.07*3,sleepBias:.9,defaultMass:10},spatialPartition:fc.SparseHashGrid,sparseHashGrid:{size:100},dynamicTree:{boundsPadding:5,velocityMultiplier:2},arcade:{contactSolveBias:Wn.None},realistic:{contactSolveBias:Wn.None,positionIterations:3,velocityIterations:8,slop:1,steeringFactor:.2,warmStart:!0}});class Qe extends Ec{constructor(t){super(),this._collisionProcessor=new Ed({...vn()}),this._dynamicAABBTree=new $0({boundsPadding:5,velocityMultiplier:2}),this._colliders=[];for(const e of t)this.addCollider(e)}set compositeStrategy(t){this._compositeStrategy=t}get compositeStrategy(){return this._compositeStrategy}clearColliders(){this._colliders=[]}addCollider(t){let e;t instanceof Qe?(e=t.getColliders(),e.forEach(s=>s.offset.addEqual(t.offset))):e=[t];for(const s of e)s.events.pipe(this.events),s.composite=this,this._colliders.push(s),this._collisionProcessor.track(s),this._dynamicAABBTree.trackCollider(s)}removeCollider(t){t.events.pipe(this.events),t.composite=null,Co(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return((e=(t=this._transform)==null?void 0:t.pos)!=null?e:B.Zero).add(this.offset)}get center(){var t,e;return((e=(t=this._transform)==null?void 0:t.pos)!=null?e:B.Zero).add(this.offset)}get bounds(){var t,e;const s=this.getColliders();return s.reduce((l,h)=>l.combine(h.bounds),(e=(t=s[0])==null?void 0:t.bounds)!=null?e:new Tt().translate(this.worldPos)).translate(this.offset)}get localBounds(){var t,e;const s=this.getColliders();return s.reduce((l,h)=>l.combine(h.localBounds),(e=(t=s[0])==null?void 0:t.localBounds)!=null?e:new Tt)}get axes(){const t=this.getColliders();let e=[];for(const s of t)e=e.concat(s.axes);return e}getFurthestPoint(t){const e=this.getColliders(),s=[];for(const h of e)s.push(h.getFurthestPoint(t));let r=s[0],l=-Number.MAX_VALUE;for(const h of s){const u=h.dot(t);u>l&&(r=h,l=u)}return r}getInertia(t){const e=this.getColliders();let s=0;for(const r of e)s+=r.getInertia(t);return s}collide(t){let e=[t];t instanceof Qe&&(e=t.getColliders());const s=[];for(const l of e)this._dynamicAABBTree.query(l,h=>(s.push(new ti(l,h)),!1));let r=[];for(const l of s)r=r.concat(l.collide());return r}getClosestLineBetween(t){const e=this.getColliders(),s=[];if(t instanceof Qe){const r=t.getColliders();for(const l of e)for(const h of r){const u=l.getClosestLineBetween(h);u&&s.push(u)}}else for(const r of e){const l=t.getClosestLineBetween(r);l&&s.push(l)}if(s.length){let r=s[0].getLength(),l=s[0];for(const h of s){const u=h.getLength();u<r&&(r=u,l=h)}return l}return null}contains(t){const e=this.getColliders();for(const s of e)if(s.contains(t))return!0;return!1}rayCast(t,e){const s=this.getColliders(),r=[];for(const l of s){const h=l.rayCast(t,e);h&&r.push(h)}if(r.length){let l=r[0],h=l.point.dot(t.dir);for(const u of r){const f=t.dir.dot(u.point);f<h&&(l=u,h=f)}return l}return null}project(t){const e=this.getColliders(),s=[];for(const r of e){const l=r.project(t);l&&s.push(l)}if(s.length){const r=new Tc(s[0].min,s[0].max);for(const l of s)r.min=Math.min(l.min,r.min),r.max=Math.max(l.max,r.max);return r}return null}update(t){if(t){const e=this.getColliders();for(const s of e)s.owner=this.owner,s.update(t)}}debug(t,e,s){const r=this.getColliders();t.save(),t.translate(this.offset.x,this.offset.y);for(const l of r)l.debug(t,e,s);t.restore()}clone(){const t=new Qe(this._colliders.map(e=>e.clone()));return t.offset=this.offset.clone(),t}}class ye{constructor(t,e){this.begin=t,this.end=e}clone(t){const e=t||new ye(this.begin.clone(),this.end.clone());return e.begin=this.begin.clone(e.begin),e.end=this.end.clone(e.end),e}transform(t,e){const s=e||new ye(B.Zero,B.Zero);return s.begin=t.multiply(this.begin,s.begin),s.end=t.multiply(this.end,s.end),s}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,e=this.end,s=t.distance(e);return this._slope=e.sub(t).scale(1/s)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new ye(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e,s=!0){let r=t;s&&(r=r.normalize());const l=r.dot(this.begin)-e,h=r.dot(this.end)-e,u=[];if(l<=0&&u.push(this.begin),h<=0&&u.push(this.end),l*h<0){const f=l/(l-h);u.push(this.begin.add(this.end.sub(this.begin).scale(f)))}return u.length!==2?null:new ye(u[0],u[1])}distanceToPoint(t,e=!1){const s=t.x,r=t.y,l=this.getLength(),h=this.end.y-this.begin.y,u=this.end.x-this.begin.x,f=(h*s-u*r+this.end.x*this.begin.y-this.end.y*this.begin.x)/l;return e?f:Math.abs(f)}findVectorToPoint(t){const e=this.begin.sub(t),s=this.getSlope();return e.sub(s.scale(e.dot(s)))}findPoint(t=null,e=null){const s=this.slope,r=this.intercept;if(t!==null)return new B(t,s*t+r);if(e!==null)return new B((e-r)/s,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new B(arguments[0],arguments[1]),e=arguments[2]||0;else if(arguments[0]instanceof B)t=arguments[0],e=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const s=t.x-this.begin.x,r=t.y-this.begin.y,l=this.end.x-this.begin.x,h=this.end.y-this.begin.y,u=s*h-r*l;return Math.abs(u)>e?!1:Math.abs(l)>=Math.abs(h)?l>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:h>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function ld(o,t){const s=o.dir(),r=t.dir(),l=s.dot(s),h=r.dot(r);if(l<1e-9&&h<1e-9)return new ye(o.begin,t.begin);if(l<1e-9){const U=Pt(r.dot(o.begin.sub(t.begin))/h,0,1),R=t.begin.add(r.scale(U));return new ye(o.begin,R)}if(h<1e-9){const U=Pt(s.dot(t.begin.sub(o.begin))/l,0,1),R=o.begin.add(s.scale(U));return new ye(R,t.begin)}const u=o.begin.sub(t.begin),f=l,g=h,_=r.dot(u),y=f*g-Math.pow(s.dot(r),2);let A=0,x=0;Math.abs(y)>1e-9?A=Pt((s.dot(r)*_-g*s.dot(u))/y,0,1):A=Pt(s.dot(u)/f,0,1),Math.abs(g)>1e-9?x=Pt((s.dot(r)*A+_)/g,0,1):x=0;const D=o.begin.add(s.scale(A)),S=t.begin.add(r.scale(x));return new ye(D,S)}const Us={PolygonPolygonClosestLine(o,t){const e=o.getSides(),s=t.getSides();let r=Number.MAX_VALUE,l=null;for(let h=0;h<e.length;h++)for(let u=0;u<s.length;u++){const f=ld(e[h],s[u]),g=f.getLength();g<r&&(r=g,l=f)}return l},PolygonEdgeClosestLine(o,t){const s=t.worldPos.sub(o.worldPos),r=new qr(o.worldPos,s),l=o.rayCast(r).point.add(r.dir.scale(.1)),h=o.getClosestFace(l),u=t.asLine();return ld(h.face,u)},PolygonCircleClosestLine(o,t){const e=t.worldPos,s=e.sub(o.worldPos),r=new qr(o.worldPos,s.normalize()),l=o.rayCast(r).point.add(r.dir.scale(.1)),h=o.getClosestFace(l),u=h.face.begin,f=h.face.getEdge();let g=(f.x*(e.x-u.x)+f.y*(e.y-u.y))/(f.x*f.x+f.y*f.y);g>1?g=1:g<0&&(g=0);const _=Math.sqrt(Math.pow(u.x+f.x*g-e.x,2)+Math.pow(u.y+f.y*g-e.y,2))-t.radius,y=(u.x+f.x*g-e.x)*t.radius/(t.radius+_),A=(u.y+f.y*g-e.y)*t.radius/(t.radius+_);return new ye(f.scale(g).add(u),new B(e.x+y,e.y+A))},CircleCircleClosestLine(o,t){const s=t.worldPos.sub(o.worldPos),l=o.worldPos.sub(t.worldPos),h=new qr(o.worldPos,s),u=new qr(t.worldPos,l),f=o.rayCast(h),g=t.rayCast(u);return new ye(f.point,g.point)},CircleEdgeClosestLine(o,t){const e=o.worldPos,s=t.asLine(),r=s.begin,l=s.getEdge(),h=r,u=l;let f=(u.x*(e.x-h.x)+u.y*(e.y-h.y))/(u.x*u.x+u.y*u.y);f>1?f=1:f<0&&(f=0);const g=Math.sqrt(Math.pow(h.x+u.x*f-e.x,2)+Math.pow(h.y+u.y*f-e.y,2))-o.radius,_=(h.x+u.x*f-e.x)*o.radius/(o.radius+g),y=(h.y+u.y*f-e.y)*o.radius/(o.radius+g);return new ye(u.scale(f).add(h),new B(e.x+_,e.y+y))},EdgeEdgeClosestLine(o,t){const e=o.asLine(),s=t.asLine();return ld(e,s)}};class qe extends Ec{constructor(t){super(),this.offset=B.Zero,this._globalMatrix=_e.identity(),this._localBoundsDirty=!0,this.offset=t.offset||B.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;if(this._radius)return this._radius;const e=this._transform,s=(t=e==null?void 0:e.globalScale)!=null?t:B.One;return this._radius=this._naturalRadius*Math.min(s.x,s.y)}set radius(t){var e;const s=this._transform,r=(e=s==null?void 0:s.globalScale)!=null?e:B.One;this._naturalRadius=t/Math.min(r.x,r.y),this._localBoundsDirty=!0,this._radius=t}clone(){return new qe({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var e,s;return((s=(e=this._transform)==null?void 0:e.pos)!=null?s:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){var s,r;const l=this.center,h=t.dir,u=t.pos,f=l.sub(u),g=h.scale(f.dot(h)),y=f.sub(g).magnitude;if(y>this.radius)return null;{let A=0;if(Bb(y,this.radius,1e-4)){if(A=-h.dot(u.sub(l)),A>0&&A<e){const x=t.getPoint(A);return{point:x,normal:x.sub(l).normalize(),collider:this,body:(s=this.owner)==null?void 0:s.get(Kt),distance:A}}return null}else{const x=Math.sqrt(Math.pow(h.dot(u.sub(l)),2)-Math.pow(u.sub(l).distance(),2)+Math.pow(this.radius,2)),D=-h.dot(u.sub(l))+x,S=-h.dot(u.sub(l))-x,U=[];D>=0&&U.push(D),S>=0&&U.push(S);const R=Math.min(...U);if(R<=e){const C=t.getPoint(R);return{point:C,normal:C.sub(l).normalize(),collider:this,body:(r=this.owner)==null?void 0:r.get(Kt),distance:R}}return null}}}getClosestLineBetween(t){if(t instanceof qe)return Us.CircleCircleClosestLine(this,t);if(t instanceof Ne)return Us.PolygonCircleClosestLine(t,this).flip();if(t instanceof Ri)return Us.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof qe)return ls.CollideCircleCircle(this,t);if(t instanceof Ne)return ls.CollideCirclePolygon(this,t);if(t instanceof Ri)return ls.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=new Tt(-this._naturalRadius,-this._naturalRadius,+this._naturalRadius,+this._naturalRadius),this._localBoundsDirty=!1),this._localBounds}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var e;this._transform=t,((e=t.matrix)!=null?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y),this._radius=void 0}project(t){const e=[],r=this.center.dot(t);return e.push(r),e.push(r+this.radius),e.push(r-this.radius),new Tc(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e,s){var r,l,h,u;const{lineWidth:f}={lineWidth:1,...s},g=this._transform,_=(r=g==null?void 0:g.globalScale)!=null?r:B.One,y=(l=g==null?void 0:g.globalRotation)!=null?l:0,A=(h=g==null?void 0:g.globalPos)!=null?h:B.Zero;t.save(),t.translate(A.x,A.y),t.rotate(y),t.scale(_.x,_.y),t.drawCircle((u=this.offset)!=null?u:B.Zero,this._naturalRadius,tt.Transparent,e,f),t.restore()}}class Gr{constructor(t,e,s,r,l,h,u,f){this._canceled=!1,this.bodyA=null,this.bodyB=null;var g,_,y,A,x,D;if(this.colliderA=t,this.colliderB=e,this.mtv=s,this.normal=r,this.tangent=l,this.points=h,this.localPoints=u,this.info=f,this.id=ti.calculatePairHash(t.id,e.id),t.composite||e.composite){const S=((g=t.composite)==null?void 0:g.compositeStrategy)==="separate"?t.id:(y=(_=t.composite)==null?void 0:_.id)!=null?y:t.id,U=((A=e.composite)==null?void 0:A.compositeStrategy)==="separate"?e.id:(D=(x=e.composite)==null?void 0:x.id)!=null?D:e.id;this.id+="|"+ti.calculatePairHash(S,U)}this.colliderA.owner&&(this.bodyA=this.colliderA.owner.get(Kt)),this.colliderB.owner&&(this.bodyB=this.colliderB.owner.get(Kt))}matchAwake(){const t=this.bodyA,e=this.bodyB;t&&e&&t.isSleeping!==e.isSleeping&&(t.isSleeping&&t.collisionType!==_t.Fixed&&e.sleepMotion>=t.wakeThreshold&&(t.isSleeping=!1),e.isSleeping&&e.collisionType!==_t.Fixed&&t.sleepMotion>=e.wakeThreshold&&(e.isSleeping=!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}bias(t){if(t!==this.colliderA&&t!==this.colliderB)throw new Error("Collider must be either colliderA or colliderB from this contact");if(t===this.colliderA)return this;const e=this.colliderA,s=this.colliderB;return this.colliderB=e,this.colliderA=s,this.mtv=this.mtv.negate(),this.normal=this.normal.negate(),this.tangent=this.tangent.negate(),this}}class of{constructor(t,e,s=100){this.builder=t,this.recycler=e,this.maxObjects=s,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=yt.getInstance()}dispose(){this.objects.length=0}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){const e=this.get();t(e),this.index--}get(){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler?this.recycler(this.objects[this.index++]):this.objects[this.index++]:(this.totalAllocations++,this.objects[this.index++]=this.builder())}done(...t){this.index=0;for(const e of t){const s=this.objects.indexOf(e);this.objects[s]=this.builder(),this.totalAllocations++}return t}}class yw{constructor(){this.axis=L(0,0),this.localAxis=L(0,0),this.side=new ye(L(0,0),L(0,0)),this.localSide=new ye(L(0,0),L(0,0)),this.point=L(0,0),this.localPoint=L(0,0)}}const $n=class Is{static findPolygonPolygonSeparation(t,e){if(e.transform.matrix.determinant()===0)return Is.findPolygonPolygonSeparationDegenerate(t,e);let s=-Number.MAX_VALUE,r=-1,l;const h=e.transform.inverse.multiply(t.transform.matrix,Is._SCRATCH_MATRIX),u=h.getRotation(),f=t.normals,g=t.points,_=e.points;for(let x=0;x<g.length;x++){const D=f[x].rotate(u,Is._ZERO,Is._SCRATCH_NORMAL),S=h.multiply(g[x],Is._SCRATCH_POINT);let U=Number.MAX_VALUE,R;for(let C=0;C<_.length;C++){const O=D.dot(_[C].sub(S,Is._SCRATCH_SUB_POINT));O<U&&(U=O,R=_[C])}U>s&&(s=U,r=x,l=R)}const y=(r+1)%g.length,A=Is.SeparationPool.get();return A.collider=t,A.separation=s,s>0||(f[r].clone(A.localAxis),f[r].rotate(t.transform.rotation,Is._ZERO,A.axis),t.transform.matrix.multiply(g[r],A.side.begin),t.transform.matrix.multiply(g[y],A.side.end),e.transform.matrix.multiply(l,A.point),A.sideId=r,l.clone(A.localPoint),g[r].clone(A.localSide.begin),g[y].clone(A.localSide.end)),A}static findCirclePolygonSeparation(t,e){const s=e.axes,l=e.center.sub(t.worldPos),h=e.getFurthestPoint(l.negate());s.push(h.sub(t.worldPos).normalize());let u=Number.MAX_VALUE,f=null,g=-1;for(let _=0;_<s.length;_++){const y=e.project(s[_]),A=t.project(s[_]),x=y.getOverlap(A);if(x<=0)return null;x<u&&(u=x,f=s[_],g=_)}return g<0?null:f.normalize().scale(u)}static findPolygonPolygonSeparationDegenerate(t,e){let s=-Number.MAX_VALUE,r=null,l=null,h=-1,u=null;const f=t.getSides(),g=t.getLocalSides();for(let _=0;_<f.length;_++){const y=f[_],A=y.normal(),x=e.getFurthestPoint(A.negate()),D=y.distanceToPoint(x,!0);D>s&&(s=D,r=y,l=A,h=_,u=x)}return{collider:t,separation:l?s:99,axis:l,side:r,localSide:g[h],sideId:h,point:u,localPoint:l?e.getFurthestLocalPoint(l.negate()):null}}};$n.SeparationPool=new of(()=>new yw,o=>o,500);$n._ZERO=L(0,0);$n._SCRATCH_POINT=L(0,0);$n._SCRATCH_SUB_POINT=L(0,0);$n._SCRATCH_NORMAL=L(0,0);$n._SCRATCH_MATRIX=_e.identity();let ro=$n;ro.SeparationPool.disableWarnings=!0;const Aw=B.Zero,vw=B.Zero,xw=_e.identity(),ls={CollideCircleCircle(o,t){const e=o.worldPos,s=t.worldPos,r=o.radius+t.radius,l=e.distance(s);if(l>r)return[];const h=r-l,u=s.sub(e).normalize(),f=u.perpendicular(),g=u.scale(h),_=o.getFurthestPoint(u),y=o.getFurthestLocalPoint(u),A={collider:o,separation:h,axis:u,point:_};return[new Gr(o,t,g,u,f,[_],[y],A)]},CollideCirclePolygon(o,t){var e,s;let r=ro.findCirclePolygonSeparation(o,t);if(!r)return[];r=r.dot(t.center.sub(o.center))<0?r.negate():r;const h=o.getFurthestPoint(r),f=((s=(e=o.owner)==null?void 0:e.get(at))!=null?s:new at).applyInverse(h),g=r.normalize(),_={collider:o,separation:-r.magnitude,axis:g,point:h,localPoint:f,side:t.findSide(g.negate()),localSide:t.findLocalSide(g.negate())};return[new Gr(o,t,r,g,g.perpendicular(),[h],[f],_)]},CollideCircleEdge(o,t){const e=o.center,s=t.asLine(),r=s.end.sub(s.begin),l=r.dot(s.end.sub(e)),h=r.dot(e.sub(s.begin)),u=t.asLine(),f=t.asLocalLine();if(h<=0){const R=s.begin.sub(e),C=R.dot(R);if(C>o.radius*o.radius)return[];const O=R.normalize(),G=o.radius-Math.sqrt(C),q={collider:o,separation:G,axis:O,point:u.begin,side:u,localSide:f};return[new Gr(o,t,O.scale(G),O,O.perpendicular(),[u.begin],[f.begin],q)]}if(l<=0){const R=s.end.sub(e),C=R.dot(R);if(C>o.radius*o.radius)return[];const O=R.normalize(),G=o.radius-Math.sqrt(C),q={collider:o,separation:G,axis:O,point:u.end,side:u,localSide:f};return[new Gr(o,t,O.scale(G),O,O.perpendicular(),[u.end],[f.end],q)]}const g=r.dot(r),_=s.begin.scale(l).add(s.end.scale(h)).scale(1/g),y=e.sub(_),A=y.dot(y);if(A>o.radius*o.radius)return[];let x=r.perpendicular();x.dot(e.sub(s.begin))<0&&(x.x=-x.x,x.y=-x.y),x=x.normalize();const D=o.radius-Math.sqrt(A),S=x.scale(D),U={collider:o,separation:D,axis:x,point:_,side:u,localSide:f};return[new Gr(o,t,S,x.negate(),x.negate().perpendicular(),[_],[_.sub(t.worldPos)],U)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(o,t){var e;const s=o.center,l=t.center.sub(s).normalize(),h=new Ne({points:[t.begin,t.end,t.end.add(l.scale(100)),t.begin.add(l.scale(100))],offset:t.offset});h.owner=t.owner,((e=t.owner)==null?void 0:e.get(at))&&h.update(t.owner.get(at).get());const f=this.CollidePolygonPolygon(o,h);return f.length&&(f[0].colliderB=t,f[0].id=ti.calculatePairHash(o.id,t.id)),f},CollidePolygonPolygon(o,t){const e=ro.findPolygonPolygonSeparation(o,t);if(e.separation>0)return[];const s=ro.findPolygonPolygonSeparation(t,o);if(s.separation>0)return[];const r=e.separation>s.separation?e:s,l=r.collider===o?t:o,h=r.collider===o?o:t,u=l.transform.inverse.multiply(h.transform.matrix,xw),f=u.getRotation(),g=h.normals[r.sideId].rotate(f,Aw,vw);let _=Number.MAX_VALUE,y=0;for(let R=0;R<l.normals.length;R++){const C=g.dot(l.normals[R]);C<_&&(_=C,y=R)}if(!r.localSide||!r.localAxis||!r.axis)return[];const A=r.localSide.transform(u),x=r.localAxis.perpendicular().negate().rotate(f),S=new ye(l.points[y],l.points[(y+1)%l.points.length]).clip(x.negate(),-x.dot(A.begin),!1);let U=null;if(S&&(U=S.clip(x,x.dot(A.end),!1)),U){const R=[],C=[],O=U.getPoints();for(let et=0;et<O.length;et++){const k=O[et];A.below(k)&&(R.push(k),C.push(l.transform.apply(k)))}let G=r.axis,q=G.perpendicular();return t.center.sub(o.center).dot(G)<0&&(G=G.negate(),q=G.perpendicular()),[new Gr(o,t,G.scale(-r.separation),G,q,C,R,r)]}return[]},FindContactSeparation(o,t){var e,s,r,l;const h=o.colliderA,u=(s=(e=o.bodyA)==null?void 0:e.transform)!=null?s:new at,f=o.colliderB,g=(l=(r=o.bodyB)==null?void 0:r.transform)!=null?l:new at;if(h instanceof qe&&f instanceof qe){const _=h.radius+f.radius,y=u.pos.distance(g.pos);return-(_-y)}if(h instanceof Ne&&f instanceof Ne&&o.info.localSide){let _,y;return o.info.collider===h?(_=new ye(u.apply(o.info.localSide.begin).add(h.offset),u.apply(o.info.localSide.end).add(h.offset)),y=g.apply(t).add(f.offset)):(_=new ye(g.apply(o.info.localSide.begin).add(f.offset),g.apply(o.info.localSide.end).add(f.offset)),y=u.apply(t).add(h.offset)),_.distanceToPoint(y,!0)}if(h instanceof Ne&&f instanceof qe||f instanceof Ne&&h instanceof qe){const _=u.apply(t);if(o.info.side)return o.info.side.distanceToPoint(_,!0)}if(h instanceof Ri&&f instanceof Ne||f instanceof Ri&&h instanceof Ne){let _;if(o.info.collider===h?_=g.apply(t):_=u.apply(t),o.info.side)return o.info.side.distanceToPoint(_,!0)}if(h instanceof qe&&f instanceof Ri||f instanceof qe&&h instanceof Ri){const _=g.apply(t);let y;h instanceof qe&&(y=h.getFurthestPoint(o.normal));const A=_.distance(y);if(o.info.side)return A>0?-A:0}return 0}};class Ri extends Ec{constructor(t){var e;super(),this._globalMatrix=_e.identity(),this.begin=t.begin||B.Zero,this.end=t.end||B.Zero,this.offset=(e=t.offset)!=null?e:B.Zero}clone(){return new Ri({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return(t=e==null?void 0:e.globalPos.add(this.offset))!=null?t:this.offset}get center(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.average(e)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),s=t.distance(e);return e.sub(t).scale(1/s)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){var s;const r=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&r.cross(t.dir)!==0)return null;const l=t.dir.cross(this.getSlope());if(l===0)return null;const h=r.cross(this.getSlope())/l;if(h>=0&&h<=e){const u=r.cross(t.dir)/l/this.getLength();if(u>=0&&u<=1)return{distance:h,normal:this.asLine().normal(),collider:this,body:(s=this.owner)==null?void 0:s.get(Kt),point:t.getPoint(h)}}return null}getClosestLineBetween(t){if(t instanceof qe)return Us.CircleEdgeClosestLine(t,this);if(t instanceof Ne)return Us.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Ri)return Us.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof qe)return ls.CollideCircleEdge(t,this);if(t instanceof Ne)return ls.CollidePolygonEdge(t,this);if(t instanceof Ri)return ls.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),s=this._getTransformedEnd();return t.dot(e)>0?e:s}_boundsFromBeginEnd(t,e,s=10){return new Tt(Math.min(t.x,e.x)-s,Math.min(t.y,e.y)-s,Math.max(t.x,e.x)+s,Math.max(t.y,e.y)+s)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new ye(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new ye(this.begin,this.end)}get axes(){const e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),s=[];return s.push(e),s.push(e.negate()),s.push(e.normal()),s.push(e.normal().negate()),s}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){var e;this._transform=t,((e=t.matrix)!=null?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],s=[this._getTransformedBegin(),this._getTransformedEnd()],r=s.length;for(let l=0;l<r;l++)e.push(s[l].dot(t));return new Tc(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){const s=this._getTransformedBegin(),r=this._getTransformedEnd();t.drawLine(s,r,e,2),t.drawCircle(s,2,e),t.drawCircle(r,2,e)}}class Ne extends Ec{constructor(t){var e;super(),this._logger=yt.getInstance(),this._transform=new bn,this._transformedPoints=[],this._sides=[],this._localSides=[],this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(e=t.offset)!=null?e:B.Zero,this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y,this.points=t.points,this.isConvex()||t.suppressConvexWarning||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}flagDirty(){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._transformedPointsDirty=!0,this._sidesDirty=!0}get normals(){return this._normals}set points(t){if(t.length<3)throw new Error("PolygonCollider cannot be created with less that 3 points");this._points=t,this._checkAndUpdateWinding(this._points),this._calculateNormals(),this.flagDirty()}_calculateNormals(){const t=[];for(let e=0;e<this._points.length;e++)t.push(this._points[(e+1)%this._points.length].sub(this._points[e]).normal());this._normals=t}get points(){return this._points}get transform(){return this._transform}_checkAndUpdateWinding(t){this._isCounterClockwiseWinding(t)||t.reverse()}_isCounterClockwiseWinding(t){let e=0;for(let s=0;s<t.length;s++)e+=(t[(s+1)%t.length].x-t[s].x)*(t[(s+1)%t.length].y+t[s].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],s=Math.atan2(e.y-t.y,e.x-t.x),r=0,l=0,h=0;for(const[u,f]of this.points.entries()){if(t=e,r=s,e=f,s=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let g=s-r;if(g<=-Math.PI?g+=Math.PI*2:g>Math.PI&&(g-=Math.PI*2),u===0){if(g===0)return!1;l=g>0?1:-1}else if(l*g<=0)return!1;h+=g}return Math.abs(Math.round(h/(Math.PI*2)))===1}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new Qe(t.map(e=>Xe.Polygon(e)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");const t=[],e=[...this.points].reverse();let s=e.length;function r(y){return y===0?s-1:y-1}function l(y){return y===s-1?0:y+1}function h(y){const A=r(y),x=l(y),D=e[A],S=e[y],U=e[x],R=D.sub(S),C=U.sub(S);return!(R.cross(C)<0)}const u=e.map((y,A)=>h(A));function f(y,A,x,D){const S=x.sub(A),U=D.sub(x),R=A.sub(D),C=y.sub(A),O=y.sub(x),G=y.sub(D),q=S.cross(C),et=U.cross(O),k=R.cross(G);return!(q>0||et>0||k>0)}function g(){for(let y=0;y<s;y++)if(u[y]){const A=r(y),x=l(y),D=e[A],S=e[y],U=e[x];let R=!0;for(let C=0;C<s;C++){if(C===y||C===A||C===x)continue;const O=e[C];if(f(O,D,S,U)){R=!1;break}}if(R)return y}for(let y=0;y<s;y++)if(u[y])return y;return 0}function _(y){const A=r(y),x=l(y),D=e[A],S=e[y],U=e[x];t.push([D,S,U]),e.splice(y,1),u.splice(y,1),s--}for(;s>3;){const y=g();_(y);for(let A=0;A<s;A++)u[A]=h(A)}return t.push([e[0],e[1],e[2]]),new Qe(t.map(y=>Xe.Polygon(y,B.Zero,!0)))}clone(){return new Ne({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform.pos}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,e=t.length;this._transformedPoints.length=0;for(let s=0;s<e;s++)this._transformedPoints[s]=this._transform.apply(t[s].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],e=this.getTransformedPoints(),s=e.length;for(let r=0;r<s;r++)t.push(new ye(e[r],e[(r+1)%s]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],e=this.points,s=e.length;for(let r=0;r<s;r++)t.push(new ye(e[r],e[(r+1)%s]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const e=this.getSides();let s=e[0],r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=e[l],f=h.normal().dot(t);f>r&&(s=h,r=f)}return s}findLocalSide(t){const e=this.getLocalSides();let s=e[0],r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=e[l],f=h.normal().dot(t);f>r&&(s=h,r=f)}return s}get axes(){const t=[],e=this.getSides();for(let s=0;s<e.length;s++)t.push(e[s].normal());return t}update(t){t&&(t.cloneWithParent(this._transform),this._transformedPointsDirty=!0,this._sidesDirty=!0,(this.offset.x!==0||this.offset.y!==0)&&(this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y),this._transform.isMirrored()&&(this.points=this.points.map(e=>L(e.x*$t(this._transform.scale.x),e.y*$t(this._transform.scale.y))),this._transform.scale.x=Math.abs(this._transform.scale.x),this._transform.scale.y=Math.abs(this._transform.scale.y)))}contains(t){const e=this._transform.applyInverse(t),s=new qr(e,new B(1,0));let r=0;const l=this.getLocalSides();for(let h=0;h<l.length;h++){const u=l[h];s.intersect(u)>=0&&r++}return r%2!==0}getClosestLineBetween(t){if(t instanceof qe)return Us.PolygonCircleClosestLine(this,t);if(t instanceof Ne)return Us.PolygonPolygonClosestLine(this,t);if(t instanceof Ri)return Us.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof qe)return ls.CollideCirclePolygon(t,this);if(t instanceof Ne)return ls.CollidePolygonPolygon(this,t);if(t instanceof Ri)return ls.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let s=null,r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=t.dot(e[l]);h>r&&(r=h,s=e[l])}return s}getFurthestLocalPoint(t){const e=this.points;let s=e[0],r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=t.dot(e[l]);h>r&&(r=h,s=e[l])}return s}getClosestFace(t){const e=this.getSides();let s=Number.POSITIVE_INFINITY,r=-1,l=-1;for(let h=0;h<e.length;h++){const u=e[h].distanceToPoint(t);u<s&&(s=u,r=h,l=u)}return r!==-1?{distance:e[r].normal().scale(l),face:e[r]}:null}get bounds(){return this.localBounds.transform(this._transform.matrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=Tt.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let e=0,s=0;const r=this.points;for(let l=0;l<r.length;l++){const h=(l+1)%r.length,u=r[h].cross(r[l]);e+=u*(r[l].dot(r[l])+r[l].dot(r[h])+r[h].dot(r[h])),s+=u}return this._cachedMass=t,this._cachedInertia=t/6*(e/s)}rayCast(t,e=1/0){var s;const r=this.getSides(),l=r.length;let h=Number.MAX_VALUE,u,f=-1;for(let g=0;g<l;g++){const _=t.intersect(r[g]);_>=0&&_<h&&_<=e&&(h=_,u=r[g],f=g)}return f>=0?{collider:this,distance:h,body:(s=this.owner)==null?void 0:s.get(Kt),point:t.getPoint(h),normal:u.normal()}:null}project(t){const e=this.getTransformedPoints(),s=e.length;let r=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let h=0;h<s;h++){const u=e[h].dot(t);r=Math.min(r,u),l=Math.max(l,u)}return new Tc(r,l)}debug(t,e,s){const r=this.getTransformedPoints();Ey.drawPolygon(r,{color:e})}}class Xe{static Box(t,e,s=B.Half,r=B.Zero){return new Ne({points:new Tt(-t*s.x,-e*s.y,t-t*s.x,e-e*s.y).getPoints().slice(),offset:r})}static Polygon(t,e=B.Zero,s=!1){return new Ne({points:t,offset:e,suppressConvexWarning:s})}static Circle(t,e=B.Zero){return new qe({radius:t,offset:e})}static Edge(t,e){return new Ri({begin:t,end:e})}static Capsule(t,e,s=B.Zero){const r=yt.getInstance();if(t===e&&r.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),e>=t){const h=new Qe([Xe.Circle(t/2,L(0,-e/2+t/2).add(s)),Xe.Box(t,e-t,B.Half,s),Xe.Circle(t/2,L(0,e/2-t/2).add(s))]);return h.compositeStrategy="together",h}else{const h=new Qe([Xe.Circle(e/2,L(-t/2+e/2,0).add(s)),Xe.Box(t-e,e,B.Half,s),Xe.Circle(e/2,L(t/2-e/2,0).add(s))]);return h.compositeStrategy="together",h}}}function Wi(o,t){return o&&(o.__isProxy===void 0?new Proxy(o,{set:(e,s,r)=>(e[s]!==r&&(e[s]=r,typeof s=="string"&&s[0]!=="_"&&t(e)),!0),get:(e,s)=>s!=="__isProxy"?e[s]:!0}):o)}const ry=(o=[],t,e)=>({get:(s,r)=>r==="__isProxy"?!0:typeof s[r]=="object"&&s[r]!=null?new Proxy(s[r],ry([...o,r],t,e)):s[r],set:(s,r,l)=>(typeof r=="string"&&r[0]!=="_"&&t(e),s[r]=l,!0)});function bw(o,t){return o&&(o.__isProxy===void 0?new Proxy(o,ry([],t,o)):o)}const ay=class oy{constructor(t){this.id=oy._ID++,this.transform=_e.identity(),this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=B.One,this._width=0,this._height=0;var e,s,r,l,h,u,f;t&&(this.origin=(e=t.origin)!=null?e:this.origin,this.flipHorizontal=(s=t.flipHorizontal)!=null?s:this.flipHorizontal,this.flipVertical=(r=t.flipVertical)!=null?r:this.flipVertical,this.rotation=(l=t.rotation)!=null?l:this.rotation,this.opacity=(h=t.opacity)!=null?h:this.opacity,this.scale=(u=t.scale)!=null?u:this.scale,this.tint=(f=t.tint)!=null?f:this.tint,t.width&&(this._width=t.width),t.height&&(this._height=t.height))}isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=Wi(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){t&&(this._origin=Wi(t,()=>{this._transformStale=!0})),this._transformStale=!0}cloneGraphicOptions(){return{width:this.width/this.scale.x,height:this.height/this.scale.y,origin:this.origin?this.origin.clone():void 0,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():void 0,tint:this.tint?this.tint.clone():void 0}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return Tt.fromDimension(this.width,this.height,B.Zero)}draw(t,e,s){this._preDraw(t,e,s),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,s){t.save(),t.translate(e,s),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var e;const s=this.scale.x>0?1:-1,r=this.scale.y>0?1:-1,l=(e=this.origin)!=null?e:L(this.width/2,this.height/2);t.translate(l.x,l.y),t.rotate(this.rotation),t.scale(s,r),t.translate(-l.x,-l.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}};ay._ID=0;let He=ay;var Dd=(o=>(o.End="end",o.Loop="loop",o.PingPong="pingpong",o.Freeze="freeze",o))(Dd||{});const ly=class Rd extends He{constructor(t){var e,s,r;super(t),this.events=new re,this.frames=[],this.strategy="loop",this.frameDuration=100,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._speed=1,this._wasResetDuringFrameCalc=!1,this._reversed=!1,this.frames=t.frames,this.speed=(e=t.speed)!=null?e:this.speed,this.strategy=(s=t.strategy)!=null?s:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(r=t.frameDuration)!=null?r:this.frameDuration,this.data=t.data?new Map(Object.entries(t.data)):new Map,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){const t=this.constructor;return new t({frames:this.frames.map(e=>({...e})),frameDuration:this.frameDuration,speed:this.speed,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,s,r="loop",l){const h=t.sprites.length-1,u=e.filter(f=>f<0||f>h);return u.length&&Rd._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${u.join(",")} no frame will be shown`),new this({frames:t.sprites.filter((f,g)=>e.indexOf(g)>-1).map(f=>({graphic:f,duration:s})),strategy:r,data:l})}static fromSpriteSheetCoordinates(t){var e;const{spriteSheet:s,frameCoordinates:r,durationPerFrame:l,durationPerFrameMs:h,speed:u,strategy:f,reverse:g,data:_}=t,y=(e=l??h)!=null?e:100,A=[];for(const x of r){const{x:D,y:S,duration:U,options:R}=x,C=s.getSprite(D,S,R);C?A.push({graphic:C,duration:U??y}):Rd._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${D}, ${S}), please check your SpriteSheet to confirm that sprite exists`)}return new this({frames:A,strategy:f,speed:u,reverse:g,data:_})}get speed(){return this._speed}set speed(t){this._speed=Pt(Math.abs(t),0,1/0)}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get currentFrameTimeLeft(){return this._timeLeftInFrame}get isPlaying(){return this._playing}get isReversed(){return this._reversed}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?"backward":"forward"}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._wasResetDuringFrameCalc=!0,this._done=!1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=this.frameDuration;const t=this.frames[this._currentFrame];t&&(this._timeLeftInFrame=(t==null?void 0:t.duration)||this.frameDuration)}get canFinish(){switch(this.strategy){case"end":case"freeze":return!0;default:return!1}}get done(){return this._done}goToFrame(t,e){this._currentFrame=t,this._timeLeftInFrame=e??this.frameDuration;const s=this.frames[this._currentFrame];s&&!this._done&&(this._timeLeftInFrame=e??((s==null?void 0:s.duration)||this.frameDuration),this.events.emit("frame",{...s,frameIndex:this.currentFrameIndex}))}_nextFrame(){this._wasResetDuringFrameCalc=!1;const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case"loop":{e=(t+1)%this.frames.length,e===0&&this.events.emit("loop",this);break}case"end":{e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case"freeze":{e=Pt(t+1,0,this.frames.length-1),t+1>=this.frames.length&&(this._done=!0,this.events.emit("end",this));break}case"pingpong":{t+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),t+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),e=t+this._pingPongDirection%this.frames.length;break}}return this._wasResetDuringFrameCalc?(this._wasResetDuringFrameCalc=!1,this._currentFrame):e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=t*this._speed,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,s){this.currentFrame&&this.currentFrame.graphic&&this.currentFrame.graphic.draw(t,e,s)}};ly._LOGGER=yt.getInstance();let cy=ly;class $r extends He{constructor(t){var e;super(t),this._logger=yt.getInstance(),this.useAnchor=!0,this.members=[],this.members=t.members,this.useAnchor=(e=t.useAnchor)!=null?e:this.useAnchor,this._updateDimensions()}clone(){return new $r({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){const t=this.localBounds;return this.width=t.width,this.height=t.height,t}get localBounds(){const t=new Tt;for(const e of this.members)if(e instanceof He)e.localBounds.combine(t,t);else{const{graphic:s,offset:r,useBounds:l}=e;s?(l===void 0?!0:l)&&s.localBounds.translate(r).combine(t,t):this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(e)}.`)}return t}_isAnimationOrGroup(t){return t instanceof cy||t instanceof $r}tick(t,e){for(const s of this.members){let r;s instanceof He?r=s:r=s.graphic,this._isAnimationOrGroup(r)&&r.tick(t,e)}}reset(){for(const t of this.members){let e;t instanceof He?e=t:e=t.graphic,this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,s){this._updateDimensions(),super._preDraw(t,this.useAnchor?e:0,this.useAnchor?s:0)}_drawImage(t,e,s){const r=B.Zero;for(const l of this.members){let h;l instanceof He?h=l:(h=l.graphic,l.offset.clone(r)),h&&(t.save(),t.translate(e,s),h.draw(t,r.x,r.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore())}}}class Dc extends He{constructor(t){var e,s,r,l,h,u,f,g,_,y;super(dw({...t},["width","height"])),this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=Wi(tt.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(e=t.quality)!=null?e:this.quality,this.color=(s=t.color)!=null?s:tt.Black,this.strokeColor=t==null?void 0:t.strokeColor,this.smoothing=(r=t.smoothing)!=null?r:this.smoothing,this.lineWidth=(l=t.lineWidth)!=null?l:this.lineWidth,this.lineDash=(h=t.lineDash)!=null?h:this.lineDash,this.lineCap=(u=t.lineCap)!=null?u:this.lineCap,this.padding=(f=t.padding)!=null?f:this.padding,this.filtering=(g=t.filtering)!=null?g:this.filtering),this._bitmap=document.createElement("canvas");const A=(_=t==null?void 0:t.width)!=null?_:this._bitmap.width,x=(y=t==null?void 0:t.height)!=null?y:this._bitmap.height;this.width=A,this.height=x;const D=this._bitmap.getContext("2d");if(D)this._ctx=D;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():void 0,strokeColor:this.strokeColor?this.strokeColor.clone():void 0,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!=null?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!=null?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return Tt.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,B.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=Wi(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),t&&(this._strokeColor=Wi(t,()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(t){var e,s,r,l;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((e=this.lineDash)!=null?e:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(r=(s=this.strokeColor)==null?void 0:s.toString())!=null?r:"",t.fillStyle=(l=this.color)==null?void 0:l.toString()}_drawImage(t,e,s){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,e,s)}}var hy=(o=>(o.Em="em",o.Rem="rem",o.Px="px",o.Pt="pt",o.Percent="%",o))(hy||{}),uy=(o=>(o.Left="left",o.Right="right",o.Center="center",o.Start="start",o.End="end",o))(uy||{}),dy=(o=>(o.Top="top",o.Hanging="hanging",o.Middle="middle",o.Alphabetic="alphabetic",o.Ideographic="ideographic",o.Bottom="bottom",o))(dy||{}),fy=(o=>(o.Normal="normal",o.Italic="italic",o.Oblique="oblique",o))(fy||{}),py=(o=>(o.LeftToRight="ltr",o.RightToLeft="rtl",o))(py||{}),gi=(o=>(o.Pixel="Pixel",o.Blended="Blended",o))(gi||{});function So(o){switch(o){case"Pixel":return"Pixel";case"Blended":return"Blended";default:return}}function Jm(o,t=tt.Red,e,s,r,l,h=1,u="butt"){o.save(),o.beginPath(),o.lineWidth=h,o.lineCap=u,o.strokeStyle=t.toString(),o.moveTo(e,s),o.lineTo(r,l),o.closePath(),o.stroke(),o.restore()}function Km(o,t,e,s,r,l=5,h=tt.White,u=null){let f;if(typeof l=="number")f={tl:l,tr:l,br:l,bl:l};else{const g={tl:0,tr:0,br:0,bl:0};for(const _ in g)if(g.hasOwnProperty(_)){const y=_;f[y]=l[y]||g[y]}}o.beginPath(),o.moveTo(t+f.tl,e),o.lineTo(t+s-f.tr,e),o.quadraticCurveTo(t+s,e,t+s,e+f.tr),o.lineTo(t+s,e+r-f.br),o.quadraticCurveTo(t+s,e+r,t+s-f.br,e+r),o.lineTo(t+f.bl,e+r),o.quadraticCurveTo(t,e+r,t,e+r-f.bl),o.lineTo(t,e+f.tl),o.quadraticCurveTo(t,e,t+f.tl,e),o.closePath(),u&&(o.fillStyle=u.toString(),o.fill()),h&&(o.strokeStyle=h.toString(),o.stroke())}class Rc{constructor(t,e,s=1){this.builder=t,this.cleaner=e,this._pool=[],this._size=0,this.grow(s)}grow(t){if(t>0){this._size+=t;for(let e=0;e<t;e++)this._pool.push(this.builder())}}rent(t=!1){return this._pool.length===0&&this.grow(this._size),t?this.cleaner(this._pool.pop()):this._pool.pop()}return(t){this._pool.push(t)}}class ww{constructor(){this._pool=new Rc(()=>_e.identity(),t=>t.reset(),100),this._transforms=[],this._currentTransform=this._pool.rent(!0)}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone(this._pool.rent())}restore(){this._pool.return(this._currentTransform),this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}reset(){this._currentTransform.reset()}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class Cw{constructor(){this.opacity=1,this.z=0,this.tint=tt.White,this.material=null}}class gy{constructor(){this._pool=new Rc(()=>new Cw,t=>(t.opacity=1,t.z=0,t.tint=tt.White,t.material=null,t),100),this.current=this._pool.rent(!0),this._states=[]}_cloneState(t){var e;return t.opacity=this.current.opacity,t.z=this.current.z,t.tint=(e=this.current.tint)==null?void 0:e.clone(),t.material=this.current.material,t}save(){this._states.push(this.current),this.current=this._cloneState(this._pool.rent())}restore(){this._pool.return(this.current),this.current=this._states.pop()}}class _y{constructor(t,e,s=!1){this.path=t,this.responseType=e,this.bustCache=s,this.data=null,this.logger=yt.getInstance(),this.events=new re}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const s=new XMLHttpRequest;s.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),s.responseType=this.responseType,s.addEventListener("loadstart",r=>this.events.emit("loadstart",r)),s.addEventListener("progress",r=>this.events.emit("progress",r)),s.addEventListener("error",r=>this.events.emit("error",r)),s.addEventListener("load",r=>this.events.emit("load",r)),s.addEventListener("load",()=>{if(s.status!==0&&s.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",s.status),this.events.emit("error",s.response),e(new Error(s.statusText));return}if(s.response instanceof Blob&&s.response.type==="text/html"){const r=`Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!

Check your server configuration, for example Vite serves static files from the /public folder`;this.events.emit("error",s.response),e(new Error(r));return}this.data=s.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),s.send()})}}class Jn extends He{constructor(t){var e,s;super(t),this._logger=yt.getInstance(),this._dirty=!0,this.image=t.image;const{width:r,height:l}=t;this.sourceView=(e=t.sourceView)!=null?e:{x:0,y:0,width:r??0,height:l??0},this.destSize=(s=t.destSize)!=null?s:{width:r??0,height:l??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}static from(t,e){return new Jn({image:t,...e})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,s,r,l,h;const{width:u,height:f}=this.image;this.sourceView.width=((t=this.sourceView)==null?void 0:t.width)||u,this.sourceView.height=((e=this.sourceView)==null?void 0:e.height)||f,this.destSize.width=((s=this.destSize)==null?void 0:s.width)||((r=this.sourceView)==null?void 0:r.width)||u,this.destSize.height=((l=this.destSize)==null?void 0:l.height)||((h=this.sourceView)==null?void 0:h.height)||f,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,s){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,s)}_drawImage(t,e,s){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,s,this.destSize.width,this.destSize.height):this._logger.warnOnce(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}clone(){return new Jn({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var Ze=(o=>(o.Clamp="Clamp",o.Repeat="Repeat",o.Mirror="Mirror",o))(Ze||{});function us(o){switch(o){case"Clamp":return"Clamp";case"Repeat":return"Repeat";case"Mirror":return"Mirror";default:return"Clamp"}}const To=class Ei{constructor(t,e){this._garbageCollector=e,this._textureMap=new Map,this._collect=r=>{var l;if(this._gl){const h=(l=r.dataset.originalSrc)!=null?l:r.constructor.name;return Ei._LOGGER.debug(`WebGL Texture for ${h} collected`),this.delete(r),!0}return!1};var s;this._gl=t,Ei._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),this._garbageCollector&&(Ei._LOGGER.debug("WebGL Texture collection interval:",this._garbageCollector.collectionInterval),(s=this._garbageCollector.garbageCollector)==null||s.registerCollector("texture",this._garbageCollector.collectionInterval,this._collect))}dispose(){for(const[t]of this._textureMap)this.delete(t);this._textureMap.clear(),this._gl=null}get(t){return this._textureMap.get(t)}has(t){return this._textureMap.has(t)}load(t,e,s=!1){var r,l;const h=this._gl;if(!h)return null;const{filtering:u,wrapping:f}={...e};let g=null;if(this.has(t)&&(g=this.get(t)),g)return s&&(h.bindTexture(h.TEXTURE_2D,g),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t)),(r=this._garbageCollector)==null||r.garbageCollector.touch(t),g;g=h.createTexture(),Ei.checkImageSizeSupportedAndLog(t),h.bindTexture(h.TEXTURE_2D,g),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let _;f&&(typeof f=="string"?_={x:f,y:f}:_={x:f.x,y:f.y});const{x:y,y:A}=_??Ei.wrapping;switch(y){case Ze.Clamp:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);break;case Ze.Repeat:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT);break;case Ze.Mirror:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.MIRRORED_REPEAT);break;default:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE)}switch(A){case Ze.Clamp:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);break;case Ze.Repeat:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT);break;case Ze.Mirror:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.MIRRORED_REPEAT);break;default:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)}const x=u??Ei.filtering;return h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,x===gi.Pixel?h.NEAREST:h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,x===gi.Pixel?h.NEAREST:h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t),this._textureMap.set(t,g),(l=this._garbageCollector)==null||l.garbageCollector.addCollectableResource("texture",t),g}delete(t){const e=this._gl;if(e&&this.has(t)){const s=this.get(t);s&&(this._textureMap.delete(t),e.deleteTexture(s))}}static checkImageSizeSupportedAndLog(t){var e;const s=(e=t.dataset.originalSrc)!=null?e:"internal canvas bitmap";return t.width>Ei._MAX_TEXTURE_SIZE||t.height>Ei._MAX_TEXTURE_SIZE?(Ei._LOGGER.error(`The image [${s}] provided to Excalibur is too large for the device's maximum texture size of (${Ei._MAX_TEXTURE_SIZE}x${Ei._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&Ei._LOGGER.warn(`The image [${s}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}};To._LOGGER=yt.getInstance();To.filtering=gi.Blended;To.wrapping={x:Ze.Clamp,y:Ze.Clamp};To._MAX_TEXTURE_SIZE=4096;let ao=To;const Ht={Filtering:"filtering",WrappingX:"wrapping-x",WrappingY:"wrapping-y"};class as{constructor(t,e,s){this._logger=yt.getInstance(),this.data=new Image,this._readyFuture=new xn,this.ready=this._readyFuture.promise,this.path=t;let r=!1,l;typeof e=="boolean"?r=e:{filtering:s,wrapping:l,bustCache:r}={...e},this._resource=new _y(t,"blob",r),this.filtering=s??this.filtering,typeof l=="string"?this.wrapping={x:l,y:l}:this.wrapping=l??this.wrapping,t.endsWith(".gif")&&this._logger.warn(`Use the ex.Gif type to load gifs, you may have mixed results with ${t} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`)}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}static fromHtmlImageElement(t,e){const s=new as("");if(s._src="image-element",s.data=t,s.data.setAttribute("data-original-src","image-element"),e!=null&&e.filtering?s.data.setAttribute(Ht.Filtering,e==null?void 0:e.filtering):s.data.setAttribute(Ht.Filtering,gi.Blended),e!=null&&e.wrapping){let r;typeof e.wrapping=="string"?r={x:e.wrapping,y:e.wrapping}:r={x:e.wrapping.x,y:e.wrapping.y},s.data.setAttribute(Ht.WrappingX,r.x),s.data.setAttribute(Ht.WrappingY,r.y)}else s.data.setAttribute(Ht.WrappingX,Ze.Clamp),s.data.setAttribute(Ht.WrappingY,Ze.Clamp);return ao.checkImageSizeSupportedAndLog(t),s._readyFuture.resolve(t),s}static fromHtmlCanvasElement(t,e){const s=new as("");if(s._src="canvas-element-blob",s.data.setAttribute("data-original-src","canvas-element-blob"),e!=null&&e.filtering?s.data.setAttribute(Ht.Filtering,e==null?void 0:e.filtering):s.data.setAttribute(Ht.Filtering,gi.Blended),e!=null&&e.wrapping){let r;typeof e.wrapping=="string"?r={x:e.wrapping,y:e.wrapping}:r={x:e.wrapping.x,y:e.wrapping.y},s.data.setAttribute(Ht.WrappingX,r.x),s.data.setAttribute(Ht.WrappingY,r.y)}else s.data.setAttribute(Ht.WrappingX,Ze.Clamp),s.data.setAttribute(Ht.WrappingY,Ze.Clamp);return ao.checkImageSizeSupportedAndLog(t),t.toBlob(r=>{const l=URL.createObjectURL(r);s.image.onload=()=>{URL.revokeObjectURL(l),s.data=s.image,s._readyFuture.resolve(s.image)},s.image.src=l}),s}static fromSvgString(t,e){const s=new Blob([t],{type:"image/svg+xml"}),r=URL.createObjectURL(s);return new as(r,e)}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){var t,e,s,r;if(this.isLoaded())return this.data;try{let l;if(this.path.includes("data:image/"))l=this.path;else{const f=await this._resource.load();l=URL.createObjectURL(f)}const h=new Image,u=new xn;h.onload=()=>u.resolve(),h.src=l,h.setAttribute("data-original-src",this.path),await u.promise,this.data=h,ao.checkImageSizeSupportedAndLog(this.data)}catch(l){throw`Error loading ImageSource from path '${this.path}' with error [${l.message}]`}return this.data.setAttribute(Ht.Filtering,this.filtering),this.data.setAttribute(Ht.WrappingX,(e=(t=this.wrapping)==null?void 0:t.x)!=null?e:Ze.Clamp),this.data.setAttribute(Ht.WrappingY,(r=(s=this.wrapping)==null?void 0:s.y)!=null?r:Ze.Clamp),this._readyFuture.resolve(this.data),this.data}toSprite(t){return Jn.from(this,t)}unload(){this.data=new Image}}class lf extends He{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=void 0,this.caseInsensitive=!1,this.spacing=0,this.lineHeight=void 0,this._logger=yt.getInstance();const{alphabet:e,spriteSheet:s,caseInsensitive:r,spacing:l,shadow:h,lineHeight:u}=t;this.alphabet=e,this.spriteSheet=s,this.caseInsensitive=r??this.caseInsensitive,this.spacing=l??this.spacing,this.shadow=h??this.shadow,this.lineHeight=u??this.lineHeight}_getCharacterSprites(t){const e=[],s=this.caseInsensitive?t.toLocaleLowerCase():t,r=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let l=0;l<s.length;l++){const h=s[l];let u=r.indexOf(h);u===-1&&(u=0,this._logger.warnOnce(`SpriteFont - Cannot find letter '${h}' in configured alphabet '${r}'.`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."));const f=this.spriteSheet.sprites[u];f?e.push(f):(this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${h}' at index '${u}' in configured SpriteSheet`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."))}return e}measureText(t,e){const s=this._getLinesFromText(t,e),r=s.reduce((f,g)=>f.length>g.length?f:g),l=this._getCharacterSprites(r);let h=0,u=0;for(const f of l)h+=f.width+this.spacing,u=Math.max(u,f.height);return Tt.fromDimension(h*this.scale.x,u*s.length*this.scale.y,B.Zero)}_drawImage(t,e,s,r){var l;let h=0,u=0,f=0;const g=this._getLinesFromText(this._text,r);for(const _ of g){for(const y of this._getCharacterSprites(_))y.draw(t,e+h,s+u),h+=y.width+this.spacing,f=Math.max(f,y.height);h=0,u+=(l=this.lineHeight)!=null?l:f}}render(t,e,s,r,l,h){this._text=e;const u=this.measureText(e,h);this.width=u.width,this.height=u.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,r,l),this._drawImage(t,0,0,h),this._postDraw(t),t.restore()),this._preDraw(t,r,l),this._drawImage(t,0,0,h),this._postDraw(t)}clone(){return new lf({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,e){var s;if(this._cachedText===t&&this._cachedRenderWidth===e&&((s=this._cachedLines)!=null&&s.length))return this._cachedLines;const r=t.split(`
`);if(e==null)return r;for(let l=0;l<r.length;l++){let h=r[l],u="";if(this.measureText(h).width>e){for(;this.measureText(h).width>e;)u=h[h.length-1]+u,h=h.slice(0,-1);r[l]=h,r[l+1]=u}}return this._cachedText=t,this._cachedLines=r,this._cachedRenderWidth=e,r}}class cf extends Jn{constructor(t){super({image:t.image,sourceView:t.sourceView,destSize:{width:t.width,height:t.height},flipHorizontal:t.flipHorizontal,flipVertical:t.flipVertical,rotation:t.rotation,scale:t.scale,opacity:t.opacity,tint:t.tint,origin:t.origin}),this._ready=new xn,this.ready=this._ready.promise,this._options=t,this.image.isLoaded()?this._applyTiling():this.image.ready.then(()=>this._applyTiling())}static fromSprite(t,e){return new cf({sourceView:{...t.sourceView},width:t.width,height:t.height,...e,image:t.image})}_applyTiling(){const{width:t,height:e,filtering:s,wrapping:r}={...this._options},l=document.createElement("canvas");l.width=this.sourceView.width,l.height=this.sourceView.height,l.getContext("2d").drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,0,0,this.sourceView.width,this.sourceView.height);const u=as.fromHtmlCanvasElement(l,{wrapping:r??Ze.Repeat,filtering:s});t&&(this.destSize.width=t,this.sourceView.width=t),e&&(this.destSize.height=e,this.sourceView.height=e),this.sourceView.x=0,this.sourceView.y=0,this.image=u,this.image.ready.then(()=>this._ready.resolve())}}class cs{constructor(t){this.sprites=[];const{sprites:e,rows:s,columns:r}=t;this.sprites=e,this.rows=s??1,this.columns=r??this.sprites.length}getSprite(t,e,s){var r,l,h,u,f,g,_,y,A;if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const x=t+e*this.columns,D=this.sprites[x];if(D){if(s){const S=D.clone();return S.flipHorizontal=(r=s.flipHorizontal)!=null?r:S.flipHorizontal,S.flipVertical=(l=s.flipVertical)!=null?l:S.flipVertical,S.width=(h=s.width)!=null?h:S.width,S.height=(u=s.height)!=null?u:S.height,S.rotation=(f=s.rotation)!=null?f:S.rotation,S.scale=(g=s.scale)!=null?g:S.scale,S.opacity=(_=s.opacity)!=null?_:S.opacity,S.tint=(y=s.tint)!=null?y:S.tint,S.origin=(A=s.origin)!=null?A:S.origin,S}return D}throw Error(`Invalid sprite coordinates (${t}, ${e})`)}getTiledSprite(t,e,s){if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const r=t+e*this.columns,l=this.sprites[r];if(l)return cf.fromSprite(l,s);throw Error(`Invalid sprite coordinates (${t}, ${e})`)}static fromImageSourceWithSourceViews(t){const e=t.sourceViews.map(s=>new Jn({image:t.image,sourceView:s}));return new cs({sprites:e})}static fromImageSource(t){var e;const s=[];t.spacing=(e=t.spacing)!=null?e:{};const{image:r,grid:{rows:l,columns:h,spriteWidth:u,spriteHeight:f},spacing:{originOffset:g,margin:_}}=t;let y,A;g instanceof B?A={x:g.x,y:g.y}:g&&(A={x:g.x,y:g.y}),_ instanceof B?y={x:_.x,y:_.y}:_&&(y={x:_.x,y:_.y});const x={x:0,y:0,...A},D={x:0,y:0,...y};for(let S=0;S<h;S++)for(let U=0;U<l;U++)s[S+U*h]=new Jn({image:r,sourceView:{x:S*u+D.x*S+x.x,y:U*f+D.y*U+x.y,width:u,height:f},destSize:{height:f,width:u}});return new cs({sprites:s,rows:l,columns:h})}clone(){return new cs({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}const Sw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAAAAXNSR0IArs4c6QAABlFJREFUeJztndmy4yoMRcWt/v9fdr8EWoDAaDD4JntVpeqcxBrMIGQDNhEAAAAAAAAAAAAAAOCrSbMfr+u6yoEpTY+906GV57YtPkjyXj9WZZ+wHWHfo2N3/bU6Tte9Rv6ptruqRyMvKvvIX/zY3I/vjLeqsg6l/CWdp0KHKO/1Y1H2EdsR9j06Ntdfp+N03SvkH2u7i3pu5XkQ+DNTkgNJSok+/183xpcdWZHjgUzpQ2pGD67vaf//KRAGAq3tdhCy2tcMQKPyXyz7iPqrdBjbX5h9g7xbtvWf4ZJvM4D/BKG24Sd+IkQ0TC9aW5NM5FbO2HgrPVzW2vmN50DZNv/QWtl5bfPy85SBtdy9dFmjsf2F2SehTBVE+u+tkE5+lAGcJlFwGuodwRRU2Qe3rx0FhPNflc3HWC7BEh8EDGVR5IMCiLnDONtPp87qhxVH/S/LvzUAuDs/kyGimA5oSONKR1w8vsLpv+v+S9vhmS71JRiX1xB5CWZNw7m6rMrllMag/RJyWb67BEgpDVMWSydc+K47pr35w05kWd7ReEq6116KaG4CsbJ7OmV9PdZLEKkONiC1/7ZONVgDsajLIJPYp2OUAXRpnPcGmnIE6eSK4nv5YQqqSYO52JqnYfYj/PdQXQIY7XszuMofMgZRT/1LdeC5h2I5/0EdWDMY2Yb05WDE1RodVdpSA5r85slArAVnSf+89iP896St0f5bZKVA7Gk/3ja8q+152/+wrLqBWZTem3IBADbRBoDuHgAA4HdAAADgh0EAAOCHQQAA4IdBAADgh0EAAOCHuVsKbJ3P9M7jjuxHzGfv8j9iDt47Dx7hP8cjq5F/o/0T62Aer//ZOgDrajBp6aNlOWTEajKLjgj/Pcs/vfZD/a++3Pc8hNfZ966EVeh5vP75luDRJUAl0KzJfnopaqbaTuzZiulc2BS5lltFXntu3dcQsXadl59Wn1H+dfYNtrt2d6D/LDF9HkCQw6eXFbr8P9X5W/un5Ol8gz1t39p5pWOPn0vLynbgdnfe8maEQw+UIPJdfxdOd/4oTtVD0IYg8wDywGas0I04T5O3P8/qf2UWwPpkn1PbOT1bN2tFe59EM7TvKf+TRFw+erZ2ey4hpS3hp9qBkqq/tjsSU1OYqucBWB1yynt5QxC42Mdk30pAEIio//zRG3feBzLUX+TTjCKwlH83aI/KbpQBVEHgUGF0j/SitcLofHem8q6AyH0wBhFv4WszuOjy0yK2vc/oRWQoP2X9ve78jfaLnpncbBqQSC6s0HnIRT0a2yNZjfxT8+ir8t+yDsDTWaS6X70GP33+d77stp+I5HtBdwEAAPBl8ECApcAA/DBvfSowAGAB7/05ZAAA/DAIAADMMU3fOuS2ggAAwBjrorKoxWiPBxHMAgAg490Ts0VeePdA+ZfJDKcCh7sBqY88mmjklZeOt9iXPrvx2I2QPRnN2/qzyJ84h4gNcbtfasq5mM1rZr+bBWh2A+bIIX13Z9wqL+nQvFno7v3oq4tJItCed7isUT6C/I7BUn9KP95wDicYBYpcjncrO2c/dmW4tBtw4RiRld1IDxDyYsoXMHxF1w3dyz0Nne8033AOFsT6VgRCafl89fenTZUfbm8CGhrgdDcS7anAsvnkkP0IeCfQ+JzYunky6jhNYj5bl7++4fJvN9WDSKS/292A0wyANyKDI91bfkm3kcH7ckaP/SKW/VHKRZAcI14pP3beu0fPyn/DuZQbWMogNnsc16sziE96f7H/iai7uTf0/3N8lwFz/e13T00Djt4OrInCnkeChXT+qOcKOLA21tJpsv/G8/COnGnw97J9QwbTvd6djYSv7fxEVTuV/LzNhj7nOawv6bfbAGCYEpQ6HxFtuxs6sq9tzOYHobQ6Nje+6vo5BwFrPZ4OgMayS4PPt1NlzdLfbRCYBoBc+NaO4JWPwLEf33oN3unY3InKPQBW6Z7nEZzEmrl4iZjC804lqgePPEOguQcwWghUphxm343wyt/pWpWR0OrR+jvyxavHajfb9pTjbt9bH07Z5/expM4TLWfwb7QQqMoC+UDWXZo/4RgA38LOgUvLJAAQ1Td9y9//0ylxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+g79apuVUsS5ZmwAAAABJRU5ErkJggg==";class my{constructor(){this.fontSheet=Sw,this.size=16,this.load()}load(){return this._imageSource=new as(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=cs.fromImageSource({image:this._imageSource,grid:{rows:4,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new lf({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+# `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,e,s){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,s.x,s.y)}}class Tw{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class ql{constructor(t){this.antialias=!1,this.samples=1;var e,s;this._gl=t.gl,this.width=t.width,this.height=t.height,this.transparency=t.transparency,this.antialias=(e=t.antialias)!=null?e:this.antialias,this.samples=(s=t.samples)!=null?s:this._gl.getParameter(this._gl.MAX_SAMPLES);const r=this._gl;r.drawingBufferFormat?this.bufferFormat=r.drawingBufferFormat:this.transparency?this.bufferFormat=r.RGBA8:this.bufferFormat=r.RGB8,this._setupRenderBuffer(),this._setupFramebuffer()}setResolution(t,e){const s=this._gl;this.width=t,this.height=e,s.bindTexture(s.TEXTURE_2D,this._frameTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.width,this.height,0,s.RGBA,s.UNSIGNED_BYTE,null),this._renderBuffer&&(s.bindRenderbuffer(s.RENDERBUFFER,this._renderBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,Math.min(this.samples,s.getParameter(s.MAX_SAMPLES)),this.bufferFormat,this.width,this.height))}get renderBuffer(){return this._renderBuffer}get renderFrameBuffer(){return this._renderFrameBuffer}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupRenderBuffer(){if(this.antialias){const t=this._gl;this._renderBuffer=t.createRenderbuffer(),this._renderFrameBuffer=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,Math.min(this.samples,t.getParameter(t.MAX_SAMPLES)),this.bufferFormat,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this._renderBuffer)}}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return this.renderBuffer&&this.blitRenderBufferToFrameBuffer(),new Tw(this._gl,this._frameTexture)}blitToScreen(){const t=this._gl;this._renderBuffer?(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)):(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR))}blitRenderBufferToFrameBuffer(){if(this._renderBuffer){const t=this._gl;t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.frameBuffer),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)}}copyToTexture(t){const e=this._gl;this._renderBuffer&&this.blitRenderBufferToFrameBuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,this.width,this.height,0)}use(){const t=this._gl;this.antialias?t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}const Ew=`#version 300 es
in vec2 a_position;
in vec4 a_color;

out lowp vec4 v_color;

uniform mat4 u_matrix;

void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Passthrough the color
   v_color = a_color;
}`,Dw=`#version 300 es
precision mediump float;

// Color
in lowp vec4 v_color;

out vec4 fragColor;

void main() {
  fragColor = v_color;
}`;class yy extends Ji{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e}}class hf extends Ji{constructor(t){super(),this.parallaxFactor=L(1,1),this.parallaxFactor=t??this.parallaxFactor}}const sa=class we{static measureText(t,e,s){const r=Zr.getHashCode(e,t);if(we._MEASURE_CACHE.has(r))return we._MEASURE_CACHE.get(r);we._LOGGER.debug("Font text measurement cache miss");const l=e.measureTextWithoutCache(t,s);return we._MEASURE_CACHE.set(r,l),l}static getTextInstance(t,e,s){const r=Zr.getHashCode(e,t,s);let l=we._TEXT_CACHE.get(r);return l||(l=new Zr(e,t,s),we._TEXT_CACHE.set(r,l),we._LOGGER.debug("Font text instance cache miss")),we._TEXT_USAGE.set(l,performance.now()),l}static checkAndClearCache(){const t=[],e=new Set;for(const[r,l]of we._TEXT_USAGE.entries())if(l+we.FONT_TIMEOUT<performance.now())we._LOGGER.debug(`Text cache entry timed out ${r.text}`),t.push(r),r.dispose();else{const h=r.getHashCode(!1);e.add(h)}t.forEach(r=>{we._TEXT_USAGE.delete(r)}),this._TEXT_CACHE.clear();for(const[r]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(r.getHashCode(),r);const s=new Map;for(const r of e)we._MEASURE_CACHE.has(r)&&s.set(r,we._MEASURE_CACHE.get(r));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=s}static get cacheSize(){return we._TEXT_USAGE.size}static clearCache(){for(const[t]of we._TEXT_USAGE.entries())t.dispose();we._TEXT_USAGE.clear(),we._TEXT_CACHE.clear(),we._MEASURE_CACHE.clear()}};sa.FONT_TIMEOUT=500;sa._LOGGER=yt.getInstance();sa._TEXT_USAGE=new Map;sa._TEXT_CACHE=new Map;sa._MEASURE_CACHE=new Map;let Md=sa;function Rw(o,t,e,s){if(o.parent!==t.parent){const _=o.clone(),y=o.globalPos.clone(),A=o.globalScale.clone(),x=o.globalRotation;_.parent=t.parent,_.globalPos=y,_.globalScale=A,_.globalRotation=x,o=_}let r=t.pos,l=t.scale,h=t.rotation;r=t.pos.scale(e).add(o.pos.scale(1-e)),l=t.scale.scale(e).add(o.scale.scale(1-e));const u=(1-e)*Math.cos(o.rotation)+e*Math.cos(t.rotation),f=(1-e)*Math.sin(o.rotation)+e*Math.sin(t.rotation);h=Math.atan2(f,u);const g=s??new bn;return g.setTransform(r,h,l),g}class Ay extends Vi{constructor(t){super(),this.world=t,this.systemType=Qi.Draw,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this._targetInterpolationTransform=new bn,this.query=this.world.query([at,Ve]),this.query.entityAdded$.subscribe(e=>{const s=e.get(at);this._sortedTransforms.push(s),s.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{const s=e.get(at);s.zIndexChanged$.unsubscribe(this._zIndexUpdate);const r=this._sortedTransforms.indexOf(s);r>-1&&this._sortedTransforms.splice(r,1)})}get sortedTransforms(){return this._sortedTransforms}initialize(t,e){this._camera=e.camera,this._engine=e.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>t.globalZ-e.globalZ),this._zHasChanged=!1)}update(t){this._token++;let e;Md.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(let s=0;s<this._sortedTransforms.length;s++){const r=this._sortedTransforms[s],l=r.owner;if(l.hasTag("ex.offscreen")||(e=l.get(Ve),!e.isVisible))continue;e.onPreTransformDraw&&e.onPreTransformDraw(this._graphicsContext,t),l.events.emit("pretransformdraw",new Hb(this._graphicsContext,t,l)),r.coordPlane===pi.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),r.coordPlane===pi.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),e.update(t,this._token);const h=l.get(hf);if(h){const u=B.One.sub(h.parallaxFactor),f=this._camera.drawPos.scale(u);this._graphicsContext.translate(f.x,f.y)}this._applyTransform(l),e.material&&(this._graphicsContext.material=e.material),e.onPreDraw&&e.onPreDraw(this._graphicsContext,t),l.events.emit("predraw",new wc(this._graphicsContext,t,l)),this._applyOpacity(l),this._drawGraphicsComponent(e,r),e.onPostDraw&&e.onPostDraw(this._graphicsContext,t),l.events.emit("postdraw",new Cc(this._graphicsContext,t,l)),this._graphicsContext.restore(),r.coordPlane===pi.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext)),e.onPostTransformDraw&&e.onPostTransformDraw(this._graphicsContext,t),l.events.emit("posttransformdraw",new Gb(this._graphicsContext,t,l))}this._graphicsContext.restore()}_drawGraphicsComponent(t,e){var s,r;if(t.isVisible){const l=t.flipHorizontal,h=t.flipVertical,u=t.current,f=(s=t.currentOptions)!=null?s:{};if(u){let g=t.anchor,_=t.offset,y=1,A=1;f!=null&&f.anchor&&(g=f.anchor),f!=null&&f.offset&&(_=f.offset);const x=e.globalScale;y*=u.scale.x*x.x,A*=u.scale.y*x.y;const D=-u.width*g.x+_.x*y,S=-u.height*g.y+_.y*A,U=u.flipHorizontal,R=u.flipVertical;if((l||h)&&(u.flipHorizontal=l?!U:U,u.flipVertical=h?!R:R),u==null||u.draw(this._graphicsContext,D,S),(l||h)&&(u.flipHorizontal=U,u.flipVertical=R),(r=this._engine)!=null&&r.isDebug&&this._engine.debug.graphics.showBounds){const C=L(D,S);if(u instanceof $r)for(const O of u.members){let G,q=B.Zero;O instanceof He?G=O:(G=O.graphic,q=O.offset),u.useAnchor?G==null||G.localBounds.translate(C.add(q)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor):G==null||G.localBounds.translate(q).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}else u==null||u.localBounds.translate(C).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(t){const e=t.getAncestors();for(let s=0;s<e.length;s++){const r=e[s],l=r==null?void 0:r.get(at),h=r==null?void 0:r.get(Kt);if(l){let u=l.get();if(h&&this._engine.fixedUpdateTimestep&&h.__oldTransformCaptured&&h.enableFixedUpdateInterpolate){const f=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep;u=Rw(h.oldTransform,l.get(),f,this._targetInterpolationTransform)}this._graphicsContext.z=l.globalZ,this._graphicsContext.translate(u.pos.x,u.pos.y),this._graphicsContext.scale(u.scale.x,u.scale.y),this._graphicsContext.rotate(u.rotation)}}}_applyOpacity(t){var e;const s=t.getAncestors();for(let r=0;r<s.length;r++){const l=s[r],h=l==null?void 0:l.get(Ve);this._graphicsContext.opacity*=(e=h==null?void 0:h.opacity)!=null?e:1}}}Ay.priority=Ns.Average;class vy extends Vi{constructor(t){super(),this.world=t,this.systemType=Qi.Draw,this.query=this.world.query([at,Ve])}initialize(t,e){this._camera=e.camera,this._screen=e.engine.screen}update(){this._worldBounds=this._screen.getWorldBounds();let t,e,s;for(let r=0;r<this.query.entities.length;r++){const l=this.query.entities[r];e=l.get(Ve),t=l.get(at),s=l.get(hf);let h;if(s){const f=B.One.sub(s.parallaxFactor);h=this._camera.pos.scale(f)}const u=this._isOffscreen(t,e,h);u&&!l.hasTag("ex.offscreen")&&(l.events.emit("exitviewport",new ew(l)),l.addTag("ex.offscreen")),!u&&l.hasTag("ex.offscreen")&&(l.events.emit("enterviewport",new iw(l)),l.removeTag("ex.offscreen"))}}_isOffscreen(t,e,s){if(e.forceOnScreen)return!1;if(t.coordPlane===pi.World){let r=e.localBounds;s&&(r=r.translate(s));const l=r.transform(t.get().matrix);return!this._worldBounds.overlaps(l)}else return!1}}vy.priority=Ns.Higher;class uf extends Dc{constructor(t){var e,s,r;super(t),this._radius=0;const l=(e=t.lineWidth)!=null?e:t.strokeColor?1:0;this.padding=(s=t.padding)!=null?s:2+l/2,this.radius=t.radius,this.filtering=(r=t.filtering)!=null?r:gi.Blended,this.rasterize()}get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}clone(){return new uf({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class Mc extends Dc{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new Mc({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class df extends Dc{constructor(t={}){super(t),this._options=t}get ctx(){return this._ctx}clone(){return new df({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,s;(e=this._options)!=null&&e.draw&&((s=this._options)==null||s.draw(t)),this._options.cache||this.flagDirty()}}const Mw={pixelArtSampler:!1,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:gi.Blended,canvasImageRendering:"auto"},Pw={pixelArtSampler:!0,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:gi.Blended,canvasImageRendering:"auto"},ff=class Pd{static clear(){Pd.DrawCallCount=0,Pd.DrawnImagesCount=0}};ff.DrawCallCount=0;ff.DrawnImagesCount=0;let Ce=ff;const he=1e-4;class Bw{constructor(t){this._ex=t,this._debugText=new my}drawRect(t,e,s,r){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+he):t,this._ex.snapToPixel?~~(e+he):e,this._ex.snapToPixel?~~(s+he):s,this._ex.snapToPixel?~~(r+he):r),this._ex.__ctx.restore()}drawLine(t,e,s={color:tt.Black}){var r,l;this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=(l=(r=s.color)==null?void 0:r.toString())!=null?l:"",this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+he):t.x,this._ex.snapToPixel?~~(t.y+he):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(e.x+he):e.x,this._ex.snapToPixel?~~(e.y+he):e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:tt.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+he):t.x,this._ex.snapToPixel?~~(t.y+he):t.y,e.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class Bd{constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=tt.ExcaliburBlue,this._state=new gy,this.snapToPixel=!1,this.debug=new Bw(this);const{canvasElement:e,context:s,enableTransparency:r,snapToPixel:l,antialiasing:h,backgroundColor:u}=t;if(this.__ctx=s??e.getContext("2d",{alpha:r??!0}),!this.__ctx)throw new Error("Cannot build new ExcaliburGraphicsContext2D for some reason!");this.backgroundColor=u??this.backgroundColor,this.snapToPixel=l??this.snapToPixel,this.smoothing=h??this.smoothing}get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,s,r,l,h,u,f,g){if(r===0||l===0)return;if(f===0||g===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const _=[t,e,s,r,l,h,u,f,g].filter(y=>y!==void 0).map(y=>typeof y=="number"&&this.snapToPixel?~~y:y);this.__ctx.drawImage.apply(this.__ctx,_),Ce.DrawCallCount++,Ce.DrawnImagesCount=1}drawLine(t,e,s,r=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=s.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+he):t.x,this.snapToPixel?~~(t.y+he):t.y),this.__ctx.lineTo(this.snapToPixel?~~(e.x+he):e.x,this.snapToPixel?~~(e.y+he):e.y),this.__ctx.lineWidth=r,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,s,r){this.__ctx.save(),this.__ctx.fillStyle=r.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+he):t.x,this.snapToPixel?~~(t.y+he):t.y,this.snapToPixel?~~(e+he):e,this.snapToPixel?~~(s+he):s),this.__ctx.restore()}drawCircle(t,e,s,r,l){this.__ctx.save(),this.__ctx.beginPath(),r&&(this.__ctx.strokeStyle=r.toString()),l&&(this.__ctx.lineWidth=l),this.__ctx.fillStyle=s.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+he):t.x,this.snapToPixel?~~(t.y+he):t.y,e,0,Math.PI*2),this.__ctx.fill(),r&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save(),this._state.save()}restore(){this.__ctx.restore(),this._state.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~(t+he):t,this.snapToPixel?~~(e+he):e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}updatePostProcessors(t){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),Ce.clear()}flush(){}dispose(){this.__ctx=void 0}}class Iw{constructor(t){this.type="static";const{gl:e,size:s,type:r,data:l}=t;if(this._gl=e,this.buffer=e.createBuffer(),this._maxFloats=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE)/32,!l&&!s)throw Error("Must either provide data or a size to the UniformBuffer");if(l?this.bufferData=l:this.bufferData=new Float32Array(s),this.bufferData.length>this._maxFloats)throw Error(`UniformBuffer exceeds browsers allowed number of floats ${this._maxFloats}`);this.type=r??this.type,e.bindBuffer(e.UNIFORM_BUFFER,this.buffer),e.bufferData(e.UNIFORM_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.UNIFORM_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.UNIFORM_BUFFER,null)}upload(t){const e=this._gl;e.bindBuffer(e.UNIFORM_BUFFER,this.buffer),t?e.bufferSubData(e.UNIFORM_BUFFER,0,this.bufferData,0,t):e.bufferData(e.UNIFORM_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}function $m(o,t){switch(t){case o.INT:case o.UNSIGNED_INT:case o.FLOAT:return 4;case o.SHORT:return 2;case o.UNSIGNED_SHORT:return 2;case o.BYTE:return 1;case o.UNSIGNED_BYTE:return 1;default:return 1}}function kw(o,t){const e=`(?<type>[a-z0-9]+)\\s+${t};`,r=new RegExp(e,"g").exec(o);return(r==null?void 0:r.length)>0}function zw(o,t,e){var s;const r=`(?<type>[a-z0-9]+)\\s+${e};`,h=new RegExp(r,"g").exec(t);switch((s=h==null?void 0:h.groups)==null?void 0:s.type){case"float":case"vec2":case"vec3":case"vec4":return o.FLOAT;case"int":case"ivec2":case"ivec3":case"ivec4":return o.INT;case"uint":case"uvec2":case"uvec3":case"uvec4":return o.UNSIGNED_INT;case"bool":case"bvec2":case"bvec3":case"bvec4":return o.BOOL;case"short":return o.SHORT;case"ushort":return o.UNSIGNED_SHORT;case"ubyte":return o.UNSIGNED_BYTE;case"byte":return o.BYTE;default:return o.FLOAT}}function Ow(o,t){switch(t){case o.LOW_FLOAT:case o.HIGH_FLOAT:case o.FLOAT:return 1;case o.FLOAT_VEC2:return 2;case o.FLOAT_VEC3:return 3;case o.FLOAT_VEC4:return 4;case o.BYTE:return 1;case o.UNSIGNED_BYTE:return 1;case o.UNSIGNED_SHORT:case o.SHORT:return 1;default:return 1}}function Uw(o,t){switch(t){case o.LOW_FLOAT:case o.HIGH_FLOAT:case o.FLOAT:case o.FLOAT_VEC2:case o.FLOAT_VEC3:case o.FLOAT_VEC4:return o.FLOAT;case o.BYTE:return o.BYTE;case o.UNSIGNED_BYTE:return o.UNSIGNED_BYTE;case o.SHORT:return o.SHORT;case o.UNSIGNED_SHORT:return o.UNSIGNED_SHORT;default:return o.FLOAT}}function xy(o,t){const e=r=>{const l=`#version 300 es
    precision mediump float;
    out vec4 fragColor;
    void main() {
      float index = 1.01;
      %%complexity%%
    }`;let h="";for(let u=0;u<r;u++)u===0?h+=`if (index <= ${u}.5) {
`:h+=`   else if (index <= ${u}.5) {
`,h+=`      fragColor = vec4(1.0);
`,h+=`   }
`;return l.replace("%%complexity%%",h)};let s=!1;do{const r=e(t),l=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(l,r),o.compileShader(l),s=o.getShaderParameter(l,o.COMPILE_STATUS),s||(t=t/2|0)}while(!s);return t}function Lw(o,t){switch(t){case o.FLOAT:return"uniform1f";case o.FLOAT_VEC2:return"uniform2f";case o.FLOAT_VEC3:return"uniform3f";case o.FLOAT_VEC4:return"uniform4f";case o.INT:return"uniform1i";case o.INT_VEC2:return"uniform2i";case o.INT_VEC3:return"uniform3i";case o.INT_VEC4:return"uniform4i";case o.BOOL:return"uniform1i";case o.BOOL_VEC2:return"uniform2i";case o.BOOL_VEC3:return"uniform3i";case o.BOOL_VEC4:return"uniform4i";case o.FLOAT_MAT2:return"uniform1f";case o.FLOAT_MAT3:return"uniform1f";case o.FLOAT_MAT4:return"uniform1f";case o.SAMPLER_2D:return"uniform1f";case o.SAMPLER_CUBE:return"uniform1f";case o.UNSIGNED_INT:return"uniform1ui";case o.UNSIGNED_INT_VEC2:return"uniform2ui";case o.UNSIGNED_INT_VEC3:return"uniform3ui";case o.UNSIGNED_INT_VEC4:return"uniform4ui";case o.FLOAT_MAT2x3:return"uniformMatrix2x3fv";case o.FLOAT_MAT2x4:return"uniformMatrix2x4fv";case o.FLOAT_MAT3x2:return"uniformMatrix3x2fv";case o.FLOAT_MAT3x4:return"uniformMatrix3x4fv";case o.FLOAT_MAT4x2:return"uniformMatrix4x2fv";case o.FLOAT_MAT4x3:return"uniformMatrix4x3fv";case o.SAMPLER_2D_ARRAY:return"uniform1fv";case o.SAMPLER_2D_ARRAY_SHADOW:return"uniform1f";case o.SAMPLER_CUBE_SHADOW:return"uniform1f";case o.INT_SAMPLER_2D:return"uniform1f";case o.INT_SAMPLER_3D:return"uniform1f";case o.INT_SAMPLER_CUBE:return"uniform1f";case o.INT_SAMPLER_2D_ARRAY:return"uniform1f";case o.UNSIGNED_INT_SAMPLER_2D:return"uniform1ui";default:throw new Error(`Unknown uniform type: ${t}`)}}const by=class eo{constructor(t){this.name="anonymous shader",this._logger=yt.getInstance(),this._textures=new Map,this.attributes={},this._uniforms={},this._uniformBuffers={},this._compiled=!1,this._dirtyUniforms=!0,this._startingTextureSlot=0,this.uniforms=Wi({},()=>this.flagUniformsDirty()),this.images={};const{name:e,graphicsContext:s,vertexSource:r,fragmentSource:l,onPreLink:h,onPostCompile:u,uniforms:f,images:g,startingTextureSlot:_}=t;if(this.name=e??this.name,!(s instanceof Ls))throw new Error(`ExcaliburGraphicsContext provided to a shader ${this.name} must be WebGL`);this._gl=s.__gl,this._startingTextureSlot=_??this._startingTextureSlot,this._maxTextureSlots=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS)-this._startingTextureSlot,this.vertexSource=r,this.fragmentSource=l,this.uniforms=Wi(f??this.uniforms,()=>this.flagUniformsDirty()),this.images=g??this.images,Object.keys(this.images).length>=this._maxTextureSlots&&this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`),this._textureLoader=s.textureLoader,this._onPreLink=h,this._onPostCompile=u}flagUniformsDirty(){this._dirtyUniforms=!0}get compiled(){return this._compiled}dispose(){this._gl.deleteProgram(this.program),this._gl=null}use(){this._gl.useProgram(this.program),eo._ACTIVE_SHADER_INSTANCE=this,this._dirtyUniforms&&(this._setUniforms(),this._dirtyUniforms=!1),this._setImages()}unuse(){const t=this._gl;eo._ACTIVE_SHADER_INSTANCE=null,t.useProgram(null)}isCurrentlyBound(){return eo._ACTIVE_SHADER_INSTANCE===this}_setUniforms(){const t=this._gl,e=Object.entries(this.uniforms);if(e.length){const s=this.getUniformDefinitions();for(const[r,l]of e)if(l instanceof Float32Array)this.setUniformBuffer(r,l);else if(Array.isArray(l)&&l[0]instanceof Float32Array&&typeof l[1]=="number")this.setUniformBuffer(r,l[0],l[1]);else if(typeof l=="number")this.trySetUniformFloat(r,l);else if(typeof l=="boolean")this.trySetUniformBoolean(r,l);else if(l instanceof B)this.trySetUniformFloatVector(r,l);else if(l instanceof tt)this.trySetUniformFloatColor(r,l);else if(l instanceof _e)this.setUniformAffineMatrix(r,l);else{const h=s.find(u=>u.name===r);if(h){const u=Lw(t,h.glType);this.trySetUniform(u,r,l)}else this._logger.warnOnce(`Could not locate uniform named ${r}, this can happen if the uniform is unused in the shader code some GPUs will remove this as an optimization.`)}}}_loadImageSource(t){const e=t.image,s=e.getAttribute(Ht.Filtering),r=s?So(s):void 0,l=us(e.getAttribute(Ht.WrappingX)),h=us(e.getAttribute(Ht.WrappingY)),u=e.getAttribute("forceUpload")==="true",f=this._textureLoader.load(e,{filtering:r,wrapping:{x:l,y:h}},u);return e.removeAttribute("forceUpload"),this._textures.has(t)||this._textures.set(t,f),f}_setImages(t=!1){const e=this._gl;let s=this._startingTextureSlot;for(const[r,l]of Object.entries(this.images)){if(!l.isLoaded()){t||this._logger.warnOnce(`Image named ${r} in not loaded, nothing will be uploaded to the shader. Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);continue}const h=this._loadImageSource(l);h||t||this._logger.warnOnce(`Image ${r} (${l.image.src}) could not be loaded for some reason in shader ${this.name}`),e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,h),this.trySetUniformInt(r,s),s++}}compile(){if(this._compiled)return this.program;const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),s=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,s);const r=this.getAttributeDefinitions();for(const h of r)this.attributes[h.name]=h;const l=this.getUniformDefinitions();for(const h of l)this._uniforms[h.name]=h;return this._compiled=!0,this._onPostCompile&&this._onPostCompile(this),t.useProgram(this.program),eo._ACTIVE_SHADER_INSTANCE=this,this._dirtyUniforms&&(this._setUniforms(),this._dirtyUniforms=!1),this._setImages(!0),this.unuse(),this.program}getUniformDefinitions(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),s=[];for(let r=0;r<e;r++){const l=t.getActiveUniform(this.program,r),h=t.getUniformLocation(this.program,l.name);s.push({name:l.name,glType:l.type,location:h})}return s}getAttributeDefinitions(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),s=[];for(let r=0;r<e;r++){const l=t.getActiveAttrib(this.program,r),h=t.getAttribLocation(this.program,l.name);s.push({name:l.name,glType:Uw(t,l.type),size:Ow(t,l.type),location:h,normalized:!1})}return s}addImageSource(t,e){Object.keys(this.images).length<this._maxTextureSlots?this.images[t]=e:this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`)}removeImageSource(t){const e=this.images[t];e&&(this._textureLoader.delete(e.image),delete this.images[t])}setTexture(t,e){const s=this._gl;s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,e)}setUniformBuffer(t,e,s=0){const r=this._gl,l=r.getUniformBlockIndex(this.program,t);l===r.INVALID_INDEX&&this._logger.warnOnce(`Invalid block name ${t}`);let h;this._uniformBuffers[t]?(h=this._uniformBuffers[t],h.bufferData.set(e),h.upload()):(h=new Iw({gl:r,data:e}),this._uniformBuffers[t]=h),r.uniformBlockBinding(this.program,l,s),r.bindBufferBase(r.UNIFORM_BUFFER,s,h.buffer)}trySetUniformBuffer(t,e,s=0){return this._compiled?this.isCurrentlyBound()?this._gl.getUniformBlockIndex(this.program,t)?(this.setUniformBuffer(t,e,s),!0):!1:(this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1):(this._logger.warn(`Must compile shader before setting a uniform block ${t} at binding point ${s}`),!1)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}trySetUniformInt(t,e){return this.trySetUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}trySetUniformIntArray(t,e){return this.trySetUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}trySetUniformBoolean(t,e){return this.trySetUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}trySetUniformFloat(t,e){return this.trySetUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}trySetUniformFloatArray(t,e){return this.trySetUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}trySetUniformFloatVector(t,e){return this.trySetUniform("uniform2f",t,e.x,e.y)}setUniformFloatColor(t,e){this.setUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}trySetUniformFloatColor(t,e){return this.trySetUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniformAffineMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,[e.data[0],e.data[1],0,0,e.data[2],e.data[3],0,0,0,0,1,0,e.data[4],e.data[5],0,1])}trySetUniformMatrix(t,e){return this.trySetUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...s){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const l=this._gl.getUniformLocation(this.program,e);if(l){const h=[l,...s];this._gl[t].apply(this._gl,h)}else throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(t,e,...s){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${t}:${e}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;const l=this._gl.getUniformLocation(this.program,e);if(l){const h=[l,...s];this._gl[t].apply(this._gl,h)}else return!1;return!0}_createProgram(t,e,s){const r=t.createProgram();if(r===null)throw Error("Could not create graphics shader program");if(t.attachShader(r,e),t.attachShader(r,s),this._onPreLink&&this._onPreLink(r),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(r)}]`);return r}_compileShader(t,e,s){const r=t.VERTEX_SHADER===s?"vertex":"fragment",l=t.createShader(s);if(l===null)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(l,e),t.compileShader(l),!t.getShaderParameter(l,t.COMPILE_STATUS)){const u=t.getShaderInfoLog(l);throw Error(`Could not compile ${r} shader:

${u}${this._processSourceForError(e,u)}`)}return l}_processSourceForError(t,e){if(!t)return e;const s=t.split(`
`),r=e.search(/\d:\d/),l=e.indexOf(" ",r),[h,u]=e.slice(r,l).split(":").map(f=>Number(f));for(let f=0;f<s.length;f++)s[f]=`${f+1}: ${s[f]}${u===f+1?" <----- ERROR!":""}`;return`

Source:
`+s.join(`
`)}};by._ACTIVE_SHADER_INSTANCE=null;let ds=by;const Fw=`#version 300 es
precision mediump float;

uniform float deltaMs;
uniform float maxLifeMs;
uniform vec2 gravity;
uniform vec2 focus;
uniform float focusAccel;
uniform mat4 u_matrix;
uniform mat4 u_transform;
uniform float startSize;
uniform float endSize;
// uniform sampler2D obstacle;

layout(location=0)in vec2 position;
layout(location=1)in vec2 velocity;
layout(location=2)in float rotation;
layout(location=3)in float angularVelocity;
layout(location=4)in float lifeMs;

// TODO z index to handle buffer wrapping?

// DO NOT RE-ORDER
out vec2 finalPosition;
out vec2 finalVelocity;
out float finalRotation;
out float finalAngularVelocity;
out float finalLifeMs;
void main(){
  // Evolve particle
  float seconds = deltaMs / 1000.;
  // euler integration
  // Weird artifact of re-using the same buffer layout for update/draw
  // we need differently named variables
  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;
  finalVelocity = velocity + finalGravity * seconds;
  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;
  finalRotation = rotation + angularVelocity * seconds;
  finalAngularVelocity = angularVelocity;
  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);

  // Collision mask sampling
  // vec2 samplePoint = finalPosition / vec2(width, height);
  // vec4 collides = texture(obstacle, samplePoint);
  // if (distance(collides,vec4(0.)) > .01) {
  //   // non opaque means we collide! recalc final pos/vel
  //   vec2 newVelocity = velocity * -.1;// lose energy
  //   finalVelocity = newVelocity + gravity * seconds;
  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;
  // }

  float lifePercent = finalLifeMs / maxLifeMs;
  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;
  float scale = sqrt(u_transform[0][0] * u_transform[0][0] + u_transform[1][1] * u_transform[1][1]);
  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z
  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent) * scale;
}`,Nw=`#version 300 es
precision mediump float;

uniform sampler2D graphic;
uniform bool useTexture;
uniform float maxLifeMs;

uniform vec4 beginColor;
uniform vec4 endColor;
uniform bool fade;
uniform float startOpacity;

in float finalRotation;
in float finalLifeMs;
out vec4 fragColor;

void main(){

  float lifePct = finalLifeMs / maxLifeMs;

  if (useTexture) {
    /** Draw texture */
    if (lifePct <= 0.) discard;
    float mid = .5;
    float cosine = cos(finalRotation);
    float sine = sin(finalRotation);
    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,
                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);
    vec4 color = texture(graphic, rotated);
    fragColor = color * (fade ? lifePct : 1.0);
  } else {
    /** Draw circle */
    if (lifePct <= 0.) discard;
    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;
    float dist = 1.0 - length(uv);
    float edge = fwidth(dot(uv, uv));
    float circle = smoothstep(-edge/2.0, edge/2.0, dist);
    vec3 color = mix(beginColor.rgb, endColor.rgb, 1.0 - lifePct);
    fragColor.rgb = color;
    fragColor.a = startOpacity * circle * (fade ? lifePct : 1.0);// * mix(beginColor.a, endColor.a, 1.0 - lifePct);
    fragColor.rgb *= fragColor.a;
  }
}`;class _o{constructor(t,e,s){this.worldPos=t,this.pagePos=e,this.screenPos=s}static fromPagePosition(t,e,s){let r,l,h,u;arguments.length===3?(r=t,l=e,h=new B(r,l),u=s):(h=t,r=h.x,l=h.y,u=e);const f=u.screen.pageToScreenCoordinates(h),g=u.screen.screenToWorldCoordinates(f);return new _o(g,h,f)}}function Hw(o,t,e){return(1-e)*o+t*e}function wy(o,t,e,s){const r=(o-t+Ge)%Ge>=Math.PI,l=Math.abs(t-o),h=Ge-l;let u=0,f=0;l>h?(u=h,f=l):(u=l,f=h);let g=0,_=1;switch(e){case me.ShortestPath:g=u,_=r?1:-1;break;case me.LongestPath:g=f,_=r?-1:1;break;case me.Clockwise:_=1,g=r?u:f;break;case me.CounterClockwise:_=-1,g=r?f:u;break}return o+_*(g*s)}function pf(o,t,e){return o.scale(1-e).add(t.scale(e))}function Gw(o,t,e){return(e-o)/(t-o)}function Hs(o,t,e,s,r){const l=Gw(o,t,r);return Hw(e,s,l)}class Pc{constructor(t){this._distLookup=[],this.quality=4;var e;if(t.controlPoints.length!==4)throw new Error("Only cubic bezier curves are supported");this._controlPoints=[...t.controlPoints],this.quality=(e=t.quality)!=null?e:this.quality,this._calculateLookup()}get arcLength(){return this._arcLength}get controlPoints(){return this._controlPoints}set controlPoints(t){this._controlPoints=[...t],this._calculateLookup()}setControlPoint(t,e){this._controlPoints[t]=e,this._calculateLookup()}_calculateLookup(){let t=0;this._distLookup.length=0;let e=this.controlPoints[0];const s=this.controlPoints.length*this.quality;for(let r=0;r<s;r++){const l=r/(s-1),h=this.getPoint(l),u=e.distance(h);t+=u,this._distLookup.push(t),e=h}this._arcLength=t}_getTimeGivenDistance(t){const e=this._distLookup.length,s=this.arcLength;if(t>=0&&t<s){for(let r=0;r<e-1;r++)if(this._distLookup[r]<=t&&t<this._distLookup[r+1])return Hs(this._distLookup[r],this._distLookup[r+1],r/(e-1),(r+1)/(e-1),t)}return t/s}getPoint(t){const e=[...this.controlPoints];for(let s=1;s<e.length;s++)for(let r=0;r<e.length-s;r++)e[r]=pf(e[r],e[r+1],t);return e[0]}getTangent(t){const e=t*t,s=this.controlPoints[0],r=this.controlPoints[1],l=this.controlPoints[2],h=this.controlPoints[3];return s.scale(-3*e+6*t-3).add(r.scale(9*e-12*t+3).add(l.scale(-9*e+6*t).add(h.scale(3*e)))).normalize()}getUniformTangent(t){const e=t*this.arcLength,s=this._getTimeGivenDistance(e);return this.getTangent(s)}getNormal(t){return this.getTangent(t).normal()}getUniformNormal(t){return this.getUniformTangent(t).normal()}getUniformPoint(t){const e=t*this.arcLength,s=this._getTimeGivenDistance(e);return this.getPoint(s)}clone(){return new Pc({controlPoints:[...this.controlPoints],quality:this.quality})}}new q0;const tr=class _n{static integrate(t,e,s,r){const l=r/1e3;e.vel.addEqual(s.scale(l,_n._ACC)),e.vel.setTo(Pt(e.vel.x,-e.maxVel.x,e.maxVel.x),Pt(e.vel.y,-e.maxVel.y,e.maxVel.y)),t.pos.add(e.vel.scale(l,_n._VEL),_n._POS).addEqual(s.scale(.5*l*l,_n._VEL_ACC)),e.angularVelocity+=e.torque*(1/e.inertia)*l;const h=t.rotation+e.angularVelocity*l;t.scale.add(e.scaleFactor.scale(l,this._SCALE_FACTOR),_n._SCALE),t.get().setTransform(_n._POS,h,_n._SCALE)}};tr._POS=new B(0,0);tr._SCALE=new B(1,1);tr._ACC=new B(0,0);tr._VEL=new B(0,0);tr._VEL_ACC=new B(0,0);tr._SCALE_FACTOR=new B(0,0);let Cy=tr;class Sy extends Fs{constructor(t){super(),this.beginColor=tt.White,this.endColor=tt.White,this.life=300,this.fade=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=tt.White,this.size=5,this.sizeRate=0,this.visible=!0,this.isOffscreen=!1,this.particleTransform="global",this.name=`Particle#${this.id}`,this.addComponent(this.transform=new at),this.addComponent(this.motion=new qt),this.addComponent(this.graphics=new Ve),this.configure(t)}registerEmitter(t){if(this._emitter=t,this.particleTransform==="global"){const e=this._emitter.transform.globalPos;this.transform.pos=this.transform.pos.add(e),this.motion.vel=this.motion.vel.rotate(this._emitter.transform.globalRotation)}}configure(t){var e,s,r,l,h,u,f,g,_,y,A,x,D,S,U;this.particleTransform=(e=t.transform)!=null?e:this.particleTransform,this.life=(s=t.life)!=null?s:this.life,this.fade=(r=t.fade)!=null?r:this.fade,this.size=(l=t.size)!=null?l:this.size,this.endColor=(h=t.endColor)!=null?h:this.endColor.clone(),this.beginColor=(u=t.beginColor)!=null?u:this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.graphic=t.graphic,this.graphics.opacity=(f=t.opacity)!=null?f:this.graphics.opacity,this.transform.pos=(g=t.pos)!=null?g:this.transform.pos,this.transform.rotation=(_=t.rotation)!=null?_:0,this.transform.scale=L(1,1),this.transform.z=(y=t.z)!=null?y:0,this.motion.vel=(A=t.vel)!=null?A:this.motion.vel,this.motion.angularVelocity=(x=t.angularVelocity)!=null?x:0,this.motion.acc=(D=t.acc)!=null?D:this.motion.acc,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.graphics.opacity/this.life,this.startSize=(S=t.startSize)!=null?S:0,this.endSize=(U=t.endSize)!=null?U:0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.size=this.startSize),this.graphic?(this.graphics.use(this.graphic),this.graphics.onPostDraw=void 0):(this.graphics.localBounds=Tt.fromDimension(this.size,this.size,B.Half),this.graphics.onPostDraw=R=>{R.save(),R.debug.drawPoint(L(0,0),{color:this._currentColor,size:this.size}),R.restore()})}kill(){var t;(t=this._emitter)!=null&&t.isActive?this._emitter.removeParticle(this):super.kill()}update(t,e){this.life=this.life-e,this.life<0&&this.kill(),this.fade&&(this.graphics.opacity=Pt(this._aRate*this.life,1e-4,1)),this.startSize&&this.endSize&&this.startSize>0&&this.endSize>0&&(this.size=Pt(this.sizeRate*e+this.size,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=Pt(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=Pt(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=Pt(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=this.graphics.opacity;let s=this.motion.acc;this.focus&&(s=this.focus.sub(this.transform.pos).normalize().scale(this.focusAccel||0).scale(e/1e3)),Cy.integrate(this.transform,this.motion,s,e)}}Sy.DefaultConfig={beginColor:tt.White,endColor:tt.White,life:300,fade:!1,size:5,graphic:void 0,startSize:void 0,endSize:void 0};var Ty=(o=>(o.Global="global",o.Local="local",o))(Ty||{});class Qw{constructor(){this.type="ex.particle",this.priority=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new ds({graphicsContext:e,vertexSource:Fw,fragmentSource:Nw,onPreLink:s=>{t.transformFeedbackVaryings(s,["finalPosition","finalVelocity","finalRotation","finalAngularVelocity","finalLifeMs"],t.INTERLEAVED_ATTRIBS)}}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho)}_getTexture(t){const e=t.getAttribute(Ht.Filtering),s=e?So(e):void 0,r=us(t.getAttribute(Ht.WrappingX)),l=us(t.getAttribute(Ht.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);return t.removeAttribute("forceUpload"),u}draw(t,e){var s,r,l,h,u,f,g,_,y;const A=this._gl;this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho);const x=t.particle.transform===Ty.Local?this._context.getTransform():this._context.getTransform().multiply(t.emitter.transform.get().inverse);this._shader.setUniformAffineMatrix("u_transform",x),this._shader.setUniformBoolean("fade",!!t.particle.fade),this._shader.setUniformBoolean("useTexture",!!t.particle.graphic),this._shader.setUniformFloat("maxLifeMs",(s=t.particle.life)!=null?s:2e3),this._shader.setUniformFloat("deltaMs",e),this._shader.setUniformFloatVector("gravity",(r=t.particle.acc)!=null?r:L(0,0)),this._shader.setUniformFloatColor("beginColor",(l=t.particle.beginColor)!=null?l:tt.Transparent),this._shader.setUniformFloatColor("endColor",(h=t.particle.endColor)!=null?h:tt.Transparent);let D=(u=t.particle.startSize)!=null?u:0,S=(f=t.particle.endSize)!=null?f:0;const U=(g=t.particle.size)!=null?g:0;if(U>0&&(D=U,S=U),this._shader.setUniformFloat("startSize",D??10),this._shader.setUniformFloat("endSize",S??10),this._shader.setUniformFloat("startOpacity",(_=t.particle.opacity)!=null?_:1),t.particle.focus&&(this._shader.setUniformFloatVector("focus",t.particle.focus),this._shader.setUniformFloat("focusAccel",(y=t.particle.focusAccel)!=null?y:0)),t.particle.graphic){const R=t.particle.graphic,C=this._getTexture(R.image.image);A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,C),this._shader.setUniformInt("graphic",0)}t.draw(A)}hasPendingDraws(){return!1}flush(){}dispose(){}}class Gs{constructor(t){this.type="dynamic";const{gl:e,size:s,type:r,data:l}=t;if(this._gl=e,this.buffer=this._gl.createBuffer(),!l&&!s)throw Error("Must either provide data or a size to the VertexBuffer");l?this.bufferData=l:this.bufferData=new Float32Array(s),this.type=r??this.type,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,null)}upload(t){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),t?e.bufferSubData(e.ARRAY_BUFFER,0,this.bufferData,0,t):e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}class wn{constructor(t){this._logger=yt.getInstance(),this._suppressWarnings=!1,this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0,this._initialized=!1;const{gl:e,shader:s,vertexBuffer:r,attributes:l,suppressWarnings:h}=t;this._gl=e,this._vertexBuffer=r,this._attributes=l,this._shader=s,this._suppressWarnings=h,s&&this.initialize()}get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(t){t&&this._shader!==t&&(this._shader=t,this.initialize())}get shader(){return this._shader}initialize(){if(this._initialized||!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._vertexTotalSizeBytes=0,this._layout.length=0;const t=this._shader.attributes;for(const l of this._attributes){const h=t[l[0]];if(!h){if(!kw(this._shader.vertexSource,l[0]))throw Error(`The attribute named: ${l[0]} size ${l[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);this._suppressWarnings||this._logger.warn(`The attribute named: ${l[0]} size ${l[1]} not found in the compiled shader. This is possibly a bug:
 1. Not a bug, but should remove unused code - attribute "${l[0]}" is unused in vertex/fragment and has been automatically removed by glsl compiler.
 2. Definitely a bug, attribute "${l[0]}" in layout has been mistyped or is missing in shader, check vertex/fragment source.`);const u=zw(this._gl,this._shader.vertexSource,l[0]);this._layout.push({name:l[0],glType:u,size:l[1],location:-1,normalized:!1})}if(h){if(h.size!==l[1])throw Error(`VertexLayout size definition for attribute: [${l[0]}, ${l[1]}], doesn't match shader source size ${h.size}:
 ${this._shader.vertexSource}`);this._layout.push(h)}}let e=0;for(const l of this._layout){const h=$m(this._gl,l.glType);this._vertexTotalSizeBytes+=h*l.size,e+=l.size}this._vertexBuffer.bufferData.length%e!==0&&this._logger.warn(`The vertex component size (${e})  does NOT divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`);const s=this._gl;this._vao=s.createVertexArray(),s.bindVertexArray(this._vao),this._vertexBuffer.bind();let r=0;for(const l of this._layout)l.location!==-1&&(l.glType===s.INT?s.vertexAttribIPointer(l.location,l.size,l.glType,this.totalVertexSizeBytes,r):s.vertexAttribPointer(l.location,l.size,l.glType,l.normalized,this.totalVertexSizeBytes,r),s.enableVertexAttribArray(l.location)),r+=$m(s,l.glType)*l.size;s.bindVertexArray(null),this._vertexBuffer.unbind(),this._initialized=!0}use(t=!1,e){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");const s=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(e),s.bindVertexArray(this._vao)}}class Vw{constructor(t,e){e.includes("v_texcoord")&&yt.getInstance().warn(`ScreenShader: "v_texcoord" is deprecated in postprocessing fragment shaders will be removed in v1.0, use "v_uv" instead. Source [${e}]`);const s=t.__gl;this._shader=new ds({graphicsContext:t,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_uv;
      out vec2 v_texcoord;
      out vec2 v_uv;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_uv;
        v_uv = a_uv;
      }`,fragmentSource:e}),this._shader.compile(),this._buffer=new Gs({gl:s,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new wn({gl:s,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}var oo=(o=>(o.Protanope="Protanope",o.Deuteranope="Deuteranope",o.Tritanope="Tritanope",o))(oo||{});const Yw=`#version 300 es
precision mediump float;
// our texture
uniform sampler2D u_image;
// the texCoords passed in from the vertex shader.
in vec2 v_texcoord;

// color blind type
uniform int u_type;

// simulation?
uniform bool u_simulate;

out vec4 fragColor;

void main() {
  vec4 o =  texture(u_image, v_texcoord);
  // RGB to LMS matrix conversion
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);
  // Simulate color blindness
  float l;
  float m;
  float s;
  //MODE CODE//
  if (u_type == 0) {
    // Protanope
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;
    m = 0.0 * L + 1.0 * M + 0.0 * S;
    s = 0.0 * L + 0.0 * M + 1.0 * S;;
  } else if (u_type == 1) {
    // Deuteranope
    l = 1.0 * L + 0.0 * M + 0.0 * S;
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;
    s = 0.0 * L + 0.0 * M + 1.0 * S;
  } else if (u_type == 2) {
    // Tritanope
    l = 1.0 * L + 0.0 * M + 0.0 * S;
    m = 0.0 * L + 1.0 * M + 0.0 * S;
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;
  }

  // LMS to RGB matrix conversion
  vec4 error; // simulate the colors
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);
  error.a = 1.0;
  vec4 diff = o - error;
  vec4 correction; // correct the colors
  correction.r = 0.0;
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);
  correction = o + correction;
  correction.a = o.a;
  //SIMULATE//

  // sim 
  if (u_simulate) {
    fragColor = error.rgba;
  } else {
    fragColor = correction.rgba;
  }
}`;class jw{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new Vw(t,Yw),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const e=this._shader.getShader();e.use(),this._colorBlindnessMode===oo.Protanope?e.setUniformInt("u_type",0):this._colorBlindnessMode===oo.Deuteranope?e.setUniformInt("u_type",1):this._colorBlindnessMode===oo.Tritanope&&e.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class Bc{constructor(t,e,s){this._logger=yt.getInstance(),this._gl=t,this.buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer);const r=e*6;if(!s)this.bufferData=new Uint32Array(r);else{const u=Math.floor(16383.5);this.bufferGlType=t.UNSIGNED_SHORT,this.bufferData=new Uint16Array(r),e>u&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${u}) requested quads(${e})`)}let l=0;for(let h=0;h<r;h+=6)this.bufferData[h+0]=l+0,this.bufferData[h+1]=l+1,this.bufferData[h+2]=l+2,this.bufferData[h+3]=l+2,this.bufferData[h+4]=l+1,this.bufferData[h+5]=l+3,l+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}const qw=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

in vec2 a_screenuv;
out vec2 v_screenuv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
  v_screenuv = a_screenuv;
}
`;class Xw{constructor(t){this._logger=yt.getInstance(),this._color=tt.Transparent,this._initialized=!1,this._images={},this._uniforms={};const{color:e,name:s,vertexSource:r,fragmentSource:l,graphicsContext:h,images:u,uniforms:f}=t;if(this._name=s??"anonymous material",this._vertexSource=r??qw,this._fragmentSource=l,this._color=e??this._color,this._uniforms=f??this._uniforms,this._images=u??this._images,!h)throw Error(`Material ${s} must be provided an excalibur webgl graphics context`);h instanceof Ls?this._initialize(h):this._logger.warn(`Material ${s} was created in 2D Canvas mode, currently only WebGL is supported`)}_initialize(t){this._initialized||(this._shader=t.createShader({name:this._name,vertexSource:this._vertexSource,fragmentSource:this._fragmentSource,uniforms:this._uniforms,images:this._images,startingTextureSlot:this.isUsingScreenTexture?2:1}),this._initialized=!0)}get uniforms(){return this._shader.uniforms}get images(){return this._shader.images}get color(){return this._color}set color(t){this._color=t}get name(){return this._name}get isUsingScreenTexture(){return this._fragmentSource.includes("u_screen_texture")}update(t){this._shader&&(this._shader.use(),t(this._shader))}getShader(){return this._shader}addImageSource(t,e){this._shader.addImageSource(t,e)}removeImageSource(t){this._shader.removeImageSource(t)}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}const gf=class hi{static registerGraphicsContext(t){hi._ctx=t}static draw(t){this._drawCalls.push(t)}static drawPoint(t,e){hi.draw(s=>{s.debug.drawPoint(t,e)})}static drawLine(t,e,s){hi.draw(r=>{r.debug.drawLine(t,e,s)})}static drawLines(t,e){t.length>1&&hi.draw(s=>{for(let r=0;r<t.length-1;r++)s.debug.drawLine(t[r],t[r+1],e)})}static drawText(t,e){hi.draw(s=>{s.debug.drawText(t,e)})}static drawPolygon(t,e){t.length>1&&hi.draw(s=>{const r=t[0],l=[...t,r];for(let h=0;h<l.length-1;h++)s.debug.drawLine(l[h],l[h+1],e)})}static drawCircle(t,e,s){const{color:r,strokeColor:l,width:h}={color:tt.Black,strokeColor:void 0,width:void 0,...s};hi.draw(u=>{u.drawCircle(t,e,r,l,h)})}static drawBounds(t,e){hi.draw(s=>{s.debug.drawRect(t.left,t.top,t.width,t.height,e)})}static drawRay(t,e){const{distance:s,color:r}={color:tt.Blue,distance:10,...e};hi.draw(l=>{const h=t.pos,u=t.pos.add(t.dir.scale(s));l.debug.drawLine(h,u,{color:r})})}static flush(t){t.save(),t.z=hi.z;for(const e of hi._drawCalls)e(t);t.restore(),hi.clear()}static clear(){hi._drawCalls.length=0}};gf._drawCalls=[];gf.z=1/0;let Ey=gf;class Zw{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0,this._startScratch=L(0,0),this._endScratch=L(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new ds({graphicsContext:e,vertexSource:Ew,fragmentSource:Dw}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new Gs({gl:t,size:12*this._maxLines,type:"dynamic"}),this._layout=new wn({gl:t,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}dispose(){this._vertexBuffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,s){this._isFull()&&this.flush(),this._lineCount++;const r=this._context.getTransform(),l=r.multiply(t,this._startScratch),h=r.multiply(e,this._endScratch),u=this._vertexBuffer.bufferData;u[this._vertexIndex++]=l.x,u[this._vertexIndex++]=l.y,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=h.x,u[this._vertexIndex++]=h.y,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),Ce.DrawnImagesCount+=this._lineCount,Ce.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const Ww=`#version 300 es
in vec2 a_position;
in vec4 a_color;
in float a_size;
out lowp vec4 v_color;
uniform mat4 u_matrix;

void main() {
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);
  gl_PointSize = a_size * 2.0;
  v_color = a_color;
}`,Jw=`#version 300 es

precision mediump float;
in lowp vec4 v_color;

out vec4 fragColor;

void main() {
  float r = 0.0, delta = 0.0, alpha = 1.0;
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;
  r = dot(cxy, cxy);

  delta = fwidth(r);
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
  // "premultiply" the color by alpha
  vec4 color = v_color;
  color.a = color.a * alpha;
  color.rgb = color.rgb * color.a;
  fragColor = color;
}`;class Kw{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new ds({graphicsContext:e,vertexSource:Ww,fragmentSource:Jw}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new Gs({gl:t,size:7*this._maxPoints,type:"dynamic"}),this._layout=new wn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}dispose(){this._buffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,s){this._isFull()&&this.flush(),this._pointCount++;const r=this._context.getTransform(),l=this._context.opacity,h=this._context.snapToPixel,u=r.multiply(t);h&&(u.x=~~(u.x+St),u.y=~~(u.y+St));const f=this._buffer.bufferData;f[this._vertexIndex++]=u.x,f[this._vertexIndex++]=u.y,f[this._vertexIndex++]=e.r/255,f[this._vertexIndex++]=e.g/255,f[this._vertexIndex++]=e.b/255,f[this._vertexIndex++]=e.a*l,f[this._vertexIndex++]=s*Math.max(r.getScaleX(),r.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),Ce.DrawnImagesCount+=this._pointCount,Ce.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const $w=`#version 300 es
in vec2 a_position;

in vec2 a_texcoord;
out vec2 v_texcoord;

void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);

  // Pass the texcoord to the fragment shader.
  v_texcoord = a_texcoord;
}`,tC=`#version 300 es
precision mediump float;

// Passed in from the vertex shader.
in vec2 v_texcoord;

// The texture.
uniform sampler2D u_texture;

out vec4 fragColor;

void main() {
   fragColor = texture(u_texture, v_texcoord);
}`;class eC{constructor(t){const e=t.__gl;this._gl=e,this._shader=new ds({graphicsContext:t,vertexSource:$w,fragmentSource:tC}),this._shader.compile(),this._buffer=new Gs({gl:e,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new wn({gl:e,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl,s=t.getShader();s.use(),t.getLayout().use(),e.activeTexture(e.TEXTURE0),s.trySetUniformInt("u_image",0),t.onDraw&&t.onDraw(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}const iC=`#version 300 es
precision mediump float;

// UV coord
in vec2 v_texcoord;

// Texture index
in lowp float v_textureIndex;

// Textures in the current draw
uniform sampler2D u_textures[%%count%%];

uniform bool u_pixelart;

// Opacity
in float v_opacity;

in vec4 v_tint;

in vec2 v_res;

out vec4 fragColor;

// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {
  vec2 pixel = uv * texture_size;
  
  vec2 seam=floor(pixel+.5);
  vec2 dudv=fwidth(pixel);
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);
  
  return pixel/texture_size;
}

void main(){
  // In order to support the most efficient sprite batching, we have multiple
  // textures loaded into the gpu (usually 8) this picker logic skips over textures
  // that do not apply to a particular sprite.
  
  vec4 color=vec4(1.,0,0,1.);
  
  // GLSL is templated out to pick the right texture and set the vec4 color
  %%texture_picker%%
  
  color.rgb=color.rgb*v_opacity;
  color.a=color.a*v_opacity;
  fragColor=color*v_tint;
}`,sC=`#version 300 es
in vec2 a_position;

// Opacity
in float a_opacity;
out float v_opacity;

// UV coordinate
in vec2 a_texcoord;
out vec2 v_texcoord;

// Texture res
in vec2 a_res;
out vec2 v_res;

// Texture number
in lowp float a_textureIndex;
out lowp float v_textureIndex;

in vec4 a_tint;
out vec4 v_tint;

uniform mat4 u_matrix;

void main(){
  // Set the vertex position using the ortho transform matrix
  gl_Position=u_matrix*vec4(a_position,0.,1.);
  
  // Pass through the Opacity to the fragment shader
  v_opacity=a_opacity;
  // Pass through the UV coord to the fragment shader
  v_texcoord=a_texcoord;

  v_res = a_res;

  // Pass through the texture number to the fragment shader
  v_textureIndex=a_textureIndex;
  // Pass through the tint
  v_tint=a_tint;
}`;class nC{constructor(t){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._quad=[0,0,0,0,0,0,0,0],this._defaultTint=tt.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r=xy(t,s);this._maxTextures=Math.min(s,r);const l=this._transformFragmentSource(iC,this._maxTextures);this._shader=new ds({graphicsContext:e,fragmentSource:l,vertexSource:sC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((h,u)=>u)),this._buffer=new Gs({gl:t,size:48*this._maxImages,type:"dynamic"}),this._layout=new wn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_res",2],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new Bc(t,this._maxImages,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let s=t.replace("%%count%%",e.toString()),r="";for(let l=0;l<e;l++)l===0?r+=`if (v_textureIndex <= ${l}.5) {
`:r+=`   else if (v_textureIndex <= ${l}.5) {
`,r+=`      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;
`,r+=`      color = texture(u_textures[${l}], uv);
`,r+=`   }
`;return s=s.replace("%%texture_picker%%",r),s}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(Ht.Filtering),s=e?So(e):void 0,r=us(t.getAttribute(Ht.WrappingX)),l=us(t.getAttribute(Ht.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);t.removeAttribute("forceUpload"),this._textures.indexOf(u)===-1&&(this._textures.push(u),this._textureToIndex.set(u,this._textureIndex++),this._images.add(t))}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const s=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(s))!=null?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,s,r,l,h,u,f,g){var _,y,A,x;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const D=this._getImageWidth(t),S=this._getImageHeight(t);let U=D||r||0,R=S||l||0;this._view[0]=0,this._view[1]=0,this._view[2]=(_=r??D)!=null?_:0,this._view[3]=(y=l??S)!=null?y:0,this._dest[0]=e??1,this._dest[1]=s??1,h!==void 0&&u!==void 0&&f!==void 0&&g!==void 0&&(this._view[0]=e??1,this._view[1]=s??1,this._view[2]=(A=r??D)!=null?A:0,this._view[3]=(x=l??S)!=null?x:0,this._dest[0]=h,this._dest[1]=u,U=f,R=g),e=this._view[0],s=this._view[1];const C=this._view[2],O=this._view[3],G=this._context.getTransform(),q=this._context.opacity,et=this._context.snapToPixel;this._quad[0]=this._dest[0],this._quad[1]=this._dest[1],this._quad[2]=this._dest[0]+U,this._quad[3]=this._dest[1],this._quad[4]=this._dest[0],this._quad[5]=this._dest[1]+R,this._quad[6]=this._dest[0]+U,this._quad[7]=this._dest[1]+R,G.multiplyQuadInPlace(this._quad),et&&(this._quad[0]=~~(this._quad[0]+$t(this._quad[0])*St),this._quad[1]=~~(this._quad[1]+$t(this._quad[1])*St),this._quad[2]=~~(this._quad[2]+$t(this._quad[2])*St),this._quad[3]=~~(this._quad[3]+$t(this._quad[3])*St),this._quad[4]=~~(this._quad[4]+$t(this._quad[4])*St),this._quad[5]=~~(this._quad[5]+$t(this._quad[5])*St),this._quad[6]=~~(this._quad[6]+$t(this._quad[6])*St),this._quad[7]=~~(this._quad[7]+$t(this._quad[7])*St));const k=this._context.tint||this._defaultTint,rt=this._getTextureIdForImage(t),pt=D||U,At=S||R,bt=(e+this.uvPadding)/pt,Et=(s+this.uvPadding)/At,I=(e+C-this.uvPadding)/pt,K=(s+O-this.uvPadding)/At,X=D,E=S,b=this._layout.vertexBuffer.bufferData;b[this._vertexIndex++]=this._quad[0],b[this._vertexIndex++]=this._quad[1],b[this._vertexIndex++]=q,b[this._vertexIndex++]=X,b[this._vertexIndex++]=E,b[this._vertexIndex++]=bt,b[this._vertexIndex++]=Et,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a,b[this._vertexIndex++]=this._quad[4],b[this._vertexIndex++]=this._quad[5],b[this._vertexIndex++]=q,b[this._vertexIndex++]=X,b[this._vertexIndex++]=E,b[this._vertexIndex++]=bt,b[this._vertexIndex++]=K,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a,b[this._vertexIndex++]=this._quad[2],b[this._vertexIndex++]=this._quad[3],b[this._vertexIndex++]=q,b[this._vertexIndex++]=X,b[this._vertexIndex++]=E,b[this._vertexIndex++]=I,b[this._vertexIndex++]=Et,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a,b[this._vertexIndex++]=this._quad[6],b[this._vertexIndex++]=this._quad[7],b[this._vertexIndex++]=q,b[this._vertexIndex++]=X,b[this._vertexIndex++]=E,b[this._vertexIndex++]=I,b[this._vertexIndex++]=K,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,48*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),Ce.DrawnImagesCount+=this._imageCount,Ce.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const rC=`#version 300 es

precision mediump float;

// UV coord
in vec2 v_uv;

in vec2 v_size; // in pixels

// Color coord to blend with image
in lowp vec4 v_color;

// Stroke color if used
in lowp vec4 v_strokeColor;

// Stroke thickness if used
in lowp float v_strokeThickness; // in pixels

// Opacity
in float v_opacity;

out vec4 fragColor;

void main() {
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border
    vec2 uv = v_uv;
    vec2 fragCoord = uv * v_size;
    float maxX = v_size.x - v_strokeThickness;
    float minX = v_strokeThickness;
    float maxY = v_size.y - v_strokeThickness;
    float minY = v_strokeThickness;

    if (fragCoord.x < maxX && fragCoord.x > minX &&
        fragCoord.y < maxY && fragCoord.y > minY) {
      fragColor = v_color;
    } else {
      fragColor = v_strokeColor;
    }
    fragColor.a *= v_opacity;
    fragColor.rgb *= fragColor.a;

    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;

    // float fHalfBorderDist      = 0.0;
    // float fHalfBorderThickness = 0.0;

    // if (fragCoord.x > max(v_radius, v_strokeThickness) && 
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))
    // {
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;
    //     fHalfBorderThickness = v_strokeThickness / 2.0;
    // }
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && 
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))
    // {
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;
    //     fHalfBorderThickness = v_strokeThickness / 2.0;
    // }
    // else
    // {
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));
        
    //     float ellipse_ab    = v_radius-v_strokeThickness;
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); 
            
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);
    // }

    // vec4 v4FromColor = v_strokeColor;
    // v4FromColor.rgb *= v4FromColor.a;
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent
    // if (fHalfBorderDist < 0.0) {
    //     v4ToColor = v_color;
    //     v4ToColor.rgb *= v4ToColor.a;
    // }

    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;

    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);
    // gl_FragColor = finalColor;
}`,aC=`#version 300 es
in vec2 a_position;

// UV coordinate
in vec2 a_uv;
out vec2 v_uv;

in vec2 a_size;
out vec2 v_size;

// Opacity 
in float a_opacity;
out float v_opacity;

in vec4 a_color;
out vec4 v_color;

in vec4 a_strokeColor;
out vec4 v_strokeColor;

in float a_strokeThickness;
out float v_strokeThickness;

uniform mat4 u_matrix;


void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Pass through UV coords
   v_uv = a_uv;
   // Pass through size
   v_size = a_size;
   // Pass through the Opacity to the fragment shader
   v_opacity = a_opacity;
   // Pass through the color to the fragment shader
   v_color = a_color;
   // Pass through the stroke color to the fragment shader
   v_strokeColor = a_strokeColor;
   // Pass through the stroke thickenss to the fragment shader
   v_strokeThickness = a_strokeThickness;
}`;class oC{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0,this._transparent=tt.Transparent,this._scratch1=L(0,0),this._scratch2=L(0,0),this._scratch3=L(0,0),this._scratch4=L(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new ds({graphicsContext:e,fragmentSource:rC,vertexSource:aC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Gs({gl:t,size:64*this._maxRectangles,type:"dynamic"}),this._layout=new wn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new Bc(t,this._maxRectangles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof B&&t[1]instanceof B?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,s,r=1){this._isFull()&&this.flush(),this._rectangleCount++;const l=this._context.getTransform(),h=this._context.opacity,u=this._context.snapToPixel,f=e.sub(t),g=f.magnitude,_=f.normalize().perpendicular(),y=r/2,A=l.multiply(_.scale(y,this._scratch1).add(t,this._scratch1),this._scratch1),x=l.multiply(_.scale(-y,this._scratch2).add(t,this._scratch2),this._scratch2),D=l.multiply(_.scale(y,this._scratch3).add(e,this._scratch3),this._scratch3),S=l.multiply(_.scale(-y,this._scratch4).add(e,this._scratch4),this._scratch4);u&&(A.x=~~(A.x+St),A.y=~~(A.y+St),D.x=~~(D.x+St),D.y=~~(D.y+St),x.x=~~(x.x+St),x.y=~~(x.y+St),S.x=~~(S.x+St),S.y=~~(S.y+St));const U=0,R=0,C=1,O=1,G=this._transparent,q=0,et=1,k=this._layout.vertexBuffer.bufferData;k[this._vertexIndex++]=A.x,k[this._vertexIndex++]=A.y,k[this._vertexIndex++]=U,k[this._vertexIndex++]=R,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=q/et,k[this._vertexIndex++]=x.x,k[this._vertexIndex++]=x.y,k[this._vertexIndex++]=U,k[this._vertexIndex++]=O,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=q/et,k[this._vertexIndex++]=D.x,k[this._vertexIndex++]=D.y,k[this._vertexIndex++]=C,k[this._vertexIndex++]=R,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=q/et,k[this._vertexIndex++]=S.x,k[this._vertexIndex++]=S.y,k[this._vertexIndex++]=C,k[this._vertexIndex++]=O,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=q/et}drawRectangle(t,e,s,r,l=tt.Transparent,h=0){this._isFull()&&this.flush(),this._rectangleCount++;const u=this._context.getTransform(),f=this._context.opacity,g=this._context.snapToPixel,_=u.multiply(t.add(L(0,0))),y=u.multiply(t.add(L(e,0))),A=u.multiply(t.add(L(e,s))),x=u.multiply(t.add(L(0,s)));g&&(_.x=~~(_.x+St),_.y=~~(_.y+St),y.x=~~(y.x+St),y.y=~~(y.y+St),x.x=~~(x.x+St),x.y=~~(x.y+St),A.x=~~(A.x+St),A.y=~~(A.y+St));const D=0,S=0,U=1,R=1,C=this._layout.vertexBuffer.bufferData;C[this._vertexIndex++]=_.x,C[this._vertexIndex++]=_.y,C[this._vertexIndex++]=D,C[this._vertexIndex++]=S,C[this._vertexIndex++]=e,C[this._vertexIndex++]=s,C[this._vertexIndex++]=f,C[this._vertexIndex++]=r.r/255,C[this._vertexIndex++]=r.g/255,C[this._vertexIndex++]=r.b/255,C[this._vertexIndex++]=r.a,C[this._vertexIndex++]=l.r/255,C[this._vertexIndex++]=l.g/255,C[this._vertexIndex++]=l.b/255,C[this._vertexIndex++]=l.a,C[this._vertexIndex++]=h,C[this._vertexIndex++]=x.x,C[this._vertexIndex++]=x.y,C[this._vertexIndex++]=D,C[this._vertexIndex++]=R,C[this._vertexIndex++]=e,C[this._vertexIndex++]=s,C[this._vertexIndex++]=f,C[this._vertexIndex++]=r.r/255,C[this._vertexIndex++]=r.g/255,C[this._vertexIndex++]=r.b/255,C[this._vertexIndex++]=r.a,C[this._vertexIndex++]=l.r/255,C[this._vertexIndex++]=l.g/255,C[this._vertexIndex++]=l.b/255,C[this._vertexIndex++]=l.a,C[this._vertexIndex++]=h,C[this._vertexIndex++]=y.x,C[this._vertexIndex++]=y.y,C[this._vertexIndex++]=U,C[this._vertexIndex++]=S,C[this._vertexIndex++]=e,C[this._vertexIndex++]=s,C[this._vertexIndex++]=f,C[this._vertexIndex++]=r.r/255,C[this._vertexIndex++]=r.g/255,C[this._vertexIndex++]=r.b/255,C[this._vertexIndex++]=r.a,C[this._vertexIndex++]=l.r/255,C[this._vertexIndex++]=l.g/255,C[this._vertexIndex++]=l.b/255,C[this._vertexIndex++]=l.a,C[this._vertexIndex++]=h,C[this._vertexIndex++]=A.x,C[this._vertexIndex++]=A.y,C[this._vertexIndex++]=U,C[this._vertexIndex++]=R,C[this._vertexIndex++]=e,C[this._vertexIndex++]=s,C[this._vertexIndex++]=f,C[this._vertexIndex++]=r.r/255,C[this._vertexIndex++]=r.g/255,C[this._vertexIndex++]=r.b/255,C[this._vertexIndex++]=r.a,C[this._vertexIndex++]=l.r/255,C[this._vertexIndex++]=l.g/255,C[this._vertexIndex++]=l.b/255,C[this._vertexIndex++]=l.a,C[this._vertexIndex++]=h}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),Ce.DrawnImagesCount+=this._rectangleCount,Ce.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const lC=`#version 300 es
precision highp float;

// UV coord
in vec2 v_uv;

// Color coord to blend with image
in lowp vec4 v_color;

// Stroke color if used
in lowp vec4 v_strokeColor;

// Stroke thickness if used
in lowp float v_strokeThickness;

// Opacity
in float v_opacity;

out vec4 fragColor;

void main() {
  // make (0, 0) the center the uv 
  vec2 uv = v_uv * 2.0 - 1.0;

  vec4 color = v_color;
  vec4 strokeColor = v_strokeColor;

  // circle border is at radius 1.0 
  // dist is > 0 when inside the circle 
  float d = length(uv);
  float dist = 1.0 - length(uv);

  // Fade based on fwidth
  float fade = fwidth(dot(uv, uv));

  // if dist is greater than 0 step to 1;
  // when we cross this 0 threshold add a smooth fade
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);

  // if dist is greater than the stroke thickness step to 1
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);

  strokeColor.a *= fill * stroke;
  strokeColor.rgb *= strokeColor.a;

  color.a *= fill * (1.0 - stroke);
  color.rgb *= color.a;

  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);
  finalColor.rgb = finalColor.rgb * v_opacity;
  finalColor.a = finalColor.a * v_opacity;
  fragColor = finalColor;
}`,cC=`#version 300 es
in vec2 a_position;

// UV coordinate
in vec2 a_uv;
out vec2 v_uv;

// Opacity 
in float a_opacity;
out float v_opacity;

in vec4 a_color;
out vec4 v_color;

in vec4 a_strokeColor;
out vec4 v_strokeColor;

in float a_strokeThickness;
out float v_strokeThickness;

uniform mat4 u_matrix;


void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Pass through UV coords
   v_uv = a_uv;
   // Pass through the Opacity to the fragment shader
   v_opacity = a_opacity;
   // Pass through the color to the fragment shader
   v_color = a_color;
   // Pass through the stroke color to the fragment shader
   v_strokeColor = a_strokeColor;
   // Pass through the stroke thickenss to the fragment shader
   v_strokeThickness = a_strokeThickness;
}`;class hC{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new ds({graphicsContext:e,fragmentSource:lC,vertexSource:cC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Gs({gl:t,size:56*this._maxCircles,type:"dynamic"}),this._layout=new wn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new Bc(t,this._maxCircles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,s,r=tt.Transparent,l=0){this._isFull()&&this.flush(),this._circleCount++;const h=this._context.getTransform(),u=this._context.opacity,f=this._context.snapToPixel,g=h.multiply(t.add(L(-e,-e))),_=h.multiply(t.add(L(e,-e))),y=h.multiply(t.add(L(e,e))),A=h.multiply(t.add(L(-e,e)));f&&(g.x=~~(g.x+St),g.y=~~(g.y+St),_.x=~~(_.x+St),_.y=~~(_.y+St),A.x=~~(A.x+St),A.y=~~(A.y+St),y.x=~~(y.x+St),y.y=~~(y.y+St));const x=0,D=0,S=1,U=1,R=this._layout.vertexBuffer.bufferData;R[this._vertexIndex++]=g.x,R[this._vertexIndex++]=g.y,R[this._vertexIndex++]=x,R[this._vertexIndex++]=D,R[this._vertexIndex++]=u,R[this._vertexIndex++]=s.r/255,R[this._vertexIndex++]=s.g/255,R[this._vertexIndex++]=s.b/255,R[this._vertexIndex++]=s.a,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l/e,R[this._vertexIndex++]=A.x,R[this._vertexIndex++]=A.y,R[this._vertexIndex++]=x,R[this._vertexIndex++]=U,R[this._vertexIndex++]=u,R[this._vertexIndex++]=s.r/255,R[this._vertexIndex++]=s.g/255,R[this._vertexIndex++]=s.b/255,R[this._vertexIndex++]=s.a,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l/e,R[this._vertexIndex++]=_.x,R[this._vertexIndex++]=_.y,R[this._vertexIndex++]=S,R[this._vertexIndex++]=D,R[this._vertexIndex++]=u,R[this._vertexIndex++]=s.r/255,R[this._vertexIndex++]=s.g/255,R[this._vertexIndex++]=s.b/255,R[this._vertexIndex++]=s.a,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l/e,R[this._vertexIndex++]=y.x,R[this._vertexIndex++]=y.y,R[this._vertexIndex++]=S,R[this._vertexIndex++]=U,R[this._vertexIndex++]=u,R[this._vertexIndex++]=s.r/255,R[this._vertexIndex++]=s.g/255,R[this._vertexIndex++]=s.b/255,R[this._vertexIndex++]=s.a,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l/e}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),Ce.DrawnImagesCount+=this._circleCount,Ce.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class uC{constructor(){this.z=0,this.priority=0,this.renderer="",this.transform=_e.identity(),this.state={z:0,opacity:1,tint:tt.White,material:null},this.args=new Array(10)}}class t0{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(t,e){this._gl=t,this._context=e,this._buffer=new Gs({gl:t,size:24,type:"dynamic"}),this._layout=new wn({gl:t,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_screenuv",2]],suppressWarnings:!0}),this._quads=new Bc(t,1,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._textures.length=0,this._context=null,this._gl=null}draw(t,e,s,r,l,h,u,f,g){var _,y,A,x;const D=this._gl,S=this._context.material;if(!S)return;const U=this._context.getTransform(),R=this._context.opacity,C=S.getShader(),O=this._layout.vertexBuffer.bufferData;let G=0,q=(t==null?void 0:t.width)||r||0,et=(t==null?void 0:t.height)||l||0,k=[0,0,(_=r??(t==null?void 0:t.width))!=null?_:0,(y=l??(t==null?void 0:t.height))!=null?y:0],rt=[e??1,s??1];h!==void 0&&u!==void 0&&f!==void 0&&g!==void 0&&(k=[e??1,s??1,(A=r??(t==null?void 0:t.width))!=null?A:0,(x=l??(t==null?void 0:t.height))!=null?x:0],rt=[h,u],q=f,et=g),e=k[0],s=k[1];const pt=k[2],At=k[3],bt=L(rt[0],rt[1]),Et=L(rt[0]+q,rt[1]),I=L(rt[0],rt[1]+et),K=L(rt[0]+q,rt[1]+et),X=t.width||q,E=t.height||et,b=e/X,$=s/E,it=(e+pt-.01)/X,nt=(s+At-.01)/E,w=U.getPosition(),V=w.add(K),st=w.x/this._context.width,ot=w.y/this._context.height,mt=V.x/this._context.width,Ct=V.y/this._context.height;O[G++]=bt.x,O[G++]=bt.y,O[G++]=b,O[G++]=$,O[G++]=st,O[G++]=ot,O[G++]=I.x,O[G++]=I.y,O[G++]=b,O[G++]=nt,O[G++]=st,O[G++]=Ct,O[G++]=Et.x,O[G++]=Et.y,O[G++]=it,O[G++]=$,O[G++]=mt,O[G++]=ot,O[G++]=K.x,O[G++]=K.y,O[G++]=it,O[G++]=nt,O[G++]=mt,O[G++]=Ct;const Ut=this._addImageAsTexture(t);S.use(),this._layout.shader=C,this._layout.use(!0),C.trySetUniformFloat("u_time_ms",performance.now()),C.trySetUniformFloat("u_opacity",R),C.trySetUniformFloatVector("u_resolution",L(this._context.width,this._context.height)),C.trySetUniformFloatVector("u_graphic_resolution",L(X,E)),C.trySetUniformFloatVector("u_size",L(pt,At)),C.trySetUniformMatrix("u_matrix",this._context.ortho),C.trySetUniformMatrix("u_transform",U.to4x4()),D.activeTexture(D.TEXTURE0+0),D.bindTexture(D.TEXTURE_2D,Ut),C.trySetUniformInt("u_graphic",0),S.isUsingScreenTexture&&(D.activeTexture(D.TEXTURE0+1),D.bindTexture(D.TEXTURE_2D,this._context.materialScreenTexture),C.trySetUniformInt("u_screen_texture",1)),this._quads.bind(),D.drawElements(D.TRIANGLES,6,this._quads.bufferGlType,0),Ce.DrawnImagesCount++,Ce.DrawCallCount++}_addImageAsTexture(t){const e=t.getAttribute(Ht.Filtering),s=e?So(e):void 0,r=us(t.getAttribute(Ht.WrappingX)),l=us(t.getAttribute(Ht.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);return t.removeAttribute("forceUpload"),this._textures.indexOf(u)===-1&&this._textures.push(u),u}hasPendingDraws(){return!1}flush(){}}const dC=`#version 300 es
precision mediump float;

// UV coord
in vec2 v_texcoord;

// Textures in the current draw
uniform sampler2D u_textures[%%count%%];

uniform bool u_pixelart;

in float v_texture_index;

in float v_opacity;

in vec4 v_tint;

// texture resolution
in vec2 v_res;

in vec2 v_size;

in vec2 v_uv_min;
in vec2 v_uv_max;

out vec4 fragColor;

// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {
  vec2 pixel = uv * texture_size;

  vec2 seam=floor(pixel+.5);
  vec2 dudv=fwidth(pixel);
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);

  return pixel/texture_size;
}

float lerp(float from, float to, float rel){
  return ((1. - rel) * from) + (rel * to);
}

float invLerp(float from, float to, float value){
  return (value - from) / (to - from);
}

float remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){
  float rel = invLerp(origFrom, origTo, value);
  return lerp(targetFrom, targetTo, rel);
}

void main(){
  // In order to support the most efficient sprite batching, we have multiple
  // textures loaded into the gpu (usually 8) this picker logic skips over textures
  // that do not apply to a particular sprite.

  vec4 color=vec4(1.,0,0,1.);
  vec2 remapped_uv = v_texcoord;
  remapped_uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, v_texcoord.x);
  remapped_uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, v_texcoord.y);
  vec2 uv = u_pixelart ? uv_iq(remapped_uv, v_size) : remapped_uv;

  // GLSL is templated out to pick the right texture and set the vec4 color
  %%texture_picker%%

  color.rgb = color.rgb * v_opacity;
  color.a = color.a * v_opacity;
  fragColor = color * v_tint;
}`,fC=`#version 300 es
layout(location=0) in vec2 pos;
layout(location=1) in vec2 a_texcoord;
out vec2 v_texcoord;

layout(location=2) in vec2 a_offset;
layout(location=3) in vec2 a_mat_column1;
layout(location=4) in vec2 a_mat_column2;
layout(location=5) in vec2 a_mat_column3;

layout(location=6) in float a_opacity;
out float v_opacity;

// Texture resolution (could be bigger than a_size)
layout(location=7) in vec2 a_res;
out vec2 v_res;

// Final size of graphic
layout(location=8) in vec2 a_size;
out vec2 v_size;

layout(location=9) in lowp float a_texture_index;
out lowp float v_texture_index;

layout(location=10) in vec2 a_uv_min;
out vec2 v_uv_min;

layout(location=11) in vec2 a_uv_max;
out vec2 v_uv_max;

layout(location=12) in vec4 a_tint;
out vec4 v_tint;

uniform mat4 u_matrix;

void main(){
  mat4 world_mat = mat4(
    a_mat_column1.x, a_mat_column1.y, 0., 0.,
    a_mat_column2.x, a_mat_column2.y, 0., 0.,
    0.             , 0.             , 1., 0.,
    a_mat_column3.x, a_mat_column3.y, 0., 1.
  );

  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);
  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);

  v_opacity = a_opacity;
  v_texcoord = a_texcoord;
  v_uv_min = a_uv_min;
  v_uv_max = a_uv_max;
  v_res = a_res;
  v_size = a_size;
  v_texture_index = a_texture_index;
  v_tint = a_tint;
}`;class pC{constructor(t){this.type="ex.image-v2",this.priority=0,this._maxImages=2e4,this._maxTextures=0,this._components=22,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._defaultTint=tt.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r=xy(t,s);this._maxTextures=Math.min(s,r);const l=this._transformFragmentSource(dC,this._maxTextures);this._shader=new ds({graphicsContext:e,fragmentSource:l,vertexSource:fC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((y,A)=>A)),this._vao=t.createVertexArray(),t.bindVertexArray(this._vao),this._quadMesh=new Float32Array([0,0,0,0,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,1,1,1,1]),this._meshBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._meshBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadMesh,t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,16,0),t.enableVertexAttribArray(0),t.vertexAttribPointer(1,2,t.FLOAT,!1,16,8),t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,null);const h=this._components;this._transformData=new Gs({gl:t,size:h*this._maxImages,type:"dynamic"}),this._transformData.bind();let u=0,f=2;const g=4,_=h*4;t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(2),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(3),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(4),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(5),u+=2*g,t.vertexAttribPointer(f++,1,t.FLOAT,!1,_,u),t.enableVertexAttribArray(6),u+=1*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(7),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(8),u+=2*g,t.vertexAttribPointer(f++,1,t.FLOAT,!1,_,u),t.enableVertexAttribArray(9),u+=1*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(10),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,_,u),t.enableVertexAttribArray(11),u+=2*g,t.vertexAttribPointer(f++,4,t.FLOAT,!1,_,u),t.enableVertexAttribArray(12),u+=4*g,t.vertexAttribDivisor(2,1),t.vertexAttribDivisor(3,1),t.vertexAttribDivisor(4,1),t.vertexAttribDivisor(5,1),t.vertexAttribDivisor(6,1),t.vertexAttribDivisor(7,1),t.vertexAttribDivisor(8,1),t.vertexAttribDivisor(9,1),t.vertexAttribDivisor(10,1),t.vertexAttribDivisor(11,1),t.vertexAttribDivisor(12,1),t.bindVertexArray(null)}_bindData(t){const e=this._components;this._transformData.bind(),this._transformData.upload(e*this._imageCount),t.bindVertexArray(this._vao)}dispose(){this._transformData.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let s=t.replace("%%count%%",e.toString()),r="";for(let l=0;l<e;l++)l===0?r+=`if (v_texture_index <= ${l}.5) {
`:r+=`   else if (v_texture_index <= ${l}.5) {
`,r+=`      color = texture(u_textures[${l}], uv);
`,r+=`   }
`;return s=s.replace("%%texture_picker%%",r),s}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(Ht.Filtering),s=e?So(e):void 0,r=us(t.getAttribute(Ht.WrappingX)),l=us(t.getAttribute(Ht.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);t.removeAttribute("forceUpload"),this._textures.indexOf(u)===-1&&(this._textures.push(u),this._textureToIndex.set(u,this._textureIndex++),this._images.add(t))}_bindTextures(t){const e=Math.min(this._textureIndex,this._maxTextures);for(let s=0;s<e;s++)t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,this._textures[s]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const s=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(s))!=null?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,s,r,l,h,u,f,g){var _,y,A,x;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const D=this._getImageWidth(t),S=this._getImageHeight(t);let U=D||r||0,R=S||l||0;this._view[0]=0,this._view[1]=0,this._view[2]=(_=r??D)!=null?_:0,this._view[3]=(y=l??S)!=null?y:0,this._dest[0]=e??1,this._dest[1]=s??1,h!==void 0&&u!==void 0&&f!==void 0&&g!==void 0&&(this._view[0]=e??1,this._view[1]=s??1,this._view[2]=(A=r??D)!=null?A:0,this._view[3]=(x=l??S)!=null?x:0,this._dest[0]=h,this._dest[1]=u,U=f,R=g),e=this._view[0],s=this._view[1];const C=this._view[2],O=this._view[3],G=this._context.getTransform(),q=this._context.opacity;this._context.snapToPixel&&(this._dest[0]=~~(this._dest[0]+St),this._dest[1]=~~(this._dest[1]+St));const k=this._context.tint||this._defaultTint,rt=this._getTextureIdForImage(t),pt=D||U,At=S||R,bt=(e+this.uvPadding)/pt,Et=(s+this.uvPadding)/At,I=(e+C-this.uvPadding)/pt,K=(s+O-this.uvPadding)/At,X=D,E=S,b=this._transformData.bufferData;b[this._vertexIndex++]=this._dest[0],b[this._vertexIndex++]=this._dest[1],b[this._vertexIndex++]=G.data[0],b[this._vertexIndex++]=G.data[1],b[this._vertexIndex++]=G.data[2],b[this._vertexIndex++]=G.data[3],b[this._vertexIndex++]=G.data[4],b[this._vertexIndex++]=G.data[5],b[this._vertexIndex++]=q,b[this._vertexIndex++]=U,b[this._vertexIndex++]=R,b[this._vertexIndex++]=X,b[this._vertexIndex++]=E,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=bt,b[this._vertexIndex++]=Et,b[this._vertexIndex++]=I,b[this._vertexIndex++]=K,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._bindData(t),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),t.drawArraysInstanced(t.TRIANGLES,0,6,this._imageCount),Ce.DrawnImagesCount+=this._imageCount,Ce.DrawCallCount++,t.bindVertexArray(null),this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const St=1e-4;class gC{constructor(t){this._webglCtx=t,this._debugText=new my}drawRect(t,e,s,r,l={color:tt.Black}){this.drawLine(L(t,e),L(t+s,e),{...l}),this.drawLine(L(t+s,e),L(t+s,e+r),{...l}),this.drawLine(L(t+s,e+r),L(t,e+r),{...l}),this.drawLine(L(t,e+r),L(t,e),{...l})}drawLine(t,e,s){var r;this._webglCtx.draw("ex.line",t,e,(r=s==null?void 0:s.color)!=null?r:tt.Black)}drawPoint(t,e={color:tt.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class Ls{constructor(t){this._logger=yt.getInstance(),this._renderers=new Map,this._lazyRenderersFactory=new Map,this.imageRenderer=$l.isEnabled("use-legacy-image-renderer")?"ex.image":"ex.image-v2",this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new of(()=>new uC,void 0,4e3),this._drawCallIndex=0,this._drawCalls=new Array(4e3).fill(null),this._postProcessTargets=[],this._postprocessors=[],this._transform=new ww,this._state=new gy,this.snapToPixel=!1,this.smoothing=!1,this.pixelArtSampler=!1,this.uvPadding=.01,this.backgroundColor=tt.ExcaliburBlue,this.multiSampleAntialiasing=!0,this.transparency=!0,this._isContextLost=!1,this._disposed=!1,this._imageToWidth=new Map,this._imageToHeight=new Map,this.debug=new gC(this),this._totalPostProcessorTime=0;const{canvasElement:e,context:s,enableTransparency:r,antialiasing:l,uvPadding:h,multiSampleAntialiasing:u,pixelArtSampler:f,powerPreference:g,snapToPixel:_,backgroundColor:y,useDrawSorting:A,garbageCollector:x,handleContextLost:D,handleContextRestored:S}=t;if(this.__gl=s??e.getContext("webgl2",{antialias:l??this.smoothing,premultipliedAlpha:!1,alpha:r??this.transparency,depth:!1,powerPreference:g??"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");D&&this.__gl.canvas.addEventListener("webglcontextlost",D,!1),S&&this.__gl.canvas.addEventListener("webglcontextrestored",S,!1),this.__gl.canvas.addEventListener("webglcontextlost",()=>{this._isContextLost=!0}),this.__gl.canvas.addEventListener("webglcontextrestored",()=>{this._isContextLost=!1}),this.textureLoader=new ao(this.__gl,x),this.snapToPixel=_??this.snapToPixel,this.smoothing=l??this.smoothing,this.transparency=r??this.transparency,this.pixelArtSampler=f??this.pixelArtSampler,this.uvPadding=h??this.uvPadding,this.multiSampleAntialiasing=typeof u=="boolean"?u:this.multiSampleAntialiasing,this.samples=typeof u=="object"?u.samples:void 0,this.backgroundColor=y??this.backgroundColor,this.useDrawSorting=A??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}dispose(){if(!this._disposed){this._disposed=!0,this.textureLoader.dispose();for(const t of this._renderers.values())t.dispose();this._renderers.clear(),this._drawCallPool.dispose(),this._drawCalls.length=0,this.__gl=null}}_init(){const t=this.__gl;if(this._ortho=Di.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!1),this.register(new nC({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.register(new t0),this.register(new oC),this.register(new hC),this.register(new Kw),this.register(new Zw),this.lazyRegister("ex.particle",()=>new Qw),this.register(new pC({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.materialScreenTexture=t.createTexture(),!this.materialScreenTexture)throw new Error("Could not create screen texture!");t.bindTexture(t.TEXTURE_2D,this.materialScreenTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this._screenRenderer=new eC(this),this._renderTarget=new ql({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new ql({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),new ql({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height})],this._msaaTarget=new ql({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height,antialias:this.multiSampleAntialiasing,samples:this.samples})}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}lazyRegister(t,e){this._lazyRenderersFactory.set(t,e)}get(t){let e=this._renderers.get(t);if(!e){const s=this._lazyRenderersFactory.get(t);s&&(this._logger.debug("lazy init renderer:",t),e=s(),this.register(e))}return e}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){if(e.length>9)throw new Error("Only 10 or less renderer arguments are supported!;");if(this._isDrawLifecycle||this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._isContextLost){this._logger.errorOnce(`Unable to draw ${t}, the webgl context is lost`);return}const s=this.get(t);if(s)if(this.useDrawSorting){const r=this._drawCallPool.get();r.z=this._state.current.z,r.priority=s.priority,r.renderer=t,this.getTransform().clone(r.transform),r.state.z=this._state.current.z,r.state.opacity=this._state.current.opacity,r.state.tint=this._state.current.tint,r.state.material=this._state.current.material,r.args[0]=e[0],r.args[1]=e[1],r.args[2]=e[2],r.args[3]=e[3],r.args[4]=e[4],r.args[5]=e[5],r.args[6]=e[6],r.args[7]=e[7],r.args[8]=e[8],r.args[9]=e[9],this._drawCalls[this._drawCallIndex++]=r}else this._currentRenderer||(this._currentRenderer=s),this._isCurrentRenderer(s)||this._currentRenderer.flush(),s.draw(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]),this._currentRenderer=s;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.reset()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=Di.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._msaaTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height)}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}drawImage(t,e,s,r,l,h,u,f,g){if(!(r===0||l===0)){{if(f===0||g===0)return;if(this._getImageWidth(t)===0||this._getImageHeight(t)===0)return}if(!t){yt.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",t,e,s,r,l,h,u,f,g):this.imageRenderer==="ex.image"?this.draw(this.imageRenderer,t,e,s,r,l,h,u,f,g):this.draw(this.imageRenderer,t,e,s,r,l,h,u,f,g)}}drawLine(t,e,s,r=1){this.draw("ex.rectangle",t,e,s,r)}drawRectangle(t,e,s,r,l,h){this.draw("ex.rectangle",t,e,s,r,l,h)}drawCircle(t,e,s,r,l){this.draw("ex.circle",t,e,s,r,l)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~(t+St):t,this.snapToPixel?~~(e+St):e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);e!==-1&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(t){for(const e of this._postprocessors){const s=e.getShader();s.use();const r=s.getUniformDefinitions();this._totalPostProcessorTime+=t,r.find(l=>l.name==="u_time_ms")&&s.setUniformFloat("u_time_ms",this._totalPostProcessorTime),r.find(l=>l.name==="u_elapsed_ms")&&s.setUniformFloat("u_elapsed_ms",t),r.find(l=>l.name==="u_resolution")&&s.setUniformFloatVector("u_resolution",L(this.width,this.height)),e.onUpdate&&e.onUpdate(t)}}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return new Xw({...t,graphicsContext:this})}createShader(t){const{name:e,vertexSource:s,fragmentSource:r,uniforms:l,images:h,startingTextureSlot:u}=t,f=new ds({name:e,graphicsContext:this,vertexSource:s,fragmentSource:r,uniforms:l,images:h,startingTextureSlot:u});return f.compile(),f}clear(){const t=this.__gl;(this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget).use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){var t;if(this._isContextLost){this._logger.errorOnce("Unable to flush the webgl context is lost");return}let e=this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget;if(e.use(),this.useDrawSorting){for(let h=this._drawCallIndex;h<this._drawCalls.length;h++)this._drawCalls[h]=null;const s=new Map;for(const[h]of this._renderers){let u=0;for(u=0;u<this._drawCallIndex&&this._drawCalls[u].renderer!==h;u++);s.set(h,u)}this._drawCalls.sort((h,u)=>{if(h===null||u===null)return 0;const f=h.z-u.z,g=s.get(h.renderer)-s.get(u.renderer),_=h.priority-u.priority;return f===0?_===0?g:_:f});const r=this._transform.current,l=this._state.current;if(this._drawCalls.length&&this._drawCallIndex){let h=this._drawCalls[0].renderer,u=this.get(h);for(let f=0;f<this._drawCallIndex;f++)this._transform.current=this._drawCalls[f].transform,this._state.current=this._drawCalls[f].state,this._drawCalls[f].renderer!==h&&(u.flush(),h=this._drawCalls[f].renderer,u=this.get(h)),u instanceof t0&&((t=this.material)!=null&&t.isUsingScreenTexture)&&(e.copyToTexture(this.materialScreenTexture),e.use()),u.draw(...this._drawCalls[f].args);u.hasPendingDraws()&&u.flush()}this._transform.current=r,this._state.current=l,this._drawCallPool.done(),this._drawCallIndex=0,this._imageToHeight.clear(),this._imageToWidth.clear()}else for(const s of this._renderers.values())s.hasPendingDraws()&&s.flush();e.disable(),this._postprocessors.length>0&&e.toRenderSource().use();for(let s=0;s<this._postprocessors.length;s++)e=this._postProcessTargets[s%2],this._postProcessTargets[s%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[s]),this._postProcessTargets[s%2].toRenderSource().use();e.blitToScreen()}}class Zr{constructor(t,e,s,r){this.font=t,this.text=e,this.color=s,this.maxWidth=r,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas");const l=this.canvas.getContext("2d");if(!l)throw new Error("Unable to create FontTextInstance, internal canvas failed to create");this.ctx=l,this.dimensions=this.measureText(e),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,e){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let s=null;e!=null?s=this._getLinesFromText(t,e):s=t.split(`
`);const r=s.reduce((A,x)=>A.length>x.length?A:x);this._applyFont(this.ctx);const l=this.ctx.measureText(r);let h=Math.abs(l.actualBoundingBoxAscent)+Math.abs(l.actualBoundingBoxDescent);const u=h*s.length;h=u;const f=u-Math.abs(l.actualBoundingBoxAscent),g=0,_=0;return new Tt({left:g-Math.abs(l.actualBoundingBoxLeft)-this.font.padding,top:_-Math.abs(l.actualBoundingBoxAscent)-this.font.padding,bottom:_+f+this.font.padding,right:g+Math.abs(l.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,e){let s=1;this.font.lineHeight&&(s=this.font.lineHeight/this.font.size),e.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,e.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality*s}static getHashCode(t,e,s){var r;return e+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+t.lineHeight+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((r=t.strokeColor)==null?void 0:r.toString())+(s?s.toString():t.color.toString()))}getHashCode(t=!0){return Zr.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var e,s,r;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((e=this.font.lineDash)!=null?e:t.getLineDash()),t.strokeStyle=(r=(s=this.font.strokeColor)==null?void 0:s.toString())!=null?r:"",t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(this.font.shadow.color&&(t.shadowColor=this.font.shadow.color.toString()),this.font.shadow.blur&&(t.shadowBlur=this.font.shadow.blur),this.font.shadow.offset&&(t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y))}_drawText(t,e,s){this._applyRasterProperties(t),this._applyFont(t);for(let r=0;r<e.length;r++){const l=e[r];this.color&&t.fillText(l,0,r*s),this.font.strokeColor&&t.strokeText(l,0,r*s)}this.font.showDebug&&(Jm(t,tt.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),Jm(t,tt.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){const e=[];let s=0,r=0;const l=Math.min(4096,t.canvas.width),h=Math.min(4096,t.canvas.height);for(;s<t.canvas.width;){for(;r<t.canvas.height;){const u=document.createElement("canvas");u.width=l,u.height=h;const f=u.getContext("2d");if(!f)throw new Error("Unable to split internal FontTextInstance bitmap, failed to create internal canvas");f.drawImage(t.canvas,s,r,l,h,0,0,l,h),e.push({x:s,y:r,canvas:u}),r+=h}s+=l,r=0}return e}flagDirty(){this._dirty=!0}render(t,e,s,r){var l;if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=t;const h=this.getHashCode();if(this._lastHashCode!==h&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,r),this._setDimension(this.dimensions,this.ctx);const u=this._getLinesFromText(this.text,r),f=(l=this.font.lineHeight)!=null?l:this.dimensions.height/u.length;if(this._drawText(this.ctx,u,f),t instanceof Ls)for(const g of this._textFragments)t.textureLoader.delete(g.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),t instanceof Ls)for(const g of this._textFragments)t.textureLoader.load(g.canvas,{filtering:this.font.filtering},!0);this._lastHashCode=h,this._dirty=!1}for(const u of this._textFragments)t.drawImage(u.canvas,0,0,u.canvas.width,u.canvas.height,u.x/this.font.quality+e-this.ctx.canvas.width/this.font.quality/2,u.y/this.font.quality+s-this.ctx.canvas.height/this.font.quality/2,u.canvas.width/this.font.quality,u.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof Ls)for(const t of this._textFragments)this._ex.textureLoader.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,e){var s;if(this._cachedText===t&&this._cachedRenderWidth===e&&((s=this._cachedLines)!=null&&s.length))return this._cachedLines;const r=t.split(`
`);if(e==null)return r;for(let l=0;l<r.length;l++){let h=r[l],u="";if(this.measureText(h).width>e){for(;this.measureText(h).width>e;)u=h[h.length-1]+u,h=h.slice(0,-1);r[l]=h,r[l+1]=u}}return this._cachedText=t,this._cachedLines=r,this._cachedRenderWidth=e,r}}class pc extends He{constructor(t={}){var e,s,r,l,h,u,f,g,_,y,A,x,D,S,U,R,C,O,G,q;super(t),this.filtering=gi.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=tt.Black,this.family="sans-serif",this.style=fy.Normal,this.bold=!1,this.unit=hy.Px,this.textAlign=uy.Left,this.baseAlign=dy.Top,this.direction=py.LeftToRight,this.lineHeight=void 0,this.size=10,this._textBounds=new Tt,this.smoothing=(e=t==null?void 0:t.smoothing)!=null?e:this.smoothing,this.padding=(s=t==null?void 0:t.padding)!=null?s:this.padding,this.color=(r=t==null?void 0:t.color)!=null?r:this.color,this.strokeColor=(l=t==null?void 0:t.strokeColor)!=null?l:this.strokeColor,this.lineDash=(h=t==null?void 0:t.lineDash)!=null?h:this.lineDash,this.lineWidth=(u=t==null?void 0:t.lineWidth)!=null?u:this.lineWidth,this.filtering=(f=t==null?void 0:t.filtering)!=null?f:this.filtering,this.family=(g=t==null?void 0:t.family)!=null?g:this.family,this.style=(_=t==null?void 0:t.style)!=null?_:this.style,this.bold=(y=t==null?void 0:t.bold)!=null?y:this.bold,this.size=(A=t==null?void 0:t.size)!=null?A:this.size,this.unit=(x=t==null?void 0:t.unit)!=null?x:this.unit,this.textAlign=(D=t==null?void 0:t.textAlign)!=null?D:this.textAlign,this.baseAlign=(S=t==null?void 0:t.baseAlign)!=null?S:this.baseAlign,this.direction=(U=t==null?void 0:t.direction)!=null?U:this.direction,this.lineHeight=(R=t==null?void 0:t.lineHeight)!=null?R:this.lineHeight,this.quality=(C=t==null?void 0:t.quality)!=null?C:this.quality,t!=null&&t.shadow&&(this.shadow={},this.shadow.blur=(O=t.shadow.blur)!=null?O:this.shadow.blur,this.shadow.offset=(G=t.shadow.offset)!=null?G:this.shadow.offset,this.shadow.color=(q=t.shadow.color)!=null?q:this.shadow.color),this._textMeasurement=new Zr(this,"",tt.Black)}clone(){return new pc({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:void 0})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,s){}_rotate(t){var e;const s=(e=this.origin)!=null?e:this._textBounds.center;t.translate(s.x,s.y),t.rotate(this.rotation),t.translate(-s.x,-s.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,e){return this._textMeasurement.measureText(t,e)}measureText(t,e){return Md.measureText(t,this,e)}_postDraw(t){t.restore()}render(t,e,s,r,l,h){const u=Md.getTextInstance(e,this,s);this._textBounds=u.dimensions,this._preDraw(t,r,l),u.render(t,r,l,h),this._postDraw(t)}}class _f extends He{constructor(t){var e,s;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(e=t.font)!=null?e:new pc,this.color=(s=t.color)!=null?s:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,e;return new _f({text:this.text.slice(),color:(e=(t=this.color)==null?void 0:t.clone())!=null?e:tt.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_preDraw(t,e,s){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(t,e,s)}_drawImage(t,e,s){var r;let l=tt.Black;this.font instanceof pc&&(l=(r=this.color)!=null?r:this.font.color);const{width:h,height:u}=this.font.measureText(this._text,this.maxWidth);this._textWidth=h,this._textHeight=u,this.font.render(t,this._text,l,e,s,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(e-h,s-u,h*2,u*2),this.maxWidth!=null&&t.debug.drawRect(e,s,this.maxWidth,this.height,{color:tt.Yellow}))}}function Dy(o){return!!o.tick}class Ve extends Ji{constructor(t){super(),this._logger=yt.getInstance(),this._current="default",this._graphics={},this._options={},this.material=null,this.isVisible=!0,this.forceOnScreen=!1,this.opacity=1,this._offset=new yn(B.Zero,()=>this.recalculateBounds()),this._anchor=new yn(B.Half,()=>this.recalculateBounds()),this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,t={visible:this.isVisible,graphics:{},...t};const{current:e,anchor:s,color:r,opacity:l,visible:h,graphics:u,offset:f,copyGraphics:g,onPreDraw:_,onPostDraw:y,onPreTransformDraw:A,onPostTransformDraw:x}=t;for(const[D,S]of Object.entries(u))S instanceof He?this._graphics[D]=S:(this._graphics[D]=S.graphic,this._options[D]=S.options);this.offset=f??this.offset,this.opacity=l??this.opacity,this.anchor=s??this.anchor,this.color=r??this.color,this.copyGraphics=g??this.copyGraphics,this.onPreDraw=_??this.onPreDraw,this.onPostDraw=y??this.onPostDraw,this.onPreDraw=A??this.onPreTransformDraw,this.onPostTransformDraw=x??this.onPostTransformDraw,this.isVisible=!!h,this._current=e??this._current,e&&this._graphics[e]&&this.use(e)}get visible(){return this.isVisible}set visible(t){this.isVisible=t}get offset(){return this._offset}set offset(t){this._offset=new yn(t,()=>this.recalculateBounds()),this.recalculateBounds()}get anchor(){return this._anchor}set anchor(t){this._anchor=new yn(t,()=>this.recalculateBounds()),this.recalculateBounds()}get color(){return this._color}set color(t){if(t){this._color=t.clone();const e=this.current;(e instanceof Dc||e instanceof _f)&&(e.color=this._color)}}getGraphic(t){return this._graphics[t]}getOptions(t){return this._options[t]}getNames(){return Object.keys(this._graphics)}get current(){return this._graphics[this._current]}get currentOptions(){return this._options[this._current]}get graphics(){return this._graphics}get options(){return this._options}add(t,e,s){let r="default",l=null,h;if(typeof t=="string"&&e instanceof He&&(r=t,l=e,h=s),t instanceof He&&!(e instanceof He)&&(l=t,h=e),!l)throw new Error("Need to provide a graphic or valid graphic string");return this._graphics[r]=this.copyGraphics?l.clone():l,this._options[r]=this.copyGraphics?{...h}:h,r==="default"&&this.use("default"),l}remove(t){delete this._graphics[t],delete this._options[t],this._current===t&&(this._current="default",this.recalculateBounds())}use(t,e){var s;if(t instanceof He){let r=t;this.copyGraphics&&(r=t.clone()),this._current="default",this._graphics[this._current]=r,this._options[this._current]=e}else this._current=t,this._options[this._current]=e,this._current in this._graphics||this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(s=this.owner)==null?void 0:s.name}. Nothing will be drawn.`);return this.recalculateBounds(),this.current}hide(){this._current="ex.none"}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new Tt;const e=this._graphics[this._current],s=this._options[this._current];if(!e){this._localBounds=t;return}let r=this.anchor,l=this.offset;s!=null&&s.anchor&&(r=s.anchor),s!=null&&s.offset&&(l=s.offset);const h=e.localBounds,u=-h.width*r.x+l.x,f=-h.height*r.y+l.y;e instanceof $r&&!e.useAnchor?t=e==null?void 0:e.localBounds.combine(t):t=e==null?void 0:e.localBounds.translate(L(u,f)).combine(t),this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}get bounds(){let t=this.localBounds;if(this.owner){const e=this.owner.get(at);e&&(t=t.transform(e.get().matrix))}return t}update(t,e=0){const s=this.current;s&&Dy(s)&&s.tick(t,e)}clone(){const t=new Ve;return t._graphics={...this._graphics},t._options={...this._options},t.offset=this.offset.clone(),this.color&&(t.color=this.color.clone()),t.opacity=this.opacity,t.anchor=this.anchor.clone(),t.copyGraphics=this.copyGraphics,t.onPreDraw=this.onPreDraw,t.onPostDraw=this.onPostDraw,t.isVisible=this.isVisible,t}}class mo extends Ji{constructor(t){var e,s;super(),this.useColliderShape=!0,this.useGraphicsBounds=!0,this.useColliderShape=(e=t==null?void 0:t.useColliderShape)!=null?e:this.useColliderShape,this.useGraphicsBounds=(s=t==null?void 0:t.useGraphicsBounds)!=null?s:this.useGraphicsBounds,this.localBounds=t==null?void 0:t.localBounds}}const ei=class{static CreateReversibleEasingFunction(t){return(e,s,r,l)=>r<s?s-(t(e,r,s,l)-r):t(e,s,r,l)}static CreateVectorEasingFunction(t){return(e,s,r,l)=>new B(t(e,s.x,r.x,l),t(e,s.y,r.y,l))}};ei.Linear=ei.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,e*o/s+t));ei.EaseInQuad=ei.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,e*o*o+t));ei.EaseOutQuad=ei.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,-e*o*(o-2)+t));ei.EaseInOutQuad=ei.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s/2,o<1?e/2*o*o+t:(o--,-e/2*(o*(o-2)-1)+t)));ei.EaseInCubic=ei.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,e*o*o*o+t));ei.EaseOutCubic=ei.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,o--,e*(o*o*o+1)+t));ei.EaseInOutCubic=ei.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s/2,o<1?e/2*o*o*o+t:(o-=2,e/2*(o*o*o+2)+t)));let Os=ei;class _C{constructor(t){this._actions=[],this._currentAction=null,this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}getIncompleteActions(){return this._actions}getCurrentAction(){return this._currentAction}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){if(this._actions.length>0&&(this._currentAction!==this._actions[0]&&(this._currentAction=this._actions[0],this._entity.emit("actionstart",new rw(this._currentAction,this._entity))),this._currentAction.update(t),this._currentAction.isComplete(this._entity))){this._entity.emit("actioncomplete",new aw(this._currentAction,this._entity));const e=this._actions.shift();e&&this._completedActions.push(e)}}}let mC=0;function te(){return mC++}class yC{constructor(t,e,s){this.id=te(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new mf(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=s,this._originalRepeat=s,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class AC{constructor(t,e){this.id=te(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new mf(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}function vC(o){return o.offset instanceof B&&typeof o.duration=="number"}class xC{constructor(t,e){this.entity=t,this.id=te(),this._started=!1,this._stopped=!1,this._easing=Os.Linear;var s;if(this._offset=e.offset,this._easing=(s=e.easing)!=null?s:this._easing,this._tx=t.get(at),this._motion=t.get(qt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._end=this._start.add(this._offset),this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=this._tx.pos,r=this._easing(e,this._start.x,this._end.x,1),l=this._easing(e,this._start.y,this._end.y,1),h=t/1e3,u=h===0?0:(r-s.x)/h,f=h===0?0:(l-s.y)/h;this._motion.vel.x=u,this._motion.vel.y=f,this.isComplete(this.entity)&&(this._tx.pos=L(this._end.x,this._end.y),this._motion.vel=L(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=L(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class e0{constructor(t,e,s,r){if(this.id=te(),this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(at),this._motion=t.get(qt),this._speed=r,this._offset=new B(e,s),r<=0)throw yt.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+r),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new B(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.magnitude,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=L(this._end.x,this._end.y),this._motion.vel=L(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(at);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=L(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function bC(o){return o.pos instanceof B&&typeof o.duration=="number"}class wC{constructor(t,e){this.entity=t,this.id=te(),this._started=!1,this._stopped=!1,this._easing=Os.Linear;var s;if(this._end=e.pos,this._easing=(s=e.easing)!=null?s:this._easing,this._tx=t.get(at),this._motion=t.get(qt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=this._tx.pos,r=this._easing(e,this._start.x,this._end.x,1),l=this._easing(e,this._start.y,this._end.y,1),h=t/1e3,u=h===0?0:(r-s.x)/h,f=h===0?0:(l-s.y)/h;this._motion.vel.x=u,this._motion.vel.y=f,this.isComplete(this.entity)&&(this._tx.pos=L(this._end.x,this._end.y),this._motion.vel=L(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=L(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class i0{constructor(t,e,s,r){this.entity=t,this.id=te(),this._started=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._end=new B(e,s),this._speed=r}update(t){this._started||(this._started=!0,this._start=new B(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=L(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=L(this._end.x,this._end.y),this._motion.vel=L(0,0))}isComplete(t){const e=t.get(at);return this._stopped||new B(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=L(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class CC{constructor(t,e){this.entity=t,this.id=te(),this._started=!1,this._stopped=!1,this._endAngle=0,this._startAngle=0;var s;if(this._endAngle=e.angle,this._tx=t.get(at),this._motion=t.get(qt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(s=e.rotationType)!=null?s:me.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=wy(this._startAngle,this._endAngle,this._rotationType,e),r=this._tx.rotation,l=t/1e3,h=l===0?0:(s-r)/l;this._motion.angularVelocity=h,this.isComplete(this.entity)&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class SC{constructor(t,e,s,r){this.id=te(),this._started=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._end=e,this._speed=s,this._rotationType=r||me.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const e=Math.abs(this._end-this._start),s=Ge-e;switch(e>s?(this._shortDistance=s,this._longDistance=e):(this._shortDistance=e,this._longDistance=s),this._shortestPathIsPositive=(this._start-this._end+Ge)%Ge>=Math.PI,this._rotationType){case me.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case me.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case me.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case me.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class TC{constructor(t,e){this.entity=t,this.id=te(),this._started=!1,this._stopped=!1,this._offset=0,this._startAngle=0,this._endAngle=0;var s;if(this._offset=e.angleRadiansOffset,this._tx=t.get(at),this._motion=t.get(qt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(s=e.rotationType)!=null?s:me.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._endAngle=An(this._startAngle+this._offset),this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=wy(this._startAngle,this._endAngle,this._rotationType,e),r=this._tx.rotation,l=t/1e3,h=l===0?0:(s-r)/l;this._motion.angularVelocity=h,this.isComplete()&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class EC{constructor(t,e,s,r){this.id=te(),this._started=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._speed=s,this._offset=e,this._rotationType=r||me.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const e=Math.abs(this._end-this._start),s=Ge-e;switch(e>s?(this._shortDistance=s,this._longDistance=e):(this._shortDistance=e,this._longDistance=s),this._shortestPathIsPositive=(this._start-this._end+Ge)%Ge>=Math.PI,this._rotationType){case me.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case me.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case me.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case me.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}function DC(o){return typeof o.scale=="object"&&typeof o.duration=="number"}class RC{constructor(t,e){if(this.entity=t,this.id=te(),this._started=!1,this._stopped=!1,this._endScale=L(1,1),this._startScale=L(1,1),this._endScale=e.scale,this._tx=t.get(at),this._motion=t.get(qt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=pf(this._startScale,this._endScale,e),r=this._tx.scale,l=t/1e3,h=s.sub(r).scale(l===0?0:1/l);this._motion.scaleFactor=h,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=B.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class MC{constructor(t,e,s,r,l){this.id=te(),this._started=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._endX=e,this._endY=s,this._speedX=r,this._speedY=l}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*e}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*e}this.isComplete()&&(this._tx.scale=L(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function PC(o){return typeof o.scaleOffset=="object"&&typeof o.duration=="number"}class BC{constructor(t,e){if(this.entity=t,this.id=te(),this._started=!1,this._stopped=!1,this._endScale=L(1,1),this._scaleOffset=L(0,0),this._startScale=L(1,1),this._scaleOffset=e.scaleOffset,this._tx=t.get(at),this._motion=t.get(qt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._endScale=this._startScale.add(this._scaleOffset),this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=pf(this._startScale,this._endScale,e),r=this._tx.scale,l=t/1e3,h=s.sub(r).scale(l===0?0:1/l);this._motion.scaleFactor=h,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=B.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class IC{constructor(t,e,s,r){this.id=te(),this._started=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._offset=new B(e,s),this._speedX=this._speedY=r}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class s0{constructor(t){this.id=te(),this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class kC{constructor(t,e,s,r,l){this.easingFcn=l,this.id=te(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new B(0,0),this._lerpEnd=new B(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._lerpDuration=r,this._lerpEnd=new B(e,s)}_initialize(){this._lerpStart=new B(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,s=this._tx.pos.y;if(this._currentLerpTime<this._lerpDuration){this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?s=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):s=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration);const r=t/1e3;this._motion.vel=L(r===0?0:(e-this._tx.pos.x)/r,r===0?0:(s-this._tx.pos.y)/r)}else this._tx.pos=L(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=B.Zero}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=L(0,0),this._stopped=!0}}class zC{constructor(t,e,s,r,l){this.easingFcn=l,this.id=te(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new B(0,0),this._lerpEnd=new B(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._lerpDuration=r,this._offset=new B(e,s)}_initialize(){this._lerpStart=new B(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,s=this._tx.pos.y;if(this._currentLerpTime<this._lerpDuration){this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?s=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):s=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration);const r=t/1e3;this._motion.vel=L(r===0?0:(e-this._tx.pos.x)/r,r===0?0:(s-this._tx.pos.y)/r)}else this._tx.pos=L(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=B.Zero}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=L(0,0),this._stopped=!0}}class OC{constructor(t,e,s,r=1){this.id=te(),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(Ve),this._timeVisible=e,this._timeNotVisible=s,this._duration=(e+s)*r}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.isVisible&&this._elapsedTime>=this._timeVisible&&(this._graphics.isVisible=!1,this._elapsedTime=0),!this._graphics.isVisible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.isVisible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.isVisible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class UC{constructor(t,e,s){this.id=te(),this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(Ve),this._endOpacity=e,this._remainingTime=this._originalTime=s}update(t){this._graphics&&(this._started||(this._started=!0,this._remainingTime=this._originalTime,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._remainingTime>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._remainingTime),this._remainingTime-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),yt.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||this._remainingTime<=0}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._remainingTime=this._originalTime}}class LC{constructor(t){this.id=te(),this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class FC{constructor(t){this.id=te(),this._stopped=!1,this._entity=t}update(t){this._entity.get(lo).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class n0{constructor(t,e,s){this.id=te(),this._started=!1,this._stopped=!1,this._tx=t.get(at),this._motion=t.get(qt),this._followTx=e.get(at),this._followMotion=e.get(qt),this._current=new B(this._tx.pos.x,this._tx.pos.y),this._end=new B(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=s!==void 0?s:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(e!==0&&(this._speed=e),this._current=L(this._tx.pos.x,this._tx.pos.y),this._end=L(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const s=this._dir.scale(this._speed);this._motion.vel=L(s.x,s.y)}else this._motion.vel=L(0,0);this.isComplete()&&(this._tx.pos=L(this._end.x,this._end.y),this._motion.vel=L(0,0))}stop(){this._motion.vel=L(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class cd{constructor(t,e,s,r){this.id=te(),this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tolerance=1,this._tx=t.get(at),this._motion=t.get(qt),this._meetTx=e.get(at),this._meetMotion=e.get(qt),this._current=new B(this._tx.pos.x,this._tx.pos.y),this._end=new B(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=s||0,s!==void 0&&(this._speedWasSpecified=!0),r!==void 0&&(this._tolerance=r)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));e!==0&&!this._speedWasSpecified&&(this._speed=e),this._current=L(this._tx.pos.x,this._tx.pos.y),this._end=L(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const s=this._dir.scale(this._speed);this._motion.vel=L(s.x,s.y),this.isComplete()&&(this._tx.pos=L(this._end.x,this._end.y),this._motion.vel=L(0,0))}isComplete(){return this._stopped||this._distanceBetween<=this._tolerance}stop(){this._motion.vel=L(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=1/0}}class NC{constructor(t,e,s=1e3){this.id=te(),this._stopped=!1,this._started=!1,this._total=0,this._currentDuration=0;var r;this._graphics=t.get(Ve),this._duration=s,this._entity=t,this._material=(r=t.scene)==null?void 0:r.engine.graphicsContext.createMaterial({name:"flash-material",color:e,fragmentSource:`#version 300 es
    
        precision mediump float;
        uniform float u_blend;
        uniform sampler2D u_graphic;
        uniform vec4 u_color;
    
        in vec2 v_uv; 
        out vec4 color;
    
        void main() { 
            vec4 textureColor = texture(u_graphic, v_uv); 
            color = mix(textureColor, u_color, u_blend * textureColor.a);
            color.rgb = color.rgb * color.a;
        }`}),this._total=s}update(t){var e;this._started||(this._started=!0,this._total=this._duration,this._currentDuration=this._duration,this._entity.graphics.material=this._material),this._graphics&&(this._currentDuration-=t,this._graphics&&((e=this._material)==null||e.update(s=>{s.trySetUniformFloat("u_blend",this._currentDuration/this._total)})),this.isComplete()&&(this._entity.graphics.material=null))}isComplete(){return this._stopped||this._currentDuration<=0}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class HC{constructor(t,e){this.id=te(),this._started=!1,this._stopped=!1,this._mode="dynamic";var s;if(this._entity=t,this._tx=this._entity.get(at),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=new Pc({controlPoints:[L(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(s=e.mode)!=null?s:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos.clone()),this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0,this._currentMs=0}}class GC{constructor(t,e){this.id=te(),this._started=!1,this._stopped=!1,this._mode="dynamic";var s;if(this._entity=t,this._tx=this._entity.get(at),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=this._curve=new Pc({controlPoints:[L(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(s=e.mode)!=null?s:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos),this._curve.setControlPoint(1,this._curve.controlPoints[1].add(this._tx.globalPos)),this._curve.setControlPoint(2,this._curve.controlPoints[2].add(this._tx.globalPos)),this._curve.setControlPoint(3,this._curve.controlPoints[3].add(this._tx.globalPos)),this._started=!0),this._currentMs-=t;const e=Pt(Hs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0}}class mf{constructor(t){this._entity=t,this._queue=new _C(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}curveBy(t){return this._queue.add(new GC(this._entity,t)),this}curveTo(t){return this._queue.add(new HC(this._entity,t)),this}easeTo(...t){var e,s;let r=0,l=0,h=0,u=Os.Linear;return t[0]instanceof B?(r=t[0].x,l=t[0].y,h=t[1],u=(e=t[2])!=null?e:u):(r=t[0],l=t[1],h=t[2],u=(s=t[3])!=null?s:u),this._queue.add(new kC(this._entity,r,l,h,u)),this}easeBy(...t){var e,s;let r=0,l=0,h=0,u=Os.Linear;return t[0]instanceof B?(r=t[0].x,l=t[0].y,h=t[1],u=(e=t[2])!=null?e:u):(r=t[0],l=t[1],h=t[2],u=(s=t[3])!=null?s:u),this._queue.add(new zC(this._entity,r,l,h,u)),this}moveTo(t,e,s){let r=0,l=0,h=0;return t instanceof B?(r=t.x,l=t.y,h=+(e??0),this._queue.add(new i0(this._entity,r,l,h))):typeof t=="number"&&typeof e=="number"&&typeof s=="number"?(r=t,l=e,h=s,this._queue.add(new i0(this._entity,r,l,h))):bC(t)&&this._queue.add(new wC(this._entity,t)),this}moveBy(t,e,s){let r=0,l=0,h=0;return t instanceof B&&typeof e=="number"?(r=t.x,l=t.y,h=e,this._queue.add(new e0(this._entity,r,l,h))):typeof t=="number"&&typeof e=="number"&&typeof s=="number"?(r=t,l=e,h=s,this._queue.add(new e0(this._entity,r,l,h))):vC(t)&&this._queue.add(new xC(this._entity,t)),this}rotateTo(t,e,s){return typeof t=="number"&&typeof e=="number"?this._queue.add(new SC(this._entity,t,e,s)):typeof t=="object"&&this._queue.add(new CC(this._entity,t)),this}rotateBy(t,e,s){return typeof t=="object"?this._queue.add(new TC(this._entity,t)):this._queue.add(new EC(this._entity,t,e,s)),this}scaleTo(t,e,s,r){let l=1,h=1,u=0,f=0;return DC(t)?(this._queue.add(new RC(this._entity,t)),this):(t instanceof B&&e instanceof B&&(l=t.x,h=t.y,u=e.x,f=e.y),typeof t=="number"&&typeof e=="number"&&(l=t,h=e,u=s,f=r),this._queue.add(new MC(this._entity,l,h,u,f)),this)}scaleBy(t,e,s){if(PC(t))return this._queue.add(new BC(this._entity,t)),this;let r=1,l=1;return t instanceof B&&(r=t.x,l=t.y,s=e),typeof t=="number"&&typeof e=="number"&&(r=t,l=e),this._queue.add(new IC(this._entity,r,l,s)),this}blink(t,e,s=1){return this._queue.add(new OC(this._entity,t,e,s)),this}fade(t,e){return this._queue.add(new UC(this._entity,t,e)),this}flash(t,e=1e3){return this._queue.add(new NC(this._entity,t,e)),this}delay(t){return this._queue.add(new LC(t)),this}die(){return this._queue.add(new FC(this._entity)),this}callMethod(t){return this._queue.add(new s0(t)),this}repeat(t,e){return e?(this._queue.add(new yC(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new AC(this._entity,t)),this}follow(t,e){return e===void 0?this._queue.add(new n0(this._entity,t)):this._queue.add(new n0(this._entity,t,e)),this}meet(t,e,s){return e===void 0&&s===void 0?this._queue.add(new cd(this._entity,t)):s===void 0?this._queue.add(new cd(this._entity,t,e)):this._queue.add(new cd(this._entity,t,e,s)),this}toPromise(){return new Promise(e=>{this._queue.add(new s0(()=>{e()}))})}}class lo extends Ji{constructor(){super(...arguments),this.dependencies=[at,qt],this._ctx=null}onAdd(t){this._ctx=new mf(t)}onRemove(){this._ctx=null}_getCtx(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no context available");return this._ctx}getQueue(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no queue available");return this._ctx.getQueue()}runAction(t){if(!this._ctx)throw new Error("Actions component not attached to an entity, cannot run action");return this._ctx.runAction(t)}update(t){var e;return(e=this._ctx)==null?void 0:e.update(t)}clearActions(){var t;(t=this._ctx)==null||t.clearActions()}curveBy(t){return this._getCtx().curveBy.apply(this._ctx,[t])}curveTo(t){return this._getCtx().curveTo.apply(this._ctx,[t])}easeTo(...t){return this._getCtx().easeTo.apply(this._ctx,t)}easeBy(...t){return this._getCtx().easeBy.apply(this._ctx,t)}moveTo(t,e,s){return this._getCtx().moveTo.apply(this._ctx,[t,e,s])}moveBy(t,e,s){return this._getCtx().moveBy.apply(this._ctx,[t,e,s])}rotateTo(t,e,s){return this._getCtx().rotateTo.apply(this._ctx,[t,e,s])}rotateBy(t,e,s){return this._getCtx().rotateBy.apply(this._ctx,[t,e,s])}scaleTo(t,e,s,r){return this._getCtx().scaleTo.apply(this._ctx,[t,e,s,r])}scaleBy(t,e,s){return this._getCtx().scaleBy.apply(this._ctx,[t,e,s])}blink(t,e,s){return this._getCtx().blink(t,e,s)}fade(t,e){return this._getCtx().fade(t,e)}flash(t,e=1e3){return this._getCtx().flash(t,e)}delay(t){return this._getCtx().delay(t)}die(){return this._getCtx().die()}callMethod(t){return this._getCtx().callMethod(t)}repeat(t,e){return this._getCtx().repeat(t,e)}repeatForever(t){return this._getCtx().repeatForever(t)}follow(t,e){return this._getCtx().follow(t,e)}meet(t,e){return this._getCtx().meet(t,e)}toPromise(){return this._getCtx().toPromise()}}const Ry=class Id extends Fs{constructor(t){super(),this.events=new re,this._anchor=Wi(B.Half,rt=>this._handleAnchorChange(rt)),this._offset=Wi(B.Zero,rt=>this._handleOffsetChange(rt)),this.logger=yt.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=rt=>{this._dragging&&(this.pos=rt.worldPos)},this._pointerDragLeaveHandler=rt=>{this._dragging&&(this.pos=rt.worldPos)};const{name:e,x:s,y:r,pos:l,coordPlane:h,scale:u,width:f,height:g,radius:_,collider:y,vel:A,acc:x,rotation:D,angularVelocity:S,z:U,color:R,visible:C,opacity:O,anchor:G,offset:q,collisionType:et,collisionGroup:k}={...t};this.name=e??this.name,this.anchor=G??Id.defaults.anchor.clone(),this.offset=q??B.Zero,this.transform=new at,this.addComponent(this.transform),this.pos=l??L(s??0,r??0),this.rotation=D??0,this.scale=u??L(1,1),this.z=U??0,this.transform.coordPlane=h??pi.World,this.pointer=new mo,this.addComponent(this.pointer),this.graphics=new Ve({anchor:this.anchor,offset:this.offset,opacity:O}),this.addComponent(this.graphics),this.motion=new qt,this.addComponent(this.motion),this.vel=A??B.Zero,this.acc=x??B.Zero,this.angularVelocity=S??0,this.actions=new lo,this.addComponent(this.actions),this.body=new Kt,this.addComponent(this.body),this.body.collisionType=et??_t.Passive,k&&(this.body.group=k),R&&(this.color=R),y?(this.collider=new Be(y),this.addComponent(this.collider)):_?(this.collider=new Be(Xe.Circle(_)),this.addComponent(this.collider),R&&this.graphics.add(new uf({color:R,radius:_}))):f>0&&g>0?(this.collider=new Be(Xe.Box(f,g,this.anchor)),this.addComponent(this.collider),R&&f&&g&&this.graphics.add(new Mc({color:R,width:f,height:g}))):(this.collider=new Be,this.addComponent(this.collider)),this.graphics.isVisible=C??!0}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}get oldGlobalPos(){return this.body.oldGlobalPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(at).scale}set scale(t){this.get(at).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=Wi(t,e=>this._handleAnchorChange(e)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get offset(){return this._offset}set offset(t){this._offset=Wi(t,e=>this._handleOffsetChange(e)),this._handleOffsetChange(t)}_handleOffsetChange(t){this.graphics&&(this.graphics.offset=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this.graphics.color}set color(t){this.graphics.color=t}clone(){const t=new Id({color:this.color.clone(),anchor:this.anchor.clone(),offset:this.offset.clone()});t.clearComponents(),t.processComponentRemoval(),t.addComponent(t.transform=this.transform.clone(),!0),t.addComponent(t.pointer=this.pointer.clone(),!0),t.addComponent(t.graphics=this.graphics.clone(),!0),t.addComponent(t.motion=this.motion.clone(),!0),t.addComponent(t.actions=this.actions.clone(),!0),t.addComponent(t.body=this.body.clone(),!0),this.collider.get()&&t.addComponent(t.collider=this.collider.clone(),!0);const e=[this.transform,this.pointer,this.graphics,this.motion,this.actions,this.body,this.collider],s=this.getComponents();for(const r of s)e.includes(r)||t.addComponent(r.clone(),!0);return t}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_prekill(t){this.events.emit("prekill",new Ub(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){this.events.emit("postkill",new Lb(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new W0(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.isActive=!0}isKilled(){return!this.isActive}get z(){return this.get(at).z}set z(t){this.get(at).z=t}get center(){const t=this.getGlobalPos();return new B(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new B(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(at).globalRotation}get globalRotation(){return this.get(at).globalRotation}getGlobalPos(){return this.get(at).globalPos}get globalPos(){return this.get(at).globalPos}getGlobalScale(){return this.get(at).globalScale}get globalScale(){return this.get(at).globalScale}get globalZ(){return this.get(at).globalZ}contains(t,e,s=!1){const r=L(t,e),l=this.get(Be);l.update();const h=l.get();if(!h)return!1;const u=h.contains(r);return s?u||this.children.some(f=>f.contains(t,e,!0)):u}within(t,e){const s=this.get(Be),r=t.get(Be),l=s.get(),h=r.get();return l&&h?l.getClosestLineBetween(h).getLength()<=e:!1}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e),this._postupdate(t,e),this._remove(t)}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreCollisionResolve(t,e,s,r){}onPostCollisionResolve(t,e,s,r){}onCollisionStart(t,e,s,r){}onCollisionEnd(t,e,s,r){}_preupdate(t,e){this.events.emit("preupdate",new ea(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new ia(t,e,this)),this.onPostUpdate(t,e)}};Ry.defaults={anchor:B.Half};let Gi=Ry;class Be extends Ji{constructor(t){super(),this.events=new re,this.$colliderAdded=new di,this.$colliderRemoved=new di,this._collidersToRemove=[],this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,t.events.pipe(this.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this._collidersToRemove.push(this._collider),this._collider=null)}processColliderRemoval(){for(const t of this._collidersToRemove)t.events.unpipe(this.events),this.$colliderRemoved.notifyAll(t),t.owner=null}clone(){return new Be(this._collider.clone())}get bounds(){var t,e;return(e=(t=this._collider)==null?void 0:t.bounds)!=null?e:new Tt}get localBounds(){var t,e;return(e=(t=this._collider)==null?void 0:t.localBounds)!=null?e:new Tt}update(){var t;const e=(t=this.owner)==null?void 0:t.get(at);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e.get()))}collide(t){let e=this._collider,s=t._collider;if(!e||!s)return[];let r=!1;if(s instanceof Qe&&(e=s,s=this._collider,r=!0),this._collider){const l=e.collide(s);return l?(r&&l.forEach(h=>{h.mtv=h.mtv.negate(),h.normal=h.normal.negate(),h.tangent=h.normal.perpendicular(),h.colliderA=this._collider,h.colliderB=t._collider}),l):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",e=>{const s=e;t.events.emit("precollision",new po(s.self,s.other,s.side,s.intersection,s.contact)),t instanceof Gi&&t.onPreCollisionResolve(s.self,s.other,s.side,s.contact)}),this.events.on("postcollision",e=>{const s=e;t.events.emit("postcollision",new go(s.self,s.other,s.side,s.intersection,s.contact)),t instanceof Gi&&t.onPostCollisionResolve(s.self,s.other,s.side,s.contact)}),this.events.on("collisionstart",e=>{const s=e;t.events.emit("collisionstart",new bd(s.self,s.other,s.side,s.contact)),t instanceof Gi&&t.onCollisionStart(s.self,s.other,s.side,s.contact)}),this.events.on("collisionend",e=>{const s=e;t.events.emit("collisionend",new wd(s.self,s.other,s.side,s.lastContact)),t instanceof Gi&&t.onCollisionEnd(s.self,s.other,s.side,s.lastContact)})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,s=B.Half,r=B.Zero){const l=Xe.Box(t,e,s,r);return this.set(l)}usePolygonCollider(t,e=B.Zero){const s=Xe.Polygon(t,e);return this.set(s)}useCircleCollider(t,e=B.Zero){const s=Xe.Circle(t,e);return this.set(s)}useEdgeCollider(t,e){const s=Xe.Edge(t,e);return this.set(s)}useCompositeCollider(t){return this.set(new Qe(t))}}var Qn=(o=>(o.Rotation="rotation",o.X="x",o.Y="y",o))(Qn||{});const yf=class tc extends Ji{constructor(t){var e,s,r;super(),this.dependencies=[at,qt],this.id=Jr("body",tc._ID++),this.events=new re,this.oldTransform=new bn,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=_t.PreventCollision,this.group=Kr.All,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this._oldGlobalPos=B.Zero,this.oldVel=new B(0,0),this.oldAcc=B.Zero,this._impulseScratch=L(0,0),this._distanceFromCenterScratch=L(0,0),t?(this.collisionType=(e=t.type)!=null?e:this.collisionType,this.group=(s=t.group)!=null?s:this.group,this.useGravity=(r=t.useGravity)!=null?r:this.useGravity,this._bodyConfig={...vn().bodies,...t.config}):this._bodyConfig={...vn().bodies},this.updatePhysicsConfig(this._bodyConfig),this._mass=tc._DEFAULT_CONFIG.defaultMass}get matrix(){return this.transform.get().matrix}updatePhysicsConfig(t){this._bodyConfig={...vn().bodies,...t},this.canSleep=this._bodyConfig.canSleepByDefault,this.sleepMotion=this._bodyConfig.sleepEpsilon*5,this.wakeThreshold=this._bodyConfig.wakeThreshold}static updateDefaultPhysicsConfig(t){tc._DEFAULT_CONFIG=t}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===_t.Fixed?0:1/this.mass}get sleeping(){return this.isSleeping}get isSleeping(){return this._sleeping}setSleeping(t){this.isSleeping=t}set isSleeping(t){this._sleeping=t,t?(this.vel=B.Zero,this.acc=B.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=this._bodyConfig.sleepEpsilon*5}updateMotion(){this._sleeping&&(this.isSleeping=!0);const t=this.vel.magnitude*this.vel.magnitude+Math.abs(this.angularVelocity*this.angularVelocity),e=this._bodyConfig.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=Pt(this.sleepMotion,0,10*this._bodyConfig.sleepEpsilon),this.canSleep&&this.sleepMotion<this._bodyConfig.sleepEpsilon&&(this.isSleeping=!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(Be);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const e=t.get();if(e)return this._cachedInertia=e.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===_t.Fixed?0:1/this.inertia}get active(){var t;return!!((t=this.owner)!=null&&t.isActive)}get isActive(){var t;return!!((t=this.owner)!=null&&t.isActive)}get center(){return this.globalPos}onAdd(t){var e,s;this.transform=(e=this.owner)==null?void 0:e.get(at),this.motion=(s=this.owner)==null?void 0:s.get(qt)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this.oldTransform.pos}get oldGlobalPos(){return this._oldGlobalPos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this.oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this.oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==_t.Active)return;const s=e.scale(this.inverseMass,this._impulseScratch);if(this.limitDegreeOfFreedom.indexOf("x")>-1&&(s.x=0),this.limitDegreeOfFreedom.indexOf("y")>-1&&(s.y=0),this.vel.addEqual(s),!this.limitDegreeOfFreedom.includes("rotation")){const r=t.sub(this.globalPos,this._distanceFromCenterScratch);this.angularVelocity+=this.inverseInertia*r.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==_t.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes("x")&&(e.x=0),this.limitDegreeOfFreedom.includes("y")&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===_t.Active&&!this.limitDegreeOfFreedom.includes("rotation")){const s=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*s.cross(e)}}captureOldTransform(){this.__oldTransformCaptured=!0;const t=this.transform.get();t.clone(this.oldTransform),this.oldTransform.parent=t.parent,this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldGlobalPos.setTo(this.globalPos.x,this.globalPos.y)}clone(){return super.clone()}};yf._ID=0;yf._DEFAULT_CONFIG={...vn().bodies};let Kt=yf;class My{constructor(t,e){this.object=t,this.id=-1,this.cells=[],this.hasZeroBounds=!1,this.gridSize=e,this.bounds=t.bounds,this.hasZeroBounds=this.bounds.hasZeroDimensions(),this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize)}hasChanged(){const t=this.object.bounds,e=Math.floor(t.left/this.gridSize),s=Math.floor(t.right/this.gridSize),r=Math.floor(t.bottom/this.gridSize),l=Math.floor(t.top/this.gridSize);return this.leftX!==e||this.rightX!==s||this.bottomY!==r||this.topY!==l}clear(){for(const t of this.cells){const e=t.proxies.indexOf(this);e>-1&&t.proxies.splice(e,1)}}updateBounds(){this.bounds=this.object.bounds}update(){this.bounds=this.object.bounds,this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize),this.hasZeroBounds=this.object.bounds.hasZeroDimensions()}}class zs{constructor(){this.proxies=[]}configure(t,e){this.x=t,this.y=e,this.key=zs.calculateHashKey(t,e)}static calculateHashKey(t,e){return`${t}+${e}`}}class Py{constructor(t){this.bounds=new Tt,this._hashGridCellPool=new Rc(()=>new zs,e=>(e.configure(0,0),e.proxies.length=0,e),1e3),this.gridSize=t.size,this.sparseHashGrid=new Map,this.objectToProxy=new Map,t.proxyFactory?this._buildProxy=e=>t.proxyFactory(e,this.gridSize):this._buildProxy=e=>new My(e,this.gridSize)}query(t){const e=new Set;if(t instanceof Tt){const s=t,r=Math.floor(s.left/this.gridSize),l=Math.floor(s.right/this.gridSize),h=Math.floor(s.bottom/this.gridSize),u=Math.floor(s.top/this.gridSize);for(let f=r;f<=l;f++)for(let g=u;g<=h;g++){const _=zs.calculateHashKey(f,g),y=this.sparseHashGrid.get(_);if(y)for(let A=0;A<y.proxies.length;A++)y.proxies[A].updateBounds(),y.proxies[A].bounds.intersect(s)&&e.add(y.proxies[A].object)}}else{const s=t,r=zs.calculateHashKey(Math.floor(s.x/this.gridSize),Math.floor(s.y/this.gridSize)),l=this.sparseHashGrid.get(r);if(l)for(let h=0;h<l.proxies.length;h++)l.proxies[h].updateBounds(),l.proxies[h].bounds.contains(s)&&e.add(l.proxies[h].object)}return Array.from(e)}get(t,e){const s=zs.calculateHashKey(t,e);return this.sparseHashGrid.get(s)}_insert(t,e,s){const r=zs.calculateHashKey(t,e);let l=this.sparseHashGrid.get(r);l||(l=this._hashGridCellPool.rent(),l.configure(t,e),this.sparseHashGrid.set(l.key,l)),l.proxies.push(s),s.cells.push(l),this.bounds.combine(s.bounds,this.bounds)}_remove(t,e,s){const r=zs.calculateHashKey(t,e),l=this.sparseHashGrid.get(r);if(l){const h=l.proxies.indexOf(s);h>-1&&l.proxies.splice(h,1);const u=s.cells.indexOf(l);u>-1&&s.cells.splice(u,1),l.proxies.length===0&&(this._hashGridCellPool.return(l),this.sparseHashGrid.delete(r))}}track(t){const e=this._buildProxy(t);this.objectToProxy.set(t,e);for(let s=e.leftX;s<=e.rightX;s++)for(let r=e.topY;r<=e.bottomY;r++)this._insert(s,r,e)}untrack(t){const e=this.objectToProxy.get(t);e&&(e.clear(),this.objectToProxy.delete(t))}update(t){let e=0;for(const s of t){const r=this.objectToProxy.get(s);if(r&&r.hasChanged()){for(let l=r.leftX;l<=r.rightX;l++)for(let h=r.topY;h<=r.bottomY;h++)this._remove(l,h,r);r.update();for(let l=r.leftX;l<=r.rightX;l++)for(let h=r.topY;h<=r.bottomY;h++)this._insert(l,h,r);e++}}return e}debug(t,e){const s=tt.Transparent,r=tt.White;for(const l of this.sparseHashGrid.values())t.drawRectangle(L(l.x*this.gridSize,l.y*this.gridSize),this.gridSize,this.gridSize,s,r,2)}}class QC extends My{constructor(t,e){var s,r,l;super(t,e),this.collider=t,this.id=-1,this.hasZeroBounds=!1,this.cells=[],this.gridSize=e;const h=t.bounds;this.hasZeroBounds=h.hasZeroDimensions(),this.leftX=Math.floor(h.left/this.gridSize),this.rightX=Math.floor(h.right/this.gridSize),this.bottomY=Math.floor(h.bottom/this.gridSize),this.topY=Math.floor(h.top/this.gridSize),this.owner=t.owner,this.body=(s=this.owner)==null?void 0:s.get(Kt),this.collisionType=(l=(r=this.body)==null?void 0:r.collisionType)!=null?l:_t.PreventCollision}update(){var t,e,s;super.update(),this.body=(t=this.owner)==null?void 0:t.get(Kt),this.collisionType=(s=(e=this.body)==null?void 0:e.collisionType)!=null?s:_t.PreventCollision,this.hasZeroBounds=this.collider.localBounds.hasZeroDimensions()}}class r0{constructor(t){this._pairs=new Set,this._nonPairs=new Set,this._pairPool=new of(()=>new ti({id:Jr("collider",0)},{id:Jr("collider",0)}),e=>(e.colliderA=null,e.colliderB=null,e),200),this.gridSize=t.size,this.hashGrid=new Py({size:this.gridSize,proxyFactory:(e,s)=>new QC(e,s)}),this._pairPool.disableWarnings=!0}getColliders(){return Array.from(this.hashGrid.objectToProxy.keys())}query(t){return this.hashGrid.query(t)}rayCast(t,e){var s,r,l;const h=[],u=(s=e==null?void 0:e.maxDistance)!=null?s:1/0,f=e==null?void 0:e.collisionGroup,g=f?f.category:(r=e==null?void 0:e.collisionMask)!=null?r:Kr.All.category,_=(l=e==null?void 0:e.searchAllColliders)!=null?l:!1,y=t.dir.normalize(),A=y.y/y.x,x=y.x/y.y,D=Math.sqrt(1+A*A)*this.gridSize,S=Math.sqrt(1+x*x)*this.gridSize,U=t.pos.x/this.gridSize,R=t.pos.y/this.gridSize,C=L(1,1);let O=~~U,G=~~R,q=0,et=0;y.x<0?(C.x=-1,q=(U-O)*D):(C.x=1,q=(O+1-U)*D),y.y<0?(C.y=-1,et=(R-G)*S):(C.y=1,et=(G+1-R)*S);const k=new Set;let rt=!1,pt=9999;for(;!rt&&pt>0&&(pt--,!!this.hashGrid.bounds.contains(L(O*this.gridSize,G*this.gridSize)));){const At=zs.calculateHashKey(O,G),bt=this.hashGrid.sparseHashGrid.get(At);if(bt){const Et=[];for(let I=0;I<bt.proxies.length;I++){const K=bt.proxies[I];if(!k.has(K.collider.id.value)){if(k.add(K.collider.id.value),K.body){if(e!=null&&e.ignoreCollisionGroupAll&&K.body.group===Kr.All)continue;const E=(g&K.body.group.category)!==0;if(K.body.group&&!E)continue}const X=K.collider.rayCast(t,u);X&&Et.push(X)}}Et.sort((I,K)=>I.distance-K.distance);for(let I=0;I<Et.length;I++){const K=Et[I];if(e!=null&&e.filter){if(e.filter(K)&&(h.push(K),!_)){rt=!0;break}}else if(h.push(K),!_){rt=!0;break}}}q<et?(O+=C.x,q+=D):(G+=C.y,et+=S)}return h.sort((At,bt)=>At.distance-bt.distance),!_&&h.length?[h[0]]:h}track(t){let e=[t];if(t instanceof Qe){const s=t.getColliders();for(const r of s)r.owner=t.owner;e=s}for(const s of e)this.hashGrid.track(s)}untrack(t){let e=[t];t instanceof Qe&&(e=t.getColliders());for(const s of e)this.hashGrid.untrack(s)}_canCollide(t,e){return!(t.collider.id===e.collider.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.hasZeroBounds||e.hasZeroBounds||t.body&&e.body&&!t.body.group.canCollide(e.body.group)||t.collisionType===_t.Fixed&&e.collisionType===_t.Fixed||t.collisionType===_t.PreventCollision||e.collisionType===_t.PreventCollision||!t.owner.isActive||!e.owner.isActive)}broadphase(t,e){const s=[];this._pairs.clear(),this._nonPairs.clear();let r=0;for(const l of this.hashGrid.objectToProxy.values())if(l.id=r++,!(!l.owner.isActive||l.collisionType===_t.PreventCollision))for(let h=0;h<l.cells.length;h++){const u=l.cells[h];for(let f=0;f<u.proxies.length;f++){const g=u.proxies[f];if(g.id===l.id)continue;const _=ti.calculatePairHash(l.collider.id,g.collider.id);if(!this._nonPairs.has(_))if(!this._pairs.has(_)&&this._canCollide(l,g)&&l.object.bounds.overlaps(g.object.bounds)){const y=this._pairPool.get();y.colliderA=l.collider,y.colliderB=g.collider,y.id=_,this._pairs.add(_),s.push(y)}else this._nonPairs.add(_)}}return s}narrowphase(t,e){const s=[];for(let r=0;r<t.length;r++){const l=t[r].collide();for(let h=0;h<l.length;h++){const u=l[h];s.push(u),e&&e.physics.contacts.set(u.id,u)}}return this._pairPool.done(),e&&(e.physics.collisions+=s.length),s}update(t,e){return this.hashGrid.update(t)}debug(t,e){this.hashGrid.debug(t,e)}}class a0{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map,this._compositeContactsIds=new Set}solve(t){this.preSolve(t),t=t.filter(s=>!s.isCanceled());let e;switch(this.config.contactSolveBias){case Wn.HorizontalFirst:{e=sy;break}case Wn.VerticalFirst:{e=iy;break}default:e=ny}t.sort((s,r)=>{const l=this.directionMap.get(s.id),h=this.directionMap.get(r.id),u=this.distanceMap.get(s.id),f=this.distanceMap.get(r.id);return e[l]-e[h]||u-f});for(const s of t)this.solvePosition(s),this.solveVelocity(s);return this.postSolve(t),t}preSolve(t){for(let s=0;s<t.length;s++){const r=t[s],l=r.id.indexOf("|");if(l>0){const g=r.id.substring(l+1);if(this._compositeContactsIds.has(g)){r.cancel();continue}this._compositeContactsIds.add(g)}if(Math.abs(r.mtv.x)<1e-4&&Math.abs(r.mtv.y)<1e-4){r.cancel();continue}const h=Jt.fromDirection(r.mtv),u=r.mtv.negate(),f=Math.abs(r.info.separation);this.distanceMap.set(r.id,f),this.directionMap.set(r.id,h===Jt.Left||h===Jt.Right?"horizontal":"vertical"),r.colliderA.events.emit("precollision",new po(r.colliderA,r.colliderB,h,u,r)),r.colliderB.events.emit("precollision",new po(r.colliderB,r.colliderA,Jt.getOpposite(h),u.negate(),r))}this._compositeContactsIds.clear()}postSolve(t){var e,s;for(let r=0;r<t.length;r++){const l=t[r];if(l.isCanceled())continue;const h=l.colliderA,u=l.colliderB,f=(e=h.owner)==null?void 0:e.get(Kt),g=(s=u.owner)==null?void 0:s.get(Kt);if(f&&g&&(f.collisionType===_t.Passive||g.collisionType===_t.Passive))continue;const _=Jt.fromDirection(l.mtv),y=l.mtv.negate();l.colliderA.events.emit("postcollision",new go(l.colliderA,l.colliderB,_,y,l)),l.colliderB.events.emit("postcollision",new go(l.colliderB,l.colliderA,Jt.getOpposite(_),y.negate(),l))}}solvePosition(t){var e,s;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let l=t.mtv;const h=t.colliderA,u=t.colliderB,f=(e=h.owner)==null?void 0:e.get(Kt),g=(s=u.owner)==null?void 0:s.get(Kt);if(f&&g){if(f.collisionType===_t.Passive||g.collisionType===_t.Passive)return;f.collisionType===_t.Active&&g.collisionType===_t.Active&&(l=l.scale(.5)),f.collisionType===_t.Active&&(f.globalPos.x-=l.x,f.globalPos.y-=l.y,h.update(f.transform.get())),g.collisionType===_t.Active&&(g.globalPos.x+=l.x,g.globalPos.y+=l.y,u.update(g.transform.get()))}}solveVelocity(t){var e,s;if(t.isCanceled())return;const r=t.colliderA,l=t.colliderB,h=(e=r.owner)==null?void 0:e.get(Kt),u=(s=l.owner)==null?void 0:s.get(Kt);if(h&&u){if(h.collisionType===_t.Passive||u.collisionType===_t.Passive)return;const f=t.normal,g=f.negate();if(h.collisionType===_t.Active&&h.vel.normalize().dot(g)<0){const _=f.scale(f.dot(h.vel.negate()));h.vel=h.vel.add(_)}if(u.collisionType===_t.Active&&u.vel.normalize().dot(f)<0){const _=g.scale(g.dot(u.vel.negate()));u.vel=u.vel.add(_)}}}}class VC{constructor(t,e,s){this.point=t,this.local=e,this.contact=s,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new B(0,0),this.bToContact=new B(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){const t=this.contact.bodyA,e=this.contact.colliderA,s=this.contact.bodyB,r=this.contact.colliderB;if(t&&s){const l=this.contact.normal,h=this.contact.tangent;this.aToContact=this.point.sub(e.center),this.bToContact=this.point.sub(r.center);const u=this.aToContact.cross(l),f=this.bToContact.cross(l);this.normalMass=t.inverseMass+s.inverseMass+t.inverseInertia*u*u+s.inverseInertia*f*f;const g=this.aToContact.cross(h),_=this.bToContact.cross(h);this.tangentMass=t.inverseMass+s.inverseMass+t.inverseInertia*g*g+s.inverseInertia*_*_}return this}getRelativeVelocity(){const t=this.contact.bodyA,e=this.contact.bodyB;if(t&&e){const s=t.vel.add(B.cross(t.angularVelocity,this.aToContact));return e.vel.add(B.cross(e.angularVelocity,this.bToContact)).sub(s)}return B.Zero}}class o0{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map,this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return(e=this.idToContactConstraint.get(t))!=null?e:[]}solve(t){this.preSolve(t),t=t.filter(s=>!s.isCanceled());let e;switch(this.config.contactSolveBias){case Wn.HorizontalFirst:{e=sy;break}case Wn.VerticalFirst:{e=iy;break}default:e=ny}return t.sort((s,r)=>{const l=this.directionMap.get(s.id),h=this.directionMap.get(r.id),u=this.distanceMap.get(s.id),f=this.distanceMap.get(r.id);return e[l]-e[h]||u-f}),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var e,s,r,l;for(let f=0;f<t.length;f++){const g=t[f];if(Math.abs(g.mtv.x)<1e-4&&Math.abs(g.mtv.y)<1e-4){g.cancel();continue}const _=Jt.fromDirection(g.mtv),y=Math.abs(((e=g==null?void 0:g.info)==null?void 0:e.separation)||0);this.distanceMap.set(g.id,y),this.directionMap.set(g.id,_===Jt.Left||_===Jt.Right?"horizontal":"vertical"),g.colliderA.events.emit("precollision",new po(g.colliderA,g.colliderB,_,g.mtv,g)),g.colliderA.events.emit("beforecollisionresolve",new Xm(g.colliderA,g.colliderB,_,g.mtv,g)),g.colliderB.events.emit("precollision",new po(g.colliderB,g.colliderA,Jt.getOpposite(_),g.mtv.negate(),g)),g.colliderB.events.emit("beforecollisionresolve",new Xm(g.colliderB,g.colliderA,Jt.getOpposite(_),g.mtv.negate(),g)),g.matchAwake()}const u=Array.from(this.idToContactConstraint.keys());for(let f=0;f<t.length;f++){const g=t[f],_=u.indexOf(g.id);_>-1&&u.splice(_,1);const y=(s=this.idToContactConstraint.get(g.id))!=null?s:[];let A=0;const x=g.bodyA,D=g.colliderA,S=g.bodyB,U=g.colliderB;if(x&&S)for(let R=0;R<g.points.length;R++){const C=g.points[R],O=g.normal,G=g.tangent,q=C.sub(D.center),et=C.sub(U.center),k=q.cross(O),rt=et.cross(O),pt=x.inverseMass+S.inverseMass+x.inverseInertia*k*k+S.inverseInertia*rt*rt,At=q.cross(G),bt=et.cross(G),Et=x.inverseMass+S.inverseMass+x.inverseInertia*At*At+S.inverseInertia*bt*bt;y[A]&&((l=(r=y[A])==null?void 0:r.point)==null?void 0:l.squareDistance(C))<4?(y[A].point=C,y[A].local=g.localPoints[A]):y[A]=new VC(C,g.localPoints[A],g),y[A].aToContact=q,y[A].bToContact=et,y[A].normalMass=1/pt,y[A].tangentMass=1/Et;const I=x.bounciness>S.bounciness?x.bounciness:S.bounciness,K=g.normal.dot(y[A].getRelativeVelocity());y[A].originalVelocityAndRestitution=0,K<-.1&&(y[A].originalVelocityAndRestitution=-I*K),A++}this.idToContactConstraint.set(g.id,y)}for(const f of u)this.idToContactConstraint.delete(f);if(this.config.warmStart)this.warmStart(t);else for(let f=0;f<t.length;f++){const g=t[f],_=this.getContactConstraints(g.id);for(const y of _)y.normalImpulse=0,y.tangentImpulse=0}}postSolve(t){for(let e=0;e<t.length;e++){const s=t[e],r=s.bodyA,l=s.bodyB;if(r&&l){if(r.collisionType===_t.Passive||l.collisionType===_t.Passive)continue;r.updateMotion(),l.updateMotion()}const h=Jt.fromDirection(s.mtv);s.colliderA.events.emit("postcollision",new go(s.colliderA,s.colliderB,h,s.mtv,s)),s.colliderA.events.emit("aftercollisionresolve",new Zm(s.colliderA,s.colliderB,h,s.mtv,s)),s.colliderB.events.emit("postcollision",new go(s.colliderB,s.colliderA,Jt.getOpposite(h),s.mtv.negate(),s)),s.colliderB.events.emit("aftercollisionresolve",new Zm(s.colliderB,s.colliderA,Jt.getOpposite(h),s.mtv.negate(),s))}this.lastFrameContacts.clear();for(let e=0;e<t.length;e++){const s=t[e];this.lastFrameContacts.set(s.id,s)}}warmStart(t){var e;for(let s=0;s<t.length;s++){const r=t[s],l=r.bodyA,h=r.bodyB;if(l&&h){const u=(e=this.idToContactConstraint.get(r.id))!=null?e:[];for(const f of u)if(this.config.warmStart){const g=r.normal.scale(f.normalImpulse),_=r.tangent.scale(f.tangentImpulse),y=g.add(_);l.applyImpulse(f.point,y.negate()),h.applyImpulse(f.point,y)}else f.normalImpulse=0,f.tangentImpulse=0}}}solvePosition(t){var e;for(let s=0;s<this.config.positionIterations;s++)for(let r=0;r<t.length;r++){const l=t[r],h=l.bodyA,u=l.bodyB;if(h&&u){if(h.collisionType===_t.Passive||u.collisionType===_t.Passive)continue;const f=(e=this.idToContactConstraint.get(l.id))!=null?e:[];for(const g of f){const _=l.normal,y=ls.FindContactSeparation(l,g.local),A=this.config.steeringFactor,x=-5,D=this.config.slop,S=Pt(A*(y+D),x,0),U=_.scale(-S*g.normalMass);if(h.collisionType===_t.Active){const R=U.negate().scale(h.inverseMass);h.limitDegreeOfFreedom.includes(Qn.X)&&(R.x=0),h.limitDegreeOfFreedom.includes(Qn.Y)&&(R.y=0),h.globalPos=h.globalPos.add(R),h.limitDegreeOfFreedom.includes(Qn.Rotation)||(h.rotation-=g.aToContact.cross(U)*h.inverseInertia)}if(u.collisionType===_t.Active){const R=U.scale(u.inverseMass);u.limitDegreeOfFreedom.includes(Qn.X)&&(R.x=0),u.limitDegreeOfFreedom.includes(Qn.Y)&&(R.y=0),u.globalPos=u.globalPos.add(R),u.limitDegreeOfFreedom.includes(Qn.Rotation)||(u.rotation+=g.bToContact.cross(U)*u.inverseInertia)}}}}}solveVelocity(t){var e;for(let s=0;s<this.config.velocityIterations;s++)for(let r=0;r<t.length;r++){const l=t[r],h=l.bodyA,u=l.bodyB;if(h&&u){if(h.collisionType===_t.Passive||u.collisionType===_t.Passive)continue;const f=Math.min(h.friction,u.friction),g=(e=this.idToContactConstraint.get(l.id))!=null?e:[];for(const _ of g){let x=-_.getRelativeVelocity().dot(l.tangent)*_.tangentMass;const D=f*_.normalImpulse,S=Pt(_.tangentImpulse+x,-D,D);x=S-_.tangentImpulse,_.tangentImpulse=S;const U=l.tangent.scale(x);h.applyImpulse(_.point,U.negate()),u.applyImpulse(_.point,U)}for(const _ of g){const A=_.getRelativeVelocity().dot(l.normal);let x=-_.normalMass*(A-_.originalVelocityAndRestitution);const D=Math.max(_.normalImpulse+x,0);x=D-_.normalImpulse,_.normalImpulse=D;const S=l.normal.scale(x);h.applyImpulse(_.point,S.negate()),u.applyImpulse(_.point,S)}}}}}class Af extends Vi{constructor(t,e){super(),this.world=t,this.physics=e,this.systemType=Qi.Update,this._physicsConfigDirty=!1,e.$configUpdate.subscribe(()=>this._physicsConfigDirty=!0),this.query=this.world.query([at,qt])}update(t){let e,s;const r=this.query.entities,l=this.physics.config.substep;for(let h=0;h<r.length;h++){e=r[h].get(at),s=r[h].get(qt);const u=r[h].get(Kt);if(this._physicsConfigDirty&&u&&u.updatePhysicsConfig(this.physics.config.bodies),u!=null&&u.isSleeping)continue;const f=s.acc.clone();(u==null?void 0:u.collisionType)===_t.Active&&(u!=null&&u.useGravity)&&f.addEqual(this.physics.config.gravity),r[h].parent||this.captureOldTransformWithChildren(r[h]),Cy.integrate(e,s,f,t/l)}this._physicsConfigDirty=!1}captureOldTransformWithChildren(t){var e;(e=t.get(Kt))==null||e.captureOldTransform();for(let s=0;s<t.children.length;s++)this.captureOldTransformWithChildren(t.children[s])}}Af.priority=Ns.Higher;class vf extends Vi{constructor(t,e){super(),this._physics=e,this.systemType=Qi.Update,this._configDirty=!1,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._arcadeSolver=new a0(e.config.arcade),this._realisticSolver=new o0(e.config.realistic),this._physics.$configUpdate.subscribe(()=>this._configDirty=!0),this._trackCollider=s=>this._processor.track(s),this._untrackCollider=s=>this._processor.untrack(s),this.query=t.query([at,Be]),this.query.entityAdded$.subscribe(s=>{const r=s.get(Be);r.$colliderAdded.subscribe(this._trackCollider),r.$colliderRemoved.subscribe(this._untrackCollider);const l=r.get();l&&this._processor.track(l)}),this.query.entityRemoved$.subscribe(s=>{const r=s.get(Be),l=r.get();r&&l&&this._processor.untrack(l)}),this._motionSystem=t.get(Af)}get _processor(){return this._physics.collisionProcessor}initialize(t,e){this._engine=e.engine}update(t){var e,s,r,l;if(!this._physics.config.enabled)return;let h=[];for(let y=0;y<this.query.entities.length;y++){const x=this.query.entities[y].get(Be),D=x==null?void 0:x.get();if(x&&((e=x.owner)!=null&&e.isActive)&&D)if(x.update(),D instanceof Qe){const S=D.getColliders();D.compositeStrategy||(D.compositeStrategy=this._physics.config.colliders.compositeStrategy),h=h.concat(S)}else h.push(D)}this._processor.update(h,t);let u=this._processor.broadphase(h,t);this._currentFrameContacts.clear();let f=[];const g=this.getSolver(),_=this._physics.config.substep;for(let y=0;y<_;y++)if(y>0&&this._motionSystem.update(t),f.length&&(u=f.map(A=>new ti(A.colliderA,A.colliderB))),u.length){f=this._processor.narrowphase(u,(l=(r=(s=this._engine)==null?void 0:s.debug)==null?void 0:r.stats)==null?void 0:l.currFrame),f=g.solve(f);for(const A of f){if(A.isCanceled())continue;const x=A.id.indexOf("|");if(x>0){const D=A.id.substring(x+1);this._currentFrameContacts.set(D,A)}else this._currentFrameContacts.set(A.id,A)}}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts);for(const y of this.query.entities){const A=y.get(Be);A&&A.processColliderRemoval()}}postupdate(){ro.SeparationPool.done()}getSolver(){return this._configDirty&&(this._configDirty=!1,this._arcadeSolver=new a0(this._physics.config.arcade),this._realisticSolver=new o0(this._physics.config.realistic)),this._physics.config.solver===af.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t,0)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const s=e.colliderA,r=e.colliderB,l=Jt.fromDirection(e.mtv),h=Jt.getOpposite(l);s.events.emit("collisionstart",new bd(s,r,l,e)),s.events.emit("contactstart",new jm(s,r,l,e)),r.events.emit("collisionstart",new bd(r,s,h,e)),r.events.emit("contactstart",new jm(r,s,h,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const s=e.colliderA,r=e.colliderB,l=Jt.fromDirection(e.mtv),h=Jt.getOpposite(l);s.events.emit("collisionend",new wd(s,r,l,e)),s.events.emit("contactend",new qm(s,r,l,e)),r.events.emit("collisionend",new wd(r,s,h,e)),r.events.emit("contactend",new qm(r,s,h,e))}}}vf.priority=Ns.Higher;class YC{constructor(t){this.$configUpdate=new di,this._configDirty=!1,this.config=t,this.$configUpdate.subscribe(e=>{this._configDirty=!0,Kt.updateDefaultPhysicsConfig(e.bodies)}),this._config.spatialPartition===fc.SparseHashGrid?this._collisionProcessor=new r0(this._config.sparseHashGrid):this._collisionProcessor=new Ed(this._config)}get config(){return bw(this._config,t=>{this.$configUpdate.notifyAll(t)})}set config(t){this._config=t,this.$configUpdate.notifyAll(t)}get collisionProcessor(){if(this._configDirty){this._configDirty=!1;const t=this._collisionProcessor.getColliders();this._config.spatialPartition===fc.SparseHashGrid?this._collisionProcessor=new r0(this._config.sparseHashGrid):this._collisionProcessor=new Ed(this._config);for(const e of t)this._collisionProcessor.track(e)}return this._collisionProcessor}rayCast(t,e){return this.collisionProcessor.rayCast(t,e)}query(t){return this._collisionProcessor.query(t)}}var co=(o=>(o.Fixed="Fixed",o.FitContainerAndFill="FitContainerAndFill",o.FitScreenAndFill="FitScreenAndFill",o.FitContainerAndZoom="FitContainerAndZoom",o.FitScreenAndZoom="FitScreenAndZoom",o.FitScreen="FitScreen",o.FillScreen="FillScreen",o.FitContainer="FitContainer",o.FillContainer="FillContainer",o))(co||{});class l0{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class c0{constructor(t){this.events=new re,this._antialiasing=!0,this._canvasImageRendering="auto",this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullscreen=!1,this._isDisposed=!1,this._logger=yt.getInstance(),this._fullscreenChangeHandler=()=>{this._isDisposed||(this._isFullscreen=!this._isFullscreen,this._logger.debug("Fullscreen Change",this._isFullscreen),this.events.emit("fullscreen",{fullscreen:this.isFullscreen}))},this._pixelRatioChangeHandler=()=>{this._isDisposed||(this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport(),this.events.emit("pixelratio",{pixelRatio:this.pixelRatio}))},this._resizeHandler=()=>{if(this._isDisposed)return;const h=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(h),this.applyResolutionAndViewport(),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._contentArea=new Tt,this._unsafeArea=new Tt;var e,s,r,l;this.viewport=t.viewport,this.resolution=(e=t.resolution)!=null?e:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(s=t.displayMode)!=null?s:"Fixed",this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(r=t.antialiasing)!=null?r:this._antialiasing,this._canvasImageRendering=(l=t.canvasImageRendering)!=null?l:this._canvasImageRendering,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this.events.clear(),this._browser.window.off("resize",this._resizeHandler),this._browser.window.clear(),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler),this._canvas=null)}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get worldToPagePixelRatio(){if(this._canvas){const t=this.worldToPageCoordinates(B.Zero);return this.worldToPageCoordinates(L(1,0)).sub(t).x}else return 1}get pixelRatioOverride(){return this._pixelRatioOverride}set pixelRatioOverride(t){this._pixelRatioOverride=t}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case"FillContainer":case"FitContainer":case"FitContainerAndFill":case"FitContainerAndZoom":return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this._resolutionStack.length&&this._viewportStack.length&&(this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop())}applyResolutionAndViewport(){if(this.graphicsContext instanceof Ls&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&(this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`),!this.pixelRatioOverride)){let r=Math.max(1,this.pixelRatio-.5),l=!1;for(;r>1&&!l;){r=Math.max(1,r-.5);const h=this._resolution.width*r,u=this._resolution.height*r;l=this.graphicsContext.checkIfResolutionSupported({width:h,height:u})}this.pixelRatioOverride=r,this._logger.warnOnce(`Scaled resolution too big attempted recovery! Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit. Setting \`ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.\`  (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)}this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvasImageRendering==="auto"?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges"));const t=this.viewport.widthUnit==="percent"?"%":"px",e=this.viewport.heightUnit==="percent"?"%":"px";this._canvas.style.width=this.viewport.width+t,this._canvas.style.height=this.viewport.height+e,this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof Bd&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio),document.documentElement.style.setProperty("--ex-pixel-ratio",this.worldToPagePixelRatio.toString())}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullscreen}get isFullscreen(){return this._isFullscreen}goFullScreen(t){return this.enterFullscreen(t)}enterFullscreen(t){var e,s,r,l,h,u;if(t){const f=document.getElementById(t);if(f!=null&&f.requestFullscreen||f!=null&&f.webkitRequestFullscreen){if(f.getAttribute("ex-fullscreen-listener")||(f.setAttribute("ex-fullscreen-listener","true"),f.addEventListener("fullscreenchange",this._fullscreenChangeHandler)),f.requestFullscreen)return(e=f.requestFullscreen())!=null?e:Promise.resolve();if(f.webkitRequestFullscreen)return(s=f.webkitRequestFullscreen())!=null?s:Promise.resolve()}}return(r=this._canvas)!=null&&r.requestFullscreen?(h=(l=this._canvas)==null?void 0:l.requestFullscreen())!=null?h:Promise.resolve():this._canvas.webkitRequestFullscreen?(u=this._canvas.webkitRequestFullscreen())!=null?u:Promise.resolve():(this._logger.warnOnce("Could not go fullscreen, is this an iPhone? Currently Apple does not support fullscreen on iPhones"),Promise.resolve())}exitFullScreen(){return this.exitFullscreen()}exitFullscreen(){return document.exitFullscreen()}_viewportToPixels(t){return{width:t.widthUnit==="percent"?this.canvas.offsetWidth:t.width,height:t.heightUnit==="percent"?this.canvas.offsetHeight:t.height}}pageToScreenCoordinates(t){let e=t.x,s=t.y;this._isFullscreen||(e-=jl(this._canvas).x,s-=jl(this._canvas).y);const r=this._viewportToPixels(this.viewport);if(this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const l=window.innerWidth/this.aspectRatio,h=(window.innerHeight-l)/2;s=(s-h)/l*r.height,e=e/window.innerWidth*r.width}else{const l=window.innerHeight*this.aspectRatio,h=(window.innerWidth-l)/2;e=(e-h)/l*r.width,s=s/window.innerHeight*r.height}return e=e/r.width*this.resolution.width,s=s/r.height*this.resolution.height,e=e-this.contentArea.left,s=s-this.contentArea.top,new B(e,s)}screenToPageCoordinates(t){let e=t.x,s=t.y;const r=this._viewportToPixels(this.viewport);if(e=e/this.resolution.width*r.width,s=s/this.resolution.height*r.height,this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const l=window.innerWidth/this.aspectRatio,h=(window.innerHeight-l)/2;s=s/r.height*l+h,e=e/r.width*window.innerWidth}else{const l=window.innerHeight*this.aspectRatio,h=(window.innerWidth-l)/2;e=e/r.width*l+h,s=s/r.height*window.innerHeight}return this._isFullscreen||(e+=jl(this._canvas).x,s+=jl(this._canvas).y),new B(e,s)}screenToWorldCoordinates(t){return t=t.add(L(this.contentArea.left,this.contentArea.top)),this._camera?this._camera.inverse.multiply(t):t.sub(L(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(L(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){return Tt.fromDimension(this.resolution.width,this.resolution.height,B.Half).scale(L(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.drawPos)}getScreenBounds(){return Tt.fromDimension(this.resolution.width,this.resolution.height,B.Zero,B.Zero)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get width(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get height(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return L(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}get unsafeArea(){return this._unsafeArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,s=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,s=window.innerWidth/t):(e=window.innerHeight*t,s=window.innerHeight),this.viewport={width:e,height:s},this._contentArea=Tt.fromDimension(this.resolution.width,this.resolution.height,B.Zero),this._unsafeArea=Tt.fromDimension(this.resolution.width,this.resolution.height,B.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndFill(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndFill(){this.canvas.style.width="100%",this.canvas.style.height="100%",this._computeFitAndFill(this.canvas.offsetWidth,this.canvas.offsetHeight,{width:100,widthUnit:"percent",height:100,heightUnit:"percent"}),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndFill(t,e,s){if(this.viewport=s??{width:t,height:e},t/e<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*e/t};const r=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new Tt({top:r,left:0,right:this._contentResolution.width,bottom:this.resolution.height-r}),this._unsafeArea=new Tt({top:-r,left:0,right:this._contentResolution.width,bottom:this.resolution.height+r})}else{this.resolution={width:e*this._contentResolution.height/e*t/e,height:e*this._contentResolution.height/e};const r=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new Tt({top:0,left:r,right:this.resolution.width-r,bottom:this._contentResolution.height}),this._unsafeArea=new Tt({top:0,left:-r,right:this.resolution.width+r,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndZoom(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndZoom(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="relative";const t=this.canvas.parentElement;t.style.overflow="hidden";const{offsetWidth:e,offsetHeight:s}=this.canvas;this._computeFitAndZoom(e,s),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndZoom(t,e){const s=this.aspectRatio;let r=0,l=0;t/s<e?(r=t,l=t/s):(r=e*s,l=e);const h=t/r,u=e/l,f=Math.max(h,u),g=r*f,_=l*f;g>t?this.canvas.style.left=-(g-t)/2+"px":this.canvas.style.left="",_>e?this.canvas.style.top=-(_-e)/2+"px":this.canvas.style.top="",this.viewport={width:g,height:_};const y=Tt.fromDimension(this.viewport.width,this.viewport.height,B.Zero);if(this.viewport.width>t){const A=(this.viewport.width-t)/this.viewport.width*this.resolution.width;y.top=0,y.left=A/2,y.right=this.resolution.width-A/2,y.bottom=this.resolution.height}if(this.viewport.height>e){const A=(this.viewport.height-e)/this.viewport.height*this.resolution.height;y.top=A/2,y.left=0,y.bottom=this.resolution.height-A/2,y.right=this.resolution.width}this._contentArea=y}_computeFitContainer(){const t=this.aspectRatio;let e=0,s=0,r="pixel",l="pixel";const h=this.canvas.parentElement;h.clientWidth/t<h.clientHeight?(this.canvas.style.width="100%",e=100,r="percent",s=this.canvas.offsetWidth/t):(this.canvas.style.height="100%",s=100,l="percent",e=this.canvas.offsetHeight*t),this.viewport={width:e,widthUnit:r,height:s,heightUnit:l},this._contentArea=Tt.fromDimension(this.resolution.width,this.resolution.height,B.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode==="FillContainer"&&(this.canvas.style.width="100%",this.canvas.style.height="100%",this.viewport={width:100,widthUnit:"percent",height:100,heightUnit:"percent"},this.resolution={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight}),this.displayMode==="FillScreen"&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=Tt.fromDimension(this.resolution.width,this.resolution.height,B.Zero),this.displayMode==="FitScreen"&&this._computeFit(),this.displayMode==="FitContainer"&&this._computeFitContainer(),this.displayMode==="FitScreenAndFill"&&this._computeFitScreenAndFill(),this.displayMode==="FitContainerAndFill"&&this._computeFitContainerAndFill(),this.displayMode==="FitScreenAndZoom"&&this._computeFitScreenAndZoom(),this.displayMode==="FitContainerAndZoom"&&this._computeFitContainerAndZoom()}}class gc{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}function jC(o){return!!o.playbackState}const By=class ec{static unlock(){return new Promise((e,s)=>{if(ec._UNLOCKED||!gc.create())return e(!0);const r=setTimeout(()=>{yt.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e(!1)},200),l=gc.create();l.resume().then(()=>{const h=l.createBuffer(1,1,22050),u=l.createBufferSource();let f=!1;u.buffer=h,u.connect(l.destination),u.onended=()=>f=!0,u.start(0),setTimeout(()=>{jC(u)?(u.playbackState===u.PLAYING_STATE||u.playbackState===u.FINISHED_STATE)&&(ec._UNLOCKED=!0):(l.currentTime>0||f)&&(ec._UNLOCKED=!0)},0),clearTimeout(r),e(!0)},()=>{s()})})}static isUnlocked(){return this._UNLOCKED}};By._UNLOCKED=!1;let qC=By;class Iy{}Iy.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class xf{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,e){const s=new xf;s.data=e;for(const r in t.states)s.states.set(r,{name:r,...t.states[r]});for(const r of s.states.values())for(const l of r.transitions)if(l!=="*"&&!s.states.has(l))throw Error(`Invalid state machine, state [${r.name}] has a transition to another state that doesn't exist [${l}]`);return s.currentState=s.startState=s.states.get(t.start),s}in(t){return this.currentState.name===t}go(t,e){var s,r;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const l=this.states.get(t);return this.currentState.onExit&&((s=this.currentState)==null?void 0:s.onExit({to:l.name,data:this.data}))===!1||l!=null&&l.onEnter&&(l==null?void 0:l.onEnter({from:this.currentState.name,eventData:e,data:this.data}))===!1?!1:(this.currentState=l,(r=this.currentState)!=null&&r.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const e=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(e.currentState),this.data=e.data}}class XC{constructor(t){this._src=t,this._audioContext=gc.create(),this._volumeNode=this._audioContext.createGain(),this._playingFuture=new xn,this._stateMachine=xf.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:e})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,e.pausedAt*this._playbackRate):this._instance.start(0,e.pausedAt*this._playbackRate,this.duration),e.startedAt=this._audioContext.currentTime-e.pausedAt,e.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:e})=>{e==="STOPPED"&&this._playingFuture.resolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:e,data:s})=>{s.pausedAt=(e??0)/this._playbackRate,s.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:e})=>{e.pausedAt=0,e.startedAt=0,this._playingFuture.resolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:e})=>{e.pausedAt=this._audioContext.currentTime-e.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)}))}get loop(){return this._loop}set volume(t){t=Pt(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!=null?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}isStopped(){return this._stateMachine.in("STOPPED")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingFuture.promise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:e}=this._stateMachine.data;return t?t*this._playbackRate:e?(this._audioContext.currentTime-e)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}class ky extends Dt{constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Qr extends ky{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class ZC extends ky{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}function WC(o){try{const t=new Audio,e=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,s=o.match(e)[1];return!!t.canPlayType("audio/"+s)}catch(t){return yt.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}function JC(o){var t;return!!((t=o[0])!=null&&t.paths)}class kd{constructor(...t){this.events=new re,this.logger=yt.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=gc.create();let e;JC(t)?e=t[0]:e={paths:t},this._resource=new _y("",Iy.type.arraybuffer);const{volume:s,position:r,playbackRate:l,loop:h,bustCache:u,duration:f}=e;this.volume=s??this.volume,this.playbackRate=l??this.playbackRate,this.loop=h??this.loop,this.duration=f??this.duration,this.bustCache=u??this.bustCache,this.position=r??this.position;for(const g of e.paths)if(WC(g)){this.path=g;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",e.paths.join(", ")),this.logger.warn("Attempting to use",e.paths[0]),this.path=e.paths[0])}set loop(t){this._loop=t;for(const e of this._tracks)e.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const e of this._tracks)e.volume=this._volume;this.events.emit("volumechange",new Qr(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}isLoaded(){return!!this.data}async load(){var t,e;if(this.data)return this.data;const s=await this._resource.load(),r=await this.decodeAudio(s.slice(0));return this._duration=(e=(t=this._duration)!=null?t:r==null?void 0:r.duration)!=null?e:void 0,this.events.emit("processed",new ZC(this,r)),this.data=r}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}isStopped(){return this._tracks.some(t=>t.isStopped())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t??this.volume,this.isPaused()?this._resumePlayback():(this.position&&this.seek(this.position),this._startPlayback())):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.events.emit("pause",new Qr(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.events.emit("stop",new Qr(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(e=>{e.playbackRate=this._playbackRate})}seek(t,e=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[e].seek(t)}getTotalPlaybackDuration(){return this.isLoaded()?this.data.duration:(this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`),0)}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused()){const t=[];for(const e of this._tracks)t.push(e.play().then(()=>(this._tracks.splice(this.getTrackId(e),1),!0)));this.events.emit("resume",new Qr(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=this._getTrackInstance(this.data),e=await t.play(()=>{this.events.emit("playbackstart",new Qr(this,t)),this.logger.debug("Playing new instance for sound",this.path)});this.events.emit("playbackend",new Qr(this,t));const s=this.getTrackId(t);return s!==-1&&this._tracks.splice(s,1),e}_getTrackInstance(t){var e;const s=new XC(t);return s.loop=this.loop,s.volume=this.volume,s.duration=(e=this.duration)!=null?e:0,s.playbackRate=this._playbackRate,this._tracks.push(s),s}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}function h0(o){var t,e;return!!(o!=null&&o.prototype)&&!!((e=(t=o==null?void 0:o.prototype)==null?void 0:t.constructor)!=null&&e.name)}class _c{constructor(t){this.events=new re,this.canvas=new df({filtering:gi.Blended,smoothing:!0,cache:!1,draw:this.onDraw.bind(this)}),this._resources=[],this._numLoaded=0,this._totalTimeMs=0,this._loadingFuture=new xn;var e;t&&((e=t.loadables)!=null&&e.length)&&this.addResources(t.loadables)}get resources(){return this._resources}onInitialize(t){this.engine=t,this.canvas.width=this.engine.screen.resolution.width,this.canvas.height=this.engine.screen.resolution.height}async onUserAction(){return await Promise.resolve()}async onBeforeLoad(){}async onAfterLoad(){await Cd(500,this.engine.clock)}addResource(t){this._resources.push(t)}addResources(t){let e=0;const s=t.length;for(e;e<s;e++)this.addResource(t[e])}markResourceComplete(){this._numLoaded++}get progress(){const t=this._resources.length;return t>0?Pt(this._numLoaded,0,t)/t:1}isLoaded(){return this._numLoaded===this._resources.length}onUpdate(t,e){this._totalTimeMs+=e}onDraw(t){const e=this._totalTimeMs/1e3;t.fillStyle=tt.Black.toRGBA(),t.fillRect(0,0,this.engine.screen.resolution.width,this.engine.screen.resolution.height),t.save(),t.translate(this.engine.screen.resolution.width/2,this.engine.screen.resolution.height/2);const s=e*10;t.strokeStyle="white",t.lineWidth=10,t.lineCap="round",t.arc(0,0,40,s,s+Math.PI*3/2),t.stroke(),t.fillStyle="white",t.font="16px sans-serif";const r=(this.progress*100).toFixed(0)+"%",l=t.measureText(r),h=Math.abs(l.actualBoundingBoxLeft)+Math.abs(l.actualBoundingBoxRight),u=Math.abs(l.actualBoundingBoxAscent)+Math.abs(l.actualBoundingBoxDescent);t.fillText(r,-h/2,u/2),t.restore()}areResourcesLoaded(){return this._resources.length===0?Promise.resolve():this._loadingFuture.promise}async load(){await this.onBeforeLoad(),this.events.emit("beforeload"),this.canvas.flagDirty(),await Promise.all(this._resources.map(async t=>{this.events.emit("loadresourcestart",t),await t.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty(),this.events.emit("loadresourceend",t)})}));for(const t of this._resources)t instanceof kd&&t.wireEngine(this.engine);return this._loadingFuture.resolve(),this.canvas.flagDirty(),await this.onUserAction(),this.events.emit("useraction"),await qC.unlock(),await this.onAfterLoad(),this.events.emit("afterload"),this.data=this._resources}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}const KC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",$C=`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition:
    background 250ms ease-in-out,
    transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,zy=class Oy extends _c{constructor(t){const e=Array.isArray(t)?{loadables:t}:t;super(e),this._logger=yt.getInstance(),this._originalOptions={loadables:[]},this.events=new re,this._playButtonShown=!1,this.logo=KC,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=tt.White,this.backgroundColor="#176BAA",this._imageLoaded=new xn,this.suppressPlayButton=!1,this._playButtonStyles=$C,this.playButtonText="Play game",this.startButtonFactory=()=>{let s=document.getElementById("excalibur-play");return s||(s=document.createElement("button")),s.id="excalibur-play",s.textContent=this.playButtonText,s.style.display="none",s},this._originalOptions={...Oy._DEFAULT_LOADER_OPTIONS,...e}}get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.onload=()=>this._imageLoaded.resolve(),this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}onInitialize(t){this.engine=t,this.screen=t.screen,this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height,this.screen.events.on("resize",()=>{this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height})}async showPlayButton(){var t,e;if(this.suppressPlayButton)this.hidePlayButton(),await Cd(500,(t=this.engine)==null?void 0:t.clock);else{const s=()=>{try{this._positionPlayButton()}catch{}};return(e=this.engine)!=null&&e.browser&&this.engine.browser.window.on("resize",s),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",l=>{l.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(l=>{const h=u=>{var f;if(u.stopPropagation(),this.hidePlayButton(),(f=this.engine)!=null&&f.browser&&this.engine.browser.window.off("resize",s),this._originalOptions.fullscreenAfterLoad)try{this._logger.info("requesting fullscreen"),this._originalOptions.fullscreenContainer instanceof HTMLElement?this._originalOptions.fullscreenContainer.requestFullscreen():this.engine.screen.enterFullscreen(this._originalOptions.fullscreenContainer)}catch(g){this._logger.error("could not go fullscreen",g)}l()};this._playButton.addEventListener("click",h),this._playButton.addEventListener("touchend",h),this._playButton.addEventListener("pointerup",h),this.engine&&this.engine.input.gamepads.once("button",()=>h(new Event("button")))})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}async onUserAction(){var t;await Cd(200,(t=this.engine)==null?void 0:t.clock),this.canvas.flagDirty(),await this.showPlayButton()}async onBeforeLoad(){this.screen.pushResolutionAndViewport(),this.screen.resolution={width:this.canvas.width,height:this.canvas.height},this.screen.applyResolutionAndViewport();const t=this._image;await this._imageLoaded.promise,await(t==null?void 0:t.decode())}async onAfterLoad(){this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.dispose()}_positionPlayButton(){if(this.engine){const{x:t,y:e,width:s,height:r}=this.engine.canvas.getBoundingClientRect();if(this._playButtonRootElement){const l=this._playButton.clientWidth,h=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${t+s/2-l/2}px`,this._playButtonRootElement.style.top=`${e+r/2-h/2+100}px`)}}}onDraw(t){const e=this.engine.canvasHeight/this.engine.pixelRatio,s=this.engine.canvasWidth/this.engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,s,e);let r=e/2;const l=Math.min(this.logoWidth,s*.75);let h=s/2-l/2;this.logoPosition&&(h=this.logoPosition.x,r=this.logoPosition.y);const u=Math.floor(l*(this.logoHeight/this.logoWidth)),f=this.engine.screen.antialiasing;if(this.engine.screen.antialiasing=!0,this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,h,r,l,u):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,h,r-u-20,l,u),!this.suppressPlayButton&&this._playButtonShown){this.engine.screen.antialiasing=f;return}let g=h,_=r;this.loadingBarPosition&&(g=this.loadingBarPosition.x,_=this.loadingBarPosition.y),t.lineWidth=2,Km(t,g,_,l,20,10,this.loadingBarColor);const y=l*this.progress,A=5,x=y-A*2,D=20-A*2;Km(t,g+A,_+A,x>10?x:10,D,5,null,this.loadingBarColor),this.engine.screen.antialiasing=f}};zy._DEFAULT_LOADER_OPTIONS={loadables:[],fullscreenAfterLoad:!1,fullscreenContainer:void 0};let mc=zy;const u0={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class tS{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],s=this.getBrowserFeatures();for(const r of Object.keys(u0))s[r]?(t+="(%c%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+u0[r]+`
`;e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:this._criticalTests.canvasSupport(),arraybuffer:this._criticalTests.arrayBufferSupport(),dataurl:this._criticalTests.dataUrlSupport(),objecturl:this._criticalTests.objectUrlSupport(),rgba:this._criticalTests.rgbaSupport(),webaudio:this._warningTest.webAudioSupport(),webgl:this._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),yt.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const e in this._warningTest)this._warningTest[e]()||yt.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",e);return!0}}function eS(o){return o instanceof Uy}class Uy extends Gi{constructor(t){var e,s;super({...t}),this.get(at).coordPlane=pi.Screen,this.anchor=(e=t==null?void 0:t.anchor)!=null?e:L(0,0),this.body.collisionType=(s=t==null?void 0:t.collisionType)!=null?s:_t.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!(t!=null&&t.collider)&&(t==null?void 0:t.width)>0&&(t==null?void 0:t.height)>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,s=!0){if(s)return super.contains(t,e);const r=this._engine.worldToScreenCoordinates(new B(t,e));return super.contains(r.x,r.y)}}const Ly=class Fy{constructor(t){this._logger=yt.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null;var e;const s=(e=t.action)!=null?e:t.fcn,r=t.interval,l=t.repeats,h=t.numberOfRepeats,u=t.randomRange,f=t.random;if(h&&h>=0&&(this.maxNumberOfRepeats=h,!l))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=Fy._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=r,u){if(u[0]>u[1])throw new Error("min value must be lower than max value for range");this.random=f??new q0,this.randomRange=u,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=l||this.repeats,s&&this.on(s)}get complete(){return this._complete}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(e=>{e.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,e){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}};Ly._MAX_ID=0;let hd=Ly;function d0(o){return o&&o._dispatchPointerEvents&&o._processPointerToObject}class iS{get events(){return this.object.events}init(t,e,s){this.object=t,this.contains=e,this.active=s}}class Ny{constructor(){this._proxyPool=new Rc(()=>new iS,t=>t,100),this._objectToProxy=new Map,this._proxies=[],this._lastFrameObjectToPointers=new Map,this._currentFrameObjectToPointers=new Map}addObject(t,e,s){const r=this._proxyPool.rent(!1);r.init(t,e,s),this._proxies.push(r),this._objectToProxy.set(t,r)}_getProxy(t){const e=this._objectToProxy.get(t);if(e)return e;throw new Error("No PointerTargetProxy for object")}removeObject(t){const e=this._objectToProxy.get(t);if(e){const s=this._proxies.indexOf(e);this._objectToProxy.delete(t),s>-1&&this._proxies.splice(s,1),this._proxyPool.return(e)}}_objectCurrentlyUnderPointer(t,e){return!!(this._currentFrameObjectToPointers.has(t)&&this._currentFrameObjectToPointers.get(t).includes(e))}_objectWasUnderPointer(t,e){return!!(this._lastFrameObjectToPointers.has(t)&&this._lastFrameObjectToPointers.get(t).includes(e))}_entered(t,e){return this._objectCurrentlyUnderPointer(t,e)&&!this._lastFrameObjectToPointers.has(t)}_left(t,e){return!this._currentFrameObjectToPointers.has(t)&&this._objectWasUnderPointer(t,e)}addPointerToObject(t,e){const s=this._objectToProxy.get(t);s&&this._addPointerToProxy(s,e)}_addPointerToProxy(t,e){if(!this._currentFrameObjectToPointers.has(t)){this._currentFrameObjectToPointers.set(t,[e]);return}const s=this._currentFrameObjectToPointers.get(t);this._currentFrameObjectToPointers.set(t,s.concat(e))}dispatchEvents(t,e){const s=new Set(this._lastFrameObjectToPointers.keys()),r=new Set(this._currentFrameObjectToPointers.keys());let l,h,u;for(let f=0;f<e.length;f++){const g=e[f],_=this._getProxy(g);if(d0(g)&&g._dispatchPointerEvents(t),s.has(_)||r.has(_)){u=this._processDownAndEmit(t,_),h=this._processUpAndEmit(t,_),l=this._processMoveAndEmit(t,_);const y=[...l.values(),...u.values(),...h.values()];this._processEnterLeaveAndEmit(t,_,y),this._processCancelAndEmit(t,_),this._processWheelAndEmit(t,_)}}}processPointerToObject(t,e){for(let s=0;s<e.length;s++){const r=e[s],l=this._getProxy(r);d0(r)&&r._processPointerToObject(t);for(const[h,u]of t.currentFramePointerCoords.entries())l.contains(u)&&this._addPointerToProxy(l,h)}}clear(){this._lastFrameObjectToPointers.clear(),this._lastFrameObjectToPointers=new Map(this._currentFrameObjectToPointers),this._currentFrameObjectToPointers.clear()}_processDownAndEmit(t,e){const s=new Map;for(const r of t.currentFrameDown)r.active&&this._objectCurrentlyUnderPointer(e,r.pointerId)&&(e.events.emit("pointerdown",r),t.isDragStart(r.pointerId)&&e.events.emit("pointerdragstart",r)),s.set(r.pointerId,r);return s}_processUpAndEmit(t,e){const s=new Map;for(const r of t.currentFrameUp)r.active&&this._objectCurrentlyUnderPointer(e,r.pointerId)&&(e.events.emit("pointerup",r),t.isDragEnd(r.pointerId)&&e.events.emit("pointerdragend",r)),s.set(r.pointerId,r);return s}_processMoveAndEmit(t,e){const s=new Map;for(const r of t.currentFrameMove)r.active&&e.active()&&this._objectCurrentlyUnderPointer(e,r.pointerId)&&(e.events.emit("pointermove",r),t.isDragging(r.pointerId)&&e.events.emit("pointerdragmove",r)),s.set(r.pointerId,r);return s}_processEnterLeaveAndEmit(t,e,s){for(const r of s){if(r.active&&e.active()&&this._entered(e,r.pointerId)){e.events.emit("pointerenter",r),t.isDragging(r.pointerId)&&e.events.emit("pointerdragenter",r);break}if(r.active&&e.active()&&(this._left(e,r.pointerId)||this._objectCurrentlyUnderPointer(e,r.pointerId)&&r.type==="up")){e.events.emit("pointerleave",r),t.isDragging(r.pointerId)&&e.events.emit("pointerdragleave",r);break}}}_processCancelAndEmit(t,e){for(const s of t.currentFrameCancel)s.active&&e.active()&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&e.events.emit("pointercancel",s)}_processWheelAndEmit(t,e){for(const s of t.currentFrameWheel)s.active&&e.active()&&this._objectCurrentlyUnderPointer(e,0)&&e.events.emit("pointerwheel",s)}}class sS extends Fs{constructor(t){var e,s,r;super([],t.name),this.events=new re,this._token=0,this.logger=yt.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this.meshingLookBehind=10,this._collidersDirty=!0,this._oldRotation=0,this._originalOffsets=new WeakMap,this.meshingLookBehind=(e=t.meshingLookBehind)!=null?e:this.meshingLookBehind,this.addComponent(new at),this.addComponent(new qt),this.addComponent(new Kt({type:_t.Fixed})),this.addComponent(new Ve({onPostDraw:(h,u)=>this.draw(h,u)})),this.addComponent(new yy((h,u)=>this.debug(h,u),!1)),this.addComponent(new Be),this.addComponent(new mo),this.pointer=this.get(mo),this._graphics=this.get(Ve),this.transform=this.get(at),this._motion=this.get(qt),this.collider=this.get(Be),this._composite=this.collider.useCompositeCollider([]),this.transform.pos=(s=t.pos)!=null?s:B.Zero,this._oldPos=this.transform.pos.clone(),this._oldScale=this.transform.scale.clone(),this.renderFromTopOfGraphic=(r=t.renderFromTopOfGraphic)!=null?r:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this._pointerEventDispatcher=new Ny,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let l=[];for(let h=0;h<this.columns;h++){for(let u=0;u<this.rows;u++){const f=new nS({x:h,y:u,map:this});f.map=this,this.tiles[h+u*this.columns]=f,this._pointerEventDispatcher.addObject(f,g=>f.bounds.contains(g.worldPos),()=>!0),l.push(f),this._rows[u]||(this._rows[u]=[]),this._rows[u].push(f)}this._cols[h]=l,l=[]}this._graphics.localBounds=new Tt({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let t=0;t<this.tiles.length;t++)this.tiles[t]&&this.tiles[t].flagDirty()}get x(){var t;return(t=this.transform.pos.x)!=null?t:0}set x(t){var e;(e=this.transform)!=null&&e.pos&&(this.get(at).pos=L(t,this.y))}get y(){var t,e;return(e=(t=this.transform)==null?void 0:t.pos.y)!=null?e:0}set y(t){var e;(e=this.transform)!=null&&e.pos&&(this.transform.pos=L(this.x,t))}get z(){var t;return(t=this.transform.z)!=null?t:0}set z(t){this.transform&&(this.transform.z=t)}get rotation(){var t,e;return(e=(t=this.transform)==null?void 0:t.rotation)!=null?e:0}set rotation(t){this.transform&&(t!==this.transform.rotation&&(this.flagCollidersDirty(),this.flagTilesDirty()),this.transform.rotation=t)}get scale(){var t,e;return(e=(t=this.transform)==null?void 0:t.scale)!=null?e:B.One}set scale(t){this.transform&&(t!=null&&t.equals(this.transform.scale)||(this.flagCollidersDirty(),this.flagTilesDirty()),this.transform.scale=t)}get pos(){return this.transform.pos}set pos(t){this.transform&&(t!=null&&t.equals(this.transform.pos)||(this.flagCollidersDirty(),this.flagTilesDirty()),this.transform.pos=t)}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}get width(){return this.tileWidth*this.columns*this.scale.x}get height(){return this.tileHeight*this.rows*this.scale.y}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_initialize(t){super._initialize(t),this._engine=t}_getOrSetColliderOriginalOffset(t){var e;if(this._originalOffsets.has(t))return(e=this._originalOffsets.get(t))!=null?e:B.Zero;{const s=t.offset;return this._originalOffsets.set(t,s),s}}_updateColliders(){this.collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const t=[];this._composite=this.collider.useCompositeCollider([]);let e=null;const s=(l,h)=>l&&h?l.top===h.top&&l.bottom===h.bottom&&l.right===h.left:!1,r=(l,h,u=this.meshingLookBehind)=>{if(!l)return!1;for(let f=h.length-1;f>=0;f--){if(u--<0)return!1;const g=h[f];if(s(g,l))return h[f]=g.combine(l),!0}return!1};for(let l=0;l<this.columns;l++){for(let h=0;h<this.rows;h++){const u=this.tiles[l+h*this.columns];if(u.solid)if(u.getColliders().length>0){for(const f of u.getColliders()){const g=this._getOrSetColliderOriginalOffset(f);f.offset=L(u.x*this.tileWidth*this.scale.x,u.y*this.tileHeight*this.scale.y).add(g),f.owner=this,this._composite.addCollider(f)}e&&!r(e,t)&&t.push(e),e=null}else e?e=e.combine(u.defaultGeometry):e=u.defaultGeometry;else e&&!r(e,t)&&t.push(e),e=null}e&&!r(e,t)&&t.push(e),e=null}for(const l of t){const h=Xe.Box(l.width,l.height,B.Zero,L(l.left-this.pos.x,l.top-this.pos.y));h.owner=this,this._composite.addCollider(h)}this.collider.update(),this.collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){var e;return(e=this.tiles[t])!=null?e:null}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const{x:e,y:s}=this._getTileCoordinates(t),r=this.getTile(e,s);return e>=0&&s>=0&&e<this.columns&&s<this.rows&&r?r:null}_getTileCoordinates(t){t=this.transform.applyInverse(t);const e=Math.floor(t.x/this.tileWidth),s=Math.floor(t.y/this.tileHeight);return{x:e,y:s}}getRows(){return this._rows}getColumns(){return this._cols}getOnScreenTiles(){const t=this._engine.screen.getWorldBounds();let e=L(0,0),s=this.transform.coordPlane===pi.Screen?this._engine.screen.getScreenBounds():t;const r=this.get(hf);if(r&&this.isInitialized){const D=B.One.sub(r.parallaxFactor);e=this._engine.currentScene.camera.pos.scale(D),s=s.translate(e.negate())}const l=this._getTileCoordinates(s.topLeft),h=this._getTileCoordinates(s.topRight),u=this._getTileCoordinates(s.bottomRight),f=this._getTileCoordinates(s.bottomLeft),g=Math.min(Pt(l.x,0,this.columns-1),Pt(h.x,0,this.columns-1)),_=Math.min(Pt(l.y,0,this.rows-1),Pt(h.y,0,this.rows-1)),y=Math.max(Pt(u.x,0,this.columns-1),Pt(f.x,0,this.columns-1)),A=Math.max(Pt(u.y,0,this.rows-1),Pt(f.y,0,this.rows-1)),x=[];for(let D=g;D<=y;D++)for(let S=_;S<=A;S++)x.push(this.getTile(D,S));return x}_processPointerToObject(t){this._pointerEventDispatcher.processPointerToObject(t,this.tiles)}_dispatchPointerEvents(t){this._pointerEventDispatcher.dispatchEvents(t,this.tiles)}update(t,e){this._initialize(t),this.onPreUpdate(t,e),this.emit("preupdate",new ea(t,e,this)),(!this._oldPos.equals(this.pos)||this._oldRotation!==this.rotation||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._pointerEventDispatcher.clear(),this._token++,this.pos.clone(this._oldPos),this._oldRotation=this.rotation,this.scale.clone(this._oldScale),this.transform.pos=this.pos,this.onPostUpdate(t,e),this.emit("postupdate",new ia(t,e,this))}draw(t,e){if(!this.isInitialized)return;this.emit("predraw",new wc(t,e,this));let s,r,l;const h=this.getOnScreenTiles();for(let u=0;u<h.length;u++){const f=h[u],g=f.getGraphicsOffsets();for(s=f.getGraphics(),r=0,l=s.length;r<l;r++){const _=s[r],y=g[r];if(_){Dy(_)&&(_==null||_.tick(e,this._token));const A=this.renderFromTopOfGraphic?0:_.height-this.tileHeight;_.draw(t,f.x*this.tileWidth+y.x,f.y*this.tileHeight-A+y.y)}}}this.emit("postdraw",new Cc(t,e,this))}debug(t,e){const{showAll:s,showGrid:r,gridColor:l,gridWidth:h,showSolidBounds:u,solidBoundsColor:f,showColliderGeometry:g}=e.tilemap,{geometryColor:_,geometryLineWidth:y,geometryPointSize:A}=e.collider,x=this.tileWidth*this.columns*this.scale.x,D=this.tileHeight*this.rows*this.scale.y,S=this.pos;if(r||s){for(let U=0;U<this.rows+1;U++){const R=L(0,U*this.tileHeight*this.scale.y);t.drawLine(S.add(R),S.add(L(x,R.y)),l,h)}for(let U=0;U<this.columns+1;U++){const R=L(U*this.tileWidth*this.scale.x,0);t.drawLine(S.add(R),S.add(L(R.x,D)),l,h)}}if(s||u||g){const U=this._composite.getColliders();t.save(),t.translate(this.pos.x,this.pos.y),t.scale(this.scale.x,this.scale.y);for(const R of U){const C=R.localBounds,O=R.worldPos.sub(this.pos);u&&t.drawRectangle(O,C.width,C.height,f)}if(t.restore(),g)for(const R of U)R.debug(t,_,{lineWidth:y,pointSize:A})}if(s||u){if(t.save(),t.z=999,u)for(let U=0;U<this.tiles.length;U++)this.tiles[U].bounds.draw(t);t.restore()}}}class nS{constructor(t){this._posDirty=!1,this.events=new re,this._solid=!1,this._graphics=[],this._offsets=[],this._colliders=[],this.data=new Map;var e,s;this.x=t.x,this.y=t.y,this.map=t.map,this._width=t.map.tileWidth*this.map.scale.x,this._height=t.map.tileHeight*this.map.scale.y,this.solid=(e=t.solid)!=null?e:this.solid,this._graphics=(s=t.graphics)!=null?s:[],this._recalculate()}get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(t){var e;(e=this.map)==null||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}getGraphicsOffsets(){return this._offsets}addGraphic(t,e){this._graphics.push(t),e!=null&&e.offset?this._offsets.push(e.offset):this._offsets.push(B.Zero)}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&(this._graphics.splice(e,1),this._offsets.splice(e,1))}clearGraphics(){this._graphics.length=0,this._offsets.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}flagDirty(){this._posDirty=!0}_recalculate(){const t=this.map.pos.add(L(this.x*this.map.tileWidth,this.y*this.map.tileHeight));this._geometry=new Tt(t.x,t.y,t.x+this.map.tileWidth,t.y+this.map.tileHeight),this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(L(this.x*this._width,this.y*this._height)),this._bounds=new Tt(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this.map.rotation&&(this._bounds=this._bounds.rotate(this.map.rotation,this.map.pos)),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get defaultGeometry(){return this._geometry}get center(){return this._posDirty&&this._recalculate(),new B(this._pos.x+this._width/2,this._pos.y+this._height/2)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}class f0 extends Ji{constructor(t){super(),this.elevation=0,this.columns=t.columns,this.rows=t.rows,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight}}class Hy extends Vi{constructor(t){super(),this.world=t,this.systemType=Qi.Update,this.query=this.world.query([at,f0])}update(){let t,e;for(let s=0;s<this.query.entities.length;s++){const r=this.query.entities[s];t=r.get(at),e=r.get(f0);const h=Math.max(e.columns*e.tileWidth,e.rows*e.tileHeight)*e.elevation+t.pos.y;t.z=h}}}Hy.priority=Ns.Lower;class rS{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new aS(t))}lockToActorAxis(t,e){this.camera.addStrategy(new oS(t,e))}elasticToActor(t,e,s){this.camera.addStrategy(new lS(t,e,s))}radiusAroundActor(t,e){this.camera.addStrategy(new cS(t,e))}limitCameraBounds(t){this.camera.addStrategy(new hS(t))}}class aS{constructor(t){this.target=t,this.action=(e,s,r,l)=>e.center}}class oS{constructor(t,e){this.target=t,this.axis=e,this.action=(s,r,l,h)=>{const u=s.center,f=r.getFocus();return this.axis===0?new B(u.x,f.y):new B(f.x,u.y)}}}class lS{constructor(t,e,s){this.target=t,this.cameraElasticity=e,this.cameraFriction=s,this.action=(r,l,h,u)=>{const f=r.center;let g=l.getFocus(),_=l.vel.clone();const y=f.sub(g).scale(this.cameraElasticity);_=_.add(y);const A=_.scale(-1).scale(this.cameraFriction);return _=_.add(A),g=g.add(_),g}}}class cS{constructor(t,e){this.target=t,this.radius=e,this.action=(s,r,l,h)=>{const u=s.center,f=r.getFocus(),g=u.sub(f),_=g.magnitude;if(_>=this.radius){const y=_-this.radius;return f.add(g.normalize().scale(y))}return f}}}class hS{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(e,s,r,l)=>{const h=s.getFocus();this.boundSizeChecked||((e.bottom-e.top<r.drawHeight||e.right-e.left<r.drawWidth)&&yt.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let u=h.x,f=h.y;return h.x<e.left+r.halfDrawWidth?u=e.left+r.halfDrawWidth:h.x>e.right-r.halfDrawWidth&&(u=e.right-r.halfDrawWidth),h.y<e.top+r.halfDrawHeight?f=e.top+r.halfDrawHeight:h.y>e.bottom-r.halfDrawHeight&&(f=e.bottom-r.halfDrawHeight),L(u,f)}}}class uS{constructor(){this.events=new re,this.transform=_e.identity(),this.inverse=_e.identity(),this._cameraStrategies=[],this.strategy=new rS(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=new yn(B.Zero,()=>{this._posChanged=!0}),this.drawPos=this.pos.clone(),this._oldPos=this.pos.clone(),this.vel=B.Zero,this.acc=B.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Os.EaseInOutCubic,this._easing=Os.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1,this._snapPos=L(0,0)}get strategies(){return this._cameraStrategies}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._posChanged=!0,this._pos=new yn(t,()=>{this._posChanged=!0})}hasChanged(){return this._posChanged}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=L(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=L(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=L(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=L(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=L(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=L(this.acc.x,t)}getFocus(){return this.pos}move(t,e,s=Os.EaseInOutCubic){if(typeof s!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(r=>{this._lerpResolve=r}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=s,this._lerpPromise)}shake(t,e,s){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=s}zoomOverTime(t,e=0,s=Os.EaseInOutCubic){if(this._zoomPromise=new Promise(r=>{this._zoomResolve=r}),e)this._isZooming=!0,this._zoomEasing=s,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new Tt(0,0,0,0)}addStrategy(...t){this._cameraStrategies.push(...t)}setStrategies(t){this._cameraStrategies=[...t]}removeStrategy(t){Co(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.events.emit("preupdate",new ea(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.events.emit("postupdate",new ia(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.contentArea;let s=L(e.width/2,e.height/2);if(!this._engine.loadingComplete){const r=this._screen.peekResolution();r&&(s=L(r.width/2,r.height/2))}this._halfWidth=s.x,this._halfHeight=s.y,this._posChanged||(this.pos=s),this.pos.clone(this.drawPos),this.updateTransform(this.pos),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(this.pos),this.pos.clone(this._oldPos),this.onInitialize(t),this.events.emit("initialize",new Sc(t,this)),this._isInitialized=!0}}onInitialize(t){}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}runStrategies(t,e){for(const s of this._cameraStrategies)this.pos=s.action.call(s,s.target,this,t,e)}updateViewport(){this._viewport=new Tt(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos.clone(this._oldPos),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const s=this._zoomEasing,r=s(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=r,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const r=Os.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=r,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const s=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(s)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(this.pos),this._postupdate(t,e),this._posChanged=!1}draw(t){if(this.pos.clone(this.drawPos),this._engine.fixedUpdateTimestep){const e=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep,s=this.pos.scale(e).add(this._oldPos.scale(1-e));s.clone(this.drawPos),this.updateTransform(s)}if(t.snapToPixel){const e=this.drawPos.clone(this._snapPos);e.x=~~(e.x+St*$t(e.x)),e.y=~~(e.y+St*$t(e.y)),e.clone(this.drawPos),this.updateTransform(e)}t.multiply(this.transform)}updateTransform(t){const e=this._screen.resolution.width/this.zoom,s=this._screen.resolution.height/this.zoom,r=L(-t.x+e/2+this._xShake,-t.y+s/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(e/2,s/2),this.transform.rotate(this.rotation),this.transform.translate(-e/2,-s/2),this.transform.translate(r.x,r.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}class dS extends Gi{constructor(t){var e,s,r,l;super({...t}),this.events=new re,this.filter=(e=t.filter)!=null?e:()=>!0,this.repeat=(s=t.repeat)!=null?s:-1,this.action=(r=t.action)!=null?r:()=>{},this.target=t.target,this.graphics.isVisible=(l=t.visible)!=null?l:!1,this.body.collisionType=_t.Passive,this.events.on("collisionstart",({other:h})=>{this._matchesTarget(h.owner)&&(this.events.emit("enter",new sw(this,h.owner)),this._dispatchAction(h.owner),this.repeat===0&&this.kill())}),this.events.on("collisionend",({other:h})=>{this._matchesTarget(h.owner)&&this.events.emit("exit",new nw(this,h.owner))})}_matchesTarget(t){return this.filter(t)&&(this.target===void 0||this.target===t)}_dispatchAction(t){this.repeat!==0&&(this.action.call(this,t),this.repeat--)}}class Gy extends Vi{constructor(t){super(),this.world=t,this.systemType=Qi.Draw,this.query=this.world.query([at])}initialize(t,e){this._graphicsContext=e.engine.graphicsContext,this._camera=e.camera,this._engine=e.engine,this._collisionSystem=t.systemManager.get(vf)}update(){var t;if(!this._engine.isDebug)return;const e=this._engine.debug.filter;let s,r;const l=this._engine.debug.entity;let h;const u=this._engine.debug.transform;let f;const g=this._engine.debug.motion;let _;const y=this._engine.debug.collider,A=this._engine.debug.physics;let x;const D=this._engine.debug.graphics;let S,U;const R=this._engine.debug.body,C=this._engine.debug.camera;for(let O=0;O<this.query.entities.length;O++){const G=this.query.entities[O];if(G.hasTag("offscreen")||G instanceof Sy||e.useFilter&&(!(e.ids.length===0||e.ids.includes(G.id))||!(e.nameQuery===""||G.name.includes(e.nameQuery))))continue;let q=B.Zero;const et=L(0,16);if(s=G.id,r=G.name,h=G.get(at),this._pushCameraTransform(h),this._graphicsContext.save(),h.coordPlane===pi.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=u.debugZIndex,this._applyTransform(G),h&&((u.showAll||u.showPosition)&&this._graphicsContext.debug.drawPoint(B.Zero,{size:4,color:u.positionColor}),(u.showAll||u.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${h.pos.toString(2)}`,q),q=q.add(et)),(u.showAll||u.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${h.z.toFixed(1)})`,q),q=q.add(et)),(l.showAll||l.showId)&&(this._graphicsContext.debug.drawText(`id(${s}) ${G.parent?"child of id("+((t=G.parent)==null?void 0:t.id)+")":""}`,q),q=q.add(et)),(l.showAll||l.showName)&&(this._graphicsContext.debug.drawText(`name(${r})`,q),q=q.add(et)),(u.showAll||u.showRotation)&&(this._graphicsContext.drawLine(B.Zero,B.fromAngle(h.rotation).scale(50).add(B.Zero),u.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${Ib(h.rotation).toFixed(2)})`,q),q=q.add(et)),(u.showAll||u.showScale)&&this._graphicsContext.drawLine(B.Zero,h.scale.add(B.Zero),u.scaleColor,2)),x=G.get(Ve),x&&(D.showAll||D.showBounds)&&x.localBounds.draw(this._graphicsContext,D.boundsColor),S=G.get(yy),S&&(S.useTransform||this._graphicsContext.restore(),S.draw(this._graphicsContext,this._engine.debug),S.useTransform||(this._graphicsContext.save(),this._applyTransform(G))),U=G.get(Kt),U&&((R.showAll||R.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${U.group.name})`,q),q=q.add(et)),(R.showAll||R.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${U.collisionType})`,q),q=q.add(et)),(R.showAll||R.showMass)&&(this._graphicsContext.debug.drawText(`mass(${U.mass})`,q),q=q.add(et)),(R.showAll||R.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${U.sleepMotion})`,q),q=q.add(et)),(R.showAll||R.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${U.canSleep?U.isSleeping:"cant sleep"})`,q),q=q.add(et))),this._graphicsContext.restore(),this._graphicsContext.save(),h.coordPlane===pi.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=u.debugZIndex,f=G.get(qt),f&&((g.showAll||g.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${f.vel.toString(2)}`,q.add(h.globalPos)),this._graphicsContext.drawLine(h.globalPos,h.globalPos.add(f.vel),g.velocityColor,2),q=q.add(et)),(g.showAll||g.showAcceleration)&&this._graphicsContext.drawLine(h.globalPos,h.globalPos.add(f.acc),g.accelerationColor,2)),_=G.get(Be),_){const k=_.get();if((y.showAll||y.showGeometry)&&k&&k.debug(this._graphicsContext,y.geometryColor,{lineWidth:y.geometryLineWidth,pointSize:y.geometryPointSize}),y.showAll||y.showBounds){if(k instanceof Qe){const rt=k.getColliders();for(const pt of rt){const At=pt.bounds,bt=L(At.left,At.top);this._graphicsContext.debug.drawRect(bt.x,bt.y,At.width,At.height,{color:y.boundsColor}),(y.showAll||y.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${pt.owner.id})`,bt)}_.bounds.draw(this._graphicsContext,y.boundsColor)}else if(k){const rt=_.bounds,pt=L(rt.left,rt.top);this._graphicsContext.debug.drawRect(pt.x,pt.y,rt.width,rt.height,{color:y.boundsColor}),(y.showAll||y.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${_.owner.id})`,pt)}}}this._graphicsContext.restore(),this._popCameraTransform(h)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(A.showAll||A.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),A.showAll||A.showCollisionContacts||A.showCollisionNormals)for(const[O,G]of this._engine.debug.stats.currFrame.physics.contacts){if(A.showAll||A.showCollisionContacts)for(const q of G.points)this._graphicsContext.debug.drawPoint(q,{size:A.contactSize,color:A.collisionContactColor});if(A.showAll||A.showCollisionNormals)for(const q of G.points)this._graphicsContext.debug.drawLine(q,G.normal.scale(30).add(q),{color:A.collisionNormalColor})}this._graphicsContext.restore(),C&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(C.showAll||C.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,C.focusColor),(C.showAll||C.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}postupdate(t,e){this._engine.isDebug&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext),Ey.flush(this._graphicsContext),this._graphicsContext.restore())}_applyTransform(t){const e=t.getAncestors();for(const s of e){const r=s==null?void 0:s.get(at);r&&(this._graphicsContext.translate(r.pos.x,r.pos.y),this._graphicsContext.scale(r.scale.x,r.scale.y),this._graphicsContext.rotate(r.rotation))}}_pushCameraTransform(t){t.coordPlane===pi.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===pi.World&&this._graphicsContext.restore()}}Gy.priority=Ns.Lowest;class bf extends Vi{constructor(t){super(),this.world=t,this.systemType=Qi.Update,this._graphicsHashGrid=new Py({size:100}),this._graphics=[],this._entityToPointer=new Map,this._pointerEventDispatcher=new Ny,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this.query=this.world.query([at,mo]),this.query.entityAdded$.subscribe(e=>{const s=e.get(at),r=e.get(mo);this._pointerEventDispatcher.addObject(e,h=>r&&r.localBounds?r.localBounds.transform(s.get().matrix).contains(s.coordPlane===pi.World?h.worldPos:h.screenPos):!1,()=>e.isActive),this._entityToPointer.set(e,r);const l=e.get(Ve);l&&(this._graphics.push(l),this._graphicsHashGrid.track(l)),this._sortedTransforms.push(s),this._sortedEntities.push(s.owner),s.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{this._pointerEventDispatcher.removeObject(e);const s=e.get(at);this._entityToPointer.delete(e);const r=e.get(Ve);if(r){const h=this._graphics.indexOf(r);h>-1&&this._graphics.splice(h,1),this._graphicsHashGrid.untrack(r)}s.zIndexChanged$.unsubscribe(this._zIndexUpdate);const l=this._sortedTransforms.indexOf(s);l>-1&&(this._sortedTransforms.splice(l,1),this._sortedEntities.splice(l,1))})}initialize(t,e){this._engine=e.engine,this._scene=e}preupdate(){this._scene.camera.hasChanged()&&this._scene.camera.updateTransform(this._scene.camera.pos),this._receivers=[this._engine.input.pointers,this._scene.input.pointers],this._engineReceiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>e.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}update(){this._graphicsHashGrid.update(this._graphics);for(const[t,e]of this._engineReceiver.currentFramePointerCoords.entries()){const s=this._scene.physics.query(e.worldPos);for(let l=0;l<s.length;l++){const h=s[l],u=this._entityToPointer.get(h.owner);u&&(u.useColliderShape||this.overrideUseColliderShape)&&this._pointerEventDispatcher.addPointerToObject(h.owner,t)}const r=this._graphicsHashGrid.query(e.worldPos);for(let l=0;l<r.length;l++){const h=r[l],u=this._entityToPointer.get(h.owner);u&&(u.useGraphicsBounds||this.overrideUseGraphicsBounds)&&this._pointerEventDispatcher.addPointerToObject(h.owner,t)}}this._pointerEventDispatcher.processPointerToObject(this._engineReceiver,this._sortedEntities),this._pointerEventDispatcher.dispatchEvents(this._engineReceiver,this._sortedEntities),this._receivers.forEach(t=>t.update()),this._pointerEventDispatcher.clear(),this._receivers.forEach(t=>t.clear())}}bf.priority=Ns.Higher;class Qy extends Vi{constructor(t){super(),this.world=t,this.systemType=Qi.Update,this._actions=[],this.query=this.world.query([lo]),this.query.entityAdded$.subscribe(e=>this._actions.push(e.get(lo))),this.query.entityRemoved$.subscribe(e=>{const s=e.get(lo),r=this._actions.indexOf(s);r>-1&&this._actions.splice(r,1)})}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}}Qy.priority=Ns.Higher;class wf{constructor(){this.events=new re,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._enabled=!0}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}toggleEnabled(t){this._enabled=t}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(r=>typeof r!==void 0).length,s=t.buttons.filter(r=>typeof r!==void 0).length;return e>=this._minimumConfiguration.axis&&s>=this._minimumConfiguration.buttons&&t.connected}emit(t,e){this.events.emit(t,e)}on(t,e){return this._enableAndUpdate(),this.events.on(t,e)}once(t,e){return this._enableAndUpdate(),this.events.once(t,e)}off(t,e){this._enableAndUpdate(),this.events.off(t,e)}update(){var t,e;if(!this.enabled||!this.supported||!this._enabled)return;this.init();const s=this._navigator.getGamepads();for(let r=0;r<s.length;r++){if(s[r]){const h=this.at(r);!this.at(r).connected&&this._isGamepadValid(s[r])&&(h.events.pipe(this.events),this.events.emit("connect",new qb(r,this.at(r)))),this.at(r).connected=!0}else{const h=this.at(r);h.connected&&(this.events.emit("disconnect",new Xb(r,h)),h.events.unpipe(this.events)),h.connected=!1;continue}if(this.at(r).update(),s[r].timestamp&&s[r].timestamp===this._gamePadTimeStamps[r])continue;this._gamePadTimeStamps[r]=s[r].timestamp,this.at(r).navigatorGamepad=s[r];const l=s[r];if(l){for(let h=0;h<l.buttons.length;h++){const u=l.buttons[h],f=u==null?void 0:u.value;f!==((t=this._oldPads[r])==null?void 0:t.getButton(h))&&(u!=null&&u.pressed?(this.at(r).updateButton(h,f),this.at(r).events.emit("button",new Zb(h in Vy?h:-1,h,f,this.at(r)))):this.at(r).updateButton(h,0))}for(let h=0;h<l.axes.length;h++){const u=l.axes[h];u!==((e=this._oldPads[r])==null?void 0:e.getAxes(h))&&(this.at(r).updateAxes(h,u),this.at(r).events.emit("axis",new Wb(h,u,this.at(r))))}}this._oldPads[r]=this._clonePad(s[r])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,s=t;e<s;e++)this._pads.push(new ud),this._oldPads.push(new ud);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let s=0,r=t.length;s<r;s++)e.push(this._clonePad(t[s]));return e}_clonePad(t){let e,s;const r=new ud;if(!t)return r;for(e=0,s=t.buttons.length;e<s;e++)t.buttons[e]&&r.updateButton(e,t.buttons[e].value);for(e=0,s=t.axes.length;e<s;e++)r.updateAxes(e,t.axes[e]);return r}}wf.MinAxisMoveThreshold=.05;class ud{constructor(){this.events=new re,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,e=1){return this._buttons[t]>=e}isButtonHeld(t,e=1){return this._buttons[t]>=e}wasButtonPressed(t,e=1){return this._buttonsDown[t]>=e}wasButtonReleased(t){return!!this._buttonsUp[t]}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<wf.MinAxisMoveThreshold?0:e}updateButton(t,e){e===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=e,this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}var Vy=(o=>(o[o.Unknown=-1]="Unknown",o[o.Face1=0]="Face1",o[o.Face2=1]="Face2",o[o.Face3=2]="Face3",o[o.Face4=3]="Face4",o[o.LeftBumper=4]="LeftBumper",o[o.RightBumper=5]="RightBumper",o[o.LeftTrigger=6]="LeftTrigger",o[o.RightTrigger=7]="RightTrigger",o[o.Select=8]="Select",o[o.Start=9]="Start",o[o.LeftStick=10]="LeftStick",o[o.RightStick=11]="RightStick",o[o.DpadUp=12]="DpadUp",o[o.DpadDown=13]="DpadDown",o[o.DpadLeft=14]="DpadLeft",o[o.DpadRight=15]="DpadRight",o[o.CenterButton=16]="CenterButton",o[o.MiscButton1=17]="MiscButton1",o))(Vy||{});class fS{constructor(t){this.inputs=t,this._handlers=new Map}execute(){for(const[t,e]of this._handlers.entries()){const s=t(this.inputs);s&&e(s)}}on(t,e){this._handlers.set(t,e)}}function Yy(){try{const o=()=>{};window.top.addEventListener("blur",o),window.top.removeEventListener("blur",o)}catch{return!0}return!1}function jy(){return window!==window.top}function qy(){let o;return Yy()?(o=window,yt.getInstance().warnOnce("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):jy()?(o=window,yt.getInstance().warnOnce("Excalibur might be in a iframe, in order to receive keyboard events it must be in focus")):o=window.top,o}var Wt=(o=>(o.Backquote="Backquote",o.Backslash="Backslash",o.BracketLeft="BracketLeft",o.BracketRight="BracketRight",o.Comma="Comma",o.Key0="Digit0",o.Key1="Digit1",o.Key2="Digit2",o.Key3="Digit3",o.Key4="Digit4",o.Key5="Digit5",o.Key6="Digit6",o.Key7="Digit7",o.Key8="Digit8",o.Key9="Digit9",o.Digit0="Digit0",o.Digit1="Digit1",o.Digit2="Digit2",o.Digit3="Digit3",o.Digit4="Digit4",o.Digit5="Digit5",o.Digit6="Digit6",o.Digit7="Digit7",o.Digit8="Digit8",o.Digit9="Digit9",o.Equal="Equal",o.IntlBackslash="IntlBackslash",o.IntlRo="IntlRo",o.IntlYen="IntlYen",o.A="KeyA",o.B="KeyB",o.C="KeyC",o.D="KeyD",o.E="KeyE",o.F="KeyF",o.G="KeyG",o.H="KeyH",o.I="KeyI",o.J="KeyJ",o.K="KeyK",o.L="KeyL",o.M="KeyM",o.N="KeyN",o.O="KeyO",o.P="KeyP",o.Q="KeyQ",o.R="KeyR",o.S="KeyS",o.T="KeyT",o.U="KeyU",o.V="KeyV",o.W="KeyW",o.X="KeyX",o.Y="KeyY",o.Z="KeyZ",o.KeyA="KeyA",o.KeyB="KeyB",o.KeyC="KeyC",o.KeyD="KeyD",o.KeyE="KeyE",o.KeyF="KeyF",o.KeyG="KeyG",o.KeyH="KeyH",o.KeyI="KeyI",o.KeyJ="KeyJ",o.KeyK="KeyK",o.KeyL="KeyL",o.KeyM="KeyM",o.KeyN="KeyN",o.KeyO="KeyO",o.KeyP="KeyP",o.KeyQ="KeyQ",o.KeyR="KeyR",o.KeyS="KeyS",o.KeyT="KeyT",o.KeyU="KeyU",o.KeyV="KeyV",o.KeyW="KeyW",o.KeyX="KeyX",o.KeyY="KeyY",o.KeyZ="KeyZ",o.Minus="Minus",o.Period="Period",o.Quote="Quote",o.Semicolon="Semicolon",o.Slash="Slash",o.AltLeft="AltLeft",o.AltRight="AltRight",o.Alt="Alt",o.AltGraph="AltGraph",o.Backspace="Backspace",o.CapsLock="CapsLock",o.ContextMenu="ContextMenu",o.ControlLeft="ControlLeft",o.ControlRight="ControlRight",o.Enter="Enter",o.MetaLeft="MetaLeft",o.MetaRight="MetaRight",o.ShiftLeft="ShiftLeft",o.ShiftRight="ShiftRight",o.Space="Space",o.Tab="Tab",o.Convert="Convert",o.KanaMode="KanaMode",o.NonConvert="NonConvert",o.Delete="Delete",o.End="End",o.Help="Help",o.Home="Home",o.Insert="Insert",o.PageDown="PageDown",o.PageUp="PageUp",o.Up="ArrowUp",o.Down="ArrowDown",o.Left="ArrowLeft",o.Right="ArrowRight",o.ArrowUp="ArrowUp",o.ArrowDown="ArrowDown",o.ArrowLeft="ArrowLeft",o.ArrowRight="ArrowRight",o.NumLock="NumLock",o.Numpad0="Numpad0",o.Numpad1="Numpad1",o.Numpad2="Numpad2",o.Numpad3="Numpad3",o.Numpad4="Numpad4",o.Numpad5="Numpad5",o.Numpad6="Numpad6",o.Numpad7="Numpad7",o.Numpad8="Numpad8",o.Numpad9="Numpad9",o.Num0="Numpad0",o.Num1="Numpad1",o.Num2="Numpad2",o.Num3="Numpad3",o.Num4="Numpad4",o.Num5="Numpad5",o.Num6="Numpad6",o.Num7="Numpad7",o.Num8="Numpad8",o.Num9="Numpad9",o.NumAdd="NumpadAdd",o.NumpadAdd="NumpadAdd",o.NumDecimal="NumpadDecimal",o.NumpadDecimal="NumpadDecimal",o.NumDivide="NumpadDivide",o.NumpadDivide="NumpadDivide",o.NumEnter="NumpadEnter",o.NumpadEnter="NumpadEnter",o.NumMultiply="NumpadMultiply",o.NumpadMultiply="NumpadMultiply",o.NumSubtract="NumpadSubtract",o.NumpadSubtract="NumpadSubtract",o.Esc="Escape",o.Escape="Escape",o.F1="F1",o.F2="F2",o.F3="F3",o.F4="F4",o.F5="F5",o.F6="F6",o.F7="F7",o.F8="F8",o.F9="F9",o.F10="F10",o.F11="F11",o.F12="F12",o.F13="F13",o.F14="F14",o.F15="F15",o.F16="F16",o.F17="F17",o.F18="F18",o.F19="F19",o.F20="F20",o.PrintScreen="PrintScreen",o.ScrollLock="ScrollLock",o.Pause="Pause",o.Unidentified="Unidentified",o))(Wt||{});class Xl extends Dt{constructor(t,e,s){super(),this.key=t,this.value=e,this.originalEvent=s}}class pS{constructor(){this.events=new re,this._enabled=!0,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=t=>{for(const e of this._keys){const s=new Xl(e,t.key,t);this.events.emit("up",s),this.events.emit("release",s)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=t=>{if(!this._enabled)return;!t.metaKey&&(this._keys.includes("MetaLeft")||this._keys.includes("MetaRight"))&&this._releaseAllKeys(t);const e=t.code;if(this._keys.indexOf(e)===-1){this._keys.push(e),this._keysDown.push(e);const s=new Xl(e,t.key,t);this.events.emit("down",s),this.events.emit("press",s)}},this._handleKeyUp=t=>{if(!this._enabled)return;const e=t.code,s=this._keys.indexOf(e);this._keys.splice(s,1),this._keysUp.push(e);const r=new Xl(e,t.key,t);this.events.emit("up",r),this.events.emit("release",r),t.key==="Meta"&&this._releaseAllKeys(t)}}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}init(t){let{global:e}=t;const{grabWindowFocus:s}=t;e?typeof e=="function"&&(e=e()):e=qy(),s&&e.focus(),e.addEventListener("blur",()=>{this._keys.length=0}),e.addEventListener("keyup",this._handleKeyUp),e.addEventListener("keydown",this._handleKeyDown)}toggleEnabled(t){this._enabled=t}clear(){this._keysDown.length=0,this._keysUp.length=0,this._keys.length=0}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.events.emit("hold",new Xl(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._enabled?this._keysDown.indexOf(t)>-1:!1}isHeld(t){return this._enabled?this._keys.indexOf(t)>-1:!1}wasReleased(t){return this._enabled?this._keysUp.indexOf(t)>-1:!1}triggerEvent(t,e,s){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:s??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:s??null}))}}class Zl{constructor(t,e,s,r,l,h){this.type=t,this.pointerId=e,this.button=s,this.pointerType=r,this.coordinates=l,this.nativeEvent=h,this.active=!0}cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}}class gS{constructor(t,e,s,r,l,h,u,f,g,_,y,A){this.x=t,this.y=e,this.pageX=s,this.pageY=r,this.screenX=l,this.screenY=h,this.index=u,this.deltaX=f,this.deltaY=g,this.deltaZ=_,this.deltaMode=y,this.ev=A,this.active=!0}cancel(){this.active=!1}}class p0{constructor(){this.events=new re,this.lastPagePos=B.Zero,this.lastScreenPos=B.Zero,this.lastWorldPos=B.Zero,this._onPointerMove=t=>{this.lastPagePos=new B(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new B(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new B(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new B(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new B(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new B(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_updateWorldPosition(t){const e=_o.fromPagePosition(this.lastPagePos,t);this.lastScreenPos=e.screenPos,this.lastWorldPos=e.worldPos}}var ic=(o=>(o.Pixel="Pixel",o.Line="Line",o.Page="Page",o))(ic||{}),jr=(o=>(o[o.NoButton=-1]="NoButton",o[o.Left=0]="Left",o[o.Middle=1]="Middle",o[o.Right=2]="Right",o[o.Unknown=3]="Unknown",o))(jr||{}),Vn=(o=>(o.Left="Left",o.Middle="Middle",o.Right="Right",o.Unknown="Unknown",o.NoButton="NoButton",o))(Vn||{}),Yn=(o=>(o.Touch="Touch",o.Mouse="Mouse",o.Pen="Pen",o.Unknown="Unknown",o))(Yn||{});function _S(o){return globalThis.TouchEvent&&o instanceof globalThis.TouchEvent}function mS(o){return globalThis.PointerEvent&&o instanceof globalThis.PointerEvent}class Cf{constructor(t,e){this.target=t,this.engine=e,this.events=new re,this.primary=new p0,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._enabled=!0,this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}toggleEnabled(t){this._enabled=t}recreate(t,e){const s=new Cf(t,e);return s.primary=this.primary,s._pointers=this._pointers,s}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,s=t;e<s;e++)this._pointers.push(new p0);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return this._enabled&&(e=this.currentFramePointerDown.get(t))!=null?e:!1}wasDown(t){var e;return this._enabled&&(e=this.lastFramePointerDown.get(t))!=null?e:!1}isDragging(t){return this._enabled?this.isDown(t):!1}isDragStart(t){return this._enabled?this.isDown(t)&&!this.wasDown(t):!1}isDragEnd(t){return this._enabled?!this.isDown(t)&&this.wasDown(t):!1}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown){if(!t.active)continue;this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t)}for(const t of this.currentFrameUp){if(!t.active)continue;this.emit("up",t),this.at(t.pointerId).emit("up",t)}for(const t of this.currentFrameMove){if(!t.active)continue;this.emit("move",t),this.at(t.pointerId).emit("move",t)}for(const t of this.currentFrameCancel){if(!t.active)continue;this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t)}for(const t of this.currentFrameWheel)t.active&&(this.emit("pointerwheel",t),this.emit("wheel",t),this.primary.emit("pointerwheel",t),this.primary.emit("wheel",t));if(this.engine.currentScene.camera.hasChanged())for(const t of this._pointers)t._updateWorldPosition(this.engine)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[s,r]of e)r===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(s)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(t){var e;if(this.engine.isDisposed())return;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const s={passive:!(this.engine.pageScrollPreventionMode===io.All||this.engine.pageScrollPreventionMode===io.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,s):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,s):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,s),((e=t==null?void 0:t.grabWindowFocus)!=null?e:!0)&&(Yy()||jy())){const l=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",l):(this.target.addEventListener("touchstart",l),this.target.addEventListener("mousedown",l))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const s=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((r,l)=>r-l).findIndex(r=>r===t);return this._activeNativePointerIdsToNormalized.set(t,s),s}_handle(t){if(!this._enabled)return;t.preventDefault();const e=new Map;let s,r;if(_S(t)){s=Vn.Unknown,r=Yn.Touch;for(let l=0;l<t.changedTouches.length;l++){const h=t.changedTouches[l],u=_o.fromPagePosition(h.pageX,h.pageY,this.engine),f=l+1,g=this._normalizePointerId(f);this.currentFramePointerCoords.set(g,u),e.set(g,u)}}else{s=this._nativeButtonToPointerButton(t.button),r=Yn.Mouse;const l=_o.fromPagePosition(t.pageX,t.pageY,this.engine);let h=1;mS(t)&&(h=t.pointerId,r=this._stringToPointerType(t.pointerType));const u=this._normalizePointerId(h);this.currentFramePointerCoords.set(u,l),e.set(u,l)}for(const[l,h]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new Zl("down",l,s,r,h,t)),this.currentFramePointerDown.set(l,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new Zl("up",l,s,r,h,t)),this.currentFramePointerDown.set(l,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new Zl("move",l,s,r,h,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new Zl("cancel",l,s,r,h,t));break}}_handleWheel(t){if(!this._enabled)return;(this.engine.pageScrollPreventionMode===io.All||this.engine.pageScrollPreventionMode===io.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(L(t.pageX,t.pageY)),s=this.engine.screen.screenToWorldCoordinates(e),r=-1/40,l=t.deltaX||t.wheelDeltaX*r||0,h=t.deltaY||t.wheelDeltaY*r||t.wheelDelta*r||t.detail||0,u=t.deltaZ||0;let f=ic.Pixel;t.deltaMode&&(t.deltaMode===1?f=ic.Line:t.deltaMode===2&&(f=ic.Page));const g=new gS(s.x,s.y,t.pageX,t.pageY,e.x,e.y,0,l,h,u,f,t);this.currentFrameWheel.push(g)}triggerEvent(t,e){const s=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:s.x,clientY:s.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:s.x,clientY:s.y}));const r=this.engine.currentScene.world.get(bf);r.preupdate(this.engine.currentScene,1),r.update(1)}_nativeButtonToPointerButton(t){switch(t){case jr.NoButton:return Vn.NoButton;case jr.Left:return Vn.Left;case jr.Middle:return Vn.Middle;case jr.Right:return Vn.Right;case jr.Unknown:return Vn.Unknown;default:return uw(t)}}_stringToPointerType(t){switch(t){case"touch":return Yn.Touch;case"mouse":return Yn.Mouse;case"pen":return Yn.Pen;default:return Yn.Unknown}}}class Xy{constructor(t){this._enabled=!0;const{pointerTarget:e,grabWindowFocus:s,engine:r,global:l}=t;this.keyboard=new pS,this.pointers=new Cf(e,r),this.gamepads=new wf,this.keyboard.init({global:l,grabWindowFocus:s}),this.pointers.init({grabWindowFocus:s}),this.gamepads.init(),this.inputMapper=new fS({keyboard:this.keyboard,pointers:this.pointers,gamepads:this.gamepads})}get enabled(){return this._enabled}toggleEnabled(t){this._enabled=t,this.keyboard.toggleEnabled(this._enabled),this.pointers.toggleEnabled(this._enabled),this.gamepads.toggleEnabled(this._enabled)}update(){this._enabled&&(this.inputMapper.execute(),this.keyboard.update(),this.gamepads.update())}clear(){this.keyboard.clear(),this.pointers.clear()}}function ks(o){var t,e;return!!(o!=null&&o.prototype)&&!!((e=(t=o==null?void 0:o.prototype)==null?void 0:t.constructor)!=null&&e.name)}class Ni{constructor(){this._logger=yt.getInstance(),this.events=new re,this.camera=new uS,this.world=new mw(this),this.physics=new YC(vn()),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(Qy),this.world.add(new Af(this.world,this.physics)),this.world.add(new vf(this.world,this.physics)),this.world.add(bf),this.world.add(Hy),this.world.add(vy),this.world.add(Ay),this.world.add(Gy)}get actors(){return this.world.entityManager.entities.filter(t=>t instanceof Gi)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof dS)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof sS)}get timers(){return this._timers}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}onPreLoad(t){}onTransition(t){}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}async _initialize(t){var e;if(!this.isInitialized){try{this.engine=t,this.physics.config=this.engine.physics,this.input=new Xy({global:t.global,pointerTarget:t.pointerScope===fo.Canvas?t.canvas:document,grabWindowFocus:t.grabWindowFocus,engine:t}),this.camera._initialize(t),this.world.systemManager.initialize(),await this.onInitialize(t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.events.emit("initialize",new Sc(t,this))}catch(s){throw this._logger.error(`Error during scene initialization for scene ${(e=t.director)==null?void 0:e.getSceneName(this)}!`),s}this._isInitialized=!0}}async _activate(t){var e,s;try{this._logger.debug("Scene.onActivate",this),this.input.toggleEnabled(!0),await this.onActivate(t)}catch(r){throw this._logger.error(`Error during scene activation for scene ${(s=(e=this.engine)==null?void 0:e.director)==null?void 0:s.getSceneName(this)}!`),r}}async _deactivate(t){return this._logger.debug("Scene.onDeactivate",this),this.input.toggleEnabled(!1),await this.onDeactivate(t)}_preupdate(t,e){this.emit("preupdate",new ea(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new ia(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new wc(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new Cc(t,e,this)),this.onPostDraw(t,e)}update(t,e){var s;if(!this.isInitialized){this._logger.warnOnce(`Scene update called before initialize for scene ${(s=t.director)==null?void 0:s.getSceneName(this)}!`);return}this._preupdate(t,e);let r,l;for(r=0,l=this._cancelQueue.length;r<l;r++)this.removeTimer(this._cancelQueue[r]);this._cancelQueue.length=0;for(const h of this._timers)h.update(e);this.world.update(Qi.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e),this.input.update()}draw(t,e){var s;if(!this.isInitialized){this._logger.warnOnce("Scene draw called before initialize!");return}this._predraw(t,e),this.world.update(Qi.Draw,e),(s=this.engine)!=null&&s.isDebug&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new Qb(t,this)),this.emit("postdebugdraw",new Vb(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),t instanceof hd){hw(this._timers,t)||this.addTimer(t);return}this.world.add(t),t.scene=this}transfer(t){let e;t instanceof Fs&&t.scene&&t.scene!==this&&(e=t.scene,t.scene.world.remove(t,!1)),t instanceof hd&&t.scene&&(e=t.scene,t.scene.removeTimer(t)),e==null||e.emit("entityremoved",{target:t}),this.add(t)}remove(t){this.emit("entityremoved",{target:t}),t instanceof Fs&&(t.isActive&&t.kill(),this.world.remove(t)),t instanceof hd&&this.removeTimer(t)}clear(t=!0){for(let e=this.entities.length-1;e>=0;e--)this.world.remove(this.entities[e],t);for(let e=this.timers.length-1;e>=0;e--)this.removeTimer(this.timers[e])}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return e!==-1&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const e=this.actors;for(let s=0;s<e.length;s++){const r=e[s];r instanceof Uy&&t.stats.currFrame.actors.ui++,t.stats.currFrame.actors.alive++;for(let l=0;l<r.children.length;l++){const h=r.children[l];eS(h)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}}class yS{constructor(t){this._engine=t,this._colorBlindPostProcessor=new jw(oo.Protanope)}correct(t){this._engine.graphicsContext instanceof Ls&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof Ls&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class AS{constructor(t){this.stats={currFrame:new yc,prevFrame:new yc},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!1,showName:!1},this.transform={showAll:!1,debugZIndex:1e7,showPosition:!1,showPositionLabel:!1,positionColor:tt.Yellow,showZIndex:!1,showScale:!1,scaleColor:tt.Green,showRotation:!1,rotationColor:tt.Blue},this.graphics={showAll:!1,showBounds:!1,boundsColor:tt.Yellow},this.collider={showAll:!1,showBounds:!1,boundsColor:tt.Blue,showOwner:!1,showGeometry:!0,geometryColor:tt.Green,geometryLineWidth:1,geometryPointSize:.5},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:tt.Cyan,showCollisionContacts:!0,contactSize:2,collisionContactColor:tt.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:tt.Yellow,showAcceleration:!1,accelerationColor:tt.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:tt.Red,showZoom:!1},this.tilemap={showAll:!1,showGrid:!1,gridColor:tt.Red,gridWidth:.5,showSolidBounds:!1,solidBoundsColor:tt.fromHex("#8080807F"),showColliderGeometry:!0},this.isometric={showAll:!1,showPosition:!1,positionColor:tt.Yellow,positionSize:1,showGrid:!1,gridColor:tt.Red,gridWidth:1,showColliderGeometry:!0},this._engine=t,this.colorBlindMode=new yS(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const s=t.toTestClock();return e&&s.start(),this._engine.clock=s,s}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const s=t.toStandardClock();return e&&s.start(),this._engine.clock=s,s}}class yc{constructor(){this._id=0,this._elapsedMs=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Sf,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.elapsedMs=t.elapsedMs,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.elapsedMs=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new yc;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get elapsedMs(){return this._elapsedMs}set elapsedMs(t){this._elapsedMs=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Sf{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Sf;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}class g0{constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}}class vS{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new g0(this._windowGlobal),this._documentComponent=new g0(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class xS{constructor(t){this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0;var e;this._fps=t.initialFps,this._samplePeriod=(e=t.samplePeriod)!=null?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Zy{constructor(t){this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._nextScheduleId=0;var e,s,r;this._options=t,this.tick=t.tick,this._lastTime=(e=this.now())!=null?e:0,this._maxFps=(s=t.maxFps)!=null?s:this._maxFps,this._onFatalException=(r=t.onFatalException)!=null?r:this._onFatalException,this.fpsSampler=new xS({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new bS({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new Wy({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0,s="preframe"){const r=this._totalElapsed+e,l=this._nextScheduleId++;return this._scheduledCbs.push([l,t,r,s]),l}clearSchedule(t){const e=this._scheduledCbs.findIndex(([s])=>s===t);e!==-1&&this._scheduledCbs.splice(e,1)}__runScheduledCbs(t="preframe"){for(let e=this._scheduledCbs.length-1;e>-1;e--){const[s,r,l,h]=this._scheduledCbs[e];t===h&&l<=this._totalElapsed&&(r(this._elapsed),this._scheduledCbs.splice(e,1))}}update(t){try{this.fpsSampler.start();const e=this.now();let s=e-this._lastTime||1;const r=1e3/this._maxFps;if(s>=r){let l=0;r!==0&&(l=s%r,s=s-l),s>200&&(s=1),this._elapsed=t||s,this._totalElapsed+=this._elapsed,this.__runScheduledCbs("preframe"),this.tick(t||s),this.__runScheduledCbs("postframe"),r!==0?this._lastTime=e-l:this._lastTime=e,this.fpsSampler.end()}}catch(e){this._onFatalException(e),this.stop()}}}class Wy extends Zy{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(e){throw window.cancelAnimationFrame(this._requestId),e}};t()}stop(){window.cancelAnimationFrame(this._requestId),this._running=!1}}class bS extends Zy{constructor(t){super({...t}),this._logger=yt.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!=null?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=t??this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let s=0;s<t;s++)this.step(e??this._updateMs)}}const wS=`#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;

  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}

.ex-toast-message button {
  align-self: flex-start;
}
`;class CS{constructor(){this._toasterCss=wS,this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const e=document.createElement("span");return e.innerText=t,e}toast(t,e,s){this._initialize();const r=document.createElement("div");r.className="ex-toast-message";const l=t.split("[LINK]").map(_=>this._createFragment(_));if(e){const _=document.createElement("a");_.href=e,s?_.innerText=s:_.innerText=e,l.splice(1,0,_)}const h=document.createElement("div");l.forEach(_=>{h.appendChild(_)}),r.appendChild(h);const u=document.createElement("button");u.innerText="x",u.addEventListener("click",()=>{this._container.removeChild(r)}),r.appendChild(u);const f=_=>{if(_.key==="Escape")try{this._container.removeChild(r)}catch{}document.removeEventListener("keydown",f)};document.addEventListener("keydown",f);const g=this._container.firstChild;this._container.insertBefore(r,g)}}class SS{constructor(t,e){this._engine=t,this.events=new re,this._logger=yt.getInstance(),this._initialized=!1,this.scenes={},this._sceneToInstance=new Map,this._sceneToLoader=new Map,this._sceneToTransition=new Map,this._loadedScenes=new Set,this._isTransitioning=!1,this.rootScene=this.currentScene=new Ni,this.add("root",this.rootScene),this.currentScene=this.rootScene,this.currentSceneName="root";for(const s in e){const r=e[s];this.add(s,r),s==="root"&&(this.rootScene=this.getSceneInstance("root"),this.currentScene=this.rootScene)}}get isTransitioning(){return this._isTransitioning}async onInitialize(){if(!this._initialized)if(this._initialized=!0,this._deferredGoto){const t=this._deferredGoto;this._deferredGoto=void 0;const e=this._deferredTransition;this._deferredTransition=void 0;const s=this.getSceneInstance(t);s&&e&&e._addToTargetScene(this._engine,s);const r=this._getInTransition(t),l=r==null?void 0:r.hideLoader;this.maybeLoadScene(t,l),await this.swapScene(t),s&&e&&await this.playTransition(e,s)}else await this.swapScene("root")}get isInitialized(){return this._initialized}configureStart(t,e){var s,r;const l=e==null?void 0:e.loader;l instanceof _c?this.mainLoader=l:h0(l)?this.mainLoader=new l:this.mainLoader=new mc;let h;if(e!=null&&e.inTransition){const{inTransition:f}=e;h=f}this.startScene=t;const u=(r=(s=e==null?void 0:e.inTransition)==null?void 0:s.hideLoader)!=null?r:!1;if(this.maybeLoadScene(t,u),h){const f=this.getSceneInstance(t);f&&(h._addToTargetScene(this._engine,f),this.swapScene(t).then(()=>(f.onTransition("in"),this.playTransition(h,f))))}else this.swapScene(t);this.currentSceneName=this.startScene}_getLoader(t){return this._sceneToLoader.get(t)}_getInTransition(t){var e;const s=this.scenes[t];if(!(s instanceof Ni||ks(s)))return(e=s==null?void 0:s.transitions)==null?void 0:e.in}_getOutTransition(t){var e;const s=this.scenes[t];if(!(s instanceof Ni||ks(s)))return(e=s==null?void 0:s.transitions)==null?void 0:e.out}getDeferredScene(){const t=this.getSceneDefinition(this._deferredGoto);return this._deferredGoto&&t?t:null}getSceneDefinition(t){const e=this.scenes[t];if(e instanceof Ni||ks(e))return e;if(e)return e.scene}getSceneName(t){for(const[e,s]of Object.entries(this.scenes))if(s instanceof Ni){if(t===s)return e}else if(!ks(s)&&t===s.scene)return e;for(const[e,s]of Object.entries(this.scenes))if(ks(s)){if(t.constructor===s)return e}else if(!(s instanceof Ni)&&t.constructor===s.scene)return e;return null}assertAdded(t){return this}assertRemoved(t){return this}add(t,e){if(!(e instanceof Ni)&&!ks(e)){const{loader:s,transitions:r}=e,{in:l,out:h}=r??{};this._sceneToTransition.set(t,{in:l,out:h}),h0(s)?this._sceneToLoader.set(t,new s):s&&this._sceneToLoader.set(t,s)}return this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,this.assertAdded(t)}remove(t){if(t instanceof Ni||ks(t)){const e=t;for(const s in this.scenes)if(this.scenes.hasOwnProperty(s)){const r=this.scenes[s];let l;if(r instanceof Ni||ks(r)?l=r:l=r.scene,l===e){if(s===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${s}`);this._sceneToInstance.delete(s),this._sceneToTransition.delete(s),this._sceneToLoader.delete(s),delete this.scenes[s]}}}if(typeof t=="string"){if(t===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${t}`);this._sceneToInstance.delete(t),this._sceneToTransition.delete(t),this._sceneToLoader.delete(t),delete this.scenes[t]}}async goToScene(t,e){var s,r,l,h,u,f;const g=this.getSceneInstance(t);if(!g){this._logger.warn(`Scene ${t} does not exist! Check the name, are you sure you added it?`);return}const _=this.currentScene,y=this.currentSceneName,A=(r=(s=this._engine.input)==null?void 0:s.enabled)!=null?r:!0;this._isTransitioning=!0;const x=(l=this.getSceneInstance(y))==null?void 0:l.onTransition("out"),D=g==null?void 0:g.onTransition("in");e={sourceOut:(h=this._getOutTransition(this.currentSceneName))!=null?h:x,destinationIn:(u=this._getInTransition(t))!=null?u:D,...e};const{sourceOut:S,destinationIn:U,sceneActivationData:R}=e,C=S??this._getOutTransition(this.currentSceneName),O=U??this._getInTransition(t),G=(C==null?void 0:C.hideLoader)||(O==null?void 0:O.hideLoader);G&&this.maybeLoadScene(t,G),this._emitEvent("navigationstart",y,t),C&&await this.playTransition(C,_),await this.maybeLoadScene(t,G),O&&await O.onPreviousSceneDeactivate(this.currentScene),O&&O._addToTargetScene(this._engine,g),await this.swapScene(t,R),this._emitEvent("navigation",y,t),O&&await this.playTransition(O,g),this._emitEvent("navigationend",y,t),(f=this._engine.input)==null||f.toggleEnabled(A),this._isTransitioning=!1}getSceneInstance(t){const e=this.getSceneDefinition(t);if(!e)return;if(this._sceneToInstance.has(t))return this._sceneToInstance.get(t);if(e instanceof Ni)return this._sceneToInstance.set(t,e),e;const s=new e;return this._sceneToInstance.set(t,s),s}async maybeLoadScene(t,e=!1){var s;const r=(s=this._getLoader(t))!=null?s:new _c,l=this.getSceneDefinition(t),h=this.getSceneInstance(t);l&&h&&!this._loadedScenes.has(h)&&(h.onPreLoad(r),h.events.emit("preload",{loader:r}),e?this._engine.load(r,e):await this._engine.load(r),this._loadedScenes.add(h))}async playTransition(t,e){var s,r,l,h,u,f,g;if(!this.isInitialized){this._deferredTransition=t;return}if(t){this.currentTransition=t;const _=(r=(s=e.input)==null?void 0:s.enabled)!=null?r:!0;(l=e.input)==null||l.toggleEnabled(!t.blockInput),(h=this._engine.input)==null||h.toggleEnabled(!t.blockInput),e.events.emit("transitionstart",t),this.currentTransition._addToTargetScene(this._engine,e),await this.currentTransition._play(),e.events.emit("transitionend",t),(u=e.input)==null||u.toggleEnabled(_)}(f=this.currentTransition)==null||f.kill(),(g=this.currentTransition)==null||g.reset(),this.currentTransition=void 0}async swapScene(t,e){const s=this._engine;if(!this.isInitialized){this._deferredGoto=t;return}const r=this.getSceneInstance(t);if(r){const l=this.currentScene,h=r;let u;if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const _={engine:s,previousScene:l,nextScene:h};u=await this.currentScene._deactivate(_),this.currentScene.events.emit("deactivate",new tw(_,this.currentScene)),this.currentScene.input.clear()}const f=this._sceneToLoader.get(t);await(f==null?void 0:f.areResourcesLoaded()),this.currentScene=h,this.currentSceneName=t,s.screen.setCurrentCamera(h.camera),await this.currentScene._initialize(s);const g={engine:s,previousScene:l,previousSceneData:u,nextScene:h,data:e};await this.currentScene._activate(g),this.currentScene.events.emit("activate",new $b(g,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}_emitEvent(t,e,s){const r=this.getSceneDefinition(e),l=this.getSceneDefinition(s);this.events.emit(t,{sourceScene:r,sourceName:e,destinationScene:l,destinationName:s})}}function TS(){const o={scope:(t,e)=>{const s=o.value;o.value=t;try{return e()}catch(r){throw r}finally{o.value=s}},value:void 0};return o}function ES(o){return o.value}const _0={textureCollectInterval:6e4};class DS{constructor(t){this.options=t,this._running=!1,this._collectionMap=new Map,this._collectors=new Map,this.collectStaleResources=e=>{if(this._running){for(const[s,[r,l]]of this._collectors.entries()){const h=this.options.getTimestamp();for(const[u,[f,g]]of this._collectionMap.entries()){if(s!==f||g+l>=h)continue;r(u)&&this._collectionMap.delete(u)}}this._collectHandle=requestIdleCallback(this.collectStaleResources)}}}registerCollector(t,e,s){this._collectors.set(t,[s,e])}addCollectableResource(t,e){this._collectionMap.set(e,[t,this.options.getTimestamp()])}touch(t){const e=this._collectionMap.get(t);e&&this._collectionMap.set(t,[e[0],this.options.getTimestamp()])}forceCollectAll(){for(const[t,[e]]of this._collectors.entries())for(const[s]of this._collectionMap.entries())e(s)&&this._collectionMap.delete(s)}running(){return this._running}start(){this._running=!0,this.collectStaleResources()}stop(){this._running=!1,cancelIdleCallback(this._collectHandle)}}j0();var io=(o=>(o[o.None=0]="None",o[o.Canvas=1]="Canvas",o[o.All=2]="All",o))(io||{});const Ic=class mn{constructor(t){this.scope=q=>mn.Context.scope(this,q),this.version=m0,this.events=new re,this.maxFps=Number.POSITIVE_INFINITY,this._inputEnabled=!0,this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=q=>{yt.getInstance().fatal(q,q.stack)},this._toaster=new CS,this._timescale=1,this._isInitialized=!1,this._hasCreatedCanvas=!1,this._originalOptions={},this._handleWebGLContextLost=q=>{var et;q.preventDefault(),this.clock.stop(),this._logger.fatalOnce("WebGL Graphics Lost",q);const k=document.createElement("div");k.id="ex-webgl-graphics-context-lost",k.style.position="absolute",k.style.zIndex="99",k.style.left="50%",k.style.top="50%",k.style.display="flex",k.style.flexDirection="column",k.style.transform="translate(-50%, -50%)",k.style.backgroundColor="white",k.style.padding="10px",k.style.borderStyle="solid 1px";const rt=document.createElement("div");if(rt.innerHTML=`
      <h1>There was an issue rendering, please refresh the page.</h1>
      <div>
        <p>WebGL Graphics Context Lost</p>

        <button id="ex-webgl-graphics-reload">Refresh Page</button>

        <p>There are a few reasons this might happen:</p>
        <ul>
          <li>Two or more pages are placing a high demand on the GPU</li>
          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>
          <li>The computer has multiple GPUs and the user has switched between them</li>
          <li>Graphics driver has crashed or restarted</li>
          <li>Graphics driver was updated</li>
        </ul>
      </div>
    `,k.appendChild(rt),(et=this.canvas)!=null&&et.parentElement){this.canvas.parentElement.appendChild(k);const pt=rt.querySelector("#ex-webgl-graphics-reload");pt==null||pt.addEventListener("click",()=>location.reload())}},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._disposed=!1,this._isLoading=!1,this._hideLoader=!1,this._isReadyFuture=new xn,this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[];var e,s,r,l,h,u,f,g,_;t={...mn._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,$l.freeze(),this.browser=new vS(window,document);const y=new tS;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=y.test())){const q=document.createElement("div");if(q.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(q),y.failedTests.forEach(function(et){const k=document.createElement("div");k.innerText="Browser feature missing "+et,document.body.appendChild(k)}),t.canvasElementId){const et=document.getElementById(t.canvasElementId);et&&et.parentElement.removeChild(et)}return}else this._compatible=!0;if(console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${m0})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=yt.getInstance(),this._logger.defaultLevel===rf.Debug&&y.logBrowserFeatures(),this._logger.debug("Building engine..."),t.garbageCollection===!0?this.garbageCollectorConfig={..._0}:t.garbageCollection===!1?(this._logger.warn("WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted"),this.garbageCollectorConfig=null):this.garbageCollectorConfig={..._0,...t.garbageCollection},this._garbageCollector=new DS({getTimestamp:Date.now}),this.canvasElementId=t.canvasElementId,t.canvasElementId){if(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),document.getElementById(t.canvasElementId)===null)throw new Error("Cannot find existing element in the DOM, please ensure element is created prior to engine creation.");this.canvas=document.getElementById(t.canvasElementId),this._hasCreatedCanvas=!1}else t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement,this._hasCreatedCanvas=!1):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"),this._hasCreatedCanvas=!0);this.canvas&&!t.enableCanvasContextMenu&&this.canvas.addEventListener("contextmenu",q=>{q.preventDefault()});let A=(e=t.displayMode)!=null?e:co.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(A=co.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),A=co.FitScreen);const x=t.global&&typeof t.global=="function"?t.global():t.global;this.global=x??qy(),this.grabWindowFocus=t.grabWindowFocus,this.pointerScope=t.pointerScope,this._originalDisplayMode=A;let D,S,U,R,C,O;typeof t.antialiasing=="object"?{pixelArtSampler:D,nativeContextAntialiasing:U,multiSampleAntialiasing:O,filtering:C,canvasImageRendering:R}={...t.pixelArt?Pw:Mw,...t.antialiasing}:(D=!!t.pixelArt,U=!1,O=t.antialiasing,R=t.antialiasing?"auto":"pixelated",C=t.antialiasing?gi.Blended:gi.Pixel),U&&O&&this._logger.warnOnce("Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing at the same time, they are incompatible settings. If you aren't sure use multiSampleAntialiasing"),t.pixelArt&&(S=.25),(!t.antialiasing||C===gi.Pixel)&&(S=0),S=(r=(s=t.uvPadding)!=null?s:S)!=null?r:.01;let G=$l.isEnabled("use-canvas-context");if(!G)try{this.graphicsContext=new Ls({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,pixelArtSampler:D,antialiasing:U,multiSampleAntialiasing:O,uvPadding:S,powerPreference:t.powerPreference,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting,garbageCollector:this.garbageCollectorConfig?{garbageCollector:this._garbageCollector,collectionInterval:this.garbageCollectorConfig.textureCollectInterval}:null,handleContextLost:(l=t.handleContextLost)!=null?l:this._handleWebGLContextLost,handleContextRestored:t.handleContextRestored})}catch(q){this._logger.warn(`Excalibur could not load webgl for some reason (${q.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/performance`),G=!0}G&&(this.graphicsContext=new Bd({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:U,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new c0({canvas:this.canvas,context:this.graphicsContext,antialiasing:U,canvasImageRendering:R,browser:this.browser,viewport:(h=t.viewport)!=null?h:t.width&&t.height?{width:t.width,height:t.height}:l0.SVGA,resolution:t.resolution,displayMode:A,pixelRatio:t.suppressHiDPIScaling?1:(u=t.pixelRatio)!=null?u:null}),ao.filtering=C,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=(f=t.maxFps)!=null?f:this.maxFps,this.fixedUpdateTimestep=(g=t.fixedUpdateTimestep)!=null?g:this.fixedUpdateTimestep,this.fixedUpdateFps=(_=t.fixedUpdateFps)!=null?_:this.fixedUpdateFps,this.fixedUpdateTimestep=this.fixedUpdateTimestep||1e3/this.fixedUpdateFps,this.clock=new Wy({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:q=>this.onFatalException(q)}),this.enableCanvasTransparency=t.enableCanvasTransparency,typeof t.physics=="boolean"?this.physics={...vn(),enabled:t.physics}:(this.physics={...vn()},Sd(this.physics,t.physics)),this.debug=new AS(this),this.director=new SS(this,t.scenes),this.director.events.pipe(this.events),this._initialize(t),window.___EXCALIBUR_DEVTOOL=this,mn.InstanceCount++}static useEngine(){const t=ES(mn.Context);if(!t)throw new Error("Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.");return t}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get currentScene(){return this.director.currentScene}get currentSceneName(){return this.director.currentSceneName}get rootScene(){return this.director.rootScene}get scenes(){return this.director.scenes}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:e,showPlayerMessage:s}=this._originalOptions.configurePerformanceCanvas2DFallback;if(e===void 0&&(e=mn._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),s===void 0&&(s=mn._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!$l.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===e.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let r=0;for(let h=0;h<this._fpsSamples.length;h++)r+=this._fpsSamples[h];const l=r/this._fpsSamples.length;this._fpsSamples.length===e.numberOfFrames&&l<=e.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),s&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,e,s;const r=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(r,this.canvas),this.canvas=r;const l={...this._originalOptions,antialiasing:this.screen.antialiasing},h=this._originalDisplayMode;this.graphicsContext=new Bd({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:l.antialiasing,backgroundColor:l.backgroundColor,snapToPixel:l.snapToPixel,useDrawSorting:l.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new c0({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=l.antialiasing)!=null?t:!0,browser:this.browser,viewport:(e=l.viewport)!=null?e:l.width&&l.height?{width:l.width,height:l.height}:l0.SVGA,resolution:l.resolution,displayMode:h,pixelRatio:l.suppressHiDPIScaling?1:(s=l.pixelRatio)!=null?s:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const u=l&&l.pointerScope===fo.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(u,this),this.input.pointers.init()}dispose(){this._disposed||(this._disposed=!0,this.stop(),this._garbageCollector.forceCollectAll(),this.input.toggleEnabled(!1),this._hasCreatedCanvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.screen.dispose(),this.graphicsContext.dispose(),this.graphicsContext=null,mn.InstanceCount--)}isDisposed(){return this._disposed}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<0){yt.getInstance().warnOnce("engine.timescale to a value less than 0 are ignored");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){return this.director.add(t,e),this}removeScene(t){this.director.remove(t)}add(t){if(arguments.length===2){this.director.add(arguments[0],arguments[1]);return}const e=this.director.getDeferredScene();e instanceof Ni?e.add(t):this.currentScene.add(t)}remove(t){t instanceof Fs&&this.currentScene.remove(t),(t instanceof Ni||ks(t))&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}async goToScene(t,e){await this.scope(async()=>{await this.director.goToScene(t,e)})}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){var e,s;this.pageScrollPreventionMode=t.scrollPreventionMode;const r=t&&t.pointerScope===fo.Document?document:this.canvas,l=(s=(e=this._originalOptions)==null?void 0:e.grabWindowFocus)!=null?s:!0;this.input=new Xy({global:this.global,pointerTarget:r,grabWindowFocus:l,engine:this}),this.inputMapper=this.input.inputMapper,this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new Kb(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new Jb(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}toggleInputEnabled(t){this._inputEnabled=t,this.input.toggleEnabled(this._inputEnabled)}onInitialize(t){}get isInitialized(){return this._isInitialized}async _overrideInitialize(t){this.isInitialized||(await this.director.onInitialize(),await this.onInitialize(t),this.events.emit("initialize",new Sc(t,this)),this._isInitialized=!0)}_update(t){var e;if(this._isLoading){(e=this._loader)==null||e.onUpdate(this,t),this.input.update();return}this.clock.__runScheduledCbs("preupdate"),this._preupdate(t),this.currentScene.update(this,t),this.graphicsContext.updatePostProcessors(t),this.clock.__runScheduledCbs("postupdate"),this._postupdate(t),this.input.update()}_preupdate(t){this.emit("preupdate",new ea(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new ia(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){var e,s;if(this.graphicsContext.backgroundColor=(e=this.currentScene.backgroundColor)!=null?e:this.backgroundColor,this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this.clock.__runScheduledCbs("predraw"),this._predraw(this.graphicsContext,t),this._isLoading){this._hideLoader||((s=this._loader)==null||s.canvas.draw(this.graphicsContext,0,0),this.clock.__runScheduledCbs("postdraw"),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle());return}this.currentScene.draw(this.graphicsContext,t),this.clock.__runScheduledCbs("postdraw"),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new wc(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new Cc(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return!this._isLoading}get ready(){return this._isReadyFuture.isCompleted}isReady(){return this._isReadyFuture.promise}async start(t,e){await this.scope(async()=>{if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");this._isLoading=!0;let s;return t instanceof _c?s=t:typeof t=="string"&&(this.director.configureStart(t,e),s=this.director.mainLoader),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this.garbageCollectorConfig&&this._garbageCollector.start(),this._logger.debug("Game clock started"),await this.load(s??new mc),await this._overrideInitialize(this),this._isReadyFuture.resolve(),this.emit("start",new Fb(this)),this._isReadyFuture.promise})}_mainloop(t){this.scope(()=>{this.emit("preframe",new Yb(this,this.stats.prevFrame));const e=t*this.timescale;this.currentFrameElapsedMs=e;const s=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=s,this.stats.currFrame.elapsedMs=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,Ce.clear();const r=this.clock.now(),l=this.fixedUpdateTimestep;if(this.fixedUpdateTimestep)for(this._lagMs+=e;this._lagMs>=l;)this._update(l),this._lagMs-=l;else this._update(e);const h=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(e);const u=this.clock.now();this.stats.currFrame.duration.update=h-r,this.stats.currFrame.duration.draw=u-h,this.stats.currFrame.graphics.drawnImages=Ce.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=Ce.DrawCallCount,this.emit("postframe",new jb(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()})}stop(){this.clock.isRunning()&&(this.emit("stop",new Nb(this)),this.browser.pause(),this.clock.stop(),this._garbageCollector.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(s=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:s})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,s=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,r=document.createElement("canvas");r.width=e,r.height=s;const l=r.getContext("2d");l.imageSmoothingEnabled=this.screen.antialiasing,l.drawImage(this.canvas,0,0,e,s);const h=new Image,u=r.toDataURL("image/png");h.onload=()=>{t.resolve(h)},h.src=u}this._screenShotRequests.length=0}async load(t,e=!1){await this.scope(async()=>{try{if(t.isLoaded())return;this._loader=t,this._isLoading=!0,this._hideLoader=e,t instanceof mc&&(t.suppressPlayButton=t.suppressPlayButton||this._suppressPlayButton),this._loader.onInitialize(this),await t.load()}catch(s){this._logger.error("Error loading resources, things may not behave properly",s),await Promise.resolve()}finally{this._isLoading=!1,this._hideLoader=!1,this._loader=null}})}};Ic.Context=TS();Ic.InstanceCount=0;Ic._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!1,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,enableCanvasContextMenu:!1,snapToPixel:!1,antialiasing:!0,pixelArt:!1,garbageCollection:!0,powerPreference:"high-performance",pointerScope:fo.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:1,backgroundColor:tt.fromHex("#2185d0")};let RS=Ic;const m0="0.31.0";j0();const MS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAUMCAYAAACN1eQpAAAAAXNSR0IArs4c6QAAHqhJREFUeJztnU1ys7wShY9vsRQNWAoDlsKApTDwUjRgKRpoKVRxB9BYyAI77xfUin2eqlR+bMdw0moJUjwAhBBCCCF/k5v2Blhr56ZpAABVVb3cHjc0s3xd9+Nl268aTBiK9x7ee7Rte7hNYSgxvx1S9Zu/7F+RUN4hDOAsqP+KejBbKON4+jw3NHNcFVcOpf9d9Ytf4RrMAB6hNA2MMVqb84RKMK7BbOy0BDKOSyAnFZOqlqvJPpSmaZox7t9W+kvd9087rxGKCtM0zZPFPE3TPE3TbLtunqZpds4lG+mVDbYYJIwwmGmaZtcgGYxmKGrNd2OsgMHBe48gnHn9UENnum4mbH2mmYD9GmYGADc0qPvzKfxKsgcj65ammXY/K2mqzs7WU5ybrbW7HmOtna21MoTCDxWK6DHGTjD3FgDgnFPeIAVk9pGqcQ12s5RU0dqEP3+aFiaLOQ7naeo+WM/kJuuK0hgzu8HD3wEMjyETNt+6rotY5WYPBgDcsD/F4O/L53rUP3EmqAQjOOfg2wqtX6rFe19MMFlnpfhkVF3XMHaCNe+dpMpJ7un6dnamLq4oTVTWMe+extREI5j96clCh1P2YNZDABKzLe7WVa8xZjbGFLOw02IGlpWvBFTaileL7ag5PEaSoLQ3TpN9MGs48q+Ur6QZ7NZPgPIr5dIleDPY5E6PfZt6Lsb++P/Wucm2IWFIqWCC5xURUJZ1TDPYeezb27s7fFRpOVH5y5wdE5luKKJiVP59YrpB420JIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEFIgoXBHe1uKYWchWq1EWtuibxxK8BMp6VWoS0hj3pWSXk0xFVOalLSIYH4qJc2B+lD6qZT0K0i5N0VKqr1taoReh9hsVkIwKj2mhB1/RRHN1xu3SEnXXuNb9daXn3jIhLoUEQaW4HtQqxjvPcZoSjbGLBrbbyRWSm7HR4FuUnsbAYWKMR2Avt4dC/m2ApoJxn5ptQCL1yGsjrhitLdPDZHrTBZbGOE6Rnv7hFxL7lneK+XbDHnnjjk5yNFjQnO8+nmWd7l6JRUPjRmLb3MO/L0Y1lsJlSRUv7JiUv1iGyZSOWEoJVXTlcHEveJ28lhRoQDX95hb8LER+jb7YPXbK5+cUifl27RdV8yqF8gwXR9p3mSaDhuu974Ymfqls9KZ+66ua0zTeg+UZiqux+Tk6fYdJfs2c658n5imR6WUMoSysQ6n5Icbmnm9udQMYC7BmKhFGMBTQBLSVwUU7uw7VfSTcKJgfwWVcd0Mdvb3/vBx0w0YsNz349Ud/666N61aw3tVESIiPdrxq2/WW+xMIKrb8GepofIV95AsiSxpx8NGKkF+XoK/N0ZFjQ08h1FySEXQDPZHU/VXrXmEs5CuDuTPlG10pP5ntpsQQgghhBBCCCGEEEIIIYQQQgghhBBCCLkaqiQTlKSSFIpQMQklqCSFYmRQpagkBfWKKU0lKagGU6JKUlAbSlRJHnCkkixJY5Cd0HkXqyXF96C9jSrsxICrqyoMqQTtm8pYds7N3ns0q1RH8N4DfQ0Me2+VxlX8arOSubeImy8A+M7uv7/f4YZhtl2XtYLUZiWRAfq2grETRpmuEdiH1qnbe599baMWjG8rmA5bKELb7i/Skkop5VDhUnYHjessZK0t4uBR0Gm+DWbfWRhjnobI2D/UBu39rrbQU2m+rTdosBiI4iPqZhiKOFZS6zF1b+CGGgDg74APpmiNZhujUqop36ZvK7TewHtfxHGSylCKZ5i6rmHsBGv8U2haqJ+PAfYVUwpawdxKX5doVkwRveSIIoZSSCnNVxXXYDbGzNvnbz5JFbC7WcPXn70L2ETqzjkJ5buDEQ/erloaFBVM9kOCWIgj03bfWKwn9IpQMmV98zON7fp48nUaIWV/w0DSdfYcrM/5jtMOKenfEdpDKWuPCXf21WkFbf1bsa5NQL9q1IjDke9F8/aVjrsjjsIihBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQUjIUkCYoUUAKFHTddUkCUqAQCWlpAlKgkIopTUAKFCAhTQlIS7gwXSUY59y8mVlXtv6yXmMsOtuvIeXY3ASkq0pSHnfOzbbrsssBgRJ6zFihae6LRXFwSyO+Lw/5+33rOR9vTjTGAGZ66CSbx3DCOpx8Z4G2AjoLv/afkqbyXye2f4gYUIZNuMCz1m62EBlqObc1+1Dy7aNIn6pgHGG8h+26WdSS3ns0w5C9YrIG471f5KNjBYzVtrPjOCZXvqKr9d5nV9dm7zFiYwUA0y4NVxqsBBSi4fIFNJqvfTTe5DoGuo5NNVINuEQVU/a/jDFmtvbZE1PXtUzLRVSLytG1MebJlBisVWYU4MhTWfmGbs0D1IeU/iHBSmkr2/wLvPd7iGrVFFMxpZE9mBNf71ZJzjk45w6e9qGEQkBjzBwGJSbF0tY0lyOq/aMFXWRR/B7CO+IEfs2Q7VSDygYGZF1IhTtcVVXqveNA1BZ6ud843PF3gjl77qVoTtc7G+uZvUzDbJblWOmFX3MWt+bZP9sigenlFZT1IPLVSW3TDYeP5bYo5g2mG4B7f/qcsW9vKVnpTwSmv4GatjbF17o1Q1IuTeojAxgGIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEfAr0bSYo0bdZ1AXpJfk2i3BtAuX5NoupmNJ8m6rBbM025dtUvihdLZjU7CP9xXQdjJ1wdtW+lmryUjafZuDcFAmghBF+Trk53TBsn6/YRr3m20yLF281nDUN4NtVsrk6N0O897veE3//26hcnBkPI3HjhWGEM5TpuqcQxn65GvcqNZxKMM65WXZ0EwaO1U5IOvb9dp22MWbz/AJ5pIHZh5K1dt6abFQFZ8Mlt0FRbVaSBZ2xE3xbwRu3C6UZhu15dd9nr+zsb2itfQyjg+W/MUbNsSmovLkcJCZnlb5GPX6hINAYM5t7iwbtc8X0NUyXe4sKwRjzWLzZx8e6whWZl/qKVvXouu73Q8mYcgyKpbo21SlKKRlVy3ceXceUMoSEYoIpDTXXZiw6RrSm0nZtZg8mJRiVvuMaYLLANE3J134sf8m1mbVi5PSCb6tks62q9eeDvrKWrs0D6Nos5A1TO3578TiawW7iQPnZ1c68LMG8cG1uO36kzdZQTV4aTOy48/f+aIV7e+XDkwDiqrlKNZk1GGAJJyZVEdRLEkIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCHkK6FrMwFdmy+gazMBXZsH0LWJ5wvTv961KYFgcIv3LiLl2sy5fdkJfZmuweycmzff5olr85XS4EoR6eUXZE7TtAkBdzPOOmSa5r79yK9fil5yGVqrUfGFWfG3XXlZZqUnQ+L9vu3UOHabS9Os1shw2g5fmVNEmld68eZObZXV14vFVcGseHnFVFV1i3UoIabbi+8klLZdr7uuKsjrw6F4tVlRRSkJ7KsnriRtnSSgsPI9CqQ0si/wwmpIWZ7R17k3KUn2kjXGzNZ4mA7wJjILra7NqtWXkGaHrs03oGszgq7NBHRt/pBShpBQTDClQdfmAXRtlgBdmwfQtXkAXZvH0LV5AF2bIVe5Nq8M59KDyFgpKSfAY+JqSJFybV4JXZsHZH3zVFBHhtWrrKvFcTQEcg0NQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIITmhXjJBKXrJYq+7fkcvabtudsNwSXBFBrPTSx4oJm3XzSLmuUL5VlQwclnxmV4yvCz5Su1BMcG4BrOxE5qmedJLAoBzbmvGxphN+uW9R3u///p1TUVcKOWcm42vdwJA3y5XJfrOAsASmDy2VsqVkq9iggEA4xc/lb8/Ll4PwwLyhFIMMkx2H+LhtIubU3rLmVPvo0iGchBOzu0qpvmmECmpv+cfOqryLufcthaRtctOIGgnjH0PmA7A/eC3XEMxzvAwIGHzbl4wHb9CtbOnDhJD9+8mIlVAtcccrVy1QwGUgzG+Tg4dc0/LMXKi+ldxDeYn5+Y3+zaBtHNTfJv4dtemEDo3S/FtqvaYF87N71RKBgeDRQpJNSvmVsKQOUL7WOlp5ik5rGyEM5MxJrQ/q998Sm1WWk5lup2M1Fpb1CJPhd2NYtYTUNbax7rmG//ZFt8JR05CHclJNdAYSnO13LYDwHLORbyb4c+x9JqvcW0CwcLNORefmTtUSgq5FHCqwSS24WUwZ/xmaCr3PknZ5JvBJq2K7/LblZQ1mE0GeO+TC7kz2WgsErx6SKmsY0w3ACfVEQYRf51pE/P3GHFoHnk3c28PIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEJIRujYT0LX5gndcm1dShPQiZufaVKLIijlzbeaimGBcs15rvRpZY9dmbooYSptrM2CzhfT9917c5Zx7WBKnabZdJ/ah78Vau7k0w3AkGNt18xUi41cU0WO2BtusRtaxgu/szqyYOxzVHmOtnZ9mnWZa1JJY+8yqmcy9ptHVvUWuzTCk2L2ZW0JaxFCSEHZV0ddomgbeexWpcTGuzbBCRJPt22pnCwn7zNVi0vJcm329NWFjFy22c26bmXKthItybQIAhkXPtNNMyvMzNuFiXJvhDu9kx6EI+b7IjnP4fdWCMcbMzi3VYZZbDCwK7Mfh0S1WMuVswkUcKx25NjUV+3RtHkDX5gF0bR6gvfKlazMFXZsJ6No8gK7NBHRtpvkTrk0NtgabqIz54CM7f861mcuVV4pr89YMdn7l2vxIc2JoSvSRa/Nd+2rI1SGpKCUB7EysZ/LRPFv1jMobn3k2U4+lnvdVhKHI181gZ/nQ27LCYTiEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBDyF6CANEEpAlJA/4L0JNoCUqAQG0hICQJSoKCKkZ5SgoAUKCCYTT4KoBQBKaAcTNxcm2G5BLAEAanaG0sood4tRC5S10LXambMMmzEsQksns22glhatbZNvcdsrOF44zb/HbCXAuY0tZYTDLANp2VmqtAMA5pmUbzZrstqalVbx7RtewuX/eM6C5l7u+jfZHg1E6YJs3jwckkCi1FKSr/xnd08m2FDNsbAdN2XmBMDba2wk5FGGlsgnxtPPRhgr40MP4ePAXmFgequTQwJ2aivUbXfJdXZYYx5OKnWDzGcaW+b6l8lDECEpGI4895/78o37CWxWlK7ajSDeZxmKJCiVr4lVY1WMLsdPhtSWpRSMcVNzSrBuAaYLEIZoPospM52A5jgxi8hq0t8+9DYRi1Od1oWfBJg7o3T5FQXeVZNn86pTzOoFDXPphbJYAJj2XdJSFPGxBCxJ479ofk566yV9c3e8djFHs7gtbvvrzYoZjvn2wx2Tu1MHJbpBuDE0ppLKam2qJJA3gnr6HlfBbWRhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQj4UujYT0LX5Aro2E9C1eQBdmwFbs6Vr80F4ffWRa9MNQ3aLovrldM65OeXaBFY3nvjx1mGlKSbNRuh52DxVwZX64depqrlSMak+lDaaCd64xZY4Vptv07fr12OPZhi2fhQqJt0w/Ho4RU3XxhjAPIaU937RSwIwHTZx4O5xxZnrMsQKsg0nqQZrF2PIOpxcg/TzLhxKRVWMIKJRMzhUVXUTpUqkbLq0CRehlATwNERy6iNT6Bqgfb19nfJsaqIWjDFm9vd0OOjrg1flQ61cQ8edNY/Zx9+B1ht1mZfmm+9cvrFrE9A1nakKAksUAwrlrHxBpeSOeBYqpXJ0zIlub30+6yVaVZO9ubkGs+mwHDCuyGIuJT42dlK/3UcW4tMK8ePGmDnUSn7Fv1Hig8bkcyKl5FcEgxeeTeBRUXLSKufGaXKqkwT2Z/UUtk+Np1CMMXNkMvsez2YzWNn5XSCJUIACPJtA5hNV4bFR4NZ8NRVLOJ/n2vyJ9E8kpYnzMp8XTEwc1Ni3t/hnscVVKix+/lWqyezBHMlIw8d/+js/3sN5FkrQwAkhhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYSQvwhdmwno2nzBV7s2Q7dUe79vl9WU4trMHkx4abG/358e37k2Fasm2wVQKQGXubeb727sH1e0bfIuY9RMiVneNAylaRr4tgKG1e3Q11s4wD6gcIh9JDLDbJrIQFHgnNupJMOPUFD6scRqgifpX+TaDL/W2N5s03VVVTfv/eLUbCv4zu6fELk2Q1vrWfVcZU/Muo6p6/pWVdWtHtO9zRizBBIrbFcpaTzkrhSRqi/wUgu5cRwPhYGp768QkWoKAk8f2xZ6ff0YfsbtXhcao397Wv8zrs2Uc+ZKH6dqMJPFHLqqpFKA6+2rr6Br8wC6Ng+ga/MAujYPUF/HhNC1GUDXZgBdmwno2jyArs0EdG0eQ9fmAXRtHkDXZghdmwnCHadrM4KuzTehazMBXZv/AF2bhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQ8olQMZlAUzGpfkH6O8glOq/MQr/pqyo+GDEPpfyb4VW5EogxBr8Rjppr8xWuwezxrJhMWYreraifUGTFuAazsdMSyDguOyxS0lW6E4dgum4L6DeMi8VVjHNuDi1EQFARXQeYHoh8VoC+uulyYsWk7brls8xQwWNnF7Z/FFszjUSArsGTq/PqbSmuxxhjHmpJYPm8mlzFDFK1y7WcV+kkgQKDAQK15FhtOhVjzE6XEuokrwqnCHam1lhfGwyv2OrqhuGSqiluVgIiS7QxiytvraBQiizP/VghcqparLXzUzOOBMlXblMRSctOxou2MTDNm3v70Gnj+nVLGcEE3qrQtyloLN6KmJVabyDezSfZhZJ3s4iKKdG7WUTFhLR+WcNIKFoUEcwre6KGJLCIYIDy1JLqwaxrFQBpsboWqsFM0zTHs04p4WgeEszeexi7GOSlatY1y+ceFL5g07mlfJrbsr9ZtHAa/1PSqJinnQxPJ8itPLz3wODgLrgZQ5GsU++hBDA+fflV/4E8C2c70rb4jtsIhTSDneNwRDkZ2FtVQ8naY3Z6yW4AIgkgsCzsAub1dcnfd6X/rghzojD27dlr5DlPlsUrAlKpGNmRnwr/5HVxEK9sjP9CMRUz9u3t7GAxdm1etGkbxbg236mej3dqxtChSQghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIZ8MXZsJ6Np8QUoneTVFqphCtlACyU4Oiq+YnWsz46XGRQYjIsCkazMTxQ2lM9dm3fffdSFXSMq1+XXXX8eI4i2WAsZuzStVkkJxPUYabKyVFCXc16gkhbBanj4CneTVKsni2PkzV41BPJx2q+BvG0rAswtcCKXqV/s1iwnmaPHmjYNvH/pa7z3a9gMvSD/COTfH4aSOkbbnrAu+q9Y2RSzwXIPZ+BoeLjmMngK73x+vHYb5inCKGEqxa3Ozyvt6sbKecNVRdxFDSWQXoWcTWFyb9TJibgB2N2uQqrmqCRcVjODc0nDFtfm1ElK6Nk+gazOCrs0EdG2moWszAV2bCejaTEHX5gl0bZ6QCAcoyLWZdakda9184No03XColGwGm92Bl+3NQjHgf3VtXrF9MWoHkQdaybPnx8+9dNtVFnixVlJC+sn/pq8Qj4YUcdrhJ0rJONCrwikiGOHI0xvrbr+Ko6qhoJQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEPJnoGszAV2bL6Brc2W7khZ0bQJYrqB1DWZjJxg7AdBzbRZTMYtbs9oCAbBViTEGfhyBb5OQhsKckGYYAKxV0zRZXZvqwVhrH9Ku1ZSIMSjkplk+f1OP2YUiNNOidhsr+LZ6aGszo3YpnQyf0GIWBiCzkfxstYRkQ30oAXsj4kZfo2kaeO+zh6KGeBtCsYWsbEO/5maCVkClYurewHQHdqG+3pqwTN1Hs9aVqA2lujebEHDHsHdrCjnkxiGqPSZlSxShzvY1Fhlgbrmx2spXJIB1b+CGGnhYEoHAlBgGZozJdjBZxCFB3YsOe993wtnIdt1civHsUkTKJYIu+UBCz6SBao/RtiOeoRaMhlj0JxSx8hW+ooe8ItVjsPaXnOd2j1CZlZazdHtnr7X2YX5+YX3+WHY3YVj1btba5djI6h0fqbI7cGywOe/Cg0ntbdQilo8e6iW/jZ2ZFc/BfG04TyG8EpN+BUchHLg31cgyXT+Zye79bjG3Pb53b26v0dC8ZXVtht/HAtIjtNx32d/0REB6ExNiLCz9SjEgIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEJICWS7qiO8MraqquKvJslypX6sO/kLlw9n+cuFwQBQM5X9hCyX/oUSUWMMPKDitiuOaZpmY8zshmE2xsy26+adq/dxYXoxZOkxVVXdhlUNOSQsq8ZOML6G6AxybFNpLBeiD8POgbfzPETuu9w2MyFb8xNP7xNjtfg1vYfxiwPPt9VmNsM4bpcit/f7B9pZB7e3roqFdQ3Few9/f35Z7ODMRbbpGlhnIgmneVRP6MEz9/ZRLetrxr7PWi1ARrHOztkbEK5v2na5vtoFCgOtVbKKcWhcHb3hEAm/LmHhl6XH7Dy97fPfokRpV5aKqarqFsrSzVhh9BbAI5S6roFlCKlXC5BxVvJt9XCCNw+1vlk/bNfJU4tY4GULph5x28IB0DTNZngWgiGnHk5eQeDgkrfrKDGcrLOSzDbGmNlau3usX1e44WzlvVfrOWra2rZt4ZwD/H2TBB6gEo6Ka/NMQLozQStSlIQUa2VIKNM0LVWlgEowq8HsiBuwhAJgsc5/C+GZu8DMuiPybqpP35eTulHDwVPDe7dld+RlH0rGTtsNX1402Jv3HlWVnDgvDyf7NPjDf7ztAohuGnPptmssnsKdffn+Yf/J6RnXDkYo4og6JLtScuzT2utmsE/6yNCymNuemOXNwh30kYA0eM7bvy9HSCoS0lBAKqREpLF3MyfZKiaUip49VzMMQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgrFdt3shqH466izXhMkgYj1o+77Yq9J+ufrrp1z2wXlrzS0cmF5yh1TKv+kSRENbbiTzrk5tpEdBVZ6tQD/OJSsXS/fW1W0ELFoX8PYRQkZfgYew+cv2J//mWmaZmmim4a263ZC0fDzX7Su/lOPqarq1q/VktLQAti8mfK5BOlfNlad7KNawkqZpnkbct9Iyssbfmhv37/yn+Vdvq1gxO3XJHy930osyZF1Tfi9PPevrHqBX1j5hsPFtxV8ZxeTfCj9u7fwW1n9jXXMfzYObeuSVTDaoN2J/pqmQajE/iva/V8RBG4LuVUw2sSPR4cBpVfLrxJLuRJ9JjSYFd9nfk0p2XoDe3CAWNd1aggV4+69FKmG2G8XVklQLdvs5Zoyq+dX/2Ii2nLOwbfVk1w0OhpfXrPei2DVuhVTQb/qwRPrWF0vR9nWJIfWbfNn9nW8KMwqAVQhNawQ7XDcnBMfn0kYzsmph10YUV/6XIwxLxttiWFc3uy223v4Rz/56LN4PyFe/IWPNYOdX5nONPjPf7mznRJ1m+0emn1Z6LX38fT3auve/vnNf/pXHprdvU1Svw+AfiDCr2zEuyEdeTbX0xSbQLCEcH5lKKV2JBVWHExw/wH1IGIu2SAJ6ygcCSTl11yfox5U1g141ahzbgshhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCPoO/Lvj7ryT9MRKI9x7fqoV8CkYkFZuvdxzFqflVHBqHJJR+HGGMwV8xHv4WL1VMtuvgvUfd9zm2pxiSF4Fvw+m+yHhFEWn8HRjcV7h5kxVT1/Ut3HnvPZphgOmWkGJzkBuG+dP60KEg8GmqHit44wDv4TsLjIvAwnbdLG7NT+I93dsaiohFgUWovmmWPiyUQ3bqJIudozfUXoup7NOGEXDSfI1frUAHVudxlakbY37SjCXAv9m8UxbnJ+vq6rb7wa/9U+K/lz1GpmqRb3nvN09427Y7h93J7T7m8Pf9BdLB9MswegrEexhfw3RA3T/vYNsu9ufQOI8/UiExyWDE5rz1GQANWqCv4e/pUEK899uNGjbhKPaSrj9JOCu5BssMlHD0hn5eGUrOuVleH8pFjTFFigCPSP71pmmaMVZLdYy4AZinaUo6eoVldWzffuPSnVTHwWDZ2XUqno0xhwLjEDGVxTsu1VJ6IKeEU3XgwjxVX4czE/Bzs2JpJI+VUsc+zWAx9i3quoZzE2y7vDSsHmm00zTNf93Amg7mfge67unn0kPa+wjvl6ElAWF4zD6+rbbhGLnA/8zK92kDbdfN4S067ia+/UIakYyG3t61R731vqWx28Dw9KX3fhfKuz5NABBNbSqUv7KW2TZQdrLzy8GhhPLOLBLOOHFYoXj0r4QCJEo63LH/MrVGv2c5l9MNf2a6zrKRiSr6E+EQQgghhBBCCCGEEEIIIYQQQgghhBBCCAGA/wPQ4OXCGtjIxgAAAABJRU5ErkJggg==",PS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAAgCAYAAADOmyyBAAABAGlDQ1BpY2MAABiVY2BgPMEABCwGDAy5eSVFQe5OChGRUQrsDxgYgRAMEpOLCxhwA6Cqb9cgai/r4lGHC3CmpBYnA+kPQKxSBLQcaKQIkC2SDmFrgNhJELYNiF1eUlACZAeA2EUhQc5AdgqQrZGOxE5CYicXFIHU9wDZNrk5pckIdzPwpOaFBgNpDiCWYShmCGJwZ3AC+R+iJH8RA4PFVwYG5gkIsaSZDAzbWxkYJG4hxFQWMDDwtzAwbDuPEEOESUFiUSJYiAWImdLSGBg+LWdg4I1kYBC+wMDAFQ0LCBxuUwC7zZ0hHwjTGXIYUoEingx5DMkMekCWEYMBgyGDGQCm1j8/yRb+6wAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH6QwKBDM3HA2FbAAACsxJREFUaN7tmn2MZ1dZxz/Pc869v5eZ+XVf2W67WsHUSLWsRRtMIDSSIIIvSSuSCGnU0EiC0RgRNFpf1tLWaGq00ZAgQRPiH5oYjVLollpKIIYgSldoSxuDLbtb+7Yv3Zn5/e7v3nOexz/u/c3s7Ous2+muzXwnN3Pv3HvPPef5Pu9nhEsNOeXaz/24omuuDbvUK7gsoBc/xCYuB2wS+SrBJpGvEsRLPYHzxcRNrA+bFrmJTVxOkIsf4oK+5LjOrrtv26Z7fRmw4a71DTe8gb1v3AuOt4QpEEFL/743/fBpU9Du5zQIr6Ta/b/DBhOpaDHkwIFHnTJAiFAOoDcHMuRtP/kzjlz6fOvVgI0lUpSbfuynHBlAmAMTyA1k5xfuvpcTegUXTKSccmwC2GgiNTIpF6Bc4LbfuQvmtkMY8IE77kQL4f77/nmTipcJGyvIOOR9d/65j8MQAMVIueEL+/9R5prjjKzh8X/9Muqn90tP66GebaabiRKw0Q0BNx647x9kHOZQU0xaTzoqA3PTCX2rwROb5ezF4/xEzixhJeO0dTzXwWp218dIsoi6YqLUdYI0ZRgCIZdskvjyYP0WKXB6zaer96S9N6PFANzoW4U4LZEoU6/RGNEmU1XV5U/jmVy6n0Oh14V21QGjD4TZsN3vDFTSfUG674m15ZufeVbnjpECH//kX2Ky+vHCDHUwIo5y78c+joshUlOYUeT22S9/7d8dQMoee7//ejEzVBUno26IBHLTcODrX1+zuFW8MvuM99xzz+pyRRDpOhfumBhlvyC5keuGlJ2iGOAZ1BqwjAtkHBHB3VlpeHT44sNfPCuRc/kEP/uW76WYvAi9jEsi4yzpAkd638Fy2MKn/vbveezAN5xmCjFA1aABXn/ddSIS+MZ/tvK7gBjZCtYBO0noLu3f1RRHWTR48sknHAIEcHMeOXDA9954o+RUEzOoA56RcHklre6+5ly9QaujzJEJBiIBz4skSlIYIgoFY9SmJ727KpssEfUx+bQSK3SyrDExdu7Z7YsOXgZcnelUkCqKx8jbb3mvP3bg99tXppP29V7Bo0/8l99www/JLNydnciTZKzeCR8waTsv4oAkAjW4EkypQ8mbb7nZH933B21Wk2uKXp9mWnHgP77qr997vZTZiSh1MNDLz7E2TUNRFPT7fR+FzFUs0a9ewJskTVNDKSzH7TxXfDdNNrZOv80wHV2jBDMshXne++63+TjMn6Ix2lGeWMoVDzx3jCPhSo42AsFYKIzdNJgHjqQBt97xZ3zqN3+lIyJiOYIab37HO/1r//YVwez8IepkEmcwsc4SDSShJIKDSo+qnOPWO/8YvACGNFOAPoQ+P37ze3ymO+qccfGXGqpKXdccO3aMg//zPOMwpOptIQyu8OH8gseIoxVmUxJOsW2Xhx3XeNz5Xacd/Z17/KlDhzl48ODa49DTHDz0NE8dOsyTh49RD68SW9gj81dfL7r1WpHhHiHOoxr5l/0PSDVJ/OK+P4LeNii28IHfuxsYkAcjkJbCs1tkJ2NhbX4TPLW3ZbbwQE6ZHkJQ5bOf+Yy89Z0/4bd99F4+8dG7wDI//1sf4a//9G4W6bVuxrxTgBXxXWr+1hCpqhRFIdX8AvuP47nZxvZmkWt3DSjKJbK7RxnQ6BY+d/gEU919xrF6VvGtR74pMVXUdU1ZlphlUsoURQEZfuSmmyAZAzlKahYhC0qiwHAVRktHeOT+++So9Lj59rs99iJHgHff+SeM87jrjNXri5ECrfukpm8nKLzGRTFg1DxP1ShlWVKlCvXMw/f/k8gS/NLtt7tZgpB5/4c/jOYaVJgZol5+BrkGWUp0YacQApqXefzFb7kyQW1KYMxYJ/R2XiemC2cmMi8zzV+hGS/S7w+opw2fe/BBjyGSLfP2H32XjHVEIZGe1QzyFM0BEyOrYQ7zXpF9kROeeWj/ZyVpm5NENwZpAl0z5bxEqrXWYgJ9G7OrfoY5O47RWuWepUOkfp/DE4XedkYOvZ6RC+VLn/4bSdOXCJJxFRQj4GQ1cO2y4fVhTcJ/qpvYIPRzzVX1ceqUmCsgD4bSjyWIYRpY8IJq+gLOsZNmt+pdhETPKrQXEXUeeuhBtwwS24Xf/+Dn/bXvulViKNhdH2eYJ1iXPAYHwZBySkoTXtMb0eSXmFZt1RA8UVji2Vyvj8jZxNSNTGQc5j0rgBE88XPvfw8f+6u/k7Kv9EpQb5DmBNM6YymjeZlSanpeUaqChJWRTZQRkDEmM+F1k3JW860M1LN3Np6/FURLlGlMr9djuVpG3LFGMAmYBsAYekWQU7WqlVkWhcEC46ri8/s/7eLtZk9CyAgUfZbivJcapNElTNo2pmJYWztyYmmR0WiITY8RLNAjIqZEEuLds6yj17rvd/etaFetkePlyKdaoiSGeYmd+UVed9VriPM7ObFc0eREKAtScoogIImhHad87nGZt+VOKdqx3TPmzrjczuHiGmIo2DX9b+ZtEQmR3CS2XDHwRe9zpPxOXvIR0zoIHpEu8/vlX/3ghtK7psHBOXtbpyP0eeNP38oP3PiD/snbPwRpAtmgCLBtB+/79X2M2UFpJlfWzzFKx+lZq7J1GOACd+z7bRBnpiuOrJwrTu7Oz2ORa5OQLCVj2SLLYYiSaOiza+sVfPOZQ95Uz9Pv92lyJhaRnDIhCskTQ53yPdt2u0hN6Hy6iyIYhcLUekgdJKUp2acM5/o+yVDOj5jEgrH1+PbzLzBJFVu3XQ0eO5PdePu081yfExIZhyFHbAD9Hdz2ax/kE394Bwjc9qGPQIwwraTM1iWRtvIFF+vqdUVs9auyZi6rMeYcRK7GxraAV8qc2F6/yJYmtiUHNXHaY2E4Ep9ry4nSjRgiKSdiiLg73hvxwAuVx/4cgQoXqEIJQKjHlFZx7dXbfZAXaew6DkehpuDxw8c5JluAyGu3lLLNwD2uLPSVIPJiUdeJhiHv+I27eEYyt9z1FwzzmANfeFjCtOFNb3kr6kbfJ62b7MqJ4IaIIb6+NV5AZ0cJbsynqhNgewziApOcSCkhIqjEVgm81aYowlIN/R3XyER6mCeyQqMtkeoNpS3y9FNP+JCqjR2xhxeKb32d9OauJjpMTxwk5jExxG5xs77vZUymJwZpmce++iWxWJLJqFXMW8WVGuiFioVmCcQIktvaeibtdRJ4XiK1E9AsnmXRNdfQ7mZMqgSUxLA6lBvE0EYTE6MnY3blZ8lE3GXFZUCbfUVqytGCKHM0UmJERIScGvqLzyJu9KRGoiF0jXZvFeZi29cbS2TFtnSEkSySLeJulKnrV1ODGAUVaq3nM0C7ZNA9Iw7S1WrnW+P6LNJ1xTmbrg5psNJQ1zXNYgPp1Euc4EbMYyCSPCCuxJlVzdyHgKNIR07AiF7TszZ2uJ68NwAmbZy8bEnsxDBnEyRNqbOACaW1RGW1lVJjFXqW8/PjrETabLCT+oImkHX1CZklHCt7lSfVULMisUuxXAQjkgm0KlivWD3aWbp0moqu/rdkN6Z4YDWt75RI7RWrKf8vUKDwgJtQemh3SkTb3aJu7bWWbbPF08rfViQs61fUdcdIoS1Ecyd+ZbVNd+YldDfd22sLmCpJpY0FHQEmp+pha6ne7RBopyQ+G7fbF82XT1fv3HITQXK7xWUh4NquOdA2RRIRugw+nORKXS5sgf8LPnsit6njABcAAAAedEVYdGljYzpjb3B5cmlnaHQAR29vZ2xlIEluYy4gMjAxNqwLMzgAAAAUdEVYdGljYzpkZXNjcmlwdGlvbgBzUkdCupBzBwAAAABJRU5ErkJggg==",BS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAAkCAYAAAAq23xmAAAAAXNSR0IArs4c6QAAAUpJREFUaIHtmEEOgzAMBNOqz+XAU3Loc5HoCSmELrbjJUGt94bkbuzBsVFTCoVCoVAoFAqFQqFQ6GZ6+C2mdf/8Jni2a8l5l89rnkfmM617QPVzXy05ryWg+rmzEIwxkBCMQZAkCH0hSRA8kIr7aS1ImjU+P2tB0qxp9atMy6KuHrbyWWVRVw9bdBY49EpQdu8rQUnehmviBeX3YoIiQ/cOXe7Q9m4m8mZjFcfxYRVH8mGva58f+5tG43dy97ZCrOtcG2+bQ1sh1nWujUdxwhZDRSAoWlg2SFIRCIoW1pn/lx+g5Fs7BcXrIKHkWzsFxaNzhKTVULa4xo47/1A0dkQ9Uw4xUseBD0U0PMVrUP5OcWV056DhKXRK/aKEF9d8jllrOr65O8id15OUyB0ldo9GvwqIAiel3wREg8MyEbdGR6F5M/R/8tA/6wPeVhatu8NaOAAAAABJRU5ErkJggg==",IS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAAAAXNSR0IArs4c6QAADlRJREFUeJztXUGyqywTPf7lUhiwFAYuxYFLycClMHApDFiKVf6D2KRt0WgC5H3vcapS916T2A3dfWga5AIVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRV/GZpE91kKyqqoqEiE/134zMJeu+vGmKXve/R9D+ccjDEwxsBai77vkytMUEotfd8vSqmYbhVpsVx4ZQezdbU3AGtt8P/1Z3r0fb/0fR86nv52zi3GmEUptRhjFmPMYq1dnHPLPM+Lc26x1i7W2uQGo+C31v5xJED6ZDPIdSyCJL+6F1bbW2uDvZ1zwR+MMacDReT6LXBH569v7vkJhL/9zO+4DlmJkYKZhJADkEBh+MNridVarLXLPM/BAf8Eo1CAUGD8kASWA5L8+H5E5pLgiQxoIOCkADFofCOft4n/XpIIyOfI75jsonamkZ/HZDZS5GkGmCG4cOyDPTsBkKPJNOhXREC6zPP8k/QYwj4UdPM8p8jC3hK8HBRIplIqkMY38pVS4Z7UNk5uuUmAZHCf44NPSRLisUf+li0b5kwee5Hh5UjAfyZV6IkN89GUhEYpmRGUMA7pgOO+yoUoMVPACL2+lnH04gEfGzDW92+Dt4NkcFIrQQJcBx74YD6IAkTP20nBz6fZOTKSQyc+SPNLTAF2zoV1VOCpGV0TU4RsOMg+stUoJMFRgMgpSKIaTJTYifRxbPNNP3zaTt4Ocnru/DwwRLu/BmUw8v7yJwoQALfzPM+LJCYASXW5E8BvR4gUCp3otQkCsMDjZJBYj51eMQLIMVflo5CcExMJSj3wnR2uEDx/L/q9TwTLrIbm4PQ7n/vyTJD64sP2Bsh0n9fDUrTvCiTBU+DzLCgyFf8aqW6YWrEoAdArwsqb4lEC+VGQvFgNILH8TdDze8emP5HXbXkXX1e++xH4nJc7Pc/4KDip3pAq6+NzfiKfSLuy+BaXx23N28zf+0SP030AzjnM84x5nj9vRSasOtHmougmI6VUdj3IEZ1zcAbw3sM5B+dcVh2UUvDew3uPaZrQ9z2GYcA4jvDeZ5G5ouEvay35STZy9d43ANB1HYZhAABM0wStNQDAGINpmgA8+4U+kwLjODbTNMFaCwBo23b3GYqRVNMO4OlX3ntoraGUCvtrxnEEsG0z+QFDGj2ITY+My5eDjr4fKYx9rdNJVTkwolwayZEB8GUh6ofZYnEGm3aLZbFvsRnluQ6RUSB5+s/f4LY48JMUBciYDruVDqoJyCXIBLJ3OvB+5kujrDj5NciefOoRWe6Tc/607ZYGlgpK5481QhBAEp3OSAnCQXKm/2z0D+lp6BOzTdsS1gA2hS5uAx5svO+/XYLDgVNRm3nxkb/P9wx8If9UB+mjTI9sBMDuudsfkZIA5NSDV/tv6HiKfT4j8C6FjaQfALBJCZ1z0Fp//SzAWoAJcoFQpIFSCm3bUmq6eO9DukQ/cyC0f03HgA5+BJSdYVi6uur7bR8swLM9fd+D9wWzQZChlEoxfWvwJBGStXBbKibbGxO+xG2VE9z3yA9oasCwIM+zKA2maQG2bbfWLl3XfSWvbVv0fb+ZelD7aEo0z/NCtl/lNdgG/tt2X3kWIMCZLascBr/NV2wjuVrrhgc/sCEd6oxsoFGNgr8bx6dxlAMeDm3bYhxHTj5J9aH7eu/hx/FJQCsJzfO8YGqDbVZi/BjOuXhdYZqghwFKKXSkQx4E/df59su/1nb7be1j194MNYoFwKbtqWsv4zhCa72pO/DgJ/lKKV5/aKgGRXWoM7wlgKeDt8DUQtk5kMBR8AMAzBy+AyDJ6B/06doQ8CVGmFOszqeUgmUPPokRqCGjfQnpwA0A+HEM5NON43NU6NqnDYbdSPg92D15u6188GvQSQPCWhtGQ9+1IQB42/0202vo8wBS6BJsSIVPGgQsZWOMhBNMBYI8CuYzP+KxwAfFdzidAmitG2ewwK7pX/f8OGcfDrruuydZAAC6t7OMy1BeA3YODhBSz10a/kqPWDAmIyHn3KK8hnrMmIbhmYKNI011Uom5DAo+StNVj0DYPkH/a60b59wSBoGuXYJ9xxFeKcB7mMcD8+OxBPtPLTzSTP+6rtvowEnAj+OegPD0zyuj4A00u0yi7wHKwgCYxwOYWkywse/flkcks07nFsrmpmEAjNnFYIJ6yxbzPC+zxfNFhT/+O79m8SrIrNXwlKmXlC2LUJbtNuPFsVTyCc650DbefuRdG35VnYXstd0728gp2zcIMsnGMR/g8tefKXWQ96afABbLVgNCUdRg4yfJ9BByZHw4g2TyqMgpi9+WbQziBWhnXqtQSXx/5+gi4HeBL15fKyB0kc4XDX5yvlSdIPWg6rYICmQkAOkEUbswO+RoO8kMuggfkP2eMvilDpvgE/3AAyAHEQGMBOxWHwr+lIQj20LXOQns/OLlk6e4lJrxNOQKKDVPOfff6bHWF2BElXtqQw3CK5dVD+A5LZlgYYwBq8gCiYt+G5nrJiDlt9MNai8hR7vlKoyEfD+1DsBr5SfIZP3gRwCPVz+QHt9W5WOYLRYYNs1a5aaW6ZxbMOgwrdr5PLCNh/Uzvmuhp3M/vDRBDHPAC8hpeO/9i4TM/Px7Ek1gHYCu3ThDDkywm6Lk+nvWtvuuhe8tIAKeiCFH3wMvPzgrMhEJqrF763yfouu6zQqQB+uHx0sP/vkcerQdGmfaxfevAYCQskCttW7Cyo5yUMAr4Fd45V7+oRxwIfiBG8uAWuvmtPIvPnv1vndAhiQdlFLPQOcvrB2wFoty6BLuGamyZ96G+6yu968CEwXBz1dEBHIFP4EHteyDEsEfZK/F0CnfEmi4v+eLHMLv5Z6Qq/1/ax/AO2R3/hvwY16jeO+fm33QbYIvJ/l57zfB/wtcGQj+FDLKHfwxbLLUhOi6rvG9fRtjbFPQJdwiAHLumBKlg/9IhzAFmdDkdAClVGBlIprco0DXdY0c+X4JSQQ5p39X8as+kXJz9EHXdQ1/CEzikxi8nQEor8MmD/4CAAw6u/GPGsmvl3DAwPQPF8igNGRfeO/zbP4R0Fo3XI70gWKIbDbaTA8LQW7CyTkYct+Oybnb7vtTADND9S8iAAAMGsprdD5/p78b1UuNPgbdxgGLOtzYPeUDOxJW+U5if8lXalE9gt3phaGMDwQ91rbu+mDsdiskucCJnwiYbPNfwO1gmed5od1u7sFG3eFpeOfc13vP38EZLFTdl4xbigCUUot7+OeDP+SIY/7iF8m2ykeDXQ+vh0Vyyn/3mdw6kB7u4bfLn4OG6svZwhks3P6qz28DuSIXYmBte9tdb/ctJZ3BslbWz5TLTgD0sJFc81Ve32r8N6AgcM7Bd20Y+Uo4Pu33j422iZ46PIQzWK6M8lZdr0R/CqXU4r3HLOqiVC1Xds7ui4GMRVzk9IPZYon5PnCf+G5tFOeNlPMPSoG11ps9yzmgB4UwAspNIIWhtYZzM+wakKtTZnU6KRPYzX2z6/Br8Cyk7cK18L5V+YvSic53uA09KLiHh19HfODp+y9ivt72j58U4euOv6i8dl4B7OQn5xwwtkUC8E9E7uLTGbz3za+CgfCr6n/p0Z/6mc6ckNn4XR9Iug+A8Isn4jhKOCM3stbPbZo06uSW771vpEzxfjbZV4t8pYqBscCPBWUplBh8DkinzDJgBM0P9gDsNqOcBURGPYrJuoo/Uacc4M/6HyH3SFyaaE7qDeH3u48/390IdOvmJXBEAqVT0l8Q0L+M9RQc+nMX6H/r6B+RCQCbE4DuPPl4iwB4A/kJLc45iNNXinbED0e94tnPEWKOkAPy3vS3tHlOHTistbcc/r+Oziv4rpXHzr/6np4azIXY8965nwGPgR+UwP91E52iyo7mzgp+VHNJufLk4aSHQJxAnkNA9nZmfyhGTj1iMmVf5JTNn71X678PyymPQH4W2rrK5X2RXRcSJo2f+gSgUx0iR07zTikRDMD+fwOUkrs7lYadwpRbNne2nU6FdAjyePsLDkQxm5e0e0xmzkNwokpwB8h5BFcMgXSEPNlBOXXgxzAV6/wVUmZJ2UcnPuU6CepMD3YS04uYIuSUSz4/magk8QmiW4BNBphVjyUS7LFrWbE5BmvtBHlcVG4d+Ogf/iNQydHPYtv+wn2PvaOVJIDd0WsyKyqhg5yGFJC5Izrz2P1j0Dx6cEHENCfXcmKT+pH8TVAUcoCcZyC+kytG/bzGF/IPZJXS4cjhS2ZiG78rNfoSONGZh939Q9jkMWgeNso0sevsWlYdeAHQPOwmEHlqlFoPhqDHyaiYTa6QlX8EeC8nqw4xX6O6T7FRcNWDF53J9/gAmMv/wUgHrJ2SBK7Kv7wMOA3Px3DNw0avnyicDFKW1hpd10H1D0zD9vFYnfHxfDIwP4aqbVu0bYt5nsEcMqlM/pMh6BK7nkqPo3ud6HX4nU9B9udHgKn+sbF/TLfUmIauIbnee0xDh7Ztd3sPUrWf34f7G38fwLMvmE9ekf3Rer152MWPA1T/2Fzn1xhhLGck8Y18AFze7nPhsE6hU0o9jmTfIcq78vw4xPY+NPR0HNchldxp6BouHwAFXsMdLfZe6n4nnej3WP+vn6H3c+1LiQZYTrnk+9LOJE/0y1v5XykYM24ug8dk87+5E8jAX99PphMLfHLws49nIZ0jJ5DESMjRfnn/s+uZfSLIpayAy88l9Gi3aQny4/bng81deX/NU3OxrADI6wBk4LNtx+QMOWRHsqDbI8C3OsRkcoLMKZ90APaZh9Qxp2yJUplPrM135f41BPArnDkB/0yBNLiR10sE4J+CSEb4s7b/MAv+Z+xdcQEFlmP/WPzLba+oqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKio+Hvxf9INUyW2N+RDAAAAAElFTkSuQmCC",kS="data:audio/wav;base64,UklGRjQKAABXQVZFZm10IBAAAAABAAEAcBcAAOAuAAACABAAZGF0YRAKAAAAFQDeALMAjACTABAAHgAVACAA5wAAABIAaQAFAO4AZAA4AG0AawA0ALMA9wAFANkA6wDQAKAApwClALEA1ADpAO4A1wDUAPcALADwAPkA5AACAPUAtQC+AMgA+QA2AFQAYAB+AH4AfgB+ACAAXQC3AMoAwQCQAKUAlQC8AM4A4AAZABcA6wDSALwArgDBANkAwwDyAPAA+QDrAM4AzAC3AMUAugDIAOcAAgA0AEkAcgB+AH4AfgB+AH4AfgB+AGsAYABdAB4A+QDbALEApwC3AKwA4gDbAN4AygCsAJ4AkACqAMMA4ADrAPcABwD5AOQAvgCeAJMAhQCcALcAwwDDAMMA4ADyAPIABQDwAPAA8ADrAOcA6wDgANQAvgDQAMEAygAeADYAZgB+AH4AfgB+AH4AewBrAHkAfgB+AHQAVgBNACUAFQAeAAkAEgAuADQATwBEAFYATQBgADQAFwDnAMEAvgCxALEAvAC6ALcAngCOAIkAgQCDAJoAoACqAJ4AswDBANIAvgCcAJoAqgCBAI4AtQC6AMUAtQDSAMwA2wAHAAcA9QAVACwALgAXAC4AIgDUAMoA1wDuAJcA2wDnABAAJwDbAGIANgA4AH4AfgB+AGkAbQB+AD8AfgAiAC4AOAALAD0AaQBZAGYAPwBUACUA+QD7AP4AvADSAOAAtwDFANIA0AAFACwAIgA2AFIAEgA4ABAAIgAHAOcA7gDbAMEAxQDDAKUAyACFAL4AgQC1AK4AvADpALEAEACsANcAEAAiACUAAAAVAPkAwwDwAPIAzACMANcA0ACTAPIAwQDyAMgA4ADwACcAEADrALwA8AAwAOQAAABSAPsAYABCAD8ALgBCAH0A6QA2ABwAFQBpANQANAAwAKMA5AClAP4A/gCjAPAAKQAiAMwARgAHAO4APQDIADYA0gD7AGYASwASAO4AaQCzAC4ABwCnAAcA6wB+AHcAMAB+APsALAAiACIAVAB0AAcATQAwAKAA8gDiAAAA3gBLAOsAugAnAOAArgD3AIkABQDiABIA+wDeANQAqgDQANIA2wDBAP4AowCjALcAmgDFAM4AsQCuALcAkACaAAcAswC+AM4AlQDDAAkApwDyAM4AsQApAOcA8gAeACkAEgBkAPsAVAAJACwAfgA4ABwAawAiAAkAVgD7ABwAGQAHACwALgA/APsAPQB0ABkANABLAAAAOwAyADIAUgA0ABIAFQA9APAAGQDwAMEA6QDIAOcAFwAFANsAEAAJAK4A/gAZAOcAEgBJAPIABwAXANQA8gDwAPIAtQAJANcAHAAcAMMAEgCqAP4AEgDnANAA9QDgAJcA6wAQALwAJwDIANAA8ADpALMAngDXALoAEgCeANkA3gDpAMoABQDSABkA8AASAD0APwDXAAkAPwBNADYATwD1AD8AUgDIAAcAEgD1ACwA4gD+ABIA+QD7ACkA5AAVAEQAEADbABwAzgDSAB4A0AAQAN4AEgDbANkAJQDgAFIA/gAyACIA7gBCANsAHgDZAEIAHAD+ABIA0AAVACAA5AA/AB4A5wAHAPUAAgAlAOAA+wA7APUABwBWAM4A1wAiAPIAFwD1AIcA0gD+AMoAAAD3AJwAiQC8APUAzgApAAsA6QDeAEIA0AD+AAsAswAsAPUA1AACAAkAugAAAPAA9QDyAOkA9wDeAAAAJwAnACwA6wB3AAcABwAQABAABwDuAD8A7gALAAIAAgAFAN4ACQD5AOAA6wDpAEQA6wAlAOcARAAlACkAMgDUANIADgD+AM4ATwDSAPUACQDFAMgAwQALAOkA4AAJABkABwDeABUAPwDbAAcAFwA7APIADgD1ABAA2wD+ABwA9wAVAPcAtwASAPsAEADpAB4A2QDnAOIAEABJAAkABQAuAOcAHgAJABkAOwBSAC4A9QBNADsAFQAOAB4ABQA9AOsABwBNAOsA4AAFAOsA3gCuAN4ApwDKAJoAxQD7AKMAwwAOAMgArADiAMMAwwD5APUAzADpANIAugDrANAAyAAJAAIA9wDwANkAugASAOkA6QBGANsA+QAAABkANAAyADAAzgAwAE0AEAA4AEkANgAXADIANgAnACwAFQBJACkASQBNAPUAFQAHABkAIAApAPcAJwAcAPAADgD+ABcAygAAAAIA/gCMAP4AtQC1APcAzgALAMgAzgDnAOQAFQDyABUA+wALAAcA9QAHAP4ACQASABwAGQD3ADAAHADrADAABwAgAB4A9wAHAOQA6QD3AO4A6wDkANkA+QDeAOsA2wDiANQAAADIALoA4ADeANcA3gAJAMwAwQDOAOQAxQAGAMMABgDgAPIAEQDhAPIAFgDYABQANgABAA8ABgAcABEAEQAvACcA9wAlAD4ADQBEADIADQArAB8AMAAfADcAKwApADYAPAAKAAAAIwAjAEsA7wAVAAkA4wATAB4A8wAdAAQA5AD+AAQA8QD7ANgAAADnANUA9gDfAO8A6wDMAAkA5QDfAA4AxgAHANcAugDyANgAzwC9AOoA5gCoAM8A7QDeAOcA6gD0AOAA6ADXAAUADQDUABwA6gARAOsA7gArANEA5QDjAN4A+gAJAAAAEgDZAAgAAQDzABsA8wAWAP4AAQATAO8AFwABAPoALwAZADIA9wA2AC4AHAATAB4ARwAaAEgAGgAcADwAJABXADcAJwAjAC0AKgBEACoALwAPABEA/gAeAPQA6ADtAPoA3wDAAAoA6ADFAA8A6QDoALkAyADKANcApADQAMgApgC7AMsAzQC4AMgA5QDQALsA3gD7ANUA7wDVAOoA5QDdAOgAAwD1AOwA5gAcAPMACQASABIAHQABACEAKAASACUAHQA9ACwALAAvACMADQAzABMAMgD7AC0AFwAFABEAHAAhAP4AIAAgAAAAAwAVAA0AHAAnAPAADQDmAA0A5wAFAB0A2gDuAAgA1QAJAOIA/ADiAOIA6gDqAOQA+wD2AOsA+wDyAPoAEgDxAO0AAADoAAAA+wAAAOgA6QDkAOoA7gDlAOwA9QDiAAkA7AADABAA7wAYAP0AGwAJAP0AGADuAO8AAAD2AOsA9wANAPAABAD7APQACAADAPQACgAAAPEACwAHAO8A7wD9AAUA+AAFAAgA8AD7AAUA+gD5AAcAAgAKAAAA/AAPAAAADAADAAIACwAEABMAHQAAAAYACAATAAIAHAATAAkACQAGAAgAAgANAAAAAwAAAAYA/AD8AP0A/AD5APkABADsAP0A7wD4APIA7AAEAN8AAAD0AN8A9AD6APEAAQD0AO4A/wDpAPYA+QDmAPwA7QD3AAAA+QD9AP4ABwD/AP0AAAADAPwA9wD+AAIACQD6AAwACwAEABAAAwAEAPcADwACAAwABQACAAcA9wAJAAYAAAD5AAYA+QAHAAcA9QAKAPsA/gD9AAEADA==",zS="data:audio/wav;base64,UklGRjQKAABXQVZFZm10IBAAAAABAAEAiBMAABAnAAACABAAZGF0YRAKAAAAFQDeALMAjACTABAAHgAVACAA5wAAABIAaQAFAO4AZAA4AG0AawA0ALMA9wAFANkA6wDQAKAApwClALEA1ADpAO4A1wDUAPcALADwAPkA5AACAPUAtQC+AMgA+QA2AFQAYAB+AH4AfgB+ACAAXQC3AMoAwQCQAKUAlQC8AM4A4AAZABcA6wDSALwArgDBANkAwwDyAPAA+QDrAM4AzAC3AMUAugDIAOcAAgA0AEkAcgB+AH4AfgB+AH4AfgB+AGsAYABdAB4A+QDbALEApwC3AKwA4gDbAN4AygCsAJ4AkACqAMMA4ADrAPcABwD5AOQAvgCeAJMAhQCcALcAwwDDAMMA4ADyAPIABQDwAPAA8ADrAOcA6wDgANQAvgDQAMEAygAeADYAZgB+AH4AfgB+AH4AewBrAHkAfgB+AHQAVgBNACUAFQAeAAkAEgAuADQATwBEAFYATQBgADQAFwDnAMEAvgCxALEAvAC6ALcAngCOAIkAgQCDAJoAoACqAJ4AswDBANIAvgCcAJoAqgCBAI4AtQC6AMUAtQDSAMwA2wAHAAcA9QAVACwALgAXAC4AIgDUAMoA1wDuAJcA2wDnABAAJwDbAGIANgA4AH4AfgB+AGkAbQB+AD8AfgAiAC4AOAALAD0AaQBZAGYAPwBUACUA+QD7AP4AvADSAOAAtwDFANIA0AAFACwAIgA2AFIAEgA4ABAAIgAHAOcA7gDbAMEAxQDDAKUAyACFAL4AgQC1AK4AvADpALEAEACsANcAEAAiACUAAAAVAPkAwwDwAPIAzACMANcA0ACTAPIAwQDyAMgA4ADwACcAEADrALwA8AAwAOQAAABSAPsAYABCAD8ALgBCAH0A6QA2ABwAFQBpANQANAAwAKMA5AClAP4A/gCjAPAAKQAiAMwARgAHAO4APQDIADYA0gD7AGYASwASAO4AaQCzAC4ABwCnAAcA6wB+AHcAMAB+APsALAAiACIAVAB0AAcATQAwAKAA8gDiAAAA3gBLAOsAugAnAOAArgD3AIkABQDiABIA+wDeANQAqgDQANIA2wDBAP4AowCjALcAmgDFAM4AsQCuALcAkACaAAcAswC+AM4AlQDDAAkApwDyAM4AsQApAOcA8gAeACkAEgBkAPsAVAAJACwAfgA4ABwAawAiAAkAVgD7ABwAGQAHACwALgA/APsAPQB0ABkANABLAAAAOwAyADIAUgA0ABIAFQA9APAAGQDwAMEA6QDIAOcAFwAFANsAEAAJAK4A/gAZAOcAEgBJAPIABwAXANQA8gDwAPIAtQAJANcAHAAcAMMAEgCqAP4AEgDnANAA9QDgAJcA6wAQALwAJwDIANAA8ADpALMAngDXALoAEgCeANkA3gDpAMoABQDSABkA8AASAD0APwDXAAkAPwBNADYATwD1AD8AUgDIAAcAEgD1ACwA4gD+ABIA+QD7ACkA5AAVAEQAEADbABwAzgDSAB4A0AAQAN4AEgDbANkAJQDgAFIA/gAyACIA7gBCANsAHgDZAEIAHAD+ABIA0AAVACAA5AA/AB4A5wAHAPUAAgAlAOAA+wA7APUABwBWAM4A1wAiAPIAFwD1AIcA0gD+AMoAAAD3AJwAiQC8APUAzgApAAsA6QDeAEIA0AD+AAsAswAsAPUA1AACAAkAugAAAPAA9QDyAOkA9wDeAAAAJwAnACwA6wB3AAcABwAQABAABwDuAD8A7gALAAIAAgAFAN4ACQD5AOAA6wDpAEQA6wAlAOcARAAlACkAMgDUANIADgD+AM4ATwDSAPUACQDFAMgAwQALAOkA4AAJABkABwDeABUAPwDbAAcAFwA7APIADgD1ABAA2wD+ABwA9wAVAPcAtwASAPsAEADpAB4A2QDnAOIAEABJAAkABQAuAOcAHgAJABkAOwBSAC4A9QBNADsAFQAOAB4ABQA9AOsABwBNAOsA4AAFAOsA3gCuAN4ApwDKAJoAxQD7AKMAwwAOAMgArADiAMMAwwD5APUAzADpANIAugDrANAAyAAJAAIA9wDwANkAugASAOkA6QBGANsA+QAAABkANAAyADAAzgAwAE0AEAA4AEkANgAXADIANgAnACwAFQBJACkASQBNAPUAFQAHABkAIAApAPcAJwAcAPAADgD+ABcAygAAAAIA/gCMAP4AtQC1APcAzgALAMgAzgDnAOQAFQDyABUA+wALAAcA9QAHAP4ACQASABwAGQD3ADAAHADrADAABwAgAB4A9wAHAOQA6QD3AO4A6wDkANkA+QDeAOsA2wDiANQAAADIALoA4ADeANcA3gAJAMwAwQDOAOQAxQAGAMMABgDgAPIAEQDhAPIAFgDYABQANgABAA8ABgAcABEAEQAvACcA9wAlAD4ADQBEADIADQArAB8AMAAfADcAKwApADYAPAAKAAAAIwAjAEsA7wAVAAkA4wATAB4A8wAdAAQA5AD+AAQA8QD7ANgAAADnANUA9gDfAO8A6wDMAAkA5QDfAA4AxgAHANcAugDyANgAzwC9AOoA5gCoAM8A7QDeAOcA6gD0AOAA6ADXAAUADQDUABwA6gARAOsA7gArANEA5QDjAN4A+gAJAAAAEgDZAAgAAQDzABsA8wAWAP4AAQATAO8AFwABAPoALwAZADIA9wA2AC4AHAATAB4ARwAaAEgAGgAcADwAJABXADcAJwAjAC0AKgBEACoALwAPABEA/gAeAPQA6ADtAPoA3wDAAAoA6ADFAA8A6QDoALkAyADKANcApADQAMgApgC7AMsAzQC4AMgA5QDQALsA3gD7ANUA7wDVAOoA5QDdAOgAAwD1AOwA5gAcAPMACQASABIAHQABACEAKAASACUAHQA9ACwALAAvACMADQAzABMAMgD7AC0AFwAFABEAHAAhAP4AIAAgAAAAAwAVAA0AHAAnAPAADQDmAA0A5wAFAB0A2gDuAAgA1QAJAOIA/ADiAOIA6gDqAOQA+wD2AOsA+wDyAPoAEgDxAO0AAADoAAAA+wAAAOgA6QDkAOoA7gDlAOwA9QDiAAkA7AADABAA7wAYAP0AGwAJAP0AGADuAO8AAAD2AOsA9wANAPAABAD7APQACAADAPQACgAAAPEACwAHAO8A7wD9AAUA+AAFAAgA8AD7AAUA+gD5AAcAAgAKAAAA/AAPAAAADAADAAIACwAEABMAHQAAAAYACAATAAIAHAATAAkACQAGAAgAAgANAAAAAwAAAAYA/AD8AP0A/AD5APkABADsAP0A7wD4APIA7AAEAN8AAAD0AN8A9AD6APEAAQD0AO4A/wDpAPYA+QDmAPwA7QD3AAAA+QD9AP4ABwD/AP0AAAADAPwA9wD+AAIACQD6AAwACwAEABAAAwAEAPcADwACAAwABQACAAcA9wAJAAYAAAD5AAYA+QAHAAcA9QAKAPsA/gD9AAEADA==",OS=()=>({SpriteSheet:new as(MS),GlovesSheet:new as(PS),StarsSheet:new as(BS),StanleySheet:new as(IS),PunchHiSound:new kd(kS),PunchLowSound:new kd(zS)}),Fe=3,y0=70,dd=76,zd=57,Od=32,A0=36,v0=36,US=32,LS=64,FS=50,NS=40,x0=.8,HS=.9,Jy=8,le={THROW_GLOVES:[0,1,2,3],READY:3,GRAB_REACH:4,HIGH_WINDUP:5,HIGH_CONNECT:6,LOW_CONNECT:7,HIT_LOW:13,HIT_HIGH:14,FALL_1:15,FALL_2:16,WIN:[0,1,2,3,4,5,6,7]},ge=16.6,Wl={idle:{frames:[le.READY],durations:[9999],loop:!0},ready:{frames:[le.READY],durations:[9999],loop:!0},throw_gloves:{frames:[le.THROW_GLOVES[0],...le.THROW_GLOVES],durations:[60*ge,16*ge,16*ge,8*ge,6*ge],loop:!1,next:"ready",dropFrame:3},high_punch:{frames:[le.HIGH_WINDUP,le.HIGH_CONNECT,le.READY],durations:[5*ge,12*ge,8*ge],loop:!1,next:"ready",hitFrame:1,hitType:"high"},low_punch:{frames:[le.HIGH_WINDUP,le.LOW_CONNECT,le.READY],durations:[5*ge,12*ge,8*ge],loop:!1,next:"ready",hitFrame:1,hitType:"low"},grab:{frames:[le.GRAB_REACH,le.READY],durations:[20*ge,6*ge],loop:!1,next:"ready",hitFrame:0,hitType:"grab"},hit_high:{frames:[le.HIT_HIGH,le.READY],durations:[16*ge,8*ge],loop:!1,next:"ready"},hit_low:{frames:[le.HIT_LOW,le.READY],durations:[16*ge,8*ge],loop:!1,next:"ready"},held:{frames:[le.GRAB_REACH,le.READY],durations:[30*ge,4*ge],loop:!1,next:"ready"},falling:{frames:[le.FALL_1,le.FALL_2],durations:[12*ge,20*ge],loop:!1,next:"down"},down:{frames:[le.FALL_2],durations:[9999],loop:!0},win:{frames:le.WIN,durations:[300,300,300,300,300,300,300,300],loop:!0,isStanley:!0}};class sc extends Gi{constructor(t,e,s){super({pos:L(t,e),width:3,height:3,color:tt.fromHex("#b91c1c"),z:20}),this.currentZ=0,this.gravity=800,this.landed=!1;const r=(Math.random()*300+50)*s,l=-(Math.random()*400+100);this.velocity=L(r,l),this.zVelocity=Math.random()*450+50,this.wallZ=150,this.floorY=360+(Math.random()*20-10)}onPreUpdate(t,e){if(this.landed)return;const s=e/1e3;if(this.velocity.y+=this.gravity*s,this.pos.x+=this.velocity.x*s,this.pos.y+=this.velocity.y*s,this.currentZ+=this.zVelocity*s,this.currentZ>=this.wallZ){this.stickToSurface();return}this.pos.y>=this.floorY&&(this.pos.y=this.floorY,this.velocity.y>50?(this.velocity.x=Math.random()*300-150,this.velocity.y*=-.4):(this.velocity.y=0,this.velocity.x*=.8),Math.abs(this.velocity.y)<10&&Math.abs(this.velocity.x)<10&&this.stickToSurface())}stickToSurface(){this.landed=!0,this.velocity=L(0,0),this.zVelocity=0,this.color=tt.fromHex("#7f1d1d"),this.z=-1;const e=1-Math.min(Math.max(this.currentZ/this.wallZ,0),1)*.6;this.scale=L(e,e)}}class b0 extends Gi{constructor(t,e,s){super({pos:L(t,e),width:y0*Fe,height:dd*Fe,anchor:L(.5,.5)}),this.isLocal=!0,this.health=5,this.maxHealth=5,this.state="idle",this.opponent=null,this.animations=new Map,this.animLocked=!0,this.hitDealt=!1,this.glovesDropped=!1,this.vx=0,this.isPlayer1=s,this.facingRight=s}onInitialize(t){const e=t;this.spriteSheet=cs.fromImageSource({image:e.resources.SpriteSheet,grid:{rows:17,columns:1,spriteWidth:y0,spriteHeight:dd}}),Object.keys(Wl).forEach(s=>{const r=s,l=Wl[r];let h;if(l.isStanley){const f=cs.fromImageSource({image:e.resources.StanleySheet,grid:{rows:1,columns:8,spriteWidth:US,spriteHeight:LS}});h=l.frames.map((g,_)=>{const y=f.getSprite(g,0);return{graphic:new $r({members:[{graphic:y,offset:L(0,-12)}]}),duration:l.durations[_]||300}})}else h=l.frames.map((f,g)=>({graphic:this.spriteSheet.getSprite(0,f),duration:l.durations[g]||100}));const u=new cy({frames:h,strategy:l.loop?Dd.Loop:Dd.Freeze});u.scale=L(Fe,Fe),this.animations.set(r,u)}),this.setupStarIndicator(e),this.setState("throw_gloves")}setupStarIndicator(t){const e=new Gi({pos:L(0,dd*Fe/2-115),width:A0*Fe,height:v0*Fe,anchor:L(.5,.5),z:-1}),r=cs.fromImageSource({image:t.resources.StarsSheet,grid:{rows:1,columns:2,spriteWidth:A0,spriteHeight:v0}}).getSprite(this.isPlayer1?0:1,0);r&&(r.scale=L(Fe,Fe),this.graphics.use(r)),this.addChild(e)}onPreUpdate(t,e){t.isReplaying||(this.isLocal&&this.handleInput(t),this.applyPhysics(),this.checkCollisions(),this.updateAnimationLogic(),this.updateGraphics())}getSyncState(){return{x:this.pos.x,y:this.pos.y,vx:this.vx,state:this.state,facingRight:this.facingRight,health:this.health}}syncFromNetwork(t){this.pos.x=t.x,this.pos.y=t.y,this.vx=t.vx,this.facingRight=t.facingRight,this.health=t.health,this.state!==t.state&&this.setState(t.state)}getSnapshot(){const t=this.graphics.current,e=t?t.currentFrameIndex:0;return{x:this.pos.x,y:this.pos.y,state:this.state,frameIndex:e,facingRight:this.facingRight,health:this.health,visible:this.graphics.visible}}setFromSnapshot(t){if(this.pos.x=t.x,this.pos.y=t.y,this.facingRight=t.facingRight,this.health=t.health,this.graphics.visible=t.visible,this.state!==t.state){this.state=t.state;const s=this.animations.get(this.state);s&&this.graphics.use(s)}const e=this.graphics.current;e&&(e.currentFrameIndex!==t.frameIndex&&e.goToFrame(t.frameIndex),e.pause()),e&&(e.flipHorizontal=!this.facingRight)}setState(t){if(this.state==="down"||this.state===t)return;this.state=t,this.hitDealt=!1,this.glovesDropped=!1,t==="win"&&(this.vx=0);const e=Wl[t];this.animLocked=!e.loop;const s=this.animations.get(t);if(s){if(s.reset(),t==="win"){const r=this.isPlayer1?3:7;s.goToFrame(r)}s.play(),this.graphics.use(s)}}handleInput(t){if(this.animLocked||this.state==="held"||this.state==="falling"||this.state==="down"||this.state==="win")return;const e=t.input.keyboard,r=t.networkManager!==null;let l=!1,h=!1,u=!1,f=!1,g=!1;r?((e.isHeld(Wt.A)||e.isHeld(Wt.Left))&&(l=!0),(e.isHeld(Wt.D)||e.isHeld(Wt.Right))&&(h=!0),(e.wasPressed(Wt.J)||e.wasPressed(Wt.Num1)||e.wasPressed(Wt.Numpad1))&&(u=!0),(e.wasPressed(Wt.K)||e.wasPressed(Wt.Num2)||e.wasPressed(Wt.Numpad2))&&(f=!0),(e.wasPressed(Wt.L)||e.wasPressed(Wt.Num3)||e.wasPressed(Wt.Numpad3))&&(g=!0)):this.isPlayer1?(l=e.isHeld(Wt.A),h=e.isHeld(Wt.D),u=e.wasPressed(Wt.J),f=e.wasPressed(Wt.K),g=e.wasPressed(Wt.L)):(l=e.isHeld(Wt.Left),h=e.isHeld(Wt.Right),u=e.wasPressed(Wt.Num1)||e.wasPressed(Wt.Numpad1),f=e.wasPressed(Wt.Num2)||e.wasPressed(Wt.Numpad2),g=e.wasPressed(Wt.Num3)||e.wasPressed(Wt.Numpad3)),l&&(this.vx-=x0),h&&(this.vx+=x0),u&&this.setState("high_punch"),f&&this.setState("low_punch"),g&&this.setState("grab")}applyPhysics(){this.transform.pos.x+=this.vx,this.vx*=HS;const t=100;this.transform.pos.x<t&&(this.transform.pos.x=t),this.transform.pos.x>800-t&&(this.transform.pos.x=800-t)}checkCollisions(){if(!this.opponent||this.state==="down"||this.state==="falling")return;const t=NS;Math.abs(this.transform.pos.x-this.opponent.transform.pos.x)<t&&(this.transform.pos.x<this.opponent.transform.pos.x?this.transform.pos.x=this.opponent.transform.pos.x-t:this.transform.pos.x=this.opponent.transform.pos.x+t,this.vx=0),this.facingRight=this.transform.pos.x<this.opponent.transform.pos.x}updateAnimationLogic(){const t=this.animations.get(this.state);if(!t)return;const e=Wl[this.state],s=t.currentFrameIndex;t.done&&!e.loop&&e.next&&(this.setState(e.next),this.animLocked=!1),e.dropFrame!==void 0&&s===e.dropFrame&&!this.glovesDropped&&(this.dropGloves(),this.glovesDropped=!0),this.isLocal&&e.hitFrame!==void 0&&s===e.hitFrame&&!this.hitDealt&&this.opponent&&this.checkHit(e.hitType)}checkHit(t){var s,r;if(!this.opponent)return;if(Math.abs(this.transform.pos.x-this.opponent.transform.pos.x)<=FS){this.hitDealt=!0;const l=(s=this.scene)==null?void 0:s.engine,h=l==null?void 0:l.networkManager;let u=!1;if(t==="grab")this.opponent.canBeGrabbed()&&(this.opponent.setState("held"),u=!0);else if(this.opponent.canBeHit()){this.opponent.takeDamage(t);const f=this.transform.pos.x<this.opponent.transform.pos.x?1:-1;if(this.opponent.vx+=f*Jy,this.scene&&this.scene.engine&&(l.shake(200,5),l.playHitSound(t)),t==="high"){const g=6+Math.floor(Math.random()*4);for(let _=0;_<g;_++){const y=this.opponent.pos.x,A=this.opponent.pos.y-70+(Math.random()*20-10),x=new sc(y,A,f);(r=this.scene)==null||r.add(x)}}u=!0}h&&u&&t!=="grab"&&l.sendHit(t,!this.isPlayer1)}}canBeGrabbed(){return!this.animLocked||this.state==="ready"}canBeHit(){return["idle","ready","held","high_punch","low_punch","grab"].includes(this.state)}takeDamage(t){this.health--,this.health<=0?this.setState("falling"):this.setState(t==="high"?"hit_high":"hit_low")}dropGloves(){var t;(t=this.scene)==null||t.emit("glovesDropped",{x:this.transform.pos.x+(this.isPlayer1?-20:20),y:this.transform.pos.y+60,isPlayer1:this.isPlayer1})}updateGraphics(){const t=this.animations.get(this.state);t&&(this.state==="win"&&!this.isPlayer1?t.flipHorizontal=!1:t.flipHorizontal=!this.facingRight)}}class fd extends Gi{constructor(t,e,s){super({pos:L(t,e),width:zd*Fe,height:Od*Fe,anchor:L(.5,.5)}),this.landed=!1,this.isPlayer1=s,this.targetY=e+20}onInitialize(t){const e=t,r=cs.fromImageSource({image:e.resources.GlovesSheet,grid:{rows:1,columns:2,spriteWidth:zd,spriteHeight:Od}}).getSprite(this.isPlayer1?0:1,0);r&&(r.scale=L(Fe,Fe),this.graphics.use(r))}onPreUpdate(t,e){var s;this.pos.y<this.targetY&&(this.pos.y+=30*(e/1e3),this.pos.y>=this.targetY&&(this.pos.y=this.targetY,this.landed||(this.landed=!0,(s=this.scene)==null||s.emit("glovesLanded",{}))))}}class GS extends RS{constructor(t){super(t),this.isGameOver=!1,this.winner=null,this.shakeTimer=0,this.shakeStrength=0,this.koTimer=0,this.glovesLanded=!1,this.winTriggered=!1,this.networkManager=null,this.isHost=!1,this.isReplaying=!1,this.replayBuffer=[],this.replayIndex=0,this.playbackSpeed=1,this.currentFrameSounds=[],this.replayPool=[],this.handlePostUpdate=e=>{this.isReplaying?this.handleReplayLogic():(this.recordReplayFrame(),this.checkGameOver(),this.updateCamera(e.elapsed),this.networkManager&&this.broadcastState()),this.updateUI()},this.onGlovesDropped=e=>{const s=new fd(e.x,e.y,e.isPlayer1);this.currentScene.add(s)},this.onGlovesLanded=()=>{this.glovesLanded=!0},this.resources=OS()}async start(){const t=new mc([this.resources.SpriteSheet,this.resources.GlovesSheet,this.resources.StarsSheet,this.resources.StanleySheet,this.resources.PunchHiSound,this.resources.PunchLowSound]);return t.suppressPlayButton=!0,this.bloodRect=new Mc({width:3,height:3,color:tt.White}),super.start(t).then(()=>{const e=cs.fromImageSource({image:this.resources.GlovesSheet,grid:{rows:1,columns:2,spriteWidth:zd,spriteHeight:Od}});this.gloveSpriteP1=e.getSprite(0,0),this.gloveSpriteP1.scale=L(Fe,Fe),this.gloveSpriteP2=e.getSprite(1,0),this.gloveSpriteP2.scale=L(Fe,Fe)})}setupGame(t){this.uiCallback=t}playHitSound(t){this.isReplaying||(t==="high"?this.resources.PunchHiSound.play(.5):this.resources.PunchLowSound.play(.5),this.currentFrameSounds.push(t))}setupNetwork(t,e){this.networkManager=t,this.isHost=e,this.networkManager.onMessage=s=>{if(s.type==="SYNC")(this.isHost?this.player2:this.player1).syncFromNetwork(s.payload);else if(s.type==="HIT"){const r=s.payload.targetP1,l=s.payload.damageType,h=r?this.player1:this.player2,u=r?this.player2:this.player1;h.takeDamage(l);const f=u.pos.x<h.pos.x?1:-1;if(h.vx+=f*Jy,this.shake(200,5),this.playHitSound(l),l==="high"){const g=6+Math.floor(Math.random()*4);for(let _=0;_<g;_++){const y=h.pos.x,A=h.pos.y-70+(Math.random()*20-10),x=new sc(y,A,f);this.currentScene.add(x)}}}else s.type==="RESTART"&&this.reset()},this.reset()}sendHit(t,e){this.networkManager&&this.networkManager.send({type:"HIT",payload:{damageType:t,targetP1:e}})}broadcastState(){var e;if(!this.player1||!this.player2)return;const t=this.isHost?this.player1:this.player2;(e=this.networkManager)==null||e.send({type:"SYNC",payload:t.getSyncState()})}restartGame(){this.reset(),this.networkManager&&this.networkManager.send({type:"RESTART",payload:{}})}shake(t,e){this.shakeTimer=t,this.shakeStrength=e}reset(){this.currentScene.clear(),this.isGameOver=!1,this.winner=null,this.shakeTimer=0,this.koTimer=0,this.glovesLanded=!1,this.winTriggered=!1,this.isReplaying=!1,this.replayBuffer=[],this.replayIndex=0,this.playbackSpeed=1,this.replayPool=[],this.currentFrameSounds=[],this.currentScene.camera.zoom=1,this.currentScene.camera.pos=new B(400,200);const t=400/2+50;this.player1=new b0(250,t,!0),this.player2=new b0(550,t,!1),this.networkManager?this.isHost?(this.player1.isLocal=!0,this.player2.isLocal=!1):(this.player1.isLocal=!1,this.player2.isLocal=!0):(this.player1.isLocal=!0,this.player2.isLocal=!0),this.player1.opponent=this.player2,this.player2.opponent=this.player1,this.currentScene.add(this.player1),this.currentScene.add(this.player2),this.currentScene.off("glovesDropped",this.onGlovesDropped),this.currentScene.off("glovesLanded",this.onGlovesLanded),this.currentScene.on("glovesDropped",this.onGlovesDropped),this.currentScene.on("glovesLanded",this.onGlovesLanded),this.off("postupdate",this.handlePostUpdate),this.on("postupdate",this.handlePostUpdate)}toggleReplay(t){this.isReplaying=t,t?(this.replayIndex=0,this.playbackSpeed=1,this.currentScene.actors.forEach(e=>{(e instanceof sc||e instanceof fd)&&e.kill()})):this.replayBuffer.length>0&&this.applySnapshot(this.replayBuffer[this.replayBuffer.length-1])}setPlaybackSpeed(t){this.playbackSpeed=t}seekTo(t){this.replayBuffer.length&&(this.replayIndex=Math.floor(Math.max(0,Math.min(1,t))*(this.replayBuffer.length-1)))}recordReplayFrame(){if(this.isGameOver&&this.koTimer>5e3)return;const t=[];this.currentScene.actors.forEach(e=>{e instanceof sc?t.push({type:"blood",x:e.pos.x,y:e.pos.y,scale:e.scale.x,color:e.color.toHex(),zIndex:e.z}):e instanceof fd&&t.push({type:"glove",x:e.pos.x,y:e.pos.y,scale:e.scale.x,zIndex:e.z,isPlayer1:e.isPlayer1})}),this.player1&&this.player2&&(this.replayBuffer.push({p1:this.player1.getSnapshot(),p2:this.player2.getSnapshot(),cameraPos:{x:this.currentScene.camera.pos.x,y:this.currentScene.camera.pos.y},cameraZoom:this.currentScene.camera.zoom,entities:t,sounds:[...this.currentFrameSounds]}),this.currentFrameSounds=[])}handleReplayLogic(){if(this.replayBuffer.length===0)return;const t=Math.floor(this.replayIndex);this.replayIndex+=this.playbackSpeed,this.replayIndex>=this.replayBuffer.length-1&&(this.replayIndex=this.replayBuffer.length-1,this.playbackSpeed=0),this.replayIndex<0&&(this.replayIndex=0,this.playbackSpeed=0);const e=Math.floor(this.replayIndex);if(this.playbackSpeed>0&&e>t)for(let r=t+1;r<=e;r++){const l=this.replayBuffer[r];l&&l.sounds&&l.sounds.forEach(h=>{h==="high"?this.resources.PunchHiSound.play(.5):h==="low"&&this.resources.PunchLowSound.play(.5)})}const s=this.replayBuffer[e];s&&this.applySnapshot(s)}applySnapshot(t){this.player1.setFromSnapshot(t.p1),this.player2.setFromSnapshot(t.p2),this.currentScene.camera.pos=new B(t.cameraPos.x,t.cameraPos.y),this.currentScene.camera.zoom=t.cameraZoom;let e=0;for(const s of t.entities){let r;e>=this.replayPool.length?(r=new Gi({anchor:L(.5,.5)}),this.currentScene.add(r),this.replayPool.push(r)):r=this.replayPool[e],r.pos.x=s.x,r.pos.y=s.y,r.z=s.zIndex,r.scale=L(s.scale,s.scale),r.graphics.visible=!0,s.type==="blood"?(r.graphics.use(this.bloodRect),r.color=tt.fromHex(s.color)):s.type==="glove"&&(r.graphics.use(s.isPlayer1?this.gloveSpriteP1:this.gloveSpriteP2),r.color=tt.White),e++}for(let s=e;s<this.replayPool.length;s++)this.replayPool[s].graphics.visible=!1}updateCamera(t){var rt;if(!this.player1||!this.player2)return;const e=800,s=400;let r=1,l=400,h=s/2;if(!this.glovesLanded)r=1,l=400,h=200;else if(this.isGameOver&&this.winner)if(this.koTimer+=t,this.koTimer<2e3){const pt=this.winner==="PLAYER 2"?this.player1:this.player2;r=3.5;const At=pt.pos.x<(((rt=pt.opponent)==null?void 0:rt.pos.x)??0)?1:-1;l=pt.pos.x+25*At,h=pt.pos.y-50}else r=1,l=400,h=200;else{const pt=this.player1.pos.x,At=this.player2.pos.x,bt=(pt+At)/2,Et=Math.abs(pt-At),I=1,K=1.4,E=Et+250;r=e/E,r=Math.max(I,Math.min(r,K)),l=bt,h=s/2}const u=.02,f=this.currentScene.camera.zoom,g=f+(r-f)*u;this.currentScene.camera.zoom=g;const _=e/g,y=s/g,A=_/2,x=y/2,D=A,S=800-A,U=x,R=400-x;l=Math.max(D,Math.min(l,S)),h=Math.max(U,Math.min(h,R));const C=this.currentScene.camera.pos.x,O=this.currentScene.camera.pos.y,G=C+(l-C)*u,q=O+(h-O)*u;let et=0,k=0;this.shakeTimer>0&&(this.shakeTimer-=t,this.shakeTimer<0&&(this.shakeTimer=0),et=Math.random()*this.shakeStrength*2-this.shakeStrength,k=Math.random()*this.shakeStrength*2-this.shakeStrength),this.currentScene.camera.pos=new B(G+et,q+k)}checkGameOver(){this.isGameOver||(this.player1.state==="down"||this.player1.state==="falling"?(this.isGameOver=!0,this.winner="PLAYER 2"):(this.player2.state==="down"||this.player2.state==="falling")&&(this.isGameOver=!0,this.winner="PLAYER 1")),this.isGameOver&&!this.winTriggered&&this.winner&&this.koTimer>1e3&&(this.winTriggered=!0,this.winner==="PLAYER 1"?this.player1.setState("win"):this.player2.setState("win"))}updateUI(){if(this.uiCallback){const t=this.replayBuffer.length,e=t>0?this.replayIndex/t:0;this.uiCallback({p1Health:this.player1.health,p2Health:this.player2.health,p1State:this.player1.state.toUpperCase().replace("_"," "),p2State:this.player2.state.toUpperCase().replace("_"," "),gameOver:this.isGameOver,showGameOver:this.isGameOver&&this.koTimer>3e3,winner:this.winner,isReplaying:this.isReplaying,replayProgress:e,replaySpeed:this.playbackSpeed,isMultiplayer:!!this.networkManager,connectionStatus:this.networkManager?"connected":"disconnected",roomId:this.networkManager?"...":void 0,isHost:this.isHost})}}}class QS{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(t){this.flush(),this._parts.push(t)}append(t){this._pieces.push(t)}flush(){if(this._pieces.length>0){const t=new Uint8Array(this._pieces);this._parts.push(t),this._pieces=[]}}toArrayBuffer(){const t=[];for(const e of this._parts)t.push(e);return VS(t).buffer}}function VS(o){let t=0;for(const r of o)t+=r.byteLength;const e=new Uint8Array(t);let s=0;for(const r of o){const l=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);e.set(l,s),s+=r.byteLength}return e}function Ky(o){return new YS(o).unpack()}function $y(o){const t=new jS,e=t.pack(o);return e instanceof Promise?e.then(()=>t.getBuffer()):t.getBuffer()}class YS{constructor(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const t=this.unpack_uint8();if(t<128)return t;if((t^224)<32)return(t^224)-32;let e;if((e=t^160)<=15)return this.unpack_raw(e);if((e=t^176)<=15)return this.unpack_string(e);if((e=t^144)<=15)return this.unpack_array(e);if((e=t^128)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}}unpack_uint8(){const t=this.dataView[this.index]&255;return this.index++,t}unpack_uint16(){const t=this.read(2),e=(t[0]&255)*256+(t[1]&255);return this.index+=2,e}unpack_uint32(){const t=this.read(4),e=((t[0]*256+t[1])*256+t[2])*256+t[3];return this.index+=4,e}unpack_uint64(){const t=this.read(8),e=((((((t[0]*256+t[1])*256+t[2])*256+t[3])*256+t[4])*256+t[5])*256+t[6])*256+t[7];return this.index+=8,e}unpack_int8(){const t=this.unpack_uint8();return t<128?t:t-256}unpack_int16(){const t=this.unpack_uint16();return t<32768?t:t-65536}unpack_int32(){const t=this.unpack_uint32();return t<2**31?t:t-2**32}unpack_int64(){const t=this.unpack_uint64();return t<2**63?t:t-2**64}unpack_raw(t){if(this.length<this.index+t)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${t} ${this.length}`);const e=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,e}unpack_string(t){const e=this.read(t);let s=0,r="",l,h;for(;s<t;)l=e[s],l<160?(h=l,s++):(l^192)<32?(h=(l&31)<<6|e[s+1]&63,s+=2):(l^224)<16?(h=(l&15)<<12|(e[s+1]&63)<<6|e[s+2]&63,s+=3):(h=(l&7)<<18|(e[s+1]&63)<<12|(e[s+2]&63)<<6|e[s+3]&63,s+=4),r+=String.fromCodePoint(h);return this.index+=t,r}unpack_array(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]=this.unpack();return e}unpack_map(t){const e={};for(let s=0;s<t;s++){const r=this.unpack();e[r]=this.unpack()}return e}unpack_float(){const t=this.unpack_uint32(),e=t>>31,s=(t>>23&255)-127,r=t&8388607|8388608;return(e===0?1:-1)*r*2**(s-23)}unpack_double(){const t=this.unpack_uint32(),e=this.unpack_uint32(),s=t>>31,r=(t>>20&2047)-1023,h=(t&1048575|1048576)*2**(r-20)+e*2**(r-52);return(s===0?1:-1)*h}read(t){const e=this.index;if(e+t<=this.length)return this.dataView.subarray(e,e+t);throw new Error("BinaryPackFailure: read index out of range")}}class jS{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(t){if(typeof t=="string")this.pack_string(t);else if(typeof t=="number")Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if(typeof t=="boolean")t===!0?this._bufferBuilder.append(195):t===!1&&this._bufferBuilder.append(194);else if(t===void 0)this._bufferBuilder.append(192);else if(typeof t=="object")if(t===null)this._bufferBuilder.append(192);else{const e=t.constructor;if(t instanceof Array){const s=this.pack_array(t);if(s instanceof Promise)return s.then(()=>this._bufferBuilder.flush())}else if(t instanceof ArrayBuffer)this.pack_bin(new Uint8Array(t));else if("BYTES_PER_ELEMENT"in t){const s=t;this.pack_bin(new Uint8Array(s.buffer,s.byteOffset,s.byteLength))}else if(t instanceof Date)this.pack_string(t.toString());else{if(t instanceof Blob)return t.arrayBuffer().then(s=>{this.pack_bin(new Uint8Array(s)),this._bufferBuilder.flush()});if(e==Object||e.toString().startsWith("class")){const s=this.pack_object(t);if(s instanceof Promise)return s.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${e.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof t}" not yet supported`);this._bufferBuilder.flush()}pack_bin(t){const e=t.length;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this._bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_string(t){const e=this._textEncoder.encode(t),s=e.length;if(s<=15)this.pack_uint8(176+s);else if(s<=65535)this._bufferBuilder.append(216),this.pack_uint16(s);else if(s<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(s);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_array(t){const e=t.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this._bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");const s=r=>{if(r<e){const l=this.pack(t[r]);return l instanceof Promise?l.then(()=>s(r+1)):s(r+1)}};return s(0)}pack_integer(t){if(t>=-32&&t<=127)this._bufferBuilder.append(t&255);else if(t>=0&&t<=255)this._bufferBuilder.append(204),this.pack_uint8(t);else if(t>=-128&&t<=127)this._bufferBuilder.append(208),this.pack_int8(t);else if(t>=0&&t<=65535)this._bufferBuilder.append(205),this.pack_uint16(t);else if(t>=-32768&&t<=32767)this._bufferBuilder.append(209),this.pack_int16(t);else if(t>=0&&t<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(t);else if(t>=-2147483648&&t<=2147483647)this._bufferBuilder.append(210),this.pack_int32(t);else if(t>=-9223372036854776e3&&t<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(t);else if(t>=0&&t<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(t);else throw new Error("Invalid integer")}pack_double(t){let e=0;t<0&&(e=1,t=-t);const s=Math.floor(Math.log(t)/Math.LN2),r=t/2**s-1,l=Math.floor(r*2**52),h=2**32,u=e<<31|s+1023<<20|l/h&1048575,f=l%h;this._bufferBuilder.append(203),this.pack_int32(u),this.pack_int32(f)}pack_object(t){const e=Object.keys(t),s=e.length;if(s<=15)this.pack_uint8(128+s);else if(s<=65535)this._bufferBuilder.append(222),this.pack_uint16(s);else if(s<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(s);else throw new Error("Invalid length");const r=l=>{if(l<e.length){const h=e[l];if(t.hasOwnProperty(h)){this.pack(h);const u=this.pack(t[h]);if(u instanceof Promise)return u.then(()=>r(l+1))}return r(l+1)}};return r(0)}pack_uint8(t){this._bufferBuilder.append(t)}pack_uint16(t){this._bufferBuilder.append(t>>8),this._bufferBuilder.append(t&255)}pack_uint32(t){const e=t&4294967295;this._bufferBuilder.append((e&4278190080)>>>24),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_uint64(t){const e=t/4294967296,s=t%2**32;this._bufferBuilder.append((e&4278190080)>>>24),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255),this._bufferBuilder.append((s&4278190080)>>>24),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255)}pack_int8(t){this._bufferBuilder.append(t&255)}pack_int16(t){this._bufferBuilder.append((t&65280)>>8),this._bufferBuilder.append(t&255)}pack_int32(t){this._bufferBuilder.append(t>>>24&255),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_int64(t){const e=Math.floor(t/4294967296),s=t%2**32;this._bufferBuilder.append((e&4278190080)>>>24),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255),this._bufferBuilder.append((s&4278190080)>>>24),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255)}constructor(){this._bufferBuilder=new QS,this._textEncoder=new TextEncoder}}let tA=!0,eA=!0;function so(o,t,e){const s=o.match(t);return s&&s.length>=e&&parseFloat(s[e],10)}function er(o,t,e){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,r=s.addEventListener;s.addEventListener=function(h,u){if(h!==t)return r.apply(this,arguments);const f=g=>{const _=e(g);_&&(u.handleEvent?u.handleEvent(_):u(_))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,f),r.apply(this,[h,f])};const l=s.removeEventListener;s.removeEventListener=function(h,u){if(h!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(u))return l.apply(this,arguments);const f=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[h,f])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function qS(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(tA=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function XS(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(eA=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function iA(){if(typeof window=="object"){if(tA)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Tf(o,t){eA&&console.warn(o+" is deprecated, please use "+t+" instead.")}function ZS(o){const t={browser:null,version:null};if(typeof o>"u"||!o.navigator||!o.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:e}=o;if(e.mozGetUserMedia)t.browser="firefox",t.version=parseInt(so(e.userAgent,/Firefox\/(\d+)\./,1));else if(e.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(so(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(o.RTCPeerConnection&&e.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(so(e.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype,t._safariVersion=so(e.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function w0(o){return Object.prototype.toString.call(o)==="[object Object]"}function sA(o){return w0(o)?Object.keys(o).reduce(function(t,e){const s=w0(o[e]),r=s?sA(o[e]):o[e],l=s&&!Object.keys(r).length;return r===void 0||l?t:Object.assign(t,{[e]:r})},{}):o}function Ud(o,t,e){!t||e.has(t.id)||(e.set(t.id,t),Object.keys(t).forEach(s=>{s.endsWith("Id")?Ud(o,o.get(t[s]),e):s.endsWith("Ids")&&t[s].forEach(r=>{Ud(o,o.get(r),e)})}))}function C0(o,t,e){const s=e?"outbound-rtp":"inbound-rtp",r=new Map;if(t===null)return r;const l=[];return o.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&l.push(h)}),l.forEach(h=>{o.forEach(u=>{u.type===s&&u.trackId===h.id&&Ud(o,u,r)})}),r}const S0=iA;function nA(o,t){const e=o&&o.navigator;if(!e.mediaDevices)return;const s=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const f={};return Object.keys(u).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const _=typeof u[g]=="object"?u[g]:{ideal:u[g]};_.exact!==void 0&&typeof _.exact=="number"&&(_.min=_.max=_.exact);const y=function(A,x){return A?A+x.charAt(0).toUpperCase()+x.slice(1):x==="deviceId"?"sourceId":x};if(_.ideal!==void 0){f.optional=f.optional||[];let A={};typeof _.ideal=="number"?(A[y("min",g)]=_.ideal,f.optional.push(A),A={},A[y("max",g)]=_.ideal,f.optional.push(A)):(A[y("",g)]=_.ideal,f.optional.push(A))}_.exact!==void 0&&typeof _.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[y("",g)]=_.exact):["min","max"].forEach(A=>{_[A]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[y(A,g)]=_[A])})}),u.advanced&&(f.optional=(f.optional||[]).concat(u.advanced)),f},r=function(u,f){if(t.version>=61)return f(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const g=function(_,y,A){y in _&&!(A in _)&&(_[A]=_[y],delete _[y])};u=JSON.parse(JSON.stringify(u)),g(u.audio,"autoGainControl","googAutoGainControl"),g(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=s(u.audio)}if(u&&typeof u.video=="object"){let g=u.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const _=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&!(e.mediaDevices.getSupportedConstraints&&e.mediaDevices.getSupportedConstraints().facingMode&&!_)){delete u.video.facingMode;let y;if(g.exact==="environment"||g.ideal==="environment"?y=["back","rear"]:(g.exact==="user"||g.ideal==="user")&&(y=["front"]),y)return e.mediaDevices.enumerateDevices().then(A=>{A=A.filter(D=>D.kind==="videoinput");let x=A.find(D=>y.some(S=>D.label.toLowerCase().includes(S)));return!x&&A.length&&y.includes("back")&&(x=A[A.length-1]),x&&(u.video.deviceId=g.exact?{exact:x.deviceId}:{ideal:x.deviceId}),u.video=s(u.video),S0("chrome: "+JSON.stringify(u)),f(u)})}u.video=s(u.video)}return S0("chrome: "+JSON.stringify(u)),f(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},h=function(u,f,g){r(u,_=>{e.webkitGetUserMedia(_,f,y=>{g&&g(l(y))})})};if(e.getUserMedia=h.bind(e),e.mediaDevices.getUserMedia){const u=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(f){return r(f,g=>u(g).then(_=>{if(g.audio&&!_.getAudioTracks().length||g.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return _},_=>Promise.reject(l(_))))}}}function WS(o,t){if(!(o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices)&&o.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}o.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(r=>{const l=s.video&&s.video.width,h=s.video&&s.video.height,u=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:u||3}},l&&(s.video.mandatory.maxWidth=l),h&&(s.video.mandatory.maxHeight=h),o.navigator.mediaDevices.getUserMedia(s)})}}}function rA(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function aA(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",r=>{let l;o.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===r.track.id):l={track:r.track};const h=new Event("track");h.track=r.track,h.receiver=l,h.transceiver={receiver:l},h.streams=[s.stream],this.dispatchEvent(h)}),s.stream.getTracks().forEach(r=>{let l;o.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===r.id):l={track:r};const h=new Event("track");h.track=r,h.receiver=l,h.transceiver={receiver:l},h.streams=[s.stream],this.dispatchEvent(h)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else er(o,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function oA(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const t=function(r,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=r.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:r}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(u,f){let g=r.apply(this,arguments);return g||(g=t(this,u),this._senders.push(g)),g};const l=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const f=this._senders.indexOf(u);f!==-1&&this._senders.splice(f,1)}}const e=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],e.apply(this,[l]),l.getTracks().forEach(h=>{this._senders.push(t(this,h))})};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],s.apply(this,[l]),l.getTracks().forEach(h=>{const u=this._senders.find(f=>f.track===h);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof o=="object"&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const t=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function lA(o){if(!o.RTCPeerConnection)return;const t=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[s,r,l]=arguments;if(arguments.length>0&&typeof s=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof s!="function"))return t.apply(this,[]);const h=function(f){const g={};return f.result().forEach(y=>{const A={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(x=>{A[x]=y.stat(x)}),g[A.id]=A}),g},u=function(f){return new Map(Object.keys(f).map(g=>[g,f[g]]))};if(arguments.length>=2){const f=function(g){r(u(h(g)))};return t.apply(this,[f,s])}return new Promise((f,g)=>{t.apply(this,[function(_){f(u(h(_)))},g])}).then(r,l)}}function cA(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const e=o.RTCPeerConnection.prototype.getSenders;e&&(o.RTCPeerConnection.prototype.getSenders=function(){const l=e.apply(this,[]);return l.forEach(h=>h._pc=this),l});const s=o.RTCPeerConnection.prototype.addTrack;s&&(o.RTCPeerConnection.prototype.addTrack=function(){const l=s.apply(this,arguments);return l._pc=this,l}),o.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(h=>C0(h,l.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const e=o.RTCPeerConnection.prototype.getReceivers;e&&(o.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(l=>l._pc=this),r}),er(o,"track",s=>(s.receiver._pc=s.srcElement,s)),o.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(l=>C0(l,r.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype&&"getStats"in o.RTCRtpReceiver.prototype))return;const t=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const s=arguments[0];let r,l,h;return this.getSenders().forEach(u=>{u.track===s&&(r?h=!0:r=u)}),this.getReceivers().forEach(u=>(u.track===s&&(l?h=!0:l=u),u.track===s)),h||r&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function hA(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(h=>this._shimmedLocalStreams[h][0])};const t=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(h,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(f)===-1&&this._shimmedLocalStreams[u.id].push(f):this._shimmedLocalStreams[u.id]=[u,f],f};const e=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(h){this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();e.apply(this,arguments);const f=this.getSenders().filter(g=>u.indexOf(g)===-1);this._shimmedLocalStreams[h.id]=[h].concat(f)};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],s.apply(this,arguments)};const r=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const f=this._shimmedLocalStreams[u].indexOf(h);f!==-1&&this._shimmedLocalStreams[u].splice(f,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),r.apply(this,arguments)}}function uA(o,t){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&t.version>=65)return hA(o);const e=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const _=e.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const s=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(x=>x.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new o.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}s.apply(this,[_])};const r=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},o.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const A=[].slice.call(arguments,1);if(A.length!==1||!A[0].getTracks().find(S=>S===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const D=this._streams[y.id];if(D)D.addTrack(_),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new o.MediaStream([_]);this._streams[y.id]=S,this._reverseStreams[S.id]=y,this.addStream(S)}return this.getSenders().find(S=>S.track===_)};function l(g,_){let y=_.sdp;return Object.keys(g._reverseStreams||[]).forEach(A=>{const x=g._reverseStreams[A],D=g._streams[x.id];y=y.replace(new RegExp(D.id,"g"),x.id)}),new RTCSessionDescription({type:_.type,sdp:y})}function h(g,_){let y=_.sdp;return Object.keys(g._reverseStreams||[]).forEach(A=>{const x=g._reverseStreams[A],D=g._streams[x.id];y=y.replace(new RegExp(x.id,"g"),D.id)}),new RTCSessionDescription({type:_.type,sdp:y})}["createOffer","createAnswer"].forEach(function(g){const _=o.RTCPeerConnection.prototype[g],y={[g](){const A=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[D=>{const S=l(this,D);A[0].apply(null,[S])},D=>{A[1]&&A[1].apply(null,D)},arguments[2]]):_.apply(this,arguments).then(D=>l(this,D))}};o.RTCPeerConnection.prototype[g]=y[g]});const u=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=h(this,arguments[0]),u.apply(this,arguments))};const f=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const g=f.get.apply(this);return g.type===""?g:l(this,g)}}),o.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(_._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let A;Object.keys(this._streams).forEach(x=>{this._streams[x].getTracks().find(S=>_.track===S)&&(A=this._streams[x])}),A&&(A.getTracks().length===1?this.removeStream(this._reverseStreams[A.id]):A.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ld(o,t){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const s=o.RTCPeerConnection.prototype[e],r={[e](){return arguments[0]=new(e==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};o.RTCPeerConnection.prototype[e]=r[e]})}function dA(o,t){er(o,"negotiationneeded",e=>{const s=e.target;if(!((t.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return e})}const T0=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:dA,shimAddTrackRemoveTrack:uA,shimAddTrackRemoveTrackWithNative:hA,shimGetDisplayMedia:WS,shimGetSendersWithDtmf:oA,shimGetStats:lA,shimGetUserMedia:nA,shimMediaStream:rA,shimOnTrack:aA,shimPeerConnection:Ld,shimSenderReceiverGetStats:cA},Symbol.toStringTag,{value:"Module"}));function fA(o,t){const e=o&&o.navigator,s=o&&o.MediaStreamTrack;if(e.getUserMedia=function(r,l,h){Tf("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(r).then(l,h)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const r=function(h,u,f){u in h&&!(f in h)&&(h[f]=h[u],delete h[u])},l=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),r(h.audio,"autoGainControl","mozAutoGainControl"),r(h.audio,"noiseSuppression","mozNoiseSuppression")),l(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const u=h.apply(this,arguments);return r(u,"mozAutoGainControl","autoGainControl"),r(u,"mozNoiseSuppression","noiseSuppression"),u}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),r(u,"autoGainControl","mozAutoGainControl"),r(u,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[u])}}}}function JS(o,t){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return s.video===!0?s.video={mediaSource:t}:s.video.mediaSource=t,o.navigator.mediaDevices.getUserMedia(s)})}function pA(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Fd(o,t){if(typeof o!="object"||!(o.RTCPeerConnection||o.mozRTCPeerConnection))return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const l=o.RTCPeerConnection.prototype[r],h={[r](){return arguments[0]=new(r==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};o.RTCPeerConnection.prototype[r]=h[r]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[l,h,u]=arguments;return s.apply(this,[l||null]).then(f=>{if(t.version<53&&!h)try{f.forEach(g=>{g.type=e[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;f.forEach((_,y)=>{f.set(y,Object.assign({},_,{type:e[_.type]||_.type}))})}return f}).then(h,u)}}function gA(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender)||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const t=o.RTCPeerConnection.prototype.getSenders;t&&(o.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(l=>l._pc=this),r});const e=o.RTCPeerConnection.prototype.addTrack;e&&(o.RTCPeerConnection.prototype.addTrack=function(){const r=e.apply(this,arguments);return r._pc=this,r}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function _A(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender)||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const t=o.RTCPeerConnection.prototype.getReceivers;t&&(o.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s}),er(o,"track",e=>(e.receiver._pc=e.srcElement,e)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function mA(o){!o.RTCPeerConnection||"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(e){Tf("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&e.getTracks().includes(s.track)&&this.removeTrack(s)})})}function yA(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function AA(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.addTransceiver;t&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const r=s.length>0;r&&s.forEach(h=>{if("rid"in h&&!/^[a-z0-9]{0,16}$/i.test(h.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in h&&!(parseFloat(h.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in h&&!(parseFloat(h.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=t.apply(this,arguments);if(r){const{sender:h}=l,u=h.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=s,h.sendEncodings=s,this.setParametersPromises.push(h.setParameters(u).then(()=>{delete h.sendEncodings}).catch(()=>{delete h.sendEncodings})))}return l})}function vA(o){if(!(typeof o=="object"&&o.RTCRtpSender))return;const t=o.RTCRtpSender.prototype.getParameters;t&&(o.RTCRtpSender.prototype.getParameters=function(){const s=t.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function xA(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function bA(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const E0=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:AA,shimCreateAnswer:bA,shimCreateOffer:xA,shimGetDisplayMedia:JS,shimGetParameters:vA,shimGetUserMedia:fA,shimOnTrack:pA,shimPeerConnection:Fd,shimRTCDataChannel:yA,shimReceiverGetStats:_A,shimRemoveStream:mA,shimSenderGetStats:gA},Symbol.toStringTag,{value:"Module"}));function wA(o){if(!(typeof o!="object"||!o.RTCPeerConnection)){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const t=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(r=>t.call(this,r,s)),s.getVideoTracks().forEach(r=>t.call(this,r,s))},o.RTCPeerConnection.prototype.addTrack=function(s,...r){return r&&r.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(e);if(s===-1)return;this._localStreams.splice(s,1);const r=e.getTracks();this.getSenders().forEach(l=>{r.includes(l.track)&&this.removeTrack(l)})})}}function CA(o){if(!(typeof o!="object"||!o.RTCPeerConnection)&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const l=new Event("addstream");l.stream=r,this.dispatchEvent(l)})})}});const t=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(l=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(l)>=0)return;s._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,s.dispatchEvent(h)})}),t.apply(s,arguments)}}}function SA(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const t=o.RTCPeerConnection.prototype,e=t.createOffer,s=t.createAnswer,r=t.setLocalDescription,l=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(g,_){const y=arguments.length>=2?arguments[2]:arguments[0],A=e.apply(this,[y]);return _?(A.then(g,_),Promise.resolve()):A},t.createAnswer=function(g,_){const y=arguments.length>=2?arguments[2]:arguments[0],A=s.apply(this,[y]);return _?(A.then(g,_),Promise.resolve()):A};let u=function(f,g,_){const y=r.apply(this,[f]);return _?(y.then(g,_),Promise.resolve()):y};t.setLocalDescription=u,u=function(f,g,_){const y=l.apply(this,[f]);return _?(y.then(g,_),Promise.resolve()):y},t.setRemoteDescription=u,u=function(f,g,_){const y=h.apply(this,[f]);return _?(y.then(g,_),Promise.resolve()):y},t.addIceCandidate=u}function TA(o){const t=o&&o.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,s=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=r=>s(EA(r))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(s,r,l){t.mediaDevices.getUserMedia(s).then(r,l)}).bind(t))}function EA(o){return o&&o.video!==void 0?Object.assign({},o,{video:sA(o.video)}):o}function DA(o){if(!o.RTCPeerConnection)return;const t=o.RTCPeerConnection;o.RTCPeerConnection=function(s,r){if(s&&s.iceServers){const l=[];for(let h=0;h<s.iceServers.length;h++){let u=s.iceServers[h];u.urls===void 0&&u.url?(Tf("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,l.push(u)):l.push(s.iceServers[h])}s.iceServers=l}return new t(s,r)},o.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function RA(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function MA(o){const t=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const r=this.getTransceivers().find(h=>h.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const l=this.getTransceivers().find(h=>h.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):s.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function PA(o){typeof o!="object"||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}const D0=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:PA,shimCallbacksAPI:SA,shimConstraints:EA,shimCreateOfferLegacy:MA,shimGetUserMedia:TA,shimLocalStreamsAPI:wA,shimRTCIceServerUrls:DA,shimRemoteStreamsAPI:CA,shimTrackEventTransceiver:RA},Symbol.toStringTag,{value:"Module"}));var pd={exports:{}},R0;function KS(){return R0||(R0=1,(function(o){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(s=>s.trim())},t.splitSections=function(e){return e.split(`
m=`).map((r,l)=>(l>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(e){const s=t.splitSections(e);return s&&s[0]},t.getMediaSections=function(e){const s=t.splitSections(e);return s.shift(),s},t.matchPrefix=function(e,s){return t.splitLines(e).filter(r=>r.indexOf(s)===0)},t.parseCandidate=function(e){let s;e.indexOf("a=candidate:")===0?s=e.substring(12).split(" "):s=e.substring(10).split(" ");const r={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let l=8;l<s.length;l+=2)switch(s[l]){case"raddr":r.relatedAddress=s[l+1];break;case"rport":r.relatedPort=parseInt(s[l+1],10);break;case"tcptype":r.tcpType=s[l+1];break;case"ufrag":r.ufrag=s[l+1],r.usernameFragment=s[l+1];break;default:r[s[l]]===void 0&&(r[s[l]]=s[l+1]);break}return r},t.writeCandidate=function(e){const s=[];s.push(e.foundation);const r=e.component;r==="rtp"?s.push(1):r==="rtcp"?s.push(2):s.push(r),s.push(e.protocol.toUpperCase()),s.push(e.priority),s.push(e.address||e.ip),s.push(e.port);const l=e.type;return s.push("typ"),s.push(l),l!=="host"&&e.relatedAddress&&e.relatedPort&&(s.push("raddr"),s.push(e.relatedAddress),s.push("rport"),s.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(s.push("ufrag"),s.push(e.usernameFragment||e.ufrag)),"candidate:"+s.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let s=e.substring(9).split(" ");const r={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),r.name=s[0],r.clockRate=parseInt(s[1],10),r.channels=s.length===3?parseInt(s[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let s=e.payloadType;e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+s+" "+e.name+"/"+e.clockRate+(r!==1?"/"+r:"")+`\r
`},t.parseExtmap=function(e){const s=e.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+`\r
`},t.parseFmtp=function(e){const s={};let r;const l=e.substring(e.indexOf(" ")+1).split(";");for(let h=0;h<l.length;h++)r=l[h].trim().split("="),s[r[0].trim()]=r[1];return s},t.writeFmtp=function(e){let s="",r=e.payloadType;if(e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const l=[];Object.keys(e.parameters).forEach(h=>{e.parameters[h]!==void 0?l.push(h+"="+e.parameters[h]):l.push(h)}),s+="a=fmtp:"+r+" "+l.join(";")+`\r
`}return s},t.parseRtcpFb=function(e){const s=e.substring(e.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},t.writeRtcpFb=function(e){let s="",r=e.payloadType;return e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(l=>{s+="a=rtcp-fb:"+r+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),s},t.parseSsrcMedia=function(e){const s=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,s),10)},l=e.indexOf(":",s);return l>-1?(r.attribute=e.substring(s+1,l),r.value=e.substring(l+1)):r.attribute=e.substring(s+1),r},t.parseSsrcGroup=function(e){const s=e.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(r=>parseInt(r,10))}},t.getMid=function(e){const s=t.matchPrefix(e,"a=mid:")[0];if(s)return s.substring(6)},t.parseFingerprint=function(e){const s=e.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},t.getDtlsParameters=function(e,s){return{role:"auto",fingerprints:t.matchPrefix(e+s,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,s){let r="a=setup:"+s+`\r
`;return e.fingerprints.forEach(l=>{r+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),r},t.parseCryptoLine=function(e){const s=e.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;const s=e.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,s){return t.matchPrefix(e+s,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,s){const r=t.matchPrefix(e+s,"a=ice-ufrag:")[0],l=t.matchPrefix(e+s,"a=ice-pwd:")[0];return r&&l?{usernameFragment:r.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(e){let s="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(s+=`a=ice-lite\r
`),s},t.parseRtpParameters=function(e){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=t.splitLines(e)[0].split(" ");s.profile=l[2];for(let u=3;u<l.length;u++){const f=l[u],g=t.matchPrefix(e,"a=rtpmap:"+f+" ")[0];if(g){const _=t.parseRtpMap(g),y=t.matchPrefix(e,"a=fmtp:"+f+" ");switch(_.parameters=y.length?t.parseFmtp(y[0]):{},_.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),s.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(_.name.toUpperCase());break}}}t.matchPrefix(e,"a=extmap:").forEach(u=>{s.headerExtensions.push(t.parseExtmap(u))});const h=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return s.codecs.forEach(u=>{h.forEach(f=>{u.rtcpFeedback.find(_=>_.type===f.type&&_.parameter===f.parameter)||u.rtcpFeedback.push(f)})}),s},t.writeRtpDescription=function(e,s){let r="";r+="m="+e+" ",r+=s.codecs.length>0?"9":"0",r+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=s.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(h=>{r+=t.writeRtpMap(h),r+=t.writeFmtp(h),r+=t.writeRtcpFb(h)});let l=0;return s.codecs.forEach(h=>{h.maxptime>l&&(l=h.maxptime)}),l>0&&(r+="a=maxptime:"+l+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(h=>{r+=t.writeExtmap(h)}),r},t.parseRtpEncodingParameters=function(e){const s=[],r=t.parseRtpParameters(e),l=r.fecMechanisms.indexOf("RED")!==-1,h=r.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(e,"a=ssrc:").map(A=>t.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),f=u.length>0&&u[0].ssrc;let g;const _=t.matchPrefix(e,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(D=>parseInt(D,10)));_.length>0&&_[0].length>1&&_[0][0]===f&&(g=_[0][1]),r.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let x={ssrc:f,codecPayloadType:parseInt(A.parameters.apt,10)};f&&g&&(x.rtx={ssrc:g}),s.push(x),l&&(x=JSON.parse(JSON.stringify(x)),x.fec={ssrc:f,mechanism:h?"red+ulpfec":"red"},s.push(x))}}),s.length===0&&f&&s.push({ssrc:f});let y=t.matchPrefix(e,"b=");return y.length&&(y[0].indexOf("b=TIAS:")===0?y=parseInt(y[0].substring(7),10):y[0].indexOf("b=AS:")===0?y=parseInt(y[0].substring(5),10)*1e3*.95-2e3*8:y=void 0,s.forEach(A=>{A.maxBitrate=y})),s},t.parseRtcpParameters=function(e){const s={},r=t.matchPrefix(e,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];r&&(s.cname=r.value,s.ssrc=r.ssrc);const l=t.matchPrefix(e,"a=rtcp-rsize");s.reducedSize=l.length>0,s.compound=l.length===0;const h=t.matchPrefix(e,"a=rtcp-mux");return s.mux=h.length>0,s},t.writeRtcpParameters=function(e){let s="";return e.reducedSize&&(s+=`a=rtcp-rsize\r
`),e.mux&&(s+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(s+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),s},t.parseMsid=function(e){let s;const r=t.matchPrefix(e,"a=msid:");if(r.length===1)return s=r[0].substring(7).split(" "),{stream:s[0],track:s[1]};const l=t.matchPrefix(e,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");if(l.length>0)return s=l[0].value.split(" "),{stream:s[0],track:s[1]}},t.parseSctpDescription=function(e){const s=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let l;r.length>0&&(l=parseInt(r[0].substring(19),10)),isNaN(l)&&(l=65536);const h=t.matchPrefix(e,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:l};const u=t.matchPrefix(e,"a=sctpmap:");if(u.length>0){const f=u[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:l}}},t.writeSctpDescription=function(e,s){let r=[];return e.protocol!=="DTLS/SCTP"?r=["m="+e.kind+" 9 "+e.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:r=["m="+e.kind+" 9 "+e.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&r.push("a=max-message-size:"+s.maxMessageSize+`\r
`),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,s,r){let l;const h=s!==void 0?s:2;return e?l=e:l=t.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+l+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(e,s){const r=t.splitLines(e);for(let l=0;l<r.length;l++)switch(r[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[l].substring(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){const r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;const s=t.splitLines(e);for(let r=0;r<s.length;r++)if(s[r].length<2||s[r].charAt(1)!=="=")return!1;return!0},o.exports=t})(pd)),pd.exports}var BA=KS();const Wr=ef(BA),$S=mb({__proto__:null,default:Wr},[BA]);function nc(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const t=o.RTCIceCandidate;o.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const r=new t(s),l=Wr.parseCandidate(s.candidate);for(const h in l)h in r||Object.defineProperty(r,h,{value:l[h]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(s)},o.RTCIceCandidate.prototype=t.prototype,er(o,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new o.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Nd(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||er(o,"icecandidate",t=>{if(t.candidate){const e=Wr.parseCandidate(t.candidate.candidate);e.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t})}function rc(o,t){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const e=function(u){if(!u||!u.sdp)return!1;const f=Wr.splitSections(u.sdp);return f.shift(),f.some(g=>{const _=Wr.parseMLine(g);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},s=function(u){const f=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const g=parseInt(f[1],10);return g!==g?-1:g},r=function(u){let f=65536;return t.browser==="firefox"&&(t.version<57?u===-1?f=16384:f=2147483637:t.version<60?f=t.version===57?65535:65536:f=2147483637),f},l=function(u,f){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const _=Wr.matchPrefix(u.sdp,"a=max-message-size:");return _.length>0?g=parseInt(_[0].substring(19),10):t.browser==="firefox"&&f!==-1&&(g=2147483637),g},h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const f=s(arguments[0]),g=r(f),_=l(arguments[0],f);let y;g===0&&_===0?y=Number.POSITIVE_INFINITY:g===0||_===0?y=Math.max(g,_):y=Math.min(g,_);const A={};Object.defineProperty(A,"maxMessageSize",{get(){return y}}),this._sctp=A}return h.apply(this,arguments)}}function ac(o){if(!(o.RTCPeerConnection&&"createDataChannel"in o.RTCPeerConnection.prototype))return;function t(s,r){const l=s.send;s.send=function(){const u=arguments[0],f=u.length||u.size||u.byteLength;if(s.readyState==="open"&&r.sctp&&f>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return l.apply(s,arguments)}}const e=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const r=e.apply(this,arguments);return t(r,this),r},er(o,"datachannel",s=>(t(s.channel,s.target),s))}function Hd(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const t=o.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const s=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const l=r.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const h=new Event("connectionstatechange",r);l.dispatchEvent(h)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function Gd(o,t){if(!o.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const e=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=r.sdp.split(`
`).filter(h=>h.trim()!=="a=extmap-allow-mixed").join(`
`);o.RTCSessionDescription&&r instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:r.type,sdp:l}):r.sdp=l}return e.apply(this,arguments)}}function oc(o,t){if(!(o.RTCPeerConnection&&o.RTCPeerConnection.prototype))return;const e=o.RTCPeerConnection.prototype.addIceCandidate;!e||e.length===0||(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function lc(o,t){if(!(o.RTCPeerConnection&&o.RTCPeerConnection.prototype))return;const e=o.RTCPeerConnection.prototype.setLocalDescription;!e||e.length===0||(o.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return e.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?e.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(h=>e.apply(this,[h]))})}const t1=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Gd,shimAddIceCandidateNullOrEmpty:oc,shimConnectionState:Hd,shimMaxMessageSize:rc,shimParameterlessSetLocalDescription:lc,shimRTCIceCandidate:nc,shimRTCIceCandidateRelayProtocol:Nd,shimSendThrowTypeError:ac},Symbol.toStringTag,{value:"Module"}));function e1({window:o}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const e=iA,s=ZS(o),r={browserDetails:s,commonShim:t1,extractVersion:so,disableLog:qS,disableWarnings:XS,sdp:$S};switch(s.browser){case"chrome":if(!T0||!Ld||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),r;if(s.version===null)return e("Chrome shim can not determine version, not shimming."),r;e("adapter.js shimming chrome."),r.browserShim=T0,oc(o,s),lc(o),nA(o,s),rA(o),Ld(o,s),aA(o),uA(o,s),oA(o),lA(o),cA(o),dA(o,s),nc(o),Nd(o),Hd(o),rc(o,s),ac(o),Gd(o,s);break;case"firefox":if(!E0||!Fd||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),r;e("adapter.js shimming firefox."),r.browserShim=E0,oc(o,s),lc(o),fA(o,s),Fd(o,s),pA(o),mA(o),gA(o),_A(o),yA(o),AA(o),vA(o),xA(o),bA(o),nc(o),Hd(o),rc(o,s),ac(o);break;case"safari":if(!D0||!t.shimSafari)return e("Safari shim is not included in this adapter release."),r;e("adapter.js shimming safari."),r.browserShim=D0,oc(o,s),lc(o),DA(o),MA(o),SA(o),wA(o),CA(o),RA(o),TA(o),PA(o),nc(o),Nd(o),rc(o,s),ac(o),Gd(o,s);break;default:e("Unsupported browser!");break}return r}const M0=e1({window:typeof window>"u"?void 0:window});let Qd;try{Qd=new TextDecoder}catch{}let ct,Xn,W=0;const i1=105,s1=57342,n1=57343,P0=57337,B0=6,Vr={};let Ot={},ue,Ac,vc=0,yo=0,De,Zi,Se=[],Vd=[],fi,$e,no,I0={useRecords:!1,mapsAsObjects:!0},Ao=!1,IA=2;try{new Function("")}catch{IA=1/0}class vo{constructor(t){if(t&&((t.keyMap||t._keyMap)&&!t.useRecords&&(t.useRecords=!1,t.mapsAsObjects=!0),t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.getStructures&&(t.getShared=t.getStructures),t.getShared&&!t.structures&&((t.structures=[]).uninitialized=!0),t.keyMap)){this.mapKey=new Map;for(let[e,s]of Object.entries(t.keyMap))this.mapKey.set(s,e)}Object.assign(this,t)}decodeKey(t){return this.keyMap&&this.mapKey.get(t)||t}encodeKey(t){return this.keyMap&&this.keyMap.hasOwnProperty(t)?this.keyMap[t]:t}encodeKeys(t){if(!this._keyMap)return t;let e=new Map;for(let[s,r]of Object.entries(t))e.set(this._keyMap.hasOwnProperty(s)?this._keyMap[s]:s,r);return e}decodeKeys(t){if(!this._keyMap||t.constructor.name!="Map")return t;if(!this._mapKey){this._mapKey=new Map;for(let[s,r]of Object.entries(this._keyMap))this._mapKey.set(r,s)}let e={};return t.forEach((s,r)=>e[Hi(this._mapKey.has(r)?this._mapKey.get(r):r)]=s),e}mapDecode(t,e){let s=this.decode(t);if(this._keyMap)switch(s.constructor.name){case"Array":return s.map(r=>this.decodeKeys(r))}return s}decode(t,e){if(ct)return UA(()=>(Xd(),this?this.decode(t,e):vo.prototype.decode.call(I0,t,e)));Xn=e>-1?e:t.length,W=0,yo=0,Ac=null,De=null,ct=t;try{$e=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(s){throw ct=null,t instanceof Uint8Array?s:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof vo){if(Ot=this,fi=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return ue=this.structures,Jl();(!ue||ue.length>0)&&(ue=[])}else Ot=I0,(!ue||ue.length>0)&&(ue=[]),fi=null;return Jl()}decodeMultiple(t,e){let s,r=0;try{let l=t.length;Ao=!0;let h=this?this.decode(t,l):Rf.decode(t,l);if(e){if(e(h)===!1)return;for(;W<l;)if(r=W,e(Jl())===!1)return}else{for(s=[h];W<l;)r=W,s.push(Jl());return s}}catch(l){throw l.lastPosition=r,l.values=s,l}finally{Ao=!1,Xd()}}}function Jl(){try{let o=zt();if(De){if(W>=De.postBundlePosition){let t=new Error("Unexpected bundle position");throw t.incomplete=!0,t}W=De.postBundlePosition,De=null}if(W==Xn)ue=null,ct=null,Zi&&(Zi=null);else if(W>Xn){let t=new Error("Unexpected end of CBOR data");throw t.incomplete=!0,t}else if(!Ao)throw new Error("Data read, but end of buffer not reached");return o}catch(o){throw Xd(),(o instanceof RangeError||o.message.startsWith("Unexpected end of buffer"))&&(o.incomplete=!0),o}}function zt(){let o=ct[W++],t=o>>5;if(o=o&31,o>23)switch(o){case 24:o=ct[W++];break;case 25:if(t==7)return l1();o=$e.getUint16(W),W+=2;break;case 26:if(t==7){let e=$e.getFloat32(W);if(Ot.useFloat32>2){let s=Df[(ct[W]&127)<<1|ct[W+1]>>7];return W+=4,(s*e+(e>0?.5:-.5)>>0)/s}return W+=4,e}o=$e.getUint32(W),W+=4;break;case 27:if(t==7){let e=$e.getFloat64(W);return W+=8,e}if(t>1){if($e.getUint32(W)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");o=$e.getUint32(W+4)}else Ot.int64AsNumber?(o=$e.getUint32(W)*4294967296,o+=$e.getUint32(W+4)):o=$e.getBigUint64(W);W+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let e=[],s,r=0;for(;(s=zt())!=Vr;)e[r++]=s;return t==4?e:t==3?e.join(""):Buffer.concat(e);case 5:let l;if(Ot.mapsAsObjects){let h={};if(Ot.keyMap)for(;(l=zt())!=Vr;)h[Hi(Ot.decodeKey(l))]=zt();else for(;(l=zt())!=Vr;)h[Hi(l)]=zt();return h}else{no&&(Ot.mapsAsObjects=!0,no=!1);let h=new Map;if(Ot.keyMap)for(;(l=zt())!=Vr;)h.set(Ot.decodeKey(l),zt());else for(;(l=zt())!=Vr;)h.set(l,zt());return h}case 7:return Vr;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+o)}switch(t){case 0:return o;case 1:return~o;case 2:return o1(o);case 3:if(yo>=W)return Ac.slice(W-vc,(W+=o)-vc);if(yo==0&&Xn<140&&o<32){let r=o<16?kA(o):a1(o);if(r!=null)return r}return r1(o);case 4:let e=new Array(o);for(let r=0;r<o;r++)e[r]=zt();return e;case 5:if(Ot.mapsAsObjects){let r={};if(Ot.keyMap)for(let l=0;l<o;l++)r[Hi(Ot.decodeKey(zt()))]=zt();else for(let l=0;l<o;l++)r[Hi(zt())]=zt();return r}else{no&&(Ot.mapsAsObjects=!0,no=!1);let r=new Map;if(Ot.keyMap)for(let l=0;l<o;l++)r.set(Ot.decodeKey(zt()),zt());else for(let l=0;l<o;l++)r.set(zt(),zt());return r}case 6:if(o>=P0){let r=ue[o&8191];if(r)return r.read||(r.read=Yd(r)),r.read();if(o<65536){if(o==n1){let l=Xr(),h=zt(),u=zt();qd(h,u);let f={};if(Ot.keyMap)for(let g=2;g<l;g++){let _=Ot.decodeKey(u[g-2]);f[Hi(_)]=zt()}else for(let g=2;g<l;g++){let _=u[g-2];f[Hi(_)]=zt()}return f}else if(o==s1){let l=Xr(),h=zt();for(let u=2;u<l;u++)qd(h++,zt());return zt()}else if(o==P0)return p1();if(Ot.getShared&&(Ef(),r=ue[o&8191],r))return r.read||(r.read=Yd(r)),r.read()}}let s=Se[o];if(s)return s.handlesRead?s(zt):s(zt());{let r=zt();for(let l=0;l<Vd.length;l++){let h=Vd[l](o,r);if(h!==void 0)return h}return new Kn(r,o)}case 7:switch(o){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let r=(fi||jn())[o];if(r!==void 0)return r;throw new Error("Unknown token "+o)}default:if(isNaN(o)){let r=new Error("Unexpected end of CBOR data");throw r.incomplete=!0,r}throw new Error("Unknown CBOR token "+o)}}const k0=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Yd(o){function t(){let e=ct[W++];if(e=e&31,e>23)switch(e){case 24:e=ct[W++];break;case 25:e=$e.getUint16(W),W+=2;break;case 26:e=$e.getUint32(W),W+=4;break;default:throw new Error("Expected array header, but got "+ct[W-1])}let s=this.compiledReader;for(;s;){if(s.propertyCount===e)return s(zt);s=s.next}if(this.slowReads++>=IA){let l=this.length==e?this:this.slice(0,e);return s=Ot.keyMap?new Function("r","return {"+l.map(h=>Ot.decodeKey(h)).map(h=>k0.test(h)?Hi(h)+":r()":"["+JSON.stringify(h)+"]:r()").join(",")+"}"):new Function("r","return {"+l.map(h=>k0.test(h)?Hi(h)+":r()":"["+JSON.stringify(h)+"]:r()").join(",")+"}"),this.compiledReader&&(s.next=this.compiledReader),s.propertyCount=e,this.compiledReader=s,s(zt)}let r={};if(Ot.keyMap)for(let l=0;l<e;l++)r[Hi(Ot.decodeKey(this[l]))]=zt();else for(let l=0;l<e;l++)r[Hi(this[l])]=zt();return r}return o.slowReads=0,t}function Hi(o){return o==="__proto__"?"__proto_":o}let r1=jd;function jd(o){let t;if(o<16&&(t=kA(o)))return t;if(o>64&&Qd)return Qd.decode(ct.subarray(W,W+=o));const e=W+o,s=[];for(t="";W<e;){const r=ct[W++];if((r&128)===0)s.push(r);else if((r&224)===192){const l=ct[W++]&63;s.push((r&31)<<6|l)}else if((r&240)===224){const l=ct[W++]&63,h=ct[W++]&63;s.push((r&31)<<12|l<<6|h)}else if((r&248)===240){const l=ct[W++]&63,h=ct[W++]&63,u=ct[W++]&63;let f=(r&7)<<18|l<<12|h<<6|u;f>65535&&(f-=65536,s.push(f>>>10&1023|55296),f=56320|f&1023),s.push(f)}else s.push(r);s.length>=4096&&(t+=Pe.apply(String,s),s.length=0)}return s.length>0&&(t+=Pe.apply(String,s)),t}let Pe=String.fromCharCode;function a1(o){let t=W,e=new Array(o);for(let s=0;s<o;s++){const r=ct[W++];if((r&128)>0){W=t;return}e[s]=r}return Pe.apply(String,e)}function kA(o){if(o<4)if(o<2){if(o===0)return"";{let t=ct[W++];if((t&128)>1){W-=1;return}return Pe(t)}}else{let t=ct[W++],e=ct[W++];if((t&128)>0||(e&128)>0){W-=2;return}if(o<3)return Pe(t,e);let s=ct[W++];if((s&128)>0){W-=3;return}return Pe(t,e,s)}else{let t=ct[W++],e=ct[W++],s=ct[W++],r=ct[W++];if((t&128)>0||(e&128)>0||(s&128)>0||(r&128)>0){W-=4;return}if(o<6){if(o===4)return Pe(t,e,s,r);{let l=ct[W++];if((l&128)>0){W-=5;return}return Pe(t,e,s,r,l)}}else if(o<8){let l=ct[W++],h=ct[W++];if((l&128)>0||(h&128)>0){W-=6;return}if(o<7)return Pe(t,e,s,r,l,h);let u=ct[W++];if((u&128)>0){W-=7;return}return Pe(t,e,s,r,l,h,u)}else{let l=ct[W++],h=ct[W++],u=ct[W++],f=ct[W++];if((l&128)>0||(h&128)>0||(u&128)>0||(f&128)>0){W-=8;return}if(o<10){if(o===8)return Pe(t,e,s,r,l,h,u,f);{let g=ct[W++];if((g&128)>0){W-=9;return}return Pe(t,e,s,r,l,h,u,f,g)}}else if(o<12){let g=ct[W++],_=ct[W++];if((g&128)>0||(_&128)>0){W-=10;return}if(o<11)return Pe(t,e,s,r,l,h,u,f,g,_);let y=ct[W++];if((y&128)>0){W-=11;return}return Pe(t,e,s,r,l,h,u,f,g,_,y)}else{let g=ct[W++],_=ct[W++],y=ct[W++],A=ct[W++];if((g&128)>0||(_&128)>0||(y&128)>0||(A&128)>0){W-=12;return}if(o<14){if(o===12)return Pe(t,e,s,r,l,h,u,f,g,_,y,A);{let x=ct[W++];if((x&128)>0){W-=13;return}return Pe(t,e,s,r,l,h,u,f,g,_,y,A,x)}}else{let x=ct[W++],D=ct[W++];if((x&128)>0||(D&128)>0){W-=14;return}if(o<15)return Pe(t,e,s,r,l,h,u,f,g,_,y,A,x,D);let S=ct[W++];if((S&128)>0){W-=15;return}return Pe(t,e,s,r,l,h,u,f,g,_,y,A,x,D,S)}}}}}function o1(o){return Ot.copyBuffers?Uint8Array.prototype.slice.call(ct,W,W+=o):ct.subarray(W,W+=o)}let zA=new Float32Array(1),Kl=new Uint8Array(zA.buffer,0,4);function l1(){let o=ct[W++],t=ct[W++],e=(o&127)>>2;if(e===31)return t||o&3?NaN:o&128?-1/0:1/0;if(e===0){let s=((o&3)<<8|t)/16777216;return o&128?-s:s}return Kl[3]=o&128|(e>>1)+56,Kl[2]=(o&7)<<5|t>>3,Kl[1]=t<<5,Kl[0]=0,zA[0]}new Array(4096);class Kn{constructor(t,e){this.value=t,this.tag=e}}Se[0]=o=>new Date(o);Se[1]=o=>new Date(Math.round(o*1e3));Se[2]=o=>{let t=BigInt(0);for(let e=0,s=o.byteLength;e<s;e++)t=BigInt(o[e])+t<<BigInt(8);return t};Se[3]=o=>BigInt(-1)-Se[2](o);Se[4]=o=>+(o[1]+"e"+o[0]);Se[5]=o=>o[1]*Math.exp(o[0]*Math.log(2));const qd=(o,t)=>{o=o-57344;let e=ue[o];e&&e.isShared&&((ue.restoreStructures||(ue.restoreStructures=[]))[o]=e),ue[o]=t,t.read=Yd(t)};Se[i1]=o=>{let t=o.length,e=o[1];qd(o[0],e);let s={};for(let r=2;r<t;r++){let l=e[r-2];s[Hi(l)]=o[r]}return s};Se[14]=o=>De?De[0].slice(De.position0,De.position0+=o):new Kn(o,14);Se[15]=o=>De?De[1].slice(De.position1,De.position1+=o):new Kn(o,15);let c1={Error,RegExp};Se[27]=o=>(c1[o[0]]||Error)(o[1],o[2]);const OA=o=>{if(ct[W++]!=132)throw new Error("Packed values structure must be followed by a 4 element array");let t=o();return fi=fi?t.concat(fi.slice(t.length)):t,fi.prefixes=o(),fi.suffixes=o(),o()};OA.handlesRead=!0;Se[51]=OA;Se[B0]=o=>{if(!fi)if(Ot.getShared)Ef();else return new Kn(o,B0);if(typeof o=="number")return fi[16+(o>=0?2*o:-2*o-1)];throw new Error("No support for non-integer packed references yet")};Se[28]=o=>{Zi||(Zi=new Map,Zi.id=0);let t=Zi.id++,e=ct[W],s;e>>5==4?s=[]:s={};let r={target:s};Zi.set(t,r);let l=o();return r.used?Object.assign(s,l):(r.target=l,l)};Se[28].handlesRead=!0;Se[29]=o=>{let t=Zi.get(o);return t.used=!0,t.target};Se[258]=o=>new Set(o);(Se[259]=o=>(Ot.mapsAsObjects&&(Ot.mapsAsObjects=!1,no=!0),o())).handlesRead=!0;function Yr(o,t){return typeof o=="string"?o+t:o instanceof Array?o.concat(t):Object.assign({},o,t)}function jn(){if(!fi)if(Ot.getShared)Ef();else throw new Error("No packed values available");return fi}const h1=1399353956;Vd.push((o,t)=>{if(o>=225&&o<=255)return Yr(jn().prefixes[o-224],t);if(o>=28704&&o<=32767)return Yr(jn().prefixes[o-28672],t);if(o>=1879052288&&o<=2147483647)return Yr(jn().prefixes[o-1879048192],t);if(o>=216&&o<=223)return Yr(t,jn().suffixes[o-216]);if(o>=27647&&o<=28671)return Yr(t,jn().suffixes[o-27639]);if(o>=1811940352&&o<=1879048191)return Yr(t,jn().suffixes[o-1811939328]);if(o==h1)return{packedValues:fi,structures:ue.slice(0),version:t};if(o==55799)return t});const u1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,z0=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],d1=[64,68,69,70,71,72,77,78,79,85,86];for(let o=0;o<z0.length;o++)f1(z0[o],d1[o]);function f1(o,t){let e="get"+o.name.slice(0,-5),s;typeof o=="function"?s=o.BYTES_PER_ELEMENT:o=null;for(let r=0;r<2;r++){if(!r&&s==1)continue;let l=s==2?1:s==4?2:3;Se[r?t:t-4]=s==1||r==u1?h=>{if(!o)throw new Error("Could not find typed array for code "+t);return new o(Uint8Array.prototype.slice.call(h,0).buffer)}:h=>{if(!o)throw new Error("Could not find typed array for code "+t);let u=new DataView(h.buffer,h.byteOffset,h.byteLength),f=h.length>>l,g=new o(f),_=u[e];for(let y=0;y<f;y++)g[y]=_.call(u,y<<l,r);return g}}}function p1(){let o=Xr(),t=W+zt();for(let s=2;s<o;s++){let r=Xr();W+=r}let e=W;return W=t,De=[jd(Xr()),jd(Xr())],De.position0=0,De.position1=0,De.postBundlePosition=W,W=e,zt()}function Xr(){let o=ct[W++]&31;if(o>23)switch(o){case 24:o=ct[W++];break;case 25:o=$e.getUint16(W),W+=2;break;case 26:o=$e.getUint32(W),W+=4;break}return o}function Ef(){if(Ot.getShared){let o=UA(()=>(ct=null,Ot.getShared()))||{},t=o.structures||[];Ot.sharedVersion=o.version,fi=Ot.sharedValues=o.packedValues,ue===!0?Ot.structures=ue=t:ue.splice.apply(ue,[0,t.length].concat(t))}}function UA(o){let t=Xn,e=W,s=vc,r=yo,l=Ac,h=Zi,u=De,f=new Uint8Array(ct.slice(0,Xn)),g=ue,_=Ot,y=Ao,A=o();return Xn=t,W=e,vc=s,yo=r,Ac=l,Zi=h,De=u,ct=f,Ao=y,ue=g,Ot=_,$e=new DataView(ct.buffer,ct.byteOffset,ct.byteLength),A}function Xd(){ct=null,Zi=null,ue=null}const Df=new Array(147);for(let o=0;o<256;o++)Df[o]=+("1e"+Math.floor(45.15-o*.30103));let Rf=new vo({useRecords:!1});Rf.decode;Rf.decodeMultiple;let cc;try{cc=new TextEncoder}catch{}let Zd,LA;const kc=typeof globalThis=="object"&&globalThis.Buffer,Eo=typeof kc<"u",gd=Eo?kc.allocUnsafeSlow:Uint8Array,O0=Eo?kc:Uint8Array,U0=256,L0=Eo?4294967296:2144337920;let _d,H,se,M=0,gn,Ee=null;const g1=61440,_1=/[\u0080-\uFFFF]/,Ti=Symbol("record-id");class m1 extends vo{constructor(t){super(t),this.offset=0;let e,s,r,l,h;t=t||{};let u=O0.prototype.utf8Write?function(I,K,X){return H.utf8Write(I,K,X)}:cc&&cc.encodeInto?function(I,K){return cc.encodeInto(I,H.subarray(K)).written}:!1,f=this,g=t.structures||t.saveStructures,_=t.maxSharedStructures;if(_==null&&(_=g?128:0),_>8190)throw new Error("Maximum maxSharedStructure is 8190");let y=t.sequential;y&&(_=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let A,x,D=t.sharedValues,S;if(D){S=Object.create(null);for(let I=0,K=D.length;I<K;I++)S[D[I]]=I}let U=[],R=0,C=0;this.mapEncode=function(I,K){if(this._keyMap&&!this._mapped)switch(I.constructor.name){case"Array":I=I.map(X=>this.encodeKeys(X));break}return this.encode(I,K)},this.encode=function(I,K){if(H||(H=new gd(8192),se=new DataView(H.buffer,0,8192),M=0),gn=H.length-10,gn-M<2048?(H=new gd(H.length),se=new DataView(H.buffer,0,H.length),gn=H.length-10,M=0):K===G0&&(M=M+7&2147483640),e=M,f.useSelfDescribedHeader&&(se.setUint32(M,3654940416),M+=3),h=f.structuredClone?new Map:null,f.bundleStrings&&typeof I!="string"?(Ee=[],Ee.size=1/0):Ee=null,s=f.structures,s){if(s.uninitialized){let E=f.getShared()||{};f.structures=s=E.structures||[],f.sharedVersion=E.version;let b=f.sharedValues=E.packedValues;if(b){S={};for(let $=0,it=b.length;$<it;$++)S[b[$]]=$}}let X=s.length;if(X>_&&!y&&(X=_),!s.transitions){s.transitions=Object.create(null);for(let E=0;E<X;E++){let b=s[E];if(!b)continue;let $,it=s.transitions;for(let nt=0,w=b.length;nt<w;nt++){it[Ti]===void 0&&(it[Ti]=E);let V=b[nt];$=it[V],$||($=it[V]=Object.create(null)),it=$}it[Ti]=E|1048576}}y||(s.nextId=X)}if(r&&(r=!1),l=s||[],x=S,t.pack){let X=new Map;if(X.values=[],X.encoder=f,X.maxValues=t.maxPrivatePackedValues||(S?16:1/0),X.objectMap=S||!1,X.samplingPackedValues=A,hc(I,X),X.values.length>0){H[M++]=216,H[M++]=51,rs(4);let E=X.values;O(E),rs(0),rs(0),x=Object.create(S||null);for(let b=0,$=E.length;b<$;b++)x[E[b]]=b}}_d=K&yd;try{if(_d)return;if(O(I),Ee&&H0(e,O),f.offset=M,h&&h.idsToInsert){M+=h.idsToInsert.length*2,M>gn&&q(M),f.offset=M;let X=v1(H.subarray(e,M),h.idsToInsert);return h=null,X}return K&G0?(H.start=e,H.end=M,H):H.subarray(e,M)}finally{if(s){if(C<10&&C++,s.length>_&&(s.length=_),R>1e4)s.transitions=null,C=0,R=0,U.length>0&&(U=[]);else if(U.length>0&&!y){for(let X=0,E=U.length;X<E;X++)U[X][Ti]=void 0;U=[]}}if(r&&f.saveShared){f.structures.length>_&&(f.structures=f.structures.slice(0,_));let X=H.subarray(e,M);return f.updateSharedData()===!1?f.encode(I):X}K&x1&&(M=e)}},this.findCommonStringsToPack=()=>(A=new Map,S||(S=Object.create(null)),I=>{let K=I&&I.threshold||4,X=this.pack?I.maxPrivatePackedValues||16:0;D||(D=this.sharedValues=[]);for(let[E,b]of A)b.count>K&&(S[E]=X++,D.push(E),r=!0);for(;this.saveShared&&this.updateSharedData()===!1;);A=null});const O=I=>{M>gn&&(H=q(M));var K=typeof I,X;if(K==="string"){if(x){let it=x[I];if(it>=0){it<16?H[M++]=it+224:(H[M++]=198,it&1?O(15-it>>1):O(it-16>>1));return}else if(A&&!t.pack){let nt=A.get(I);nt?nt.count++:A.set(I,{count:1})}}let E=I.length;if(Ee&&E>=4&&E<1024){if((Ee.size+=E)>g1){let nt,w=(Ee[0]?Ee[0].length*3+Ee[1].length:0)+10;M+w>gn&&(H=q(M+w)),H[M++]=217,H[M++]=223,H[M++]=249,H[M++]=Ee.position?132:130,H[M++]=26,nt=M-e,M+=4,Ee.position&&H0(e,O),Ee=["",""],Ee.size=0,Ee.position=nt}let it=_1.test(I);Ee[it?0:1]+=I,H[M++]=it?206:207,O(E);return}let b;E<32?b=1:E<256?b=2:E<65536?b=3:b=5;let $=E*3;if(M+$>gn&&(H=q(M+$)),E<64||!u){let it,nt,w,V=M+b;for(it=0;it<E;it++)nt=I.charCodeAt(it),nt<128?H[V++]=nt:nt<2048?(H[V++]=nt>>6|192,H[V++]=nt&63|128):(nt&64512)===55296&&((w=I.charCodeAt(it+1))&64512)===56320?(nt=65536+((nt&1023)<<10)+(w&1023),it++,H[V++]=nt>>18|240,H[V++]=nt>>12&63|128,H[V++]=nt>>6&63|128,H[V++]=nt&63|128):(H[V++]=nt>>12|224,H[V++]=nt>>6&63|128,H[V++]=nt&63|128);X=V-M-b}else X=u(I,M+b,$);X<24?H[M++]=96|X:X<256?(b<2&&H.copyWithin(M+2,M+1,M+1+X),H[M++]=120,H[M++]=X):X<65536?(b<3&&H.copyWithin(M+3,M+2,M+2+X),H[M++]=121,H[M++]=X>>8,H[M++]=X&255):(b<5&&H.copyWithin(M+5,M+3,M+3+X),H[M++]=122,se.setUint32(M,X),M+=4),M+=X}else if(K==="number")if(!this.alwaysUseFloat&&I>>>0===I)I<24?H[M++]=I:I<256?(H[M++]=24,H[M++]=I):I<65536?(H[M++]=25,H[M++]=I>>8,H[M++]=I&255):(H[M++]=26,se.setUint32(M,I),M+=4);else if(!this.alwaysUseFloat&&I>>0===I)I>=-24?H[M++]=31-I:I>=-256?(H[M++]=56,H[M++]=~I):I>=-65536?(H[M++]=57,se.setUint16(M,~I),M+=2):(H[M++]=58,se.setUint32(M,~I),M+=4);else{let E;if((E=this.useFloat32)>0&&I<4294967296&&I>=-2147483648){H[M++]=250,se.setFloat32(M,I);let b;if(E<4||(b=I*Df[(H[M]&127)<<1|H[M+1]>>7])>>0===b){M+=4;return}else M--}H[M++]=251,se.setFloat64(M,I),M+=8}else if(K==="object")if(!I)H[M++]=246;else{if(h){let b=h.get(I);if(b){if(H[M++]=216,H[M++]=29,H[M++]=25,!b.references){let $=h.idsToInsert||(h.idsToInsert=[]);b.references=[],$.push(b)}b.references.push(M-e),M+=2;return}else h.set(I,{offset:M-e})}let E=I.constructor;if(E===Object)G(I,!0);else if(E===Array){X=I.length,X<24?H[M++]=128|X:rs(X);for(let b=0;b<X;b++)O(I[b])}else if(E===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(H[M++]=217,H[M++]=1,H[M++]=3),X=I.size,X<24?H[M++]=160|X:X<256?(H[M++]=184,H[M++]=X):X<65536?(H[M++]=185,H[M++]=X>>8,H[M++]=X&255):(H[M++]=186,se.setUint32(M,X),M+=4),f.keyMap)for(let[b,$]of I)O(f.encodeKey(b)),O($);else for(let[b,$]of I)O(b),O($);else{for(let b=0,$=Zd.length;b<$;b++){let it=LA[b];if(I instanceof it){let nt=Zd[b],w=nt.tag;w==null&&(w=nt.getTag&&nt.getTag.call(this,I)),w<24?H[M++]=192|w:w<256?(H[M++]=216,H[M++]=w):w<65536?(H[M++]=217,H[M++]=w>>8,H[M++]=w&255):w>-1&&(H[M++]=218,se.setUint32(M,w),M+=4),nt.encode.call(this,I,O,q);return}}if(I[Symbol.iterator]){if(_d){let b=new Error("Iterable should be serialized as iterator");throw b.iteratorNotHandled=!0,b}H[M++]=159;for(let b of I)O(b);H[M++]=255;return}if(I[Symbol.asyncIterator]||md(I)){let b=new Error("Iterable/blob should be serialized as iterator");throw b.iteratorNotHandled=!0,b}if(this.useToJSON&&I.toJSON){const b=I.toJSON();if(b!==I)return O(b)}G(I,!I.hasOwnProperty)}}else if(K==="boolean")H[M++]=I?245:244;else if(K==="bigint"){if(I<BigInt(1)<<BigInt(64)&&I>=0)H[M++]=27,se.setBigUint64(M,I);else if(I>-(BigInt(1)<<BigInt(64))&&I<0)H[M++]=59,se.setBigUint64(M,-I-BigInt(1));else if(this.largeBigIntToFloat)H[M++]=251,se.setFloat64(M,Number(I));else throw new RangeError(I+" was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64");M+=8}else if(K==="undefined")H[M++]=247;else throw new Error("Unknown type: "+K)},G=this.useRecords===!1?this.variableMapSize?I=>{let K=Object.keys(I),X=Object.values(I),E=K.length;if(E<24?H[M++]=160|E:E<256?(H[M++]=184,H[M++]=E):E<65536?(H[M++]=185,H[M++]=E>>8,H[M++]=E&255):(H[M++]=186,se.setUint32(M,E),M+=4),f.keyMap)for(let b=0;b<E;b++)O(f.encodeKey(K[b])),O(X[b]);else for(let b=0;b<E;b++)O(K[b]),O(X[b])}:(I,K)=>{H[M++]=185;let X=M-e;M+=2;let E=0;if(f.keyMap)for(let b in I)(K||I.hasOwnProperty(b))&&(O(f.encodeKey(b)),O(I[b]),E++);else for(let b in I)(K||I.hasOwnProperty(b))&&(O(b),O(I[b]),E++);H[X+++e]=E>>8,H[X+e]=E&255}:(I,K)=>{let X,E=l.transitions||(l.transitions=Object.create(null)),b=0,$=0,it,nt;if(this.keyMap){nt=Object.keys(I).map(V=>this.encodeKey(V)),$=nt.length;for(let V=0;V<$;V++){let st=nt[V];X=E[st],X||(X=E[st]=Object.create(null),b++),E=X}}else for(let V in I)(K||I.hasOwnProperty(V))&&(X=E[V],X||(E[Ti]&1048576&&(it=E[Ti]&65535),X=E[V]=Object.create(null),b++),E=X,$++);let w=E[Ti];if(w!==void 0)w&=65535,H[M++]=217,H[M++]=w>>8|224,H[M++]=w&255;else if(nt||(nt=E.__keys__||(E.__keys__=Object.keys(I))),it===void 0?(w=l.nextId++,w||(w=0,l.nextId=1),w>=U0&&(l.nextId=(w=_)+1)):w=it,l[w]=nt,w<_){H[M++]=217,H[M++]=w>>8|224,H[M++]=w&255,E=l.transitions;for(let V=0;V<$;V++)(E[Ti]===void 0||E[Ti]&1048576)&&(E[Ti]=w),E=E[nt[V]];E[Ti]=w|1048576,r=!0}else{if(E[Ti]=w,se.setUint32(M,3655335680),M+=3,b&&(R+=C*b),U.length>=U0-_&&(U.shift()[Ti]=void 0),U.push(E),rs($+2),O(57344+w),O(nt),K===null)return;for(let V in I)(K||I.hasOwnProperty(V))&&O(I[V]);return}if($<24?H[M++]=128|$:rs($),K!==null)for(let V in I)(K||I.hasOwnProperty(V))&&O(I[V])},q=I=>{let K;if(I>16777216){if(I-e>L0)throw new Error("Encoded buffer would be larger than maximum buffer size");K=Math.min(L0,Math.round(Math.max((I-e)*(I>67108864?1.25:2),4194304)/4096)*4096)}else K=(Math.max(I-e<<2,H.length-1)>>12)+1<<12;let X=new gd(K);return se=new DataView(X.buffer,0,K),H.copy?H.copy(X,0,e,I):X.set(H.slice(e,I)),M-=e,e=0,gn=X.length-10,H=X};let et=100,k=1e3;this.encodeAsIterable=function(I,K){return bt(I,K,rt)},this.encodeAsAsyncIterable=function(I,K){return bt(I,K,Et)};function*rt(I,K,X){let E=I.constructor;if(E===Object){let b=f.useRecords!==!1;b?G(I,null):F0(Object.keys(I).length,160);for(let $ in I){let it=I[$];b||O($),it&&typeof it=="object"?K[$]?yield*rt(it,K[$]):yield*pt(it,K,$):O(it)}}else if(E===Array){let b=I.length;rs(b);for(let $=0;$<b;$++){let it=I[$];it&&(typeof it=="object"||M-e>et)?K.element?yield*rt(it,K.element):yield*pt(it,K,"element"):O(it)}}else if(I[Symbol.iterator]){H[M++]=159;for(let b of I)b&&(typeof b=="object"||M-e>et)?K.element?yield*rt(b,K.element):yield*pt(b,K,"element"):O(b);H[M++]=255}else md(I)?(F0(I.size,64),yield H.subarray(e,M),yield I,At()):I[Symbol.asyncIterator]?(H[M++]=159,yield H.subarray(e,M),yield I,At(),H[M++]=255):O(I);X&&M>e?yield H.subarray(e,M):M-e>et&&(yield H.subarray(e,M),At())}function*pt(I,K,X){let E=M-e;try{O(I),M-e>et&&(yield H.subarray(e,M),At())}catch(b){if(b.iteratorNotHandled)K[X]={},M=e+E,yield*rt.call(this,I,K[X]);else throw b}}function At(){et=k,f.encode(null,yd)}function bt(I,K,X){return K&&K.chunkThreshold?et=k=K.chunkThreshold:et=100,I&&typeof I=="object"?(f.encode(null,yd),X(I,f.iterateProperties||(f.iterateProperties={}),!0)):[f.encode(I)]}async function*Et(I,K){for(let X of rt(I,K,!0)){let E=X.constructor;if(E===O0||E===Uint8Array)yield X;else if(md(X)){let b=X.stream().getReader(),$;for(;!($=await b.read()).done;)yield $.value}else if(X[Symbol.asyncIterator])for await(let b of X)At(),b?yield*Et(b,K.async||(K.async={})):yield f.encode(b);else yield X}}}useBuffer(t){H=t,se=new DataView(H.buffer,H.byteOffset,H.byteLength),M=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let t=this.sharedVersion||0;this.sharedVersion=t+1;let e=this.structures.slice(0),s=new FA(e,this.sharedValues,this.sharedVersion),r=this.saveShared(s,l=>(l&&l.version||0)==t);return r===!1?(s=this.getShared()||{},this.structures=s.structures||[],this.sharedValues=s.packedValues,this.sharedVersion=s.version,this.structures.nextId=this.structures.length):e.forEach((l,h)=>this.structures[h]=l),r}}function F0(o,t){o<24?H[M++]=t|o:o<256?(H[M++]=t|24,H[M++]=o):o<65536?(H[M++]=t|25,H[M++]=o>>8,H[M++]=o&255):(H[M++]=t|26,se.setUint32(M,o),M+=4)}class FA{constructor(t,e,s){this.structures=t,this.packedValues=e,this.version=s}}function rs(o){o<24?H[M++]=128|o:o<256?(H[M++]=152,H[M++]=o):o<65536?(H[M++]=153,H[M++]=o>>8,H[M++]=o&255):(H[M++]=154,se.setUint32(M,o),M+=4)}const y1=typeof Blob>"u"?function(){}:Blob;function md(o){if(o instanceof y1)return!0;let t=o[Symbol.toStringTag];return t==="Blob"||t==="File"}function hc(o,t){switch(typeof o){case"string":if(o.length>3){if(t.objectMap[o]>-1||t.values.length>=t.maxValues)return;let s=t.get(o);if(s)++s.count==2&&t.values.push(o);else if(t.set(o,{count:1}),t.samplingPackedValues){let r=t.samplingPackedValues.get(o);r?r.count++:t.samplingPackedValues.set(o,{count:1})}}break;case"object":if(o)if(o instanceof Array)for(let s=0,r=o.length;s<r;s++)hc(o[s],t);else{let s=!t.encoder.useRecords;for(var e in o)o.hasOwnProperty(e)&&(s&&hc(e,t),hc(o[e],t))}break;case"function":console.log(o)}}const A1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;LA=[Date,Set,Error,RegExp,Kn,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,FA];Zd=[{tag:1,encode(o,t){let e=o.getTime()/1e3;(this.useTimestamp32||o.getMilliseconds()===0)&&e>=0&&e<4294967296?(H[M++]=26,se.setUint32(M,e),M+=4):(H[M++]=251,se.setFloat64(M,e),M+=8)}},{tag:258,encode(o,t){let e=Array.from(o);t(e)}},{tag:27,encode(o,t){t([o.name,o.message])}},{tag:27,encode(o,t){t(["RegExp",o.source,o.flags])}},{getTag(o){return o.tag},encode(o,t){t(o.value)}},{encode(o,t,e){N0(o,e)}},{getTag(o){if(o.constructor===Uint8Array&&(this.tagUint8Array||Eo&&this.tagUint8Array!==!1))return 64},encode(o,t,e){N0(o,e)}},is(68,1),is(69,2),is(70,4),is(71,8),is(72,1),is(77,2),is(78,4),is(79,8),is(85,4),is(86,8),{encode(o,t){let e=o.packedValues||[],s=o.structures||[];if(e.values.length>0){H[M++]=216,H[M++]=51,rs(4);let r=e.values;t(r),rs(0),rs(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let l=0,h=r.length;l<h;l++)packedObjectMap[r[l]]=l}if(s){se.setUint32(M,3655335424),M+=3;let r=s.slice(0);r.unshift(57344),r.push(new Kn(o.version,1399353956)),t(r)}else t(new Kn(o.version,1399353956))}}];function is(o,t){return!A1&&t>1&&(o-=4),{tag:o,encode:function(s,r){let l=s.byteLength,h=s.byteOffset||0,u=s.buffer||s;r(Eo?kc.from(u,h,l):new Uint8Array(u,h,l))}}}function N0(o,t){let e=o.byteLength;e<24?H[M++]=64+e:e<256?(H[M++]=88,H[M++]=e):e<65536?(H[M++]=89,H[M++]=e>>8,H[M++]=e&255):(H[M++]=90,se.setUint32(M,e),M+=4),M+e>=H.length&&t(M+e),H.set(o.buffer?o:new Uint8Array(o),M),M+=e}function v1(o,t){let e,s=t.length*2,r=o.length-s;t.sort((l,h)=>l.offset>h.offset?1:-1);for(let l=0;l<t.length;l++){let h=t[l];h.id=l;for(let u of h.references)o[u++]=l>>8,o[u]=l&255}for(;e=t.pop();){let l=e.offset;o.copyWithin(l+s,l,r),s-=2;let h=l+s;o[h++]=216,o[h++]=28,r=l}return o}function H0(o,t){se.setUint32(Ee.position+o,M-Ee.position-o+1);let e=Ee;Ee=null,t(e[0]),t(e[1])}let Mf=new m1({useRecords:!1});Mf.encode;Mf.encodeAsIterable;Mf.encodeAsAsyncIterable;const G0=512,x1=1024,yd=2048;function ir(o,t,e,s){Object.defineProperty(o,t,{get:e,set:s,enumerable:!0,configurable:!0})}class NA{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=t=>{const e=[],s=t.byteLength,r=Math.ceil(s/this.chunkedMTU);let l=0,h=0;for(;h<s;){const u=Math.min(s,h+this.chunkedMTU),f=t.slice(h,u),g={__peerData:this._dataCount,n:l,data:f,total:r};e.push(g),h=u,l++}return this._dataCount++,e}}}function b1(o){let t=0;for(const r of o)t+=r.byteLength;const e=new Uint8Array(t);let s=0;for(const r of o)e.set(r,s),s+=r.byteLength;return e}const Ad=M0.default||M0,to=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const o=this.getBrowser(),t=this.getVersion();return this.supportedBrowsers.includes(o)?o==="chrome"?t>=this.minChromeVersion:o==="firefox"?t>=this.minFirefoxVersion:o==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1}getBrowser(){return Ad.browserDetails.browser}getVersion(){return Ad.browserDetails.version||0}isUnifiedPlanSupported(){const o=this.getBrowser(),t=Ad.browserDetails.version||0;if(o==="chrome"&&t<this.minChromeVersion)return!1;if(o==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e,s=!1;try{e=new RTCPeerConnection,e.addTransceiver("audio"),s=!0}catch{}finally{e&&e.close()}return s}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},w1=o=>!o||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(o),HA=()=>Math.random().toString(36).slice(2),Q0={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class C1 extends NA{noop(){}blobToArrayBuffer(t,e){const s=new FileReader;return s.onload=function(r){r.target&&e(r.target.result)},s.readAsArrayBuffer(t),s}binaryStringToArrayBuffer(t){const e=new Uint8Array(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s)&255;return e.buffer}isSecure(){return location.protocol==="https:"}constructor(...t){super(...t),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Q0,this.browser=to.getBrowser(),this.browserVersion=to.getVersion(),this.pack=$y,this.unpack=Ky,this.supports=(function(){const e={browser:to.isBrowserSupported(),webRTC:to.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;let s;try{s=new RTCPeerConnection(Q0),e.audioVideo=!0;let r;try{r=s.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!r.ordered;try{r.binaryType="blob",e.binaryBlob=!to.isIOS}catch{}}catch{}finally{r&&r.close()}}catch{}finally{s&&s.close()}return e})(),this.validateId=w1,this.randomToken=HA}}const ui=new C1,S1="PeerJS: ";var V0;(function(o){o[o.Disabled=0]="Disabled",o[o.Errors=1]="Errors",o[o.Warnings=2]="Warnings",o[o.All=3]="All"})(V0||(V0={}));class T1{get logLevel(){return this._logLevel}set logLevel(t){this._logLevel=t}log(...t){this._logLevel>=3&&this._print(3,...t)}warn(...t){this._logLevel>=2&&this._print(2,...t)}error(...t){this._logLevel>=1&&this._print(1,...t)}setLogFunction(t){this._print=t}_print(t,...e){const s=[S1,...e];for(const r in s)s[r]instanceof Error&&(s[r]="("+s[r].name+") "+s[r].message);t>=3?console.log(...s):t>=2?console.warn("WARNING",...s):t>=1&&console.error("ERROR",...s)}constructor(){this._logLevel=0}}var ht=new T1,Pf={},E1=Object.prototype.hasOwnProperty,ii="~";function xo(){}Object.create&&(xo.prototype=Object.create(null),new xo().__proto__||(ii=!1));function D1(o,t,e){this.fn=o,this.context=t,this.once=e||!1}function GA(o,t,e,s,r){if(typeof e!="function")throw new TypeError("The listener must be a function");var l=new D1(e,s||o,r),h=ii?ii+t:t;return o._events[h]?o._events[h].fn?o._events[h]=[o._events[h],l]:o._events[h].push(l):(o._events[h]=l,o._eventsCount++),o}function uc(o,t){--o._eventsCount===0?o._events=new xo:delete o._events[t]}function We(){this._events=new xo,this._eventsCount=0}We.prototype.eventNames=function(){var t=[],e,s;if(this._eventsCount===0)return t;for(s in e=this._events)E1.call(e,s)&&t.push(ii?s.slice(1):s);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};We.prototype.listeners=function(t){var e=ii?ii+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,l=s.length,h=new Array(l);r<l;r++)h[r]=s[r].fn;return h};We.prototype.listenerCount=function(t){var e=ii?ii+t:t,s=this._events[e];return s?s.fn?1:s.length:0};We.prototype.emit=function(t,e,s,r,l,h){var u=ii?ii+t:t;if(!this._events[u])return!1;var f=this._events[u],g=arguments.length,_,y;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),g){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,s),!0;case 4:return f.fn.call(f.context,e,s,r),!0;case 5:return f.fn.call(f.context,e,s,r,l),!0;case 6:return f.fn.call(f.context,e,s,r,l,h),!0}for(y=1,_=new Array(g-1);y<g;y++)_[y-1]=arguments[y];f.fn.apply(f.context,_)}else{var A=f.length,x;for(y=0;y<A;y++)switch(f[y].once&&this.removeListener(t,f[y].fn,void 0,!0),g){case 1:f[y].fn.call(f[y].context);break;case 2:f[y].fn.call(f[y].context,e);break;case 3:f[y].fn.call(f[y].context,e,s);break;case 4:f[y].fn.call(f[y].context,e,s,r);break;default:if(!_)for(x=1,_=new Array(g-1);x<g;x++)_[x-1]=arguments[x];f[y].fn.apply(f[y].context,_)}}return!0};We.prototype.on=function(t,e,s){return GA(this,t,e,s,!1)};We.prototype.once=function(t,e,s){return GA(this,t,e,s,!0)};We.prototype.removeListener=function(t,e,s,r){var l=ii?ii+t:t;if(!this._events[l])return this;if(!e)return uc(this,l),this;var h=this._events[l];if(h.fn)h.fn===e&&(!r||h.once)&&(!s||h.context===s)&&uc(this,l);else{for(var u=0,f=[],g=h.length;u<g;u++)(h[u].fn!==e||r&&!h[u].once||s&&h[u].context!==s)&&f.push(h[u]);f.length?this._events[l]=f.length===1?f[0]:f:uc(this,l)}return this};We.prototype.removeAllListeners=function(t){var e;return t?(e=ii?ii+t:t,this._events[e]&&uc(this,e)):(this._events=new xo,this._eventsCount=0),this};We.prototype.off=We.prototype.removeListener;We.prototype.addListener=We.prototype.on;We.prefixed=ii;We.EventEmitter=We;Pf=We;var sr={};ir(sr,"ConnectionType",()=>hs);ir(sr,"PeerErrorType",()=>ce);ir(sr,"BaseConnectionErrorType",()=>bo);ir(sr,"DataConnectionErrorType",()=>wo);ir(sr,"SerializationType",()=>ta);ir(sr,"SocketEventType",()=>os);ir(sr,"ServerMessageType",()=>Ie);var hs;(function(o){o.Data="data",o.Media="media"})(hs||(hs={}));var ce;(function(o){o.BrowserIncompatible="browser-incompatible",o.Disconnected="disconnected",o.InvalidID="invalid-id",o.InvalidKey="invalid-key",o.Network="network",o.PeerUnavailable="peer-unavailable",o.SslUnavailable="ssl-unavailable",o.ServerError="server-error",o.SocketError="socket-error",o.SocketClosed="socket-closed",o.UnavailableID="unavailable-id",o.WebRTC="webrtc"})(ce||(ce={}));var bo;(function(o){o.NegotiationFailed="negotiation-failed",o.ConnectionClosed="connection-closed"})(bo||(bo={}));var wo;(function(o){o.NotOpenYet="not-open-yet",o.MessageToBig="message-too-big"})(wo||(wo={}));var ta;(function(o){o.Binary="binary",o.BinaryUTF8="binary-utf8",o.JSON="json",o.None="raw"})(ta||(ta={}));var os;(function(o){o.Message="message",o.Disconnected="disconnected",o.Error="error",o.Close="close"})(os||(os={}));var Ie;(function(o){o.Heartbeat="HEARTBEAT",o.Candidate="CANDIDATE",o.Offer="OFFER",o.Answer="ANSWER",o.Open="OPEN",o.Error="ERROR",o.IdTaken="ID-TAKEN",o.InvalidKey="INVALID-KEY",o.Leave="LEAVE",o.Expire="EXPIRE"})(Ie||(Ie={}));var Bf={};Bf=JSON.parse('{"name":"peerjs","version":"1.5.2","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-cbor":"dist/serializer.cbor.mjs","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-cbor":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/Cbor.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","cbor-x":"1.5.4","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^8.0.0"},"alias":{"process":false,"buffer":false}}');class R1 extends Pf.EventEmitter{constructor(t,e,s,r,l,h=5e3){super(),this.pingInterval=h,this._disconnected=!0,this._messagesQueue=[];const u=t?"wss://":"ws://";this._baseUrl=u+e+":"+s+r+"peerjs?key="+l}start(t,e){this._id=t;const s=`${this._baseUrl}&id=${t}&token=${e}`;this._socket||!this._disconnected||(this._socket=new WebSocket(s+"&version="+Bf.version),this._disconnected=!1,this._socket.onmessage=r=>{let l;try{l=JSON.parse(r.data),ht.log("Server message received:",l)}catch{ht.log("Invalid server message",r.data);return}this.emit(os.Message,l)},this._socket.onclose=r=>{this._disconnected||(ht.log("Socket closed.",r),this._cleanup(),this._disconnected=!0,this.emit(os.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),ht.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){ht.log("Cannot send heartbeat, because socket closed");return}const t=JSON.stringify({type:Ie.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const t=[...this._messagesQueue];this._messagesQueue=[];for(const e of t)this.send(e)}send(t){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(os.Error,"Invalid message");return}if(!this._wsOpen())return;const e=JSON.stringify(t);this._socket.send(e)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class QA{constructor(t){this.connection=t}startConnection(t){const e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===hs.Media&&t._stream&&this._addTracksToConnection(t._stream,e),t.originator){const s=this.connection,r={ordered:!!t.reliable},l=e.createDataChannel(s.label,r);s._initializeDataChannel(l),this._makeOffer()}else this.handleSDP("OFFER",t.sdp)}_startPeerConnection(){ht.log("Creating RTCPeerConnection.");const t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t}_setupListeners(t){const e=this.connection.peer,s=this.connection.connectionId,r=this.connection.type,l=this.connection.provider;ht.log("Listening for ICE candidates."),t.onicecandidate=h=>{!h.candidate||!h.candidate.candidate||(ht.log(`Received ICE candidates for ${e}:`,h.candidate),l.socket.send({type:Ie.Candidate,payload:{candidate:h.candidate,type:r,connectionId:s},dst:e}))},t.oniceconnectionstatechange=()=>{switch(t.iceConnectionState){case"failed":ht.log("iceConnectionState is failed, closing connections to "+e),this.connection.emitError(bo.NegotiationFailed,"Negotiation of connection to "+e+" failed."),this.connection.close();break;case"closed":ht.log("iceConnectionState is closed, closing connections to "+e),this.connection.emitError(bo.ConnectionClosed,"Connection to "+e+" closed."),this.connection.close();break;case"disconnected":ht.log("iceConnectionState changed to disconnected on the connection with "+e);break;case"completed":t.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",t.iceConnectionState)},ht.log("Listening for data channel"),t.ondatachannel=h=>{ht.log("Received data channel");const u=h.channel;l.getConnection(e,s)._initializeDataChannel(u)},ht.log("Listening for remote stream"),t.ontrack=h=>{ht.log("Received remote stream");const u=h.streams[0],f=l.getConnection(e,s);if(f.type===hs.Media){const g=f;this._addStreamToMediaConnection(u,g)}}}cleanup(){ht.log("Cleaning up PeerConnection to "+this.connection.peer);const t=this.connection.peerConnection;if(!t)return;this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=()=>{};const e=t.signalingState!=="closed";let s=!1;const r=this.connection.dataChannel;r&&(s=!!r.readyState&&r.readyState!=="closed"),(e||s)&&t.close()}async _makeOffer(){const t=this.connection.peerConnection,e=this.connection.provider;try{const s=await t.createOffer(this.connection.options.constraints);ht.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp);try{await t.setLocalDescription(s),ht.log("Set localDescription:",s,`for:${this.connection.peer}`);let r={sdp:s,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===hs.Data){const l=this.connection;r={...r,label:l.label,reliable:l.reliable,serialization:l.serialization}}e.socket.send({type:Ie.Offer,payload:r,dst:this.connection.peer})}catch(r){r!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(e.emitError(ce.WebRTC,r),ht.log("Failed to setLocalDescription, ",r))}}catch(s){e.emitError(ce.WebRTC,s),ht.log("Failed to createOffer, ",s)}}async _makeAnswer(){const t=this.connection.peerConnection,e=this.connection.provider;try{const s=await t.createAnswer();ht.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp);try{await t.setLocalDescription(s),ht.log("Set localDescription:",s,`for:${this.connection.peer}`),e.socket.send({type:Ie.Answer,payload:{sdp:s,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(r){e.emitError(ce.WebRTC,r),ht.log("Failed to setLocalDescription, ",r)}}catch(s){e.emitError(ce.WebRTC,s),ht.log("Failed to create answer, ",s)}}async handleSDP(t,e){e=new RTCSessionDescription(e);const s=this.connection.peerConnection,r=this.connection.provider;ht.log("Setting remote description",e);const l=this;try{await s.setRemoteDescription(e),ht.log(`Set remoteDescription:${t} for:${this.connection.peer}`),t==="OFFER"&&await l._makeAnswer()}catch(h){r.emitError(ce.WebRTC,h),ht.log("Failed to setRemoteDescription, ",h)}}async handleCandidate(t){ht.log("handleCandidate:",t);try{await this.connection.peerConnection.addIceCandidate(t),ht.log(`Added ICE candidate for:${this.connection.peer}`)}catch(e){this.connection.provider.emitError(ce.WebRTC,e),ht.log("Failed to handleCandidate, ",e)}}_addTracksToConnection(t,e){if(ht.log(`add tracks from stream ${t.id} to peer connection`),!e.addTrack)return ht.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(s=>{e.addTrack(s,t)})}_addStreamToMediaConnection(t,e){ht.log(`add stream ${t.id} to media connection ${e.connectionId}`),e.addStream(t)}}class VA extends Pf.EventEmitter{emitError(t,e){ht.error("Error:",e),this.emit("error",new M1(`${t}`,e))}}class M1 extends Error{constructor(t,e){typeof e=="string"?super(e):(super(),Object.assign(this,e)),this.type=t}}class YA extends VA{get open(){return this._open}constructor(t,e,s){super(),this.peer=t,this.provider=e,this.options=s,this._open=!1,this.metadata=s.metadata}}var Jd;const ho=class ho extends YA{get type(){return hs.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(t,e,s){super(t,e,s),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||ho.ID_PREFIX+ui.randomToken(),this._negotiator=new QA(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{ht.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{ht.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(t){ht.log("Receiving stream",t),this._remoteStream=t,super.emit("stream",t)}handleMessage(t){const e=t.type,s=t.payload;switch(t.type){case Ie.Answer:this._negotiator.handleSDP(e,s.sdp),this._open=!0;break;case Ie.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:ht.warn(`Unrecognized message type:${e} from peer:${this.peer}`);break}}answer(t,e={}){if(this._localStream){ht.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,e&&e.sdpTransform&&(this.options.sdpTransform=e.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:t});const s=this.provider._getMessages(this.connectionId);for(const r of s)this.handleMessage(r);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Jd=new WeakMap,Ja(ho,Jd,ho.ID_PREFIX="mc_");let xc=ho;class P1{constructor(t){this._options=t}_buildRequest(t){const e=this._options.secure?"https":"http",{host:s,port:r,path:l,key:h}=this._options,u=new URL(`${e}://${s}:${r}${l}${h}/${t}`);return u.searchParams.set("ts",`${Date.now()}${Math.random()}`),u.searchParams.set("version",Bf.version),fetch(u.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const t=await this._buildRequest("id");if(t.status!==200)throw new Error(`Error. Status:${t.status}`);return t.text()}catch(t){ht.error("Error retrieving ID",t);let e="";throw this._options.path==="/"&&this._options.host!==ui.CLOUD_HOST&&(e=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+e)}}async listAllPeers(){try{const t=await this._buildRequest("peers");if(t.status!==200){if(t.status===401){let e="";throw this._options.host===ui.CLOUD_HOST?e="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":e="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)}throw new Error(`Error. Status:${t.status}`)}return t.json()}catch(t){throw ht.error("Error retrieving list peers",t),new Error("Could not get list peers from the server."+t)}}}var Kd,$d;const qn=class qn extends YA{get type(){return hs.Data}constructor(t,e,s){super(t,e,s),this.connectionId=this.options.connectionId||qn.ID_PREFIX+HA(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new QA(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{ht.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=e=>{ht.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{ht.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(t,e=!1){if(!this.open){this.emitError(wo.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(t,e)}async handleMessage(t){const e=t.payload;switch(t.type){case Ie.Answer:await this._negotiator.handleSDP(t.type,e.sdp);break;case Ie.Candidate:await this._negotiator.handleCandidate(e.candidate);break;default:ht.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}}};Kd=new WeakMap,$d=new WeakMap,Ja(qn,Kd,qn.ID_PREFIX="dc_"),Ja(qn,$d,qn.MAX_BUFFERED_AMOUNT=8388608);let bc=qn;class If extends bc{get bufferSize(){return this._bufferSize}_initializeDataChannel(t){super._initializeDataChannel(t),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",e=>this._handleDataMessage(e))}_bufferedSend(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)}_trySend(t){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>bc.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(e){return ht.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...t){super(...t),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class vd extends If{close(t){super.close(t),this._chunkedData={}}constructor(t,e,s){super(t,e,s),this.chunker=new NA,this.serialization=ta.Binary,this._chunkedData={}}_handleDataMessage({data:t}){const e=Ky(t),s=e.__peerData;if(s){if(s.type==="close"){this.close();return}this._handleChunk(e);return}this.emit("data",e)}_handleChunk(t){const e=t.__peerData,s=this._chunkedData[e]||{data:[],count:0,total:t.total};if(s.data[t.n]=new Uint8Array(t.data),s.count++,this._chunkedData[e]=s,s.total===s.count){delete this._chunkedData[e];const r=b1(s.data);this._handleDataMessage({data:r})}}_send(t,e){const s=$y(t);if(s instanceof Promise)return this._send_blob(s);if(!e&&s.byteLength>this.chunker.chunkedMTU){this._sendChunks(s);return}this._bufferedSend(s)}async _send_blob(t){const e=await t;if(e.byteLength>this.chunker.chunkedMTU){this._sendChunks(e);return}this._bufferedSend(e)}_sendChunks(t){const e=this.chunker.chunk(t);ht.log(`DC#${this.connectionId} Try to send ${e.length} chunks...`);for(const s of e)this.send(s,!0)}}class B1 extends If{_handleDataMessage({data:t}){super.emit("data",t)}_send(t,e){this._bufferedSend(t)}constructor(...t){super(...t),this.serialization=ta.None}}class I1 extends If{_handleDataMessage({data:t}){const e=this.parse(this.decoder.decode(t)),s=e.__peerData;if(s&&s.type==="close"){this.close();return}this.emit("data",e)}_send(t,e){const s=this.encoder.encode(this.stringify(t));if(s.byteLength>=ui.chunkedMTU){this.emitError(wo.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(s)}constructor(...t){super(...t),this.serialization=ta.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var tf;const uo=class uo extends VA{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const t=Object.create(null);for(const[e,s]of this._connections)t[e]=s;return t}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(t,e){super(),this._serializers={raw:B1,json:I1,binary:vd,"binary-utf8":vd,default:vd},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let s;if(t&&t.constructor==Object?e=t:t&&(s=t.toString()),e={debug:0,host:ui.CLOUD_HOST,port:ui.CLOUD_PORT,path:"/",key:uo.DEFAULT_KEY,token:ui.randomToken(),config:ui.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...e},this._options=e,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==ui.CLOUD_HOST?this._options.secure=ui.isSecure():this._options.host==ui.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&ht.setLogFunction(this._options.logFunction),ht.logLevel=this._options.debug||0,this._api=new P1(e),this._socket=this._createServerConnection(),!ui.supports.audioVideo&&!ui.supports.data){this._delayedAbort(ce.BrowserIncompatible,"The current browser does not support WebRTC");return}if(s&&!ui.validateId(s)){this._delayedAbort(ce.InvalidID,`ID "${s}" is invalid`);return}s?this._initialize(s):this._api.retrieveId().then(r=>this._initialize(r)).catch(r=>this._abort(ce.ServerError,r))}_createServerConnection(){const t=new R1(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(os.Message,e=>{this._handleMessage(e)}),t.on(os.Error,e=>{this._abort(ce.SocketError,e)}),t.on(os.Disconnected,()=>{this.disconnected||(this.emitError(ce.Network,"Lost connection to server."),this.disconnect())}),t.on(os.Close,()=>{this.disconnected||this._abort(ce.SocketClosed,"Underlying socket is already closed.")}),t}_initialize(t){this._id=t,this.socket.start(t,this._options.token)}_handleMessage(t){const e=t.type,s=t.payload,r=t.src;switch(e){case Ie.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Ie.Error:this._abort(ce.ServerError,s.msg);break;case Ie.IdTaken:this._abort(ce.UnavailableID,`ID "${this.id}" is taken`);break;case Ie.InvalidKey:this._abort(ce.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Ie.Leave:ht.log(`Received leave message from ${r}`),this._cleanupPeer(r),this._connections.delete(r);break;case Ie.Expire:this.emitError(ce.PeerUnavailable,`Could not connect to peer ${r}`);break;case Ie.Offer:{const l=s.connectionId;let h=this.getConnection(r,l);if(h&&(h.close(),ht.warn(`Offer received for existing Connection ID:${l}`)),s.type===hs.Media){const f=new xc(r,this,{connectionId:l,_payload:s,metadata:s.metadata});h=f,this._addConnection(r,h),this.emit("call",f)}else if(s.type===hs.Data){const f=new this._serializers[s.serialization](r,this,{connectionId:l,_payload:s,metadata:s.metadata,label:s.label,serialization:s.serialization,reliable:s.reliable});h=f,this._addConnection(r,h),this.emit("connection",f)}else{ht.warn(`Received malformed connection type:${s.type}`);return}const u=this._getMessages(l);for(const f of u)h.handleMessage(f);break}default:{if(!s){ht.warn(`You received a malformed message from ${r} of type ${e}`);return}const l=s.connectionId,h=this.getConnection(r,l);h&&h.peerConnection?h.handleMessage(t):l?this._storeMessage(l,t):ht.warn("You received an unrecognized message:",t);break}}}_storeMessage(t,e){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(e)}_getMessages(t){const e=this._lostMessages.get(t);return e?(this._lostMessages.delete(t),e):[]}connect(t,e={}){if(e={serialization:"default",...e},this.disconnected){ht.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(ce.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const s=new this._serializers[e.serialization](t,this,e);return this._addConnection(t,s),s}call(t,e,s={}){if(this.disconnected){ht.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(ce.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!e){ht.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const r=new xc(t,this,{...s,_stream:e});return this._addConnection(t,r),r}_addConnection(t,e){ht.log(`add connection ${e.type}:${e.connectionId} to peerId:${t}`),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(e)}_removeConnection(t){const e=this._connections.get(t.peer);if(e){const s=e.indexOf(t);s!==-1&&e.splice(s,1)}this._lostMessages.delete(t.connectionId)}getConnection(t,e){const s=this._connections.get(t);if(!s)return null;for(const r of s)if(r.connectionId===e)return r;return null}_delayedAbort(t,e){setTimeout(()=>{this._abort(t,e)},0)}_abort(t,e){ht.error("Aborting!"),this.emitError(t,e),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(ht.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const t of this._connections.keys())this._cleanupPeer(t),this._connections.delete(t);this.socket.removeAllListeners()}_cleanupPeer(t){const e=this._connections.get(t);if(e)for(const s of e)s.close()}disconnect(){if(this.disconnected)return;const t=this.id;ht.log(`Disconnect peer with ID:${t}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}reconnect(){if(this.disconnected&&!this.destroyed)ht.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)ht.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(t=e=>{}){this._api.listAllPeers().then(e=>t(e)).catch(e=>this._abort(ce.ServerError,e))}};tf=new WeakMap,Ja(uo,tf,uo.DEFAULT_KEY="peerjs");let Wd=uo;var k1=Wd;class Y0{constructor(){this.peer=null,this.conn=null,this.onMessage=()=>{},this.onConnection=()=>{},this.onDisconnect=()=>{}}init(){return new Promise((t,e)=>{this.peer=new k1,this.peer.on("open",s=>{console.log("My peer ID is: "+s),t(s)}),this.peer.on("error",s=>{console.error(s),e(s)}),this.peer.on("connection",s=>{this.setupConnection(s)})})}connect(t){if(!this.peer)return;const e=this.peer.connect(t);this.setupConnection(e)}setupConnection(t){this.conn=t,this.conn.on("open",()=>{console.log("Connected to peer!"),this.onConnection()}),this.conn.on("data",e=>{this.onMessage(e)}),this.conn.on("close",()=>{console.log("Connection closed"),this.conn=null,this.onDisconnect()}),this.conn.on("error",e=>{console.error("Connection error:",e),this.conn=null,this.onDisconnect()})}send(t){this.conn&&this.conn.open&&this.conn.send(t)}destroy(){this.conn&&this.conn.close(),this.peer&&this.peer.destroy()}}const z1=()=>{const o=Ps.useRef(null),t=Ps.useRef(null),e=Ps.useRef(null),[s,r]=Ps.useState({p1Health:5,p2Health:5,p1State:"READY",p2State:"READY",gameOver:!1,showGameOver:!1,winner:null,isReplaying:!1,replayProgress:0,replaySpeed:1,isMultiplayer:!1,connectionStatus:"disconnected"}),[l,h]=Ps.useState("main"),[u,f]=Ps.useState(""),[g,_]=Ps.useState("");Ps.useEffect(()=>{if(!o.current)return;const C=new GS({canvasElement:o.current,width:800,height:400,displayMode:co.Fixed,backgroundColor:tt.fromHex("#90fcfc"),pixelArt:!0,fixedUpdateFps:60,antialiasing:!1});C.start().then(()=>{C.setupGame(G=>{r({...G})})}),t.current=C;const O=G=>{!C.isReplaying&&C.isGameOver&&(G.key===" "||G.key==="Enter")&&C.restartGame()};return window.addEventListener("keydown",O),()=>{window.removeEventListener("keydown",O),C.stop&&C.stop(),C.dispose&&C.dispose(),e.current&&e.current.destroy()}},[]);const y=()=>{h("game"),t.current&&t.current.restartGame()},A=async()=>{const C=new Y0;try{const O=await C.init();f(O),h("host"),C.onConnection=()=>{h("game"),t.current&&t.current.setupNetwork(C,!0)},e.current=C}catch{alert("Failed to connect to matchmaking server.")}},x=async()=>{if(!g)return;const C=new Y0;try{await C.init(),C.connect(g),C.onConnection=()=>{h("game"),t.current&&t.current.setupNetwork(C,!1)},e.current=C}catch{alert("Connection failed")}},D=(C,O=5)=>Math.max(0,C/O*100),S=C=>{t.current&&(t.current.seekTo(parseFloat(C.target.value)),t.current.setPlaybackSpeed(0))},U=C=>{t.current&&t.current.setPlaybackSpeed(C)},R=()=>{t.current&&t.current.toggleReplay(!s.isReplaying)};return ft.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen font-sans",children:[ft.jsx("h1",{className:"text-4xl mb-4 text-[#e94560] drop-shadow-md font-bold",children:" HOCKEY FIGHT "}),ft.jsxs("div",{className:"relative",children:[ft.jsx("canvas",{ref:o,id:"gameCanvas",className:"border-4 border-[#e94560] rounded-lg shadow-[0_0_30px_rgba(233,69,96,0.3)] image-pixelated",onContextMenu:C=>C.preventDefault()}),l!=="game"&&ft.jsxs("div",{className:"absolute inset-0 bg-[#1a1a2e]/95 flex flex-col items-center justify-center z-20",children:[l==="main"&&ft.jsxs("div",{className:"flex flex-col gap-4",children:[ft.jsx("button",{onClick:y,className:"bg-[#4ecdc4] text-[#1a1a2e] px-8 py-3 rounded-lg font-bold text-xl hover:bg-[#3dbdb4] transition",children:"LOCAL 2 PLAYER"}),ft.jsxs("div",{className:"flex gap-4",children:[ft.jsx("button",{onClick:A,className:"bg-[#e94560] text-white px-6 py-2 rounded-lg font-bold hover:bg-[#d13650]",children:"HOST ONLINE"}),ft.jsx("button",{onClick:()=>h("join"),className:"bg-[#16213e] border-2 border-[#e94560] text-white px-6 py-2 rounded-lg font-bold hover:bg-[#1f2b4d]",children:"JOIN ONLINE"})]})]}),l==="host"&&ft.jsxs("div",{className:"flex flex-col items-center gap-4 text-center p-6",children:[ft.jsx("h2",{className:"text-2xl text-[#4ecdc4] font-bold",children:"WAITING FOR PLAYER..."}),ft.jsxs("div",{className:"bg-[#16213e] p-4 rounded border border-gray-600",children:[ft.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"SHARE THIS ROOM ID:"}),ft.jsx("p",{className:"text-2xl font-mono text-white tracking-widest select-all",children:u})]}),ft.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mt-4"}),ft.jsx("button",{onClick:()=>h("main"),className:"text-gray-400 hover:text-white mt-4 underline",children:"Cancel"})]}),l==="join"&&ft.jsxs("div",{className:"flex flex-col items-center gap-4",children:[ft.jsx("h2",{className:"text-2xl text-[#e94560] font-bold",children:"JOIN GAME"}),ft.jsx("input",{type:"text",placeholder:"ENTER ROOM ID",className:"bg-[#16213e] border border-gray-600 p-3 rounded text-white text-center font-mono uppercase",value:g,onChange:C=>_(C.target.value)}),ft.jsxs("div",{className:"flex gap-4",children:[ft.jsx("button",{onClick:()=>h("main"),className:"text-gray-400 hover:text-white",children:"Back"}),ft.jsx("button",{onClick:x,className:"bg-[#4ecdc4] text-[#1a1a2e] px-6 py-2 rounded font-bold hover:bg-[#3dbdb4]",children:"CONNECT"})]})]})]}),s.isReplaying&&ft.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80 p-4 border-t-2 border-[#e94560] z-30",children:ft.jsxs("div",{className:"flex flex-col gap-2",children:[ft.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:s.replayProgress,onChange:S,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#e94560]"}),ft.jsxs("div",{className:"flex justify-center items-center gap-4 mt-2",children:[ft.jsx("button",{onClick:()=>U(-2),className:`px-3 py-1 rounded ${s.replaySpeed===-2?"bg-[#e94560]":"bg-gray-700"}`,children:""}),ft.jsx("button",{onClick:()=>U(0),className:`px-3 py-1 rounded ${s.replaySpeed===0?"bg-[#e94560]":"bg-gray-700"}`,children:""}),ft.jsx("button",{onClick:()=>U(1),className:`px-3 py-1 rounded ${s.replaySpeed===1?"bg-[#e94560]":"bg-gray-700"}`,children:""}),ft.jsx("button",{onClick:()=>U(2),className:`px-3 py-1 rounded ${s.replaySpeed===2?"bg-[#e94560]":"bg-gray-700"}`,children:""}),ft.jsx("button",{onClick:R,className:"px-3 py-1 rounded bg-red-600 text-white font-bold ml-4 hover:bg-red-500",children:"EXIT REPLAY"})]})]})}),s.showGameOver&&!s.isReplaying&&ft.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/60 z-10",children:[ft.jsxs("div",{className:"text-4xl text-[#feca57] drop-shadow-md font-bold mb-4 animate-bounce",children:[" ",s.winner," WINS! "]}),ft.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[ft.jsx("div",{className:"text-white text-lg",children:s.isMultiplayer?s.isHost?"Press SPACE to rematch":"Waiting for Host to rematch...":"Press SPACE to fight again"}),ft.jsx("button",{onClick:R,className:"mt-2 bg-[#e94560] text-white px-6 py-2 rounded-full font-bold shadow-lg hover:bg-[#d43750] transition-transform hover:scale-105",children:" WATCH REPLAY"}),s.isMultiplayer&&ft.jsx("button",{onClick:()=>window.location.reload(),className:"text-sm text-gray-400 hover:text-white mt-4 underline",children:"DISCONNECT"})]})]})]}),ft.jsxs("div",{className:"flex justify-between w-[800px] mt-4",children:[ft.jsxs("div",{className:"bg-[#16213e] p-4 rounded-lg min-w-[200px] border-l-4 border-[#4ecdc4]",children:[ft.jsx("div",{className:"text-lg font-bold mb-2 text-[#4ecdc4]",children:"PLAYER 1"}),ft.jsx("div",{className:"w-full h-5 bg-[#0f0f23] rounded-full overflow-hidden mb-2",children:ft.jsx("div",{className:"h-full transition-all duration-200 bg-gradient-to-r from-[#4ecdc4] to-[#44a08d]",style:{width:`${D(s.p1Health)}%`}})}),ft.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wider",children:s.p1State})]}),s.isMultiplayer?ft.jsxs("div",{className:"text-center text-sm text-gray-400 mt-2",children:[ft.jsxs("span",{className:"block font-bold text-[#e94560]",children:["YOU ARE ",s.isHost?"PLAYER 1":"PLAYER 2"]}),ft.jsx("span",{children:"WASD / ARROWS to Move  J / 1 High  K / 2 Low  L / 3 Grab"})]}):ft.jsx("div",{className:"text-center text-sm text-gray-400 mt-2",children:"P1: WASD+J/K/L | P2: ARROWS+1/2/3"}),ft.jsxs("div",{className:"bg-[#16213e] p-4 rounded-lg min-w-[200px] border-r-4 border-[#ff6b6b] text-right",children:[ft.jsx("div",{className:"text-lg font-bold mb-2 text-[#ff6b6b]",children:"PLAYER 2"}),ft.jsx("div",{className:"w-full h-5 bg-[#0f0f23] rounded-full overflow-hidden mb-2",children:ft.jsx("div",{className:"h-full transition-all duration-200 bg-gradient-to-l from-[#ff6b6b] to-[#ee5a5a] float-right",style:{width:`${D(s.p2Health)}%`}})}),ft.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wider",children:s.p2State})]})]})]})},jA=document.getElementById("root");if(!jA)throw new Error("Could not find root element to mount to");const O1=Rb.createRoot(jA);O1.render(ft.jsx(xb.StrictMode,{children:ft.jsx(z1,{})}));
