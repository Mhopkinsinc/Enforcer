var yb=o=>{throw TypeError(o)};var Ka=(o,t,e)=>t.has(o)?yb("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e);function vb(o,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in o)){const l=Object.getOwnPropertyDescriptor(s,r);l&&Object.defineProperty(o,r,l.get?l:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=e(r);fetch(r.href,l)}})();function af(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var id={exports:{}},$a={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U_;function xb(){if(U_)return $a;U_=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,r,l){var h=null;if(l!==void 0&&(h=""+l),r.key!==void 0&&(h=""+r.key),"key"in r){l={};for(var u in r)u!=="key"&&(l[u]=r[u])}else l=r;return r=l.ref,{$$typeof:o,type:s,key:h,ref:r!==void 0?r:null,props:l}}return $a.Fragment=t,$a.jsx=e,$a.jsxs=e,$a}var L_;function bb(){return L_||(L_=1,id.exports=xb()),id.exports}var it=bb(),sd={exports:{}},bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F_;function wb(){if(F_)return bt;F_=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),h=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),y=Symbol.iterator;function x(w){return w===null||typeof w!="object"?null:(w=y&&w[y]||w["@@iterator"],typeof w=="function"?w:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,L={};function D(w,j,nt){this.props=w,this.context=j,this.refs=L,this.updater=nt||E}D.prototype.isReactComponent={},D.prototype.setState=function(w,j){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,j,"setState")},D.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function R(){}R.prototype=D.prototype;function P(w,j,nt){this.props=w,this.context=j,this.refs=L,this.updater=nt||E}var F=P.prototype=new R;F.constructor=P,C(F,D.prototype),F.isPureReactComponent=!0;var Y=Array.isArray;function et(){}var k={H:null,A:null,T:null,S:null},rt=Object.prototype.hasOwnProperty;function gt(w,j,nt){var lt=nt.ref;return{$$typeof:o,type:w,key:j,ref:lt!==void 0?lt:null,props:nt}}function _t(w,j){return gt(w.type,j,w.props)}function At(w){return typeof w=="object"&&w!==null&&w.$$typeof===o}function xt(w){var j={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(nt){return j[nt]})}var O=/\/+/g;function K(w,j){return typeof w=="object"&&w!==null&&w.key!=null?xt(""+w.key):j.toString(36)}function X(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(et,et):(w.status="pending",w.then(function(j){w.status==="pending"&&(w.status="fulfilled",w.value=j)},function(j){w.status==="pending"&&(w.status="rejected",w.reason=j)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function T(w,j,nt,lt,yt){var St=typeof w;(St==="undefined"||St==="boolean")&&(w=null);var Lt=!1;if(w===null)Lt=!0;else switch(St){case"bigint":case"string":case"number":Lt=!0;break;case"object":switch(w.$$typeof){case o:case t:Lt=!0;break;case m:return Lt=w._init,T(Lt(w._payload),j,nt,lt,yt)}}if(Lt)return yt=yt(w),Lt=lt===""?"."+K(w,0):lt,Y(yt)?(nt="",Lt!=null&&(nt=Lt.replace(O,"$&/")+"/"),T(yt,j,nt,"",function(ra){return ra})):yt!=null&&(At(yt)&&(yt=_t(yt,nt+(yt.key==null||w&&w.key===yt.key?"":(""+yt.key).replace(O,"$&/")+"/")+Lt)),j.push(yt)),1;Lt=0;var Ke=lt===""?".":lt+":";if(Y(w))for(var fe=0;fe<w.length;fe++)lt=w[fe],St=Ke+K(lt,fe),Lt+=T(lt,j,nt,St,yt);else if(fe=x(w),typeof fe=="function")for(w=fe.call(w),fe=0;!(lt=w.next()).done;)lt=lt.value,St=Ke+K(lt,fe++),Lt+=T(lt,j,nt,St,yt);else if(St==="object"){if(typeof w.then=="function")return T(X(w),j,nt,lt,yt);throw j=String(w),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.")}return Lt}function b(w,j,nt){if(w==null)return w;var lt=[],yt=0;return T(w,lt,"","",function(St){return j.call(nt,St,yt++)}),lt}function tt(w){if(w._status===-1){var j=w._result;j=j(),j.then(function(nt){(w._status===0||w._status===-1)&&(w._status=1,w._result=nt)},function(nt){(w._status===0||w._status===-1)&&(w._status=2,w._result=nt)}),w._status===-1&&(w._status=0,w._result=j)}if(w._status===1)return w._result.default;throw w._result}var st=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var j=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(j))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)},at={map:b,forEach:function(w,j,nt){b(w,function(){j.apply(this,arguments)},nt)},count:function(w){var j=0;return b(w,function(){j++}),j},toArray:function(w){return b(w,function(j){return j})||[]},only:function(w){if(!At(w))throw Error("React.Children.only expected to receive a single React element child.");return w}};return bt.Activity=A,bt.Children=at,bt.Component=D,bt.Fragment=e,bt.Profiler=r,bt.PureComponent=P,bt.StrictMode=s,bt.Suspense=f,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,bt.__COMPILER_RUNTIME={__proto__:null,c:function(w){return k.H.useMemoCache(w)}},bt.cache=function(w){return function(){return w.apply(null,arguments)}},bt.cacheSignal=function(){return null},bt.cloneElement=function(w,j,nt){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var lt=C({},w.props),yt=w.key;if(j!=null)for(St in j.key!==void 0&&(yt=""+j.key),j)!rt.call(j,St)||St==="key"||St==="__self"||St==="__source"||St==="ref"&&j.ref===void 0||(lt[St]=j[St]);var St=arguments.length-2;if(St===1)lt.children=nt;else if(1<St){for(var Lt=Array(St),Ke=0;Ke<St;Ke++)Lt[Ke]=arguments[Ke+2];lt.children=Lt}return gt(w.type,yt,lt)},bt.createContext=function(w){return w={$$typeof:h,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:l,_context:w},w},bt.createElement=function(w,j,nt){var lt,yt={},St=null;if(j!=null)for(lt in j.key!==void 0&&(St=""+j.key),j)rt.call(j,lt)&&lt!=="key"&&lt!=="__self"&&lt!=="__source"&&(yt[lt]=j[lt]);var Lt=arguments.length-2;if(Lt===1)yt.children=nt;else if(1<Lt){for(var Ke=Array(Lt),fe=0;fe<Lt;fe++)Ke[fe]=arguments[fe+2];yt.children=Ke}if(w&&w.defaultProps)for(lt in Lt=w.defaultProps,Lt)yt[lt]===void 0&&(yt[lt]=Lt[lt]);return gt(w,St,yt)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(w){return{$$typeof:u,render:w}},bt.isValidElement=At,bt.lazy=function(w){return{$$typeof:m,_payload:{_status:-1,_result:w},_init:tt}},bt.memo=function(w,j){return{$$typeof:g,type:w,compare:j===void 0?null:j}},bt.startTransition=function(w){var j=k.T,nt={};k.T=nt;try{var lt=w(),yt=k.S;yt!==null&&yt(nt,lt),typeof lt=="object"&&lt!==null&&typeof lt.then=="function"&&lt.then(et,st)}catch(St){st(St)}finally{j!==null&&nt.types!==null&&(j.types=nt.types),k.T=j}},bt.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},bt.use=function(w){return k.H.use(w)},bt.useActionState=function(w,j,nt){return k.H.useActionState(w,j,nt)},bt.useCallback=function(w,j){return k.H.useCallback(w,j)},bt.useContext=function(w){return k.H.useContext(w)},bt.useDebugValue=function(){},bt.useDeferredValue=function(w,j){return k.H.useDeferredValue(w,j)},bt.useEffect=function(w,j){return k.H.useEffect(w,j)},bt.useEffectEvent=function(w){return k.H.useEffectEvent(w)},bt.useId=function(){return k.H.useId()},bt.useImperativeHandle=function(w,j,nt){return k.H.useImperativeHandle(w,j,nt)},bt.useInsertionEffect=function(w,j){return k.H.useInsertionEffect(w,j)},bt.useLayoutEffect=function(w,j){return k.H.useLayoutEffect(w,j)},bt.useMemo=function(w,j){return k.H.useMemo(w,j)},bt.useOptimistic=function(w,j){return k.H.useOptimistic(w,j)},bt.useReducer=function(w,j,nt){return k.H.useReducer(w,j,nt)},bt.useRef=function(w){return k.H.useRef(w)},bt.useState=function(w){return k.H.useState(w)},bt.useSyncExternalStore=function(w,j,nt){return k.H.useSyncExternalStore(w,j,nt)},bt.useTransition=function(){return k.H.useTransition()},bt.version="19.2.3",bt}var N_;function of(){return N_||(N_=1,sd.exports=wb()),sd.exports}var Bs=of();const Cb=af(Bs);var nd={exports:{}},to={},rd={exports:{}},ad={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H_;function Sb(){return H_||(H_=1,(function(o){function t(T,b){var tt=T.length;T.push(b);t:for(;0<tt;){var st=tt-1>>>1,at=T[st];if(0<r(at,b))T[st]=b,T[tt]=at,tt=st;else break t}}function e(T){return T.length===0?null:T[0]}function s(T){if(T.length===0)return null;var b=T[0],tt=T.pop();if(tt!==b){T[0]=tt;t:for(var st=0,at=T.length,w=at>>>1;st<w;){var j=2*(st+1)-1,nt=T[j],lt=j+1,yt=T[lt];if(0>r(nt,tt))lt<at&&0>r(yt,nt)?(T[st]=yt,T[lt]=tt,st=lt):(T[st]=nt,T[j]=tt,st=j);else if(lt<at&&0>r(yt,tt))T[st]=yt,T[lt]=tt,st=lt;else break t}}return b}function r(T,b){var tt=T.sortIndex-b.sortIndex;return tt!==0?tt:T.id-b.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;o.unstable_now=function(){return l.now()}}else{var h=Date,u=h.now();o.unstable_now=function(){return h.now()-u}}var f=[],g=[],m=1,A=null,y=3,x=!1,E=!1,C=!1,L=!1,D=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;function F(T){for(var b=e(g);b!==null;){if(b.callback===null)s(g);else if(b.startTime<=T)s(g),b.sortIndex=b.expirationTime,t(f,b);else break;b=e(g)}}function Y(T){if(C=!1,F(T),!E)if(e(f)!==null)E=!0,et||(et=!0,xt());else{var b=e(g);b!==null&&X(Y,b.startTime-T)}}var et=!1,k=-1,rt=5,gt=-1;function _t(){return L?!0:!(o.unstable_now()-gt<rt)}function At(){if(L=!1,et){var T=o.unstable_now();gt=T;var b=!0;try{t:{E=!1,C&&(C=!1,R(k),k=-1),x=!0;var tt=y;try{e:{for(F(T),A=e(f);A!==null&&!(A.expirationTime>T&&_t());){var st=A.callback;if(typeof st=="function"){A.callback=null,y=A.priorityLevel;var at=st(A.expirationTime<=T);if(T=o.unstable_now(),typeof at=="function"){A.callback=at,F(T),b=!0;break e}A===e(f)&&s(f),F(T)}else s(f);A=e(f)}if(A!==null)b=!0;else{var w=e(g);w!==null&&X(Y,w.startTime-T),b=!1}}break t}finally{A=null,y=tt,x=!1}b=void 0}}finally{b?xt():et=!1}}}var xt;if(typeof P=="function")xt=function(){P(At)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,K=O.port2;O.port1.onmessage=At,xt=function(){K.postMessage(null)}}else xt=function(){D(At,0)};function X(T,b){k=D(function(){T(o.unstable_now())},b)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(T){T.callback=null},o.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):rt=0<T?Math.floor(1e3/T):5},o.unstable_getCurrentPriorityLevel=function(){return y},o.unstable_next=function(T){switch(y){case 1:case 2:case 3:var b=3;break;default:b=y}var tt=y;y=b;try{return T()}finally{y=tt}},o.unstable_requestPaint=function(){L=!0},o.unstable_runWithPriority=function(T,b){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var tt=y;y=T;try{return b()}finally{y=tt}},o.unstable_scheduleCallback=function(T,b,tt){var st=o.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?st+tt:st):tt=st,T){case 1:var at=-1;break;case 2:at=250;break;case 5:at=1073741823;break;case 4:at=1e4;break;default:at=5e3}return at=tt+at,T={id:m++,callback:b,priorityLevel:T,startTime:tt,expirationTime:at,sortIndex:-1},tt>st?(T.sortIndex=tt,t(g,T),e(f)===null&&T===e(g)&&(C?(R(k),k=-1):C=!0,X(Y,tt-st))):(T.sortIndex=at,t(f,T),E||x||(E=!0,et||(et=!0,xt()))),T},o.unstable_shouldYield=_t,o.unstable_wrapCallback=function(T){var b=y;return function(){var tt=y;y=b;try{return T.apply(this,arguments)}finally{y=tt}}}})(ad)),ad}var G_;function Tb(){return G_||(G_=1,rd.exports=Sb()),rd.exports}var od={exports:{}},Ve={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q_;function Eb(){if(Q_)return Ve;Q_=1;var o=of();function t(f){var g="https://react.dev/errors/"+f;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)g+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(f,g,m){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:A==null?null:""+A,children:f,containerInfo:g,implementation:m}}var h=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,g){if(f==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return Ve.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ve.createPortal=function(f,g){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(t(299));return l(f,g,null,m)},Ve.flushSync=function(f){var g=h.T,m=s.p;try{if(h.T=null,s.p=2,f)return f()}finally{h.T=g,s.p=m,s.d.f()}},Ve.preconnect=function(f,g){typeof f=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,s.d.C(f,g))},Ve.prefetchDNS=function(f){typeof f=="string"&&s.d.D(f)},Ve.preinit=function(f,g){if(typeof f=="string"&&g&&typeof g.as=="string"){var m=g.as,A=u(m,g.crossOrigin),y=typeof g.integrity=="string"?g.integrity:void 0,x=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;m==="style"?s.d.S(f,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:A,integrity:y,fetchPriority:x}):m==="script"&&s.d.X(f,{crossOrigin:A,integrity:y,fetchPriority:x,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},Ve.preinitModule=function(f,g){if(typeof f=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var m=u(g.as,g.crossOrigin);s.d.M(f,{crossOrigin:m,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&s.d.M(f)},Ve.preload=function(f,g){if(typeof f=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var m=g.as,A=u(m,g.crossOrigin);s.d.L(f,m,{crossOrigin:A,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},Ve.preloadModule=function(f,g){if(typeof f=="string")if(g){var m=u(g.as,g.crossOrigin);s.d.m(f,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:m,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else s.d.m(f)},Ve.requestFormReset=function(f){s.d.r(f)},Ve.unstable_batchedUpdates=function(f,g){return f(g)},Ve.useFormState=function(f,g,m){return h.H.useFormState(f,g,m)},Ve.useFormStatus=function(){return h.H.useHostTransitionStatus()},Ve.version="19.2.3",Ve}var j_;function Db(){if(j_)return od.exports;j_=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),od.exports=Eb(),od.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V_;function Rb(){if(V_)return to;V_=1;var o=Tb(),t=of(),e=Db();function s(i){var n="https://react.dev/errors/"+i;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+i+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function l(i){var n=i,a=i;if(i.alternate)for(;n.return;)n=n.return;else{i=n;do n=i,(n.flags&4098)!==0&&(a=n.return),i=n.return;while(i)}return n.tag===3?a:null}function h(i){if(i.tag===13){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function u(i){if(i.tag===31){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function f(i){if(l(i)!==i)throw Error(s(188))}function g(i){var n=i.alternate;if(!n){if(n=l(i),n===null)throw Error(s(188));return n!==i?null:i}for(var a=i,c=n;;){var d=a.return;if(d===null)break;var p=d.alternate;if(p===null){if(c=d.return,c!==null){a=c;continue}break}if(d.child===p.child){for(p=d.child;p;){if(p===a)return f(d),i;if(p===c)return f(d),n;p=p.sibling}throw Error(s(188))}if(a.return!==c.return)a=d,c=p;else{for(var _=!1,v=d.child;v;){if(v===a){_=!0,a=d,c=p;break}if(v===c){_=!0,c=d,a=p;break}v=v.sibling}if(!_){for(v=p.child;v;){if(v===a){_=!0,a=p,c=d;break}if(v===c){_=!0,c=p,a=d;break}v=v.sibling}if(!_)throw Error(s(189))}}if(a.alternate!==c)throw Error(s(190))}if(a.tag!==3)throw Error(s(188));return a.stateNode.current===a?i:n}function m(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i;for(i=i.child;i!==null;){if(n=m(i),n!==null)return n;i=i.sibling}return null}var A=Object.assign,y=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),P=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),et=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),gt=Symbol.for("react.activity"),_t=Symbol.for("react.memo_cache_sentinel"),At=Symbol.iterator;function xt(i){return i===null||typeof i!="object"?null:(i=At&&i[At]||i["@@iterator"],typeof i=="function"?i:null)}var O=Symbol.for("react.client.reference");function K(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===O?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case C:return"Fragment";case D:return"Profiler";case L:return"StrictMode";case Y:return"Suspense";case et:return"SuspenseList";case gt:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case E:return"Portal";case P:return i.displayName||"Context";case R:return(i._context.displayName||"Context")+".Consumer";case F:var n=i.render;return i=i.displayName,i||(i=n.displayName||n.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case k:return n=i.displayName||null,n!==null?n:K(i.type)||"Memo";case rt:n=i._payload,i=i._init;try{return K(i(n))}catch{}}return null}var X=Array.isArray,T=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,b=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,tt={pending:!1,data:null,method:null,action:null},st=[],at=-1;function w(i){return{current:i}}function j(i){0>at||(i.current=st[at],st[at]=null,at--)}function nt(i,n){at++,st[at]=i.current,i.current=n}var lt=w(null),yt=w(null),St=w(null),Lt=w(null);function Ke(i,n){switch(nt(St,n),nt(yt,i),nt(lt,null),n.nodeType){case 9:case 11:i=(i=n.documentElement)&&(i=i.namespaceURI)?a_(i):0;break;default:if(i=n.tagName,n=n.namespaceURI)n=a_(n),i=o_(n,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}j(lt),nt(lt,i)}function fe(){j(lt),j(yt),j(St)}function ra(i){i.memoizedState!==null&&nt(Lt,i);var n=lt.current,a=o_(n,i.type);n!==a&&(nt(yt,i),nt(lt,a))}function Po(i){yt.current===i&&(j(lt),j(yt)),Lt.current===i&&(j(Lt),Xa._currentValue=tt)}var Lc,Of;function Tn(i){if(Lc===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);Lc=n&&n[1]||"",Of=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Lc+i+Of}var Fc=!1;function Nc(i,n){if(!i||Fc)return"";Fc=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(V){var Q=V}Reflect.construct(i,[],J)}else{try{J.call()}catch(V){Q=V}i.call(J.prototype)}}else{try{throw Error()}catch(V){Q=V}(J=i())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(V){if(V&&Q&&typeof V.stack=="string")return[V.stack,Q.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=c.DetermineComponentFrameRoot(),_=p[0],v=p[1];if(_&&v){var S=_.split(`
`),H=v.split(`
`);for(d=c=0;c<S.length&&!S[c].includes("DetermineComponentFrameRoot");)c++;for(;d<H.length&&!H[d].includes("DetermineComponentFrameRoot");)d++;if(c===S.length||d===H.length)for(c=S.length-1,d=H.length-1;1<=c&&0<=d&&S[c]!==H[d];)d--;for(;1<=c&&0<=d;c--,d--)if(S[c]!==H[d]){if(c!==1||d!==1)do if(c--,d--,0>d||S[c]!==H[d]){var q=`
`+S[c].replace(" at new "," at ");return i.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",i.displayName)),q}while(1<=c&&0<=d);break}}}finally{Fc=!1,Error.prepareStackTrace=a}return(a=i?i.displayName||i.name:"")?Tn(a):""}function Wy(i,n){switch(i.tag){case 26:case 27:case 5:return Tn(i.type);case 16:return Tn("Lazy");case 13:return i.child!==n&&n!==null?Tn("Suspense Fallback"):Tn("Suspense");case 19:return Tn("SuspenseList");case 0:case 15:return Nc(i.type,!1);case 11:return Nc(i.type.render,!1);case 1:return Nc(i.type,!0);case 31:return Tn("Activity");default:return""}}function Uf(i){try{var n="",a=null;do n+=Wy(i,a),a=i,i=i.return;while(i);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Hc=Object.prototype.hasOwnProperty,Gc=o.unstable_scheduleCallback,Qc=o.unstable_cancelCallback,Jy=o.unstable_shouldYield,Ky=o.unstable_requestPaint,Ai=o.unstable_now,$y=o.unstable_getCurrentPriorityLevel,Lf=o.unstable_ImmediatePriority,Ff=o.unstable_UserBlockingPriority,Bo=o.unstable_NormalPriority,tv=o.unstable_LowPriority,Nf=o.unstable_IdlePriority,ev=o.log,iv=o.unstable_setDisableYieldValue,aa=null,yi=null;function js(i){if(typeof ev=="function"&&iv(i),yi&&typeof yi.setStrictMode=="function")try{yi.setStrictMode(aa,i)}catch{}}var vi=Math.clz32?Math.clz32:rv,sv=Math.log,nv=Math.LN2;function rv(i){return i>>>=0,i===0?32:31-(sv(i)/nv|0)|0}var Io=256,ko=262144,zo=4194304;function En(i){var n=i&42;if(n!==0)return n;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Oo(i,n,a){var c=i.pendingLanes;if(c===0)return 0;var d=0,p=i.suspendedLanes,_=i.pingedLanes;i=i.warmLanes;var v=c&134217727;return v!==0?(c=v&~p,c!==0?d=En(c):(_&=v,_!==0?d=En(_):a||(a=v&~i,a!==0&&(d=En(a))))):(v=c&~p,v!==0?d=En(v):_!==0?d=En(_):a||(a=c&~i,a!==0&&(d=En(a)))),d===0?0:n!==0&&n!==d&&(n&p)===0&&(p=d&-d,a=n&-n,p>=a||p===32&&(a&4194048)!==0)?n:d}function oa(i,n){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&n)===0}function av(i,n){switch(i){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hf(){var i=zo;return zo<<=1,(zo&62914560)===0&&(zo=4194304),i}function jc(i){for(var n=[],a=0;31>a;a++)n.push(i);return n}function la(i,n){i.pendingLanes|=n,n!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function ov(i,n,a,c,d,p){var _=i.pendingLanes;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=a,i.entangledLanes&=a,i.errorRecoveryDisabledLanes&=a,i.shellSuspendCounter=0;var v=i.entanglements,S=i.expirationTimes,H=i.hiddenUpdates;for(a=_&~a;0<a;){var q=31-vi(a),J=1<<q;v[q]=0,S[q]=-1;var Q=H[q];if(Q!==null)for(H[q]=null,q=0;q<Q.length;q++){var V=Q[q];V!==null&&(V.lane&=-536870913)}a&=~J}c!==0&&Gf(i,c,0),p!==0&&d===0&&i.tag!==0&&(i.suspendedLanes|=p&~(_&~n))}function Gf(i,n,a){i.pendingLanes|=n,i.suspendedLanes&=~n;var c=31-vi(n);i.entangledLanes|=n,i.entanglements[c]=i.entanglements[c]|1073741824|a&261930}function Qf(i,n){var a=i.entangledLanes|=n;for(i=i.entanglements;a;){var c=31-vi(a),d=1<<c;d&n|i[c]&n&&(i[c]|=n),a&=~d}}function jf(i,n){var a=n&-n;return a=(a&42)!==0?1:Vc(a),(a&(i.suspendedLanes|n))!==0?0:a}function Vc(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Yc(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Vf(){var i=b.p;return i!==0?i:(i=window.event,i===void 0?32:M_(i.type))}function Yf(i,n){var a=b.p;try{return b.p=i,n()}finally{b.p=a}}var Vs=Math.random().toString(36).slice(2),ze="__reactFiber$"+Vs,ri="__reactProps$"+Vs,rr="__reactContainer$"+Vs,qc="__reactEvents$"+Vs,lv="__reactListeners$"+Vs,cv="__reactHandles$"+Vs,qf="__reactResources$"+Vs,ca="__reactMarker$"+Vs;function Xc(i){delete i[ze],delete i[ri],delete i[qc],delete i[lv],delete i[cv]}function ar(i){var n=i[ze];if(n)return n;for(var a=i.parentNode;a;){if(n=a[rr]||a[ze]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(i=p_(i);i!==null;){if(a=i[ze])return a;i=p_(i)}return n}i=a,a=i.parentNode}return null}function or(i){if(i=i[ze]||i[rr]){var n=i.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return i}return null}function ha(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i.stateNode;throw Error(s(33))}function lr(i){var n=i[qf];return n||(n=i[qf]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Me(i){i[ca]=!0}var Xf=new Set,Zf={};function Dn(i,n){cr(i,n),cr(i+"Capture",n)}function cr(i,n){for(Zf[i]=n,i=0;i<n.length;i++)Xf.add(n[i])}var hv=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wf={},Jf={};function uv(i){return Hc.call(Jf,i)?!0:Hc.call(Wf,i)?!1:hv.test(i)?Jf[i]=!0:(Wf[i]=!0,!1)}function Uo(i,n,a){if(uv(n))if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":i.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){i.removeAttribute(n);return}}i.setAttribute(n,""+a)}}function Lo(i,n,a){if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(n);return}i.setAttribute(n,""+a)}}function ps(i,n,a,c){if(c===null)i.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttributeNS(n,a,""+c)}}function Ii(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Kf(i){var n=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function dv(i,n,a){var c=Object.getOwnPropertyDescriptor(i.constructor.prototype,n);if(!i.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var d=c.get,p=c.set;return Object.defineProperty(i,n,{configurable:!0,get:function(){return d.call(this)},set:function(_){a=""+_,p.call(this,_)}}),Object.defineProperty(i,n,{enumerable:c.enumerable}),{getValue:function(){return a},setValue:function(_){a=""+_},stopTracking:function(){i._valueTracker=null,delete i[n]}}}}function Zc(i){if(!i._valueTracker){var n=Kf(i)?"checked":"value";i._valueTracker=dv(i,n,""+i[n])}}function $f(i){if(!i)return!1;var n=i._valueTracker;if(!n)return!0;var a=n.getValue(),c="";return i&&(c=Kf(i)?i.checked?"true":"false":i.value),i=c,i!==a?(n.setValue(i),!0):!1}function Fo(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var fv=/[\n"\\]/g;function ki(i){return i.replace(fv,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Wc(i,n,a,c,d,p,_,v){i.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?i.type=_:i.removeAttribute("type"),n!=null?_==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+Ii(n)):i.value!==""+Ii(n)&&(i.value=""+Ii(n)):_!=="submit"&&_!=="reset"||i.removeAttribute("value"),n!=null?Jc(i,_,Ii(n)):a!=null?Jc(i,_,Ii(a)):c!=null&&i.removeAttribute("value"),d==null&&p!=null&&(i.defaultChecked=!!p),d!=null&&(i.checked=d&&typeof d!="function"&&typeof d!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?i.name=""+Ii(v):i.removeAttribute("name")}function tp(i,n,a,c,d,p,_,v){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(i.type=p),n!=null||a!=null){if(!(p!=="submit"&&p!=="reset"||n!=null)){Zc(i);return}a=a!=null?""+Ii(a):"",n=n!=null?""+Ii(n):a,v||n===i.value||(i.value=n),i.defaultValue=n}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,i.checked=v?i.checked:!!c,i.defaultChecked=!!c,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(i.name=_),Zc(i)}function Jc(i,n,a){n==="number"&&Fo(i.ownerDocument)===i||i.defaultValue===""+a||(i.defaultValue=""+a)}function hr(i,n,a,c){if(i=i.options,n){n={};for(var d=0;d<a.length;d++)n["$"+a[d]]=!0;for(a=0;a<i.length;a++)d=n.hasOwnProperty("$"+i[a].value),i[a].selected!==d&&(i[a].selected=d),d&&c&&(i[a].defaultSelected=!0)}else{for(a=""+Ii(a),n=null,d=0;d<i.length;d++){if(i[d].value===a){i[d].selected=!0,c&&(i[d].defaultSelected=!0);return}n!==null||i[d].disabled||(n=i[d])}n!==null&&(n.selected=!0)}}function ep(i,n,a){if(n!=null&&(n=""+Ii(n),n!==i.value&&(i.value=n),a==null)){i.defaultValue!==n&&(i.defaultValue=n);return}i.defaultValue=a!=null?""+Ii(a):""}function ip(i,n,a,c){if(n==null){if(c!=null){if(a!=null)throw Error(s(92));if(X(c)){if(1<c.length)throw Error(s(93));c=c[0]}a=c}a==null&&(a=""),n=a}a=Ii(n),i.defaultValue=a,c=i.textContent,c===a&&c!==""&&c!==null&&(i.value=c),Zc(i)}function ur(i,n){if(n){var a=i.firstChild;if(a&&a===i.lastChild&&a.nodeType===3){a.nodeValue=n;return}}i.textContent=n}var pv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function sp(i,n,a){var c=n.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?c?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="":c?i.setProperty(n,a):typeof a!="number"||a===0||pv.has(n)?n==="float"?i.cssFloat=a:i[n]=(""+a).trim():i[n]=a+"px"}function np(i,n,a){if(n!=null&&typeof n!="object")throw Error(s(62));if(i=i.style,a!=null){for(var c in a)!a.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?i.setProperty(c,""):c==="float"?i.cssFloat="":i[c]="");for(var d in n)c=n[d],n.hasOwnProperty(d)&&a[d]!==c&&sp(i,d,c)}else for(var p in n)n.hasOwnProperty(p)&&sp(i,p,n[p])}function Kc(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),mv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function No(i){return mv.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function gs(){}var $c=null;function th(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var dr=null,fr=null;function rp(i){var n=or(i);if(n&&(i=n.stateNode)){var a=i[ri]||null;t:switch(i=n.stateNode,n.type){case"input":if(Wc(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),n=a.name,a.type==="radio"&&n!=null){for(a=i;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ki(""+n)+'"][type="radio"]'),n=0;n<a.length;n++){var c=a[n];if(c!==i&&c.form===i.form){var d=c[ri]||null;if(!d)throw Error(s(90));Wc(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(n=0;n<a.length;n++)c=a[n],c.form===i.form&&$f(c)}break t;case"textarea":ep(i,a.value,a.defaultValue);break t;case"select":n=a.value,n!=null&&hr(i,!!a.multiple,n,!1)}}}var eh=!1;function ap(i,n,a){if(eh)return i(n,a);eh=!0;try{var c=i(n);return c}finally{if(eh=!1,(dr!==null||fr!==null)&&(El(),dr&&(n=dr,i=fr,fr=dr=null,rp(n),i)))for(n=0;n<i.length;n++)rp(i[n])}}function ua(i,n){var a=i.stateNode;if(a===null)return null;var c=a[ri]||null;if(c===null)return null;a=c[n];t:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(i=i.type,c=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!c;break t;default:i=!1}if(i)return null;if(a&&typeof a!="function")throw Error(s(231,n,typeof a));return a}var ms=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ih=!1;if(ms)try{var da={};Object.defineProperty(da,"passive",{get:function(){ih=!0}}),window.addEventListener("test",da,da),window.removeEventListener("test",da,da)}catch{ih=!1}var Ys=null,sh=null,Ho=null;function op(){if(Ho)return Ho;var i,n=sh,a=n.length,c,d="value"in Ys?Ys.value:Ys.textContent,p=d.length;for(i=0;i<a&&n[i]===d[i];i++);var _=a-i;for(c=1;c<=_&&n[a-c]===d[p-c];c++);return Ho=d.slice(i,1<c?1-c:void 0)}function Go(i){var n=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&n===13&&(i=13)):i=n,i===10&&(i=13),32<=i||i===13?i:0}function Qo(){return!0}function lp(){return!1}function ai(i){function n(a,c,d,p,_){this._reactName=a,this._targetInst=d,this.type=c,this.nativeEvent=p,this.target=_,this.currentTarget=null;for(var v in i)i.hasOwnProperty(v)&&(a=i[v],this[v]=a?a(p):p[v]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Qo:lp,this.isPropagationStopped=lp,this}return A(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Qo)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Qo)},persist:function(){},isPersistent:Qo}),n}var Rn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jo=ai(Rn),fa=A({},Rn,{view:0,detail:0}),_v=ai(fa),nh,rh,pa,Vo=A({},fa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:oh,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==pa&&(pa&&i.type==="mousemove"?(nh=i.screenX-pa.screenX,rh=i.screenY-pa.screenY):rh=nh=0,pa=i),nh)},movementY:function(i){return"movementY"in i?i.movementY:rh}}),cp=ai(Vo),Av=A({},Vo,{dataTransfer:0}),yv=ai(Av),vv=A({},fa,{relatedTarget:0}),ah=ai(vv),xv=A({},Rn,{animationName:0,elapsedTime:0,pseudoElement:0}),bv=ai(xv),wv=A({},Rn,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Cv=ai(wv),Sv=A({},Rn,{data:0}),hp=ai(Sv),Tv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ev={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rv(i){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(i):(i=Dv[i])?!!n[i]:!1}function oh(){return Rv}var Mv=A({},fa,{key:function(i){if(i.key){var n=Tv[i.key]||i.key;if(n!=="Unidentified")return n}return i.type==="keypress"?(i=Go(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Ev[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:oh,charCode:function(i){return i.type==="keypress"?Go(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Go(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Pv=ai(Mv),Bv=A({},Vo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),up=ai(Bv),Iv=A({},fa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:oh}),kv=ai(Iv),zv=A({},Rn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ov=ai(zv),Uv=A({},Vo,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Lv=ai(Uv),Fv=A({},Rn,{newState:0,oldState:0}),Nv=ai(Fv),Hv=[9,13,27,32],lh=ms&&"CompositionEvent"in window,ga=null;ms&&"documentMode"in document&&(ga=document.documentMode);var Gv=ms&&"TextEvent"in window&&!ga,dp=ms&&(!lh||ga&&8<ga&&11>=ga),fp=" ",pp=!1;function gp(i,n){switch(i){case"keyup":return Hv.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mp(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var pr=!1;function Qv(i,n){switch(i){case"compositionend":return mp(n);case"keypress":return n.which!==32?null:(pp=!0,fp);case"textInput":return i=n.data,i===fp&&pp?null:i;default:return null}}function jv(i,n){if(pr)return i==="compositionend"||!lh&&gp(i,n)?(i=op(),Ho=sh=Ys=null,pr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return dp&&n.locale!=="ko"?null:n.data;default:return null}}var Vv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _p(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n==="input"?!!Vv[i.type]:n==="textarea"}function Ap(i,n,a,c){dr?fr?fr.push(c):fr=[c]:dr=c,n=kl(n,"onChange"),0<n.length&&(a=new jo("onChange","change",null,a,c),i.push({event:a,listeners:n}))}var ma=null,_a=null;function Yv(i){t_(i,0)}function Yo(i){var n=ha(i);if($f(n))return i}function yp(i,n){if(i==="change")return n}var vp=!1;if(ms){var ch;if(ms){var hh="oninput"in document;if(!hh){var xp=document.createElement("div");xp.setAttribute("oninput","return;"),hh=typeof xp.oninput=="function"}ch=hh}else ch=!1;vp=ch&&(!document.documentMode||9<document.documentMode)}function bp(){ma&&(ma.detachEvent("onpropertychange",wp),_a=ma=null)}function wp(i){if(i.propertyName==="value"&&Yo(_a)){var n=[];Ap(n,_a,i,th(i)),ap(Yv,n)}}function qv(i,n,a){i==="focusin"?(bp(),ma=n,_a=a,ma.attachEvent("onpropertychange",wp)):i==="focusout"&&bp()}function Xv(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Yo(_a)}function Zv(i,n){if(i==="click")return Yo(n)}function Wv(i,n){if(i==="input"||i==="change")return Yo(n)}function Jv(i,n){return i===n&&(i!==0||1/i===1/n)||i!==i&&n!==n}var xi=typeof Object.is=="function"?Object.is:Jv;function Aa(i,n){if(xi(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;var a=Object.keys(i),c=Object.keys(n);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var d=a[c];if(!Hc.call(n,d)||!xi(i[d],n[d]))return!1}return!0}function Cp(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Sp(i,n){var a=Cp(i);i=0;for(var c;a;){if(a.nodeType===3){if(c=i+a.textContent.length,i<=n&&c>=n)return{node:a,offset:n-i};i=c}t:{for(;a;){if(a.nextSibling){a=a.nextSibling;break t}a=a.parentNode}a=void 0}a=Cp(a)}}function Tp(i,n){return i&&n?i===n?!0:i&&i.nodeType===3?!1:n&&n.nodeType===3?Tp(i,n.parentNode):"contains"in i?i.contains(n):i.compareDocumentPosition?!!(i.compareDocumentPosition(n)&16):!1:!1}function Ep(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var n=Fo(i.document);n instanceof i.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)i=n.contentWindow;else break;n=Fo(i.document)}return n}function uh(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n&&(n==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||n==="textarea"||i.contentEditable==="true")}var Kv=ms&&"documentMode"in document&&11>=document.documentMode,gr=null,dh=null,ya=null,fh=!1;function Dp(i,n,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;fh||gr==null||gr!==Fo(c)||(c=gr,"selectionStart"in c&&uh(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),ya&&Aa(ya,c)||(ya=c,c=kl(dh,"onSelect"),0<c.length&&(n=new jo("onSelect","select",null,n,a),i.push({event:n,listeners:c}),n.target=gr)))}function Mn(i,n){var a={};return a[i.toLowerCase()]=n.toLowerCase(),a["Webkit"+i]="webkit"+n,a["Moz"+i]="moz"+n,a}var mr={animationend:Mn("Animation","AnimationEnd"),animationiteration:Mn("Animation","AnimationIteration"),animationstart:Mn("Animation","AnimationStart"),transitionrun:Mn("Transition","TransitionRun"),transitionstart:Mn("Transition","TransitionStart"),transitioncancel:Mn("Transition","TransitionCancel"),transitionend:Mn("Transition","TransitionEnd")},ph={},Rp={};ms&&(Rp=document.createElement("div").style,"AnimationEvent"in window||(delete mr.animationend.animation,delete mr.animationiteration.animation,delete mr.animationstart.animation),"TransitionEvent"in window||delete mr.transitionend.transition);function Pn(i){if(ph[i])return ph[i];if(!mr[i])return i;var n=mr[i],a;for(a in n)if(n.hasOwnProperty(a)&&a in Rp)return ph[i]=n[a];return i}var Mp=Pn("animationend"),Pp=Pn("animationiteration"),Bp=Pn("animationstart"),$v=Pn("transitionrun"),tx=Pn("transitionstart"),ex=Pn("transitioncancel"),Ip=Pn("transitionend"),kp=new Map,gh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gh.push("scrollEnd");function qi(i,n){kp.set(i,n),Dn(n,[i])}var qo=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},zi=[],_r=0,mh=0;function Xo(){for(var i=_r,n=mh=_r=0;n<i;){var a=zi[n];zi[n++]=null;var c=zi[n];zi[n++]=null;var d=zi[n];zi[n++]=null;var p=zi[n];if(zi[n++]=null,c!==null&&d!==null){var _=c.pending;_===null?d.next=d:(d.next=_.next,_.next=d),c.pending=d}p!==0&&zp(a,d,p)}}function Zo(i,n,a,c){zi[_r++]=i,zi[_r++]=n,zi[_r++]=a,zi[_r++]=c,mh|=c,i.lanes|=c,i=i.alternate,i!==null&&(i.lanes|=c)}function _h(i,n,a,c){return Zo(i,n,a,c),Wo(i)}function Bn(i,n){return Zo(i,null,null,n),Wo(i)}function zp(i,n,a){i.lanes|=a;var c=i.alternate;c!==null&&(c.lanes|=a);for(var d=!1,p=i.return;p!==null;)p.childLanes|=a,c=p.alternate,c!==null&&(c.childLanes|=a),p.tag===22&&(i=p.stateNode,i===null||i._visibility&1||(d=!0)),i=p,p=p.return;return i.tag===3?(p=i.stateNode,d&&n!==null&&(d=31-vi(a),i=p.hiddenUpdates,c=i[d],c===null?i[d]=[n]:c.push(n),n.lane=a|536870912),p):null}function Wo(i){if(50<Ha)throw Ha=0,Tu=null,Error(s(185));for(var n=i.return;n!==null;)i=n,n=i.return;return i.tag===3?i.stateNode:null}var Ar={};function ix(i,n,a,c){this.tag=i,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bi(i,n,a,c){return new ix(i,n,a,c)}function Ah(i){return i=i.prototype,!(!i||!i.isReactComponent)}function _s(i,n){var a=i.alternate;return a===null?(a=bi(i.tag,n,i.key,i.mode),a.elementType=i.elementType,a.type=i.type,a.stateNode=i.stateNode,a.alternate=i,i.alternate=a):(a.pendingProps=n,a.type=i.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=i.flags&65011712,a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,n=i.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=i.sibling,a.index=i.index,a.ref=i.ref,a.refCleanup=i.refCleanup,a}function Op(i,n){i.flags&=65011714;var a=i.alternate;return a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),i}function Jo(i,n,a,c,d,p){var _=0;if(c=i,typeof i=="function")Ah(i)&&(_=1);else if(typeof i=="string")_=ob(i,a,lt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case gt:return i=bi(31,a,n,d),i.elementType=gt,i.lanes=p,i;case C:return In(a.children,d,p,n);case L:_=8,d|=24;break;case D:return i=bi(12,a,n,d|2),i.elementType=D,i.lanes=p,i;case Y:return i=bi(13,a,n,d),i.elementType=Y,i.lanes=p,i;case et:return i=bi(19,a,n,d),i.elementType=et,i.lanes=p,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case P:_=10;break t;case R:_=9;break t;case F:_=11;break t;case k:_=14;break t;case rt:_=16,c=null;break t}_=29,a=Error(s(130,i===null?"null":typeof i,"")),c=null}return n=bi(_,a,n,d),n.elementType=i,n.type=c,n.lanes=p,n}function In(i,n,a,c){return i=bi(7,i,c,n),i.lanes=a,i}function yh(i,n,a){return i=bi(6,i,null,n),i.lanes=a,i}function Up(i){var n=bi(18,null,null,0);return n.stateNode=i,n}function vh(i,n,a){return n=bi(4,i.children!==null?i.children:[],i.key,n),n.lanes=a,n.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},n}var Lp=new WeakMap;function Oi(i,n){if(typeof i=="object"&&i!==null){var a=Lp.get(i);return a!==void 0?a:(n={value:i,source:n,stack:Uf(n)},Lp.set(i,n),n)}return{value:i,source:n,stack:Uf(n)}}var yr=[],vr=0,Ko=null,va=0,Ui=[],Li=0,qs=null,es=1,is="";function As(i,n){yr[vr++]=va,yr[vr++]=Ko,Ko=i,va=n}function Fp(i,n,a){Ui[Li++]=es,Ui[Li++]=is,Ui[Li++]=qs,qs=i;var c=es;i=is;var d=32-vi(c)-1;c&=~(1<<d),a+=1;var p=32-vi(n)+d;if(30<p){var _=d-d%5;p=(c&(1<<_)-1).toString(32),c>>=_,d-=_,es=1<<32-vi(n)+d|a<<d|c,is=p+i}else es=1<<p|a<<d|c,is=i}function xh(i){i.return!==null&&(As(i,1),Fp(i,1,0))}function bh(i){for(;i===Ko;)Ko=yr[--vr],yr[vr]=null,va=yr[--vr],yr[vr]=null;for(;i===qs;)qs=Ui[--Li],Ui[Li]=null,is=Ui[--Li],Ui[Li]=null,es=Ui[--Li],Ui[Li]=null}function Np(i,n){Ui[Li++]=es,Ui[Li++]=is,Ui[Li++]=qs,es=n.id,is=n.overflow,qs=i}var Oe=null,ie=null,zt=!1,Xs=null,Fi=!1,wh=Error(s(519));function Zs(i){var n=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw xa(Oi(n,i)),wh}function Hp(i){var n=i.stateNode,a=i.type,c=i.memoizedProps;switch(n[ze]=i,n[ri]=c,a){case"dialog":Pt("cancel",n),Pt("close",n);break;case"iframe":case"object":case"embed":Pt("load",n);break;case"video":case"audio":for(a=0;a<Qa.length;a++)Pt(Qa[a],n);break;case"source":Pt("error",n);break;case"img":case"image":case"link":Pt("error",n),Pt("load",n);break;case"details":Pt("toggle",n);break;case"input":Pt("invalid",n),tp(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Pt("invalid",n);break;case"textarea":Pt("invalid",n),ip(n,c.value,c.defaultValue,c.children)}a=c.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||n.textContent===""+a||c.suppressHydrationWarning===!0||n_(n.textContent,a)?(c.popover!=null&&(Pt("beforetoggle",n),Pt("toggle",n)),c.onScroll!=null&&Pt("scroll",n),c.onScrollEnd!=null&&Pt("scrollend",n),c.onClick!=null&&(n.onclick=gs),n=!0):n=!1,n||Zs(i,!0)}function Gp(i){for(Oe=i.return;Oe;)switch(Oe.tag){case 5:case 31:case 13:Fi=!1;return;case 27:case 3:Fi=!0;return;default:Oe=Oe.return}}function xr(i){if(i!==Oe)return!1;if(!zt)return Gp(i),zt=!0,!1;var n=i.tag,a;if((a=n!==3&&n!==27)&&((a=n===5)&&(a=i.type,a=!(a!=="form"&&a!=="button")||Hu(i.type,i.memoizedProps)),a=!a),a&&ie&&Zs(i),Gp(i),n===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));ie=f_(i)}else if(n===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));ie=f_(i)}else n===27?(n=ie,hn(i.type)?(i=Yu,Yu=null,ie=i):ie=n):ie=Oe?Hi(i.stateNode.nextSibling):null;return!0}function kn(){ie=Oe=null,zt=!1}function Ch(){var i=Xs;return i!==null&&(hi===null?hi=i:hi.push.apply(hi,i),Xs=null),i}function xa(i){Xs===null?Xs=[i]:Xs.push(i)}var Sh=w(null),zn=null,ys=null;function Ws(i,n,a){nt(Sh,n._currentValue),n._currentValue=a}function vs(i){i._currentValue=Sh.current,j(Sh)}function Th(i,n,a){for(;i!==null;){var c=i.alternate;if((i.childLanes&n)!==n?(i.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),i===a)break;i=i.return}}function Eh(i,n,a,c){var d=i.child;for(d!==null&&(d.return=i);d!==null;){var p=d.dependencies;if(p!==null){var _=d.child;p=p.firstContext;t:for(;p!==null;){var v=p;p=d;for(var S=0;S<n.length;S++)if(v.context===n[S]){p.lanes|=a,v=p.alternate,v!==null&&(v.lanes|=a),Th(p.return,a,i),c||(_=null);break t}p=v.next}}else if(d.tag===18){if(_=d.return,_===null)throw Error(s(341));_.lanes|=a,p=_.alternate,p!==null&&(p.lanes|=a),Th(_,a,i),_=null}else _=d.child;if(_!==null)_.return=d;else for(_=d;_!==null;){if(_===i){_=null;break}if(d=_.sibling,d!==null){d.return=_.return,_=d;break}_=_.return}d=_}}function br(i,n,a,c){i=null;for(var d=n,p=!1;d!==null;){if(!p){if((d.flags&524288)!==0)p=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var _=d.alternate;if(_===null)throw Error(s(387));if(_=_.memoizedProps,_!==null){var v=d.type;xi(d.pendingProps.value,_.value)||(i!==null?i.push(v):i=[v])}}else if(d===Lt.current){if(_=d.alternate,_===null)throw Error(s(387));_.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(i!==null?i.push(Xa):i=[Xa])}d=d.return}i!==null&&Eh(n,i,a,c),n.flags|=262144}function $o(i){for(i=i.firstContext;i!==null;){if(!xi(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function On(i){zn=i,ys=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Ue(i){return Qp(zn,i)}function tl(i,n){return zn===null&&On(i),Qp(i,n)}function Qp(i,n){var a=n._currentValue;if(n={context:n,memoizedValue:a,next:null},ys===null){if(i===null)throw Error(s(308));ys=n,i.dependencies={lanes:0,firstContext:n},i.flags|=524288}else ys=ys.next=n;return a}var sx=typeof AbortController<"u"?AbortController:function(){var i=[],n=this.signal={aborted:!1,addEventListener:function(a,c){i.push(c)}};this.abort=function(){n.aborted=!0,i.forEach(function(a){return a()})}},nx=o.unstable_scheduleCallback,rx=o.unstable_NormalPriority,ve={$$typeof:P,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Dh(){return{controller:new sx,data:new Map,refCount:0}}function ba(i){i.refCount--,i.refCount===0&&nx(rx,function(){i.controller.abort()})}var wa=null,Rh=0,wr=0,Cr=null;function ax(i,n){if(wa===null){var a=wa=[];Rh=0,wr=Bu(),Cr={status:"pending",value:void 0,then:function(c){a.push(c)}}}return Rh++,n.then(jp,jp),n}function jp(){if(--Rh===0&&wa!==null){Cr!==null&&(Cr.status="fulfilled");var i=wa;wa=null,wr=0,Cr=null;for(var n=0;n<i.length;n++)(0,i[n])()}}function ox(i,n){var a=[],c={status:"pending",value:null,reason:null,then:function(d){a.push(d)}};return i.then(function(){c.status="fulfilled",c.value=n;for(var d=0;d<a.length;d++)(0,a[d])(n)},function(d){for(c.status="rejected",c.reason=d,d=0;d<a.length;d++)(0,a[d])(void 0)}),c}var Vp=T.S;T.S=function(i,n){Dm=Ai(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&ax(i,n),Vp!==null&&Vp(i,n)};var Un=w(null);function Mh(){var i=Un.current;return i!==null?i:Wt.pooledCache}function el(i,n){n===null?nt(Un,Un.current):nt(Un,n.pool)}function Yp(){var i=Mh();return i===null?null:{parent:ve._currentValue,pool:i}}var Sr=Error(s(460)),Ph=Error(s(474)),il=Error(s(542)),sl={then:function(){}};function qp(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Xp(i,n,a){switch(a=i[a],a===void 0?i.push(n):a!==n&&(n.then(gs,gs),n=a),n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Wp(i),i;default:if(typeof n.status=="string")n.then(gs,gs);else{if(i=Wt,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=n,i.status="pending",i.then(function(c){if(n.status==="pending"){var d=n;d.status="fulfilled",d.value=c}},function(c){if(n.status==="pending"){var d=n;d.status="rejected",d.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Wp(i),i}throw Fn=n,Sr}}function Ln(i){try{var n=i._init;return n(i._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Fn=a,Sr):a}}var Fn=null;function Zp(){if(Fn===null)throw Error(s(459));var i=Fn;return Fn=null,i}function Wp(i){if(i===Sr||i===il)throw Error(s(483))}var Tr=null,Ca=0;function nl(i){var n=Ca;return Ca+=1,Tr===null&&(Tr=[]),Xp(Tr,i,n)}function Sa(i,n){n=n.props.ref,i.ref=n!==void 0?n:null}function rl(i,n){throw n.$$typeof===y?Error(s(525)):(i=Object.prototype.toString.call(n),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)))}function Jp(i){function n(U,B){if(i){var N=U.deletions;N===null?(U.deletions=[B],U.flags|=16):N.push(B)}}function a(U,B){if(!i)return null;for(;B!==null;)n(U,B),B=B.sibling;return null}function c(U){for(var B=new Map;U!==null;)U.key!==null?B.set(U.key,U):B.set(U.index,U),U=U.sibling;return B}function d(U,B){return U=_s(U,B),U.index=0,U.sibling=null,U}function p(U,B,N){return U.index=N,i?(N=U.alternate,N!==null?(N=N.index,N<B?(U.flags|=67108866,B):N):(U.flags|=67108866,B)):(U.flags|=1048576,B)}function _(U){return i&&U.alternate===null&&(U.flags|=67108866),U}function v(U,B,N,Z){return B===null||B.tag!==6?(B=yh(N,U.mode,Z),B.return=U,B):(B=d(B,N),B.return=U,B)}function S(U,B,N,Z){var ft=N.type;return ft===C?q(U,B,N.props.children,Z,N.key):B!==null&&(B.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===rt&&Ln(ft)===B.type)?(B=d(B,N.props),Sa(B,N),B.return=U,B):(B=Jo(N.type,N.key,N.props,null,U.mode,Z),Sa(B,N),B.return=U,B)}function H(U,B,N,Z){return B===null||B.tag!==4||B.stateNode.containerInfo!==N.containerInfo||B.stateNode.implementation!==N.implementation?(B=vh(N,U.mode,Z),B.return=U,B):(B=d(B,N.children||[]),B.return=U,B)}function q(U,B,N,Z,ft){return B===null||B.tag!==7?(B=In(N,U.mode,Z,ft),B.return=U,B):(B=d(B,N),B.return=U,B)}function J(U,B,N){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=yh(""+B,U.mode,N),B.return=U,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case x:return N=Jo(B.type,B.key,B.props,null,U.mode,N),Sa(N,B),N.return=U,N;case E:return B=vh(B,U.mode,N),B.return=U,B;case rt:return B=Ln(B),J(U,B,N)}if(X(B)||xt(B))return B=In(B,U.mode,N,null),B.return=U,B;if(typeof B.then=="function")return J(U,nl(B),N);if(B.$$typeof===P)return J(U,tl(U,B),N);rl(U,B)}return null}function Q(U,B,N,Z){var ft=B!==null?B.key:null;if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return ft!==null?null:v(U,B,""+N,Z);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case x:return N.key===ft?S(U,B,N,Z):null;case E:return N.key===ft?H(U,B,N,Z):null;case rt:return N=Ln(N),Q(U,B,N,Z)}if(X(N)||xt(N))return ft!==null?null:q(U,B,N,Z,null);if(typeof N.then=="function")return Q(U,B,nl(N),Z);if(N.$$typeof===P)return Q(U,B,tl(U,N),Z);rl(U,N)}return null}function V(U,B,N,Z,ft){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return U=U.get(N)||null,v(B,U,""+Z,ft);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case x:return U=U.get(Z.key===null?N:Z.key)||null,S(B,U,Z,ft);case E:return U=U.get(Z.key===null?N:Z.key)||null,H(B,U,Z,ft);case rt:return Z=Ln(Z),V(U,B,N,Z,ft)}if(X(Z)||xt(Z))return U=U.get(N)||null,q(B,U,Z,ft,null);if(typeof Z.then=="function")return V(U,B,N,nl(Z),ft);if(Z.$$typeof===P)return V(U,B,N,tl(B,Z),ft);rl(B,Z)}return null}function ct(U,B,N,Z){for(var ft=null,Ft=null,dt=B,Ct=B=0,kt=null;dt!==null&&Ct<N.length;Ct++){dt.index>Ct?(kt=dt,dt=null):kt=dt.sibling;var Nt=Q(U,dt,N[Ct],Z);if(Nt===null){dt===null&&(dt=kt);break}i&&dt&&Nt.alternate===null&&n(U,dt),B=p(Nt,B,Ct),Ft===null?ft=Nt:Ft.sibling=Nt,Ft=Nt,dt=kt}if(Ct===N.length)return a(U,dt),zt&&As(U,Ct),ft;if(dt===null){for(;Ct<N.length;Ct++)dt=J(U,N[Ct],Z),dt!==null&&(B=p(dt,B,Ct),Ft===null?ft=dt:Ft.sibling=dt,Ft=dt);return zt&&As(U,Ct),ft}for(dt=c(dt);Ct<N.length;Ct++)kt=V(dt,U,Ct,N[Ct],Z),kt!==null&&(i&&kt.alternate!==null&&dt.delete(kt.key===null?Ct:kt.key),B=p(kt,B,Ct),Ft===null?ft=kt:Ft.sibling=kt,Ft=kt);return i&&dt.forEach(function(gn){return n(U,gn)}),zt&&As(U,Ct),ft}function pt(U,B,N,Z){if(N==null)throw Error(s(151));for(var ft=null,Ft=null,dt=B,Ct=B=0,kt=null,Nt=N.next();dt!==null&&!Nt.done;Ct++,Nt=N.next()){dt.index>Ct?(kt=dt,dt=null):kt=dt.sibling;var gn=Q(U,dt,Nt.value,Z);if(gn===null){dt===null&&(dt=kt);break}i&&dt&&gn.alternate===null&&n(U,dt),B=p(gn,B,Ct),Ft===null?ft=gn:Ft.sibling=gn,Ft=gn,dt=kt}if(Nt.done)return a(U,dt),zt&&As(U,Ct),ft;if(dt===null){for(;!Nt.done;Ct++,Nt=N.next())Nt=J(U,Nt.value,Z),Nt!==null&&(B=p(Nt,B,Ct),Ft===null?ft=Nt:Ft.sibling=Nt,Ft=Nt);return zt&&As(U,Ct),ft}for(dt=c(dt);!Nt.done;Ct++,Nt=N.next())Nt=V(dt,U,Ct,Nt.value,Z),Nt!==null&&(i&&Nt.alternate!==null&&dt.delete(Nt.key===null?Ct:Nt.key),B=p(Nt,B,Ct),Ft===null?ft=Nt:Ft.sibling=Nt,Ft=Nt);return i&&dt.forEach(function(Ab){return n(U,Ab)}),zt&&As(U,Ct),ft}function qt(U,B,N,Z){if(typeof N=="object"&&N!==null&&N.type===C&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case x:t:{for(var ft=N.key;B!==null;){if(B.key===ft){if(ft=N.type,ft===C){if(B.tag===7){a(U,B.sibling),Z=d(B,N.props.children),Z.return=U,U=Z;break t}}else if(B.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===rt&&Ln(ft)===B.type){a(U,B.sibling),Z=d(B,N.props),Sa(Z,N),Z.return=U,U=Z;break t}a(U,B);break}else n(U,B);B=B.sibling}N.type===C?(Z=In(N.props.children,U.mode,Z,N.key),Z.return=U,U=Z):(Z=Jo(N.type,N.key,N.props,null,U.mode,Z),Sa(Z,N),Z.return=U,U=Z)}return _(U);case E:t:{for(ft=N.key;B!==null;){if(B.key===ft)if(B.tag===4&&B.stateNode.containerInfo===N.containerInfo&&B.stateNode.implementation===N.implementation){a(U,B.sibling),Z=d(B,N.children||[]),Z.return=U,U=Z;break t}else{a(U,B);break}else n(U,B);B=B.sibling}Z=vh(N,U.mode,Z),Z.return=U,U=Z}return _(U);case rt:return N=Ln(N),qt(U,B,N,Z)}if(X(N))return ct(U,B,N,Z);if(xt(N)){if(ft=xt(N),typeof ft!="function")throw Error(s(150));return N=ft.call(N),pt(U,B,N,Z)}if(typeof N.then=="function")return qt(U,B,nl(N),Z);if(N.$$typeof===P)return qt(U,B,tl(U,N),Z);rl(U,N)}return typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint"?(N=""+N,B!==null&&B.tag===6?(a(U,B.sibling),Z=d(B,N),Z.return=U,U=Z):(a(U,B),Z=yh(N,U.mode,Z),Z.return=U,U=Z),_(U)):a(U,B)}return function(U,B,N,Z){try{Ca=0;var ft=qt(U,B,N,Z);return Tr=null,ft}catch(dt){if(dt===Sr||dt===il)throw dt;var Ft=bi(29,dt,null,U.mode);return Ft.lanes=Z,Ft.return=U,Ft}finally{}}}var Nn=Jp(!0),Kp=Jp(!1),Js=!1;function Bh(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ih(i,n){i=i.updateQueue,n.updateQueue===i&&(n.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ks(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function $s(i,n,a){var c=i.updateQueue;if(c===null)return null;if(c=c.shared,(Ht&2)!==0){var d=c.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),c.pending=n,n=Wo(i),zp(i,null,a),n}return Zo(i,c,n,a),Wo(i)}function Ta(i,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194048)!==0)){var c=n.lanes;c&=i.pendingLanes,a|=c,n.lanes=a,Qf(i,a)}}function kh(i,n){var a=i.updateQueue,c=i.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var d=null,p=null;if(a=a.firstBaseUpdate,a!==null){do{var _={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};p===null?d=p=_:p=p.next=_,a=a.next}while(a!==null);p===null?d=p=n:p=p.next=n}else d=p=n;a={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:p,shared:c.shared,callbacks:c.callbacks},i.updateQueue=a;return}i=a.lastBaseUpdate,i===null?a.firstBaseUpdate=n:i.next=n,a.lastBaseUpdate=n}var zh=!1;function Ea(){if(zh){var i=Cr;if(i!==null)throw i}}function Da(i,n,a,c){zh=!1;var d=i.updateQueue;Js=!1;var p=d.firstBaseUpdate,_=d.lastBaseUpdate,v=d.shared.pending;if(v!==null){d.shared.pending=null;var S=v,H=S.next;S.next=null,_===null?p=H:_.next=H,_=S;var q=i.alternate;q!==null&&(q=q.updateQueue,v=q.lastBaseUpdate,v!==_&&(v===null?q.firstBaseUpdate=H:v.next=H,q.lastBaseUpdate=S))}if(p!==null){var J=d.baseState;_=0,q=H=S=null,v=p;do{var Q=v.lane&-536870913,V=Q!==v.lane;if(V?(It&Q)===Q:(c&Q)===Q){Q!==0&&Q===wr&&(zh=!0),q!==null&&(q=q.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});t:{var ct=i,pt=v;Q=n;var qt=a;switch(pt.tag){case 1:if(ct=pt.payload,typeof ct=="function"){J=ct.call(qt,J,Q);break t}J=ct;break t;case 3:ct.flags=ct.flags&-65537|128;case 0:if(ct=pt.payload,Q=typeof ct=="function"?ct.call(qt,J,Q):ct,Q==null)break t;J=A({},J,Q);break t;case 2:Js=!0}}Q=v.callback,Q!==null&&(i.flags|=64,V&&(i.flags|=8192),V=d.callbacks,V===null?d.callbacks=[Q]:V.push(Q))}else V={lane:Q,tag:v.tag,payload:v.payload,callback:v.callback,next:null},q===null?(H=q=V,S=J):q=q.next=V,_|=Q;if(v=v.next,v===null){if(v=d.shared.pending,v===null)break;V=v,v=V.next,V.next=null,d.lastBaseUpdate=V,d.shared.pending=null}}while(!0);q===null&&(S=J),d.baseState=S,d.firstBaseUpdate=H,d.lastBaseUpdate=q,p===null&&(d.shared.lanes=0),rn|=_,i.lanes=_,i.memoizedState=J}}function $p(i,n){if(typeof i!="function")throw Error(s(191,i));i.call(n)}function tg(i,n){var a=i.callbacks;if(a!==null)for(i.callbacks=null,i=0;i<a.length;i++)$p(a[i],n)}var Er=w(null),al=w(0);function eg(i,n){i=Rs,nt(al,i),nt(Er,n),Rs=i|n.baseLanes}function Oh(){nt(al,Rs),nt(Er,Er.current)}function Uh(){Rs=al.current,j(Er),j(al)}var wi=w(null),Ni=null;function tn(i){var n=i.alternate;nt(pe,pe.current&1),nt(wi,i),Ni===null&&(n===null||Er.current!==null||n.memoizedState!==null)&&(Ni=i)}function Lh(i){nt(pe,pe.current),nt(wi,i),Ni===null&&(Ni=i)}function ig(i){i.tag===22?(nt(pe,pe.current),nt(wi,i),Ni===null&&(Ni=i)):en()}function en(){nt(pe,pe.current),nt(wi,wi.current)}function Ci(i){j(wi),Ni===i&&(Ni=null),j(pe)}var pe=w(0);function ol(i){for(var n=i;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||ju(a)||Vu(a)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var xs=0,wt=null,Vt=null,xe=null,ll=!1,Dr=!1,Hn=!1,cl=0,Ra=0,Rr=null,lx=0;function oe(){throw Error(s(321))}function Fh(i,n){if(n===null)return!1;for(var a=0;a<n.length&&a<i.length;a++)if(!xi(i[a],n[a]))return!1;return!0}function Nh(i,n,a,c,d,p){return xs=p,wt=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,T.H=i===null||i.memoizedState===null?Fg:eu,Hn=!1,p=a(c,d),Hn=!1,Dr&&(p=ng(n,a,c,d)),sg(i),p}function sg(i){T.H=Ba;var n=Vt!==null&&Vt.next!==null;if(xs=0,xe=Vt=wt=null,ll=!1,Ra=0,Rr=null,n)throw Error(s(300));i===null||be||(i=i.dependencies,i!==null&&$o(i)&&(be=!0))}function ng(i,n,a,c){wt=i;var d=0;do{if(Dr&&(Rr=null),Ra=0,Dr=!1,25<=d)throw Error(s(301));if(d+=1,xe=Vt=null,i.updateQueue!=null){var p=i.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}T.H=Ng,p=n(a,c)}while(Dr);return p}function cx(){var i=T.H,n=i.useState()[0];return n=typeof n.then=="function"?Ma(n):n,i=i.useState()[0],(Vt!==null?Vt.memoizedState:null)!==i&&(wt.flags|=1024),n}function Hh(){var i=cl!==0;return cl=0,i}function Gh(i,n,a){n.updateQueue=i.updateQueue,n.flags&=-2053,i.lanes&=~a}function Qh(i){if(ll){for(i=i.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}ll=!1}xs=0,xe=Vt=wt=null,Dr=!1,Ra=cl=0,Rr=null}function $e(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xe===null?wt.memoizedState=xe=i:xe=xe.next=i,xe}function ge(){if(Vt===null){var i=wt.alternate;i=i!==null?i.memoizedState:null}else i=Vt.next;var n=xe===null?wt.memoizedState:xe.next;if(n!==null)xe=n,Vt=i;else{if(i===null)throw wt.alternate===null?Error(s(467)):Error(s(310));Vt=i,i={memoizedState:Vt.memoizedState,baseState:Vt.baseState,baseQueue:Vt.baseQueue,queue:Vt.queue,next:null},xe===null?wt.memoizedState=xe=i:xe=xe.next=i}return xe}function hl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ma(i){var n=Ra;return Ra+=1,Rr===null&&(Rr=[]),i=Xp(Rr,i,n),n=wt,(xe===null?n.memoizedState:xe.next)===null&&(n=n.alternate,T.H=n===null||n.memoizedState===null?Fg:eu),i}function ul(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Ma(i);if(i.$$typeof===P)return Ue(i)}throw Error(s(438,String(i)))}function jh(i){var n=null,a=wt.updateQueue;if(a!==null&&(n=a.memoCache),n==null){var c=wt.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(d){return d.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),a===null&&(a=hl(),wt.updateQueue=a),a.memoCache=n,a=n.data[n.index],a===void 0)for(a=n.data[n.index]=Array(i),c=0;c<i;c++)a[c]=_t;return n.index++,a}function bs(i,n){return typeof n=="function"?n(i):n}function dl(i){var n=ge();return Vh(n,Vt,i)}function Vh(i,n,a){var c=i.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=a;var d=i.baseQueue,p=c.pending;if(p!==null){if(d!==null){var _=d.next;d.next=p.next,p.next=_}n.baseQueue=d=p,c.pending=null}if(p=i.baseState,d===null)i.memoizedState=p;else{n=d.next;var v=_=null,S=null,H=n,q=!1;do{var J=H.lane&-536870913;if(J!==H.lane?(It&J)===J:(xs&J)===J){var Q=H.revertLane;if(Q===0)S!==null&&(S=S.next={lane:0,revertLane:0,gesture:null,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null}),J===wr&&(q=!0);else if((xs&Q)===Q){H=H.next,Q===wr&&(q=!0);continue}else J={lane:0,revertLane:H.revertLane,gesture:null,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},S===null?(v=S=J,_=p):S=S.next=J,wt.lanes|=Q,rn|=Q;J=H.action,Hn&&a(p,J),p=H.hasEagerState?H.eagerState:a(p,J)}else Q={lane:J,revertLane:H.revertLane,gesture:H.gesture,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},S===null?(v=S=Q,_=p):S=S.next=Q,wt.lanes|=J,rn|=J;H=H.next}while(H!==null&&H!==n);if(S===null?_=p:S.next=v,!xi(p,i.memoizedState)&&(be=!0,q&&(a=Cr,a!==null)))throw a;i.memoizedState=p,i.baseState=_,i.baseQueue=S,c.lastRenderedState=p}return d===null&&(c.lanes=0),[i.memoizedState,c.dispatch]}function Yh(i){var n=ge(),a=n.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=i;var c=a.dispatch,d=a.pending,p=n.memoizedState;if(d!==null){a.pending=null;var _=d=d.next;do p=i(p,_.action),_=_.next;while(_!==d);xi(p,n.memoizedState)||(be=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),a.lastRenderedState=p}return[p,c]}function rg(i,n,a){var c=wt,d=ge(),p=zt;if(p){if(a===void 0)throw Error(s(407));a=a()}else a=n();var _=!xi((Vt||d).memoizedState,a);if(_&&(d.memoizedState=a,be=!0),d=d.queue,Zh(lg.bind(null,c,d,i),[i]),d.getSnapshot!==n||_||xe!==null&&xe.memoizedState.tag&1){if(c.flags|=2048,Mr(9,{destroy:void 0},og.bind(null,c,d,a,n),null),Wt===null)throw Error(s(349));p||(xs&127)!==0||ag(c,n,a)}return a}function ag(i,n,a){i.flags|=16384,i={getSnapshot:n,value:a},n=wt.updateQueue,n===null?(n=hl(),wt.updateQueue=n,n.stores=[i]):(a=n.stores,a===null?n.stores=[i]:a.push(i))}function og(i,n,a,c){n.value=a,n.getSnapshot=c,cg(n)&&hg(i)}function lg(i,n,a){return a(function(){cg(n)&&hg(i)})}function cg(i){var n=i.getSnapshot;i=i.value;try{var a=n();return!xi(i,a)}catch{return!0}}function hg(i){var n=Bn(i,2);n!==null&&ui(n,i,2)}function qh(i){var n=$e();if(typeof i=="function"){var a=i;if(i=a(),Hn){js(!0);try{a()}finally{js(!1)}}}return n.memoizedState=n.baseState=i,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bs,lastRenderedState:i},n}function ug(i,n,a,c){return i.baseState=a,Vh(i,Vt,typeof c=="function"?c:bs)}function hx(i,n,a,c,d){if(gl(i))throw Error(s(485));if(i=n.action,i!==null){var p={payload:d,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){p.listeners.push(_)}};T.T!==null?a(!0):p.isTransition=!1,c(p),a=n.pending,a===null?(p.next=n.pending=p,dg(n,p)):(p.next=a.next,n.pending=a.next=p)}}function dg(i,n){var a=n.action,c=n.payload,d=i.state;if(n.isTransition){var p=T.T,_={};T.T=_;try{var v=a(d,c),S=T.S;S!==null&&S(_,v),fg(i,n,v)}catch(H){Xh(i,n,H)}finally{p!==null&&_.types!==null&&(p.types=_.types),T.T=p}}else try{p=a(d,c),fg(i,n,p)}catch(H){Xh(i,n,H)}}function fg(i,n,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(c){pg(i,n,c)},function(c){return Xh(i,n,c)}):pg(i,n,a)}function pg(i,n,a){n.status="fulfilled",n.value=a,gg(n),i.state=a,n=i.pending,n!==null&&(a=n.next,a===n?i.pending=null:(a=a.next,n.next=a,dg(i,a)))}function Xh(i,n,a){var c=i.pending;if(i.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=a,gg(n),n=n.next;while(n!==c)}i.action=null}function gg(i){i=i.listeners;for(var n=0;n<i.length;n++)(0,i[n])()}function mg(i,n){return n}function _g(i,n){if(zt){var a=Wt.formState;if(a!==null){t:{var c=wt;if(zt){if(ie){e:{for(var d=ie,p=Fi;d.nodeType!==8;){if(!p){d=null;break e}if(d=Hi(d.nextSibling),d===null){d=null;break e}}p=d.data,d=p==="F!"||p==="F"?d:null}if(d){ie=Hi(d.nextSibling),c=d.data==="F!";break t}}Zs(c)}c=!1}c&&(n=a[0])}}return a=$e(),a.memoizedState=a.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mg,lastRenderedState:n},a.queue=c,a=Og.bind(null,wt,c),c.dispatch=a,c=qh(!1),p=tu.bind(null,wt,!1,c.queue),c=$e(),d={state:n,dispatch:null,action:i,pending:null},c.queue=d,a=hx.bind(null,wt,d,p,a),d.dispatch=a,c.memoizedState=i,[n,a,!1]}function Ag(i){var n=ge();return yg(n,Vt,i)}function yg(i,n,a){if(n=Vh(i,n,mg)[0],i=dl(bs)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=Ma(n)}catch(_){throw _===Sr?il:_}else c=n;n=ge();var d=n.queue,p=d.dispatch;return a!==n.memoizedState&&(wt.flags|=2048,Mr(9,{destroy:void 0},ux.bind(null,d,a),null)),[c,p,i]}function ux(i,n){i.action=n}function vg(i){var n=ge(),a=Vt;if(a!==null)return yg(n,a,i);ge(),n=n.memoizedState,a=ge();var c=a.queue.dispatch;return a.memoizedState=i,[n,c,!1]}function Mr(i,n,a,c){return i={tag:i,create:a,deps:c,inst:n,next:null},n=wt.updateQueue,n===null&&(n=hl(),wt.updateQueue=n),a=n.lastEffect,a===null?n.lastEffect=i.next=i:(c=a.next,a.next=i,i.next=c,n.lastEffect=i),i}function xg(){return ge().memoizedState}function fl(i,n,a,c){var d=$e();wt.flags|=i,d.memoizedState=Mr(1|n,{destroy:void 0},a,c===void 0?null:c)}function pl(i,n,a,c){var d=ge();c=c===void 0?null:c;var p=d.memoizedState.inst;Vt!==null&&c!==null&&Fh(c,Vt.memoizedState.deps)?d.memoizedState=Mr(n,p,a,c):(wt.flags|=i,d.memoizedState=Mr(1|n,p,a,c))}function bg(i,n){fl(8390656,8,i,n)}function Zh(i,n){pl(2048,8,i,n)}function dx(i){wt.flags|=4;var n=wt.updateQueue;if(n===null)n=hl(),wt.updateQueue=n,n.events=[i];else{var a=n.events;a===null?n.events=[i]:a.push(i)}}function wg(i){var n=ge().memoizedState;return dx({ref:n,nextImpl:i}),function(){if((Ht&2)!==0)throw Error(s(440));return n.impl.apply(void 0,arguments)}}function Cg(i,n){return pl(4,2,i,n)}function Sg(i,n){return pl(4,4,i,n)}function Tg(i,n){if(typeof n=="function"){i=i();var a=n(i);return function(){typeof a=="function"?a():n(null)}}if(n!=null)return i=i(),n.current=i,function(){n.current=null}}function Eg(i,n,a){a=a!=null?a.concat([i]):null,pl(4,4,Tg.bind(null,n,i),a)}function Wh(){}function Dg(i,n){var a=ge();n=n===void 0?null:n;var c=a.memoizedState;return n!==null&&Fh(n,c[1])?c[0]:(a.memoizedState=[i,n],i)}function Rg(i,n){var a=ge();n=n===void 0?null:n;var c=a.memoizedState;if(n!==null&&Fh(n,c[1]))return c[0];if(c=i(),Hn){js(!0);try{i()}finally{js(!1)}}return a.memoizedState=[c,n],c}function Jh(i,n,a){return a===void 0||(xs&1073741824)!==0&&(It&261930)===0?i.memoizedState=n:(i.memoizedState=a,i=Mm(),wt.lanes|=i,rn|=i,a)}function Mg(i,n,a,c){return xi(a,n)?a:Er.current!==null?(i=Jh(i,a,c),xi(i,n)||(be=!0),i):(xs&42)===0||(xs&1073741824)!==0&&(It&261930)===0?(be=!0,i.memoizedState=a):(i=Mm(),wt.lanes|=i,rn|=i,n)}function Pg(i,n,a,c,d){var p=b.p;b.p=p!==0&&8>p?p:8;var _=T.T,v={};T.T=v,tu(i,!1,n,a);try{var S=d(),H=T.S;if(H!==null&&H(v,S),S!==null&&typeof S=="object"&&typeof S.then=="function"){var q=ox(S,c);Pa(i,n,q,Ei(i))}else Pa(i,n,c,Ei(i))}catch(J){Pa(i,n,{then:function(){},status:"rejected",reason:J},Ei())}finally{b.p=p,_!==null&&v.types!==null&&(_.types=v.types),T.T=_}}function fx(){}function Kh(i,n,a,c){if(i.tag!==5)throw Error(s(476));var d=Bg(i).queue;Pg(i,d,n,tt,a===null?fx:function(){return Ig(i),a(c)})}function Bg(i){var n=i.memoizedState;if(n!==null)return n;n={memoizedState:tt,baseState:tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:bs,lastRenderedState:tt},next:null};var a={};return n.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:bs,lastRenderedState:a},next:null},i.memoizedState=n,i=i.alternate,i!==null&&(i.memoizedState=n),n}function Ig(i){var n=Bg(i);n.next===null&&(n=i.alternate.memoizedState),Pa(i,n.next.queue,{},Ei())}function $h(){return Ue(Xa)}function kg(){return ge().memoizedState}function zg(){return ge().memoizedState}function px(i){for(var n=i.return;n!==null;){switch(n.tag){case 24:case 3:var a=Ei();i=Ks(a);var c=$s(n,i,a);c!==null&&(ui(c,n,a),Ta(c,n,a)),n={cache:Dh()},i.payload=n;return}n=n.return}}function gx(i,n,a){var c=Ei();a={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},gl(i)?Ug(n,a):(a=_h(i,n,a,c),a!==null&&(ui(a,i,c),Lg(a,n,c)))}function Og(i,n,a){var c=Ei();Pa(i,n,a,c)}function Pa(i,n,a,c){var d={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(gl(i))Ug(n,d);else{var p=i.alternate;if(i.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var _=n.lastRenderedState,v=p(_,a);if(d.hasEagerState=!0,d.eagerState=v,xi(v,_))return Zo(i,n,d,0),Wt===null&&Xo(),!1}catch{}finally{}if(a=_h(i,n,d,c),a!==null)return ui(a,i,c),Lg(a,n,c),!0}return!1}function tu(i,n,a,c){if(c={lane:2,revertLane:Bu(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},gl(i)){if(n)throw Error(s(479))}else n=_h(i,a,c,2),n!==null&&ui(n,i,2)}function gl(i){var n=i.alternate;return i===wt||n!==null&&n===wt}function Ug(i,n){Dr=ll=!0;var a=i.pending;a===null?n.next=n:(n.next=a.next,a.next=n),i.pending=n}function Lg(i,n,a){if((a&4194048)!==0){var c=n.lanes;c&=i.pendingLanes,a|=c,n.lanes=a,Qf(i,a)}}var Ba={readContext:Ue,use:ul,useCallback:oe,useContext:oe,useEffect:oe,useImperativeHandle:oe,useLayoutEffect:oe,useInsertionEffect:oe,useMemo:oe,useReducer:oe,useRef:oe,useState:oe,useDebugValue:oe,useDeferredValue:oe,useTransition:oe,useSyncExternalStore:oe,useId:oe,useHostTransitionStatus:oe,useFormState:oe,useActionState:oe,useOptimistic:oe,useMemoCache:oe,useCacheRefresh:oe};Ba.useEffectEvent=oe;var Fg={readContext:Ue,use:ul,useCallback:function(i,n){return $e().memoizedState=[i,n===void 0?null:n],i},useContext:Ue,useEffect:bg,useImperativeHandle:function(i,n,a){a=a!=null?a.concat([i]):null,fl(4194308,4,Tg.bind(null,n,i),a)},useLayoutEffect:function(i,n){return fl(4194308,4,i,n)},useInsertionEffect:function(i,n){fl(4,2,i,n)},useMemo:function(i,n){var a=$e();n=n===void 0?null:n;var c=i();if(Hn){js(!0);try{i()}finally{js(!1)}}return a.memoizedState=[c,n],c},useReducer:function(i,n,a){var c=$e();if(a!==void 0){var d=a(n);if(Hn){js(!0);try{a(n)}finally{js(!1)}}}else d=n;return c.memoizedState=c.baseState=d,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:d},c.queue=i,i=i.dispatch=gx.bind(null,wt,i),[c.memoizedState,i]},useRef:function(i){var n=$e();return i={current:i},n.memoizedState=i},useState:function(i){i=qh(i);var n=i.queue,a=Og.bind(null,wt,n);return n.dispatch=a,[i.memoizedState,a]},useDebugValue:Wh,useDeferredValue:function(i,n){var a=$e();return Jh(a,i,n)},useTransition:function(){var i=qh(!1);return i=Pg.bind(null,wt,i.queue,!0,!1),$e().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,n,a){var c=wt,d=$e();if(zt){if(a===void 0)throw Error(s(407));a=a()}else{if(a=n(),Wt===null)throw Error(s(349));(It&127)!==0||ag(c,n,a)}d.memoizedState=a;var p={value:a,getSnapshot:n};return d.queue=p,bg(lg.bind(null,c,p,i),[i]),c.flags|=2048,Mr(9,{destroy:void 0},og.bind(null,c,p,a,n),null),a},useId:function(){var i=$e(),n=Wt.identifierPrefix;if(zt){var a=is,c=es;a=(c&~(1<<32-vi(c)-1)).toString(32)+a,n="_"+n+"R_"+a,a=cl++,0<a&&(n+="H"+a.toString(32)),n+="_"}else a=lx++,n="_"+n+"r_"+a.toString(32)+"_";return i.memoizedState=n},useHostTransitionStatus:$h,useFormState:_g,useActionState:_g,useOptimistic:function(i){var n=$e();n.memoizedState=n.baseState=i;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=a,n=tu.bind(null,wt,!0,a),a.dispatch=n,[i,n]},useMemoCache:jh,useCacheRefresh:function(){return $e().memoizedState=px.bind(null,wt)},useEffectEvent:function(i){var n=$e(),a={impl:i};return n.memoizedState=a,function(){if((Ht&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}},eu={readContext:Ue,use:ul,useCallback:Dg,useContext:Ue,useEffect:Zh,useImperativeHandle:Eg,useInsertionEffect:Cg,useLayoutEffect:Sg,useMemo:Rg,useReducer:dl,useRef:xg,useState:function(){return dl(bs)},useDebugValue:Wh,useDeferredValue:function(i,n){var a=ge();return Mg(a,Vt.memoizedState,i,n)},useTransition:function(){var i=dl(bs)[0],n=ge().memoizedState;return[typeof i=="boolean"?i:Ma(i),n]},useSyncExternalStore:rg,useId:kg,useHostTransitionStatus:$h,useFormState:Ag,useActionState:Ag,useOptimistic:function(i,n){var a=ge();return ug(a,Vt,i,n)},useMemoCache:jh,useCacheRefresh:zg};eu.useEffectEvent=wg;var Ng={readContext:Ue,use:ul,useCallback:Dg,useContext:Ue,useEffect:Zh,useImperativeHandle:Eg,useInsertionEffect:Cg,useLayoutEffect:Sg,useMemo:Rg,useReducer:Yh,useRef:xg,useState:function(){return Yh(bs)},useDebugValue:Wh,useDeferredValue:function(i,n){var a=ge();return Vt===null?Jh(a,i,n):Mg(a,Vt.memoizedState,i,n)},useTransition:function(){var i=Yh(bs)[0],n=ge().memoizedState;return[typeof i=="boolean"?i:Ma(i),n]},useSyncExternalStore:rg,useId:kg,useHostTransitionStatus:$h,useFormState:vg,useActionState:vg,useOptimistic:function(i,n){var a=ge();return Vt!==null?ug(a,Vt,i,n):(a.baseState=i,[i,a.queue.dispatch])},useMemoCache:jh,useCacheRefresh:zg};Ng.useEffectEvent=wg;function iu(i,n,a,c){n=i.memoizedState,a=a(c,n),a=a==null?n:A({},n,a),i.memoizedState=a,i.lanes===0&&(i.updateQueue.baseState=a)}var su={enqueueSetState:function(i,n,a){i=i._reactInternals;var c=Ei(),d=Ks(c);d.payload=n,a!=null&&(d.callback=a),n=$s(i,d,c),n!==null&&(ui(n,i,c),Ta(n,i,c))},enqueueReplaceState:function(i,n,a){i=i._reactInternals;var c=Ei(),d=Ks(c);d.tag=1,d.payload=n,a!=null&&(d.callback=a),n=$s(i,d,c),n!==null&&(ui(n,i,c),Ta(n,i,c))},enqueueForceUpdate:function(i,n){i=i._reactInternals;var a=Ei(),c=Ks(a);c.tag=2,n!=null&&(c.callback=n),n=$s(i,c,a),n!==null&&(ui(n,i,a),Ta(n,i,a))}};function Hg(i,n,a,c,d,p,_){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(c,p,_):n.prototype&&n.prototype.isPureReactComponent?!Aa(a,c)||!Aa(d,p):!0}function Gg(i,n,a,c){i=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,c),n.state!==i&&su.enqueueReplaceState(n,n.state,null)}function Gn(i,n){var a=n;if("ref"in n){a={};for(var c in n)c!=="ref"&&(a[c]=n[c])}if(i=i.defaultProps){a===n&&(a=A({},a));for(var d in i)a[d]===void 0&&(a[d]=i[d])}return a}function Qg(i){qo(i)}function jg(i){console.error(i)}function Vg(i){qo(i)}function ml(i,n){try{var a=i.onUncaughtError;a(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function Yg(i,n,a){try{var c=i.onCaughtError;c(a.value,{componentStack:a.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function nu(i,n,a){return a=Ks(a),a.tag=3,a.payload={element:null},a.callback=function(){ml(i,n)},a}function qg(i){return i=Ks(i),i.tag=3,i}function Xg(i,n,a,c){var d=a.type.getDerivedStateFromError;if(typeof d=="function"){var p=c.value;i.payload=function(){return d(p)},i.callback=function(){Yg(n,a,c)}}var _=a.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(i.callback=function(){Yg(n,a,c),typeof d!="function"&&(an===null?an=new Set([this]):an.add(this));var v=c.stack;this.componentDidCatch(c.value,{componentStack:v!==null?v:""})})}function mx(i,n,a,c,d){if(a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=a.alternate,n!==null&&br(n,a,d,!0),a=wi.current,a!==null){switch(a.tag){case 31:case 13:return Ni===null?Dl():a.alternate===null&&le===0&&(le=3),a.flags&=-257,a.flags|=65536,a.lanes=d,c===sl?a.flags|=16384:(n=a.updateQueue,n===null?a.updateQueue=new Set([c]):n.add(c),Ru(i,c,d)),!1;case 22:return a.flags|=65536,c===sl?a.flags|=16384:(n=a.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},a.updateQueue=n):(a=n.retryQueue,a===null?n.retryQueue=new Set([c]):a.add(c)),Ru(i,c,d)),!1}throw Error(s(435,a.tag))}return Ru(i,c,d),Dl(),!1}if(zt)return n=wi.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=d,c!==wh&&(i=Error(s(422),{cause:c}),xa(Oi(i,a)))):(c!==wh&&(n=Error(s(423),{cause:c}),xa(Oi(n,a))),i=i.current.alternate,i.flags|=65536,d&=-d,i.lanes|=d,c=Oi(c,a),d=nu(i.stateNode,c,d),kh(i,d),le!==4&&(le=2)),!1;var p=Error(s(520),{cause:c});if(p=Oi(p,a),Na===null?Na=[p]:Na.push(p),le!==4&&(le=2),n===null)return!0;c=Oi(c,a),a=n;do{switch(a.tag){case 3:return a.flags|=65536,i=d&-d,a.lanes|=i,i=nu(a.stateNode,c,i),kh(a,i),!1;case 1:if(n=a.type,p=a.stateNode,(a.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(an===null||!an.has(p))))return a.flags|=65536,d&=-d,a.lanes|=d,d=qg(d),Xg(d,i,a,c),kh(a,d),!1}a=a.return}while(a!==null);return!1}var ru=Error(s(461)),be=!1;function Le(i,n,a,c){n.child=i===null?Kp(n,null,a,c):Nn(n,i.child,a,c)}function Zg(i,n,a,c,d){a=a.render;var p=n.ref;if("ref"in c){var _={};for(var v in c)v!=="ref"&&(_[v]=c[v])}else _=c;return On(n),c=Nh(i,n,a,_,p,d),v=Hh(),i!==null&&!be?(Gh(i,n,d),ws(i,n,d)):(zt&&v&&xh(n),n.flags|=1,Le(i,n,c,d),n.child)}function Wg(i,n,a,c,d){if(i===null){var p=a.type;return typeof p=="function"&&!Ah(p)&&p.defaultProps===void 0&&a.compare===null?(n.tag=15,n.type=p,Jg(i,n,p,c,d)):(i=Jo(a.type,null,c,n,n.mode,d),i.ref=n.ref,i.return=n,n.child=i)}if(p=i.child,!fu(i,d)){var _=p.memoizedProps;if(a=a.compare,a=a!==null?a:Aa,a(_,c)&&i.ref===n.ref)return ws(i,n,d)}return n.flags|=1,i=_s(p,c),i.ref=n.ref,i.return=n,n.child=i}function Jg(i,n,a,c,d){if(i!==null){var p=i.memoizedProps;if(Aa(p,c)&&i.ref===n.ref)if(be=!1,n.pendingProps=c=p,fu(i,d))(i.flags&131072)!==0&&(be=!0);else return n.lanes=i.lanes,ws(i,n,d)}return au(i,n,a,c,d)}function Kg(i,n,a,c){var d=c.children,p=i!==null?i.memoizedState:null;if(i===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(p=p!==null?p.baseLanes|a:a,i!==null){for(c=n.child=i.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;c=d&~p}else c=0,n.child=null;return $g(i,n,p,a,c)}if((a&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},i!==null&&el(n,p!==null?p.cachePool:null),p!==null?eg(n,p):Oh(),ig(n);else return c=n.lanes=536870912,$g(i,n,p!==null?p.baseLanes|a:a,a,c)}else p!==null?(el(n,p.cachePool),eg(n,p),en(),n.memoizedState=null):(i!==null&&el(n,null),Oh(),en());return Le(i,n,d,a),n.child}function Ia(i,n){return i!==null&&i.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function $g(i,n,a,c,d){var p=Mh();return p=p===null?null:{parent:ve._currentValue,pool:p},n.memoizedState={baseLanes:a,cachePool:p},i!==null&&el(n,null),Oh(),ig(n),i!==null&&br(i,n,c,!0),n.childLanes=d,null}function _l(i,n){return n=yl({mode:n.mode,children:n.children},i.mode),n.ref=i.ref,i.child=n,n.return=i,n}function tm(i,n,a){return Nn(n,i.child,null,a),i=_l(n,n.pendingProps),i.flags|=2,Ci(n),n.memoizedState=null,i}function _x(i,n,a){var c=n.pendingProps,d=(n.flags&128)!==0;if(n.flags&=-129,i===null){if(zt){if(c.mode==="hidden")return i=_l(n,c),n.lanes=536870912,Ia(null,i);if(Lh(n),(i=ie)?(i=d_(i,Fi),i=i!==null&&i.data==="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:qs!==null?{id:es,overflow:is}:null,retryLane:536870912,hydrationErrors:null},a=Up(i),a.return=n,n.child=a,Oe=n,ie=null)):i=null,i===null)throw Zs(n);return n.lanes=536870912,null}return _l(n,c)}var p=i.memoizedState;if(p!==null){var _=p.dehydrated;if(Lh(n),d)if(n.flags&256)n.flags&=-257,n=tm(i,n,a);else if(n.memoizedState!==null)n.child=i.child,n.flags|=128,n=null;else throw Error(s(558));else if(be||br(i,n,a,!1),d=(a&i.childLanes)!==0,be||d){if(c=Wt,c!==null&&(_=jf(c,a),_!==0&&_!==p.retryLane))throw p.retryLane=_,Bn(i,_),ui(c,i,_),ru;Dl(),n=tm(i,n,a)}else i=p.treeContext,ie=Hi(_.nextSibling),Oe=n,zt=!0,Xs=null,Fi=!1,i!==null&&Np(n,i),n=_l(n,c),n.flags|=4096;return n}return i=_s(i.child,{mode:c.mode,children:c.children}),i.ref=n.ref,n.child=i,i.return=n,i}function Al(i,n){var a=n.ref;if(a===null)i!==null&&i.ref!==null&&(n.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(s(284));(i===null||i.ref!==a)&&(n.flags|=4194816)}}function au(i,n,a,c,d){return On(n),a=Nh(i,n,a,c,void 0,d),c=Hh(),i!==null&&!be?(Gh(i,n,d),ws(i,n,d)):(zt&&c&&xh(n),n.flags|=1,Le(i,n,a,d),n.child)}function em(i,n,a,c,d,p){return On(n),n.updateQueue=null,a=ng(n,c,a,d),sg(i),c=Hh(),i!==null&&!be?(Gh(i,n,p),ws(i,n,p)):(zt&&c&&xh(n),n.flags|=1,Le(i,n,a,p),n.child)}function im(i,n,a,c,d){if(On(n),n.stateNode===null){var p=Ar,_=a.contextType;typeof _=="object"&&_!==null&&(p=Ue(_)),p=new a(c,p),n.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=su,n.stateNode=p,p._reactInternals=n,p=n.stateNode,p.props=c,p.state=n.memoizedState,p.refs={},Bh(n),_=a.contextType,p.context=typeof _=="object"&&_!==null?Ue(_):Ar,p.state=n.memoizedState,_=a.getDerivedStateFromProps,typeof _=="function"&&(iu(n,a,_,c),p.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(_=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),_!==p.state&&su.enqueueReplaceState(p,p.state,null),Da(n,c,p,d),Ea(),p.state=n.memoizedState),typeof p.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(i===null){p=n.stateNode;var v=n.memoizedProps,S=Gn(a,v);p.props=S;var H=p.context,q=a.contextType;_=Ar,typeof q=="object"&&q!==null&&(_=Ue(q));var J=a.getDerivedStateFromProps;q=typeof J=="function"||typeof p.getSnapshotBeforeUpdate=="function",v=n.pendingProps!==v,q||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(v||H!==_)&&Gg(n,p,c,_),Js=!1;var Q=n.memoizedState;p.state=Q,Da(n,c,p,d),Ea(),H=n.memoizedState,v||Q!==H||Js?(typeof J=="function"&&(iu(n,a,J,c),H=n.memoizedState),(S=Js||Hg(n,a,S,c,Q,H,_))?(q||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(n.flags|=4194308)):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=H),p.props=c,p.state=H,p.context=_,c=S):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{p=n.stateNode,Ih(i,n),_=n.memoizedProps,q=Gn(a,_),p.props=q,J=n.pendingProps,Q=p.context,H=a.contextType,S=Ar,typeof H=="object"&&H!==null&&(S=Ue(H)),v=a.getDerivedStateFromProps,(H=typeof v=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(_!==J||Q!==S)&&Gg(n,p,c,S),Js=!1,Q=n.memoizedState,p.state=Q,Da(n,c,p,d),Ea();var V=n.memoizedState;_!==J||Q!==V||Js||i!==null&&i.dependencies!==null&&$o(i.dependencies)?(typeof v=="function"&&(iu(n,a,v,c),V=n.memoizedState),(q=Js||Hg(n,a,q,c,Q,V,S)||i!==null&&i.dependencies!==null&&$o(i.dependencies))?(H||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(c,V,S),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(c,V,S)),typeof p.componentDidUpdate=="function"&&(n.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof p.componentDidUpdate!="function"||_===i.memoizedProps&&Q===i.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||_===i.memoizedProps&&Q===i.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=V),p.props=c,p.state=V,p.context=S,c=q):(typeof p.componentDidUpdate!="function"||_===i.memoizedProps&&Q===i.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||_===i.memoizedProps&&Q===i.memoizedState||(n.flags|=1024),c=!1)}return p=c,Al(i,n),c=(n.flags&128)!==0,p||c?(p=n.stateNode,a=c&&typeof a.getDerivedStateFromError!="function"?null:p.render(),n.flags|=1,i!==null&&c?(n.child=Nn(n,i.child,null,d),n.child=Nn(n,null,a,d)):Le(i,n,a,d),n.memoizedState=p.state,i=n.child):i=ws(i,n,d),i}function sm(i,n,a,c){return kn(),n.flags|=256,Le(i,n,a,c),n.child}var ou={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function lu(i){return{baseLanes:i,cachePool:Yp()}}function cu(i,n,a){return i=i!==null?i.childLanes&~a:0,n&&(i|=Ti),i}function nm(i,n,a){var c=n.pendingProps,d=!1,p=(n.flags&128)!==0,_;if((_=p)||(_=i!==null&&i.memoizedState===null?!1:(pe.current&2)!==0),_&&(d=!0,n.flags&=-129),_=(n.flags&32)!==0,n.flags&=-33,i===null){if(zt){if(d?tn(n):en(),(i=ie)?(i=d_(i,Fi),i=i!==null&&i.data!=="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:qs!==null?{id:es,overflow:is}:null,retryLane:536870912,hydrationErrors:null},a=Up(i),a.return=n,n.child=a,Oe=n,ie=null)):i=null,i===null)throw Zs(n);return Vu(i)?n.lanes=32:n.lanes=536870912,null}var v=c.children;return c=c.fallback,d?(en(),d=n.mode,v=yl({mode:"hidden",children:v},d),c=In(c,d,a,null),v.return=n,c.return=n,v.sibling=c,n.child=v,c=n.child,c.memoizedState=lu(a),c.childLanes=cu(i,_,a),n.memoizedState=ou,Ia(null,c)):(tn(n),hu(n,v))}var S=i.memoizedState;if(S!==null&&(v=S.dehydrated,v!==null)){if(p)n.flags&256?(tn(n),n.flags&=-257,n=uu(i,n,a)):n.memoizedState!==null?(en(),n.child=i.child,n.flags|=128,n=null):(en(),v=c.fallback,d=n.mode,c=yl({mode:"visible",children:c.children},d),v=In(v,d,a,null),v.flags|=2,c.return=n,v.return=n,c.sibling=v,n.child=c,Nn(n,i.child,null,a),c=n.child,c.memoizedState=lu(a),c.childLanes=cu(i,_,a),n.memoizedState=ou,n=Ia(null,c));else if(tn(n),Vu(v)){if(_=v.nextSibling&&v.nextSibling.dataset,_)var H=_.dgst;_=H,c=Error(s(419)),c.stack="",c.digest=_,xa({value:c,source:null,stack:null}),n=uu(i,n,a)}else if(be||br(i,n,a,!1),_=(a&i.childLanes)!==0,be||_){if(_=Wt,_!==null&&(c=jf(_,a),c!==0&&c!==S.retryLane))throw S.retryLane=c,Bn(i,c),ui(_,i,c),ru;ju(v)||Dl(),n=uu(i,n,a)}else ju(v)?(n.flags|=192,n.child=i.child,n=null):(i=S.treeContext,ie=Hi(v.nextSibling),Oe=n,zt=!0,Xs=null,Fi=!1,i!==null&&Np(n,i),n=hu(n,c.children),n.flags|=4096);return n}return d?(en(),v=c.fallback,d=n.mode,S=i.child,H=S.sibling,c=_s(S,{mode:"hidden",children:c.children}),c.subtreeFlags=S.subtreeFlags&65011712,H!==null?v=_s(H,v):(v=In(v,d,a,null),v.flags|=2),v.return=n,c.return=n,c.sibling=v,n.child=c,Ia(null,c),c=n.child,v=i.child.memoizedState,v===null?v=lu(a):(d=v.cachePool,d!==null?(S=ve._currentValue,d=d.parent!==S?{parent:S,pool:S}:d):d=Yp(),v={baseLanes:v.baseLanes|a,cachePool:d}),c.memoizedState=v,c.childLanes=cu(i,_,a),n.memoizedState=ou,Ia(i.child,c)):(tn(n),a=i.child,i=a.sibling,a=_s(a,{mode:"visible",children:c.children}),a.return=n,a.sibling=null,i!==null&&(_=n.deletions,_===null?(n.deletions=[i],n.flags|=16):_.push(i)),n.child=a,n.memoizedState=null,a)}function hu(i,n){return n=yl({mode:"visible",children:n},i.mode),n.return=i,i.child=n}function yl(i,n){return i=bi(22,i,null,n),i.lanes=0,i}function uu(i,n,a){return Nn(n,i.child,null,a),i=hu(n,n.pendingProps.children),i.flags|=2,n.memoizedState=null,i}function rm(i,n,a){i.lanes|=n;var c=i.alternate;c!==null&&(c.lanes|=n),Th(i.return,n,a)}function du(i,n,a,c,d,p){var _=i.memoizedState;_===null?i.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:d,treeForkCount:p}:(_.isBackwards=n,_.rendering=null,_.renderingStartTime=0,_.last=c,_.tail=a,_.tailMode=d,_.treeForkCount=p)}function am(i,n,a){var c=n.pendingProps,d=c.revealOrder,p=c.tail;c=c.children;var _=pe.current,v=(_&2)!==0;if(v?(_=_&1|2,n.flags|=128):_&=1,nt(pe,_),Le(i,n,c,a),c=zt?va:0,!v&&i!==null&&(i.flags&128)!==0)t:for(i=n.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&rm(i,a,n);else if(i.tag===19)rm(i,a,n);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break t;for(;i.sibling===null;){if(i.return===null||i.return===n)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(d){case"forwards":for(a=n.child,d=null;a!==null;)i=a.alternate,i!==null&&ol(i)===null&&(d=a),a=a.sibling;a=d,a===null?(d=n.child,n.child=null):(d=a.sibling,a.sibling=null),du(n,!1,d,a,p,c);break;case"backwards":case"unstable_legacy-backwards":for(a=null,d=n.child,n.child=null;d!==null;){if(i=d.alternate,i!==null&&ol(i)===null){n.child=d;break}i=d.sibling,d.sibling=a,a=d,d=i}du(n,!0,a,null,p,c);break;case"together":du(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function ws(i,n,a){if(i!==null&&(n.dependencies=i.dependencies),rn|=n.lanes,(a&n.childLanes)===0)if(i!==null){if(br(i,n,a,!1),(a&n.childLanes)===0)return null}else return null;if(i!==null&&n.child!==i.child)throw Error(s(153));if(n.child!==null){for(i=n.child,a=_s(i,i.pendingProps),n.child=a,a.return=n;i.sibling!==null;)i=i.sibling,a=a.sibling=_s(i,i.pendingProps),a.return=n;a.sibling=null}return n.child}function fu(i,n){return(i.lanes&n)!==0?!0:(i=i.dependencies,!!(i!==null&&$o(i)))}function Ax(i,n,a){switch(n.tag){case 3:Ke(n,n.stateNode.containerInfo),Ws(n,ve,i.memoizedState.cache),kn();break;case 27:case 5:ra(n);break;case 4:Ke(n,n.stateNode.containerInfo);break;case 10:Ws(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Lh(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?(tn(n),n.flags|=128,null):(a&n.child.childLanes)!==0?nm(i,n,a):(tn(n),i=ws(i,n,a),i!==null?i.sibling:null);tn(n);break;case 19:var d=(i.flags&128)!==0;if(c=(a&n.childLanes)!==0,c||(br(i,n,a,!1),c=(a&n.childLanes)!==0),d){if(c)return am(i,n,a);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),nt(pe,pe.current),c)break;return null;case 22:return n.lanes=0,Kg(i,n,a,n.pendingProps);case 24:Ws(n,ve,i.memoizedState.cache)}return ws(i,n,a)}function om(i,n,a){if(i!==null)if(i.memoizedProps!==n.pendingProps)be=!0;else{if(!fu(i,a)&&(n.flags&128)===0)return be=!1,Ax(i,n,a);be=(i.flags&131072)!==0}else be=!1,zt&&(n.flags&1048576)!==0&&Fp(n,va,n.index);switch(n.lanes=0,n.tag){case 16:t:{var c=n.pendingProps;if(i=Ln(n.elementType),n.type=i,typeof i=="function")Ah(i)?(c=Gn(i,c),n.tag=1,n=im(null,n,i,c,a)):(n.tag=0,n=au(null,n,i,c,a));else{if(i!=null){var d=i.$$typeof;if(d===F){n.tag=11,n=Zg(null,n,i,c,a);break t}else if(d===k){n.tag=14,n=Wg(null,n,i,c,a);break t}}throw n=K(i)||i,Error(s(306,n,""))}}return n;case 0:return au(i,n,n.type,n.pendingProps,a);case 1:return c=n.type,d=Gn(c,n.pendingProps),im(i,n,c,d,a);case 3:t:{if(Ke(n,n.stateNode.containerInfo),i===null)throw Error(s(387));c=n.pendingProps;var p=n.memoizedState;d=p.element,Ih(i,n),Da(n,c,null,a);var _=n.memoizedState;if(c=_.cache,Ws(n,ve,c),c!==p.cache&&Eh(n,[ve],a,!0),Ea(),c=_.element,p.isDehydrated)if(p={element:c,isDehydrated:!1,cache:_.cache},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){n=sm(i,n,c,a);break t}else if(c!==d){d=Oi(Error(s(424)),n),xa(d),n=sm(i,n,c,a);break t}else{switch(i=n.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(ie=Hi(i.firstChild),Oe=n,zt=!0,Xs=null,Fi=!0,a=Kp(n,null,c,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(kn(),c===d){n=ws(i,n,a);break t}Le(i,n,c,a)}n=n.child}return n;case 26:return Al(i,n),i===null?(a=A_(n.type,null,n.pendingProps,null))?n.memoizedState=a:zt||(a=n.type,i=n.pendingProps,c=zl(St.current).createElement(a),c[ze]=n,c[ri]=i,Fe(c,a,i),Me(c),n.stateNode=c):n.memoizedState=A_(n.type,i.memoizedProps,n.pendingProps,i.memoizedState),null;case 27:return ra(n),i===null&&zt&&(c=n.stateNode=g_(n.type,n.pendingProps,St.current),Oe=n,Fi=!0,d=ie,hn(n.type)?(Yu=d,ie=Hi(c.firstChild)):ie=d),Le(i,n,n.pendingProps.children,a),Al(i,n),i===null&&(n.flags|=4194304),n.child;case 5:return i===null&&zt&&((d=c=ie)&&(c=Xx(c,n.type,n.pendingProps,Fi),c!==null?(n.stateNode=c,Oe=n,ie=Hi(c.firstChild),Fi=!1,d=!0):d=!1),d||Zs(n)),ra(n),d=n.type,p=n.pendingProps,_=i!==null?i.memoizedProps:null,c=p.children,Hu(d,p)?c=null:_!==null&&Hu(d,_)&&(n.flags|=32),n.memoizedState!==null&&(d=Nh(i,n,cx,null,null,a),Xa._currentValue=d),Al(i,n),Le(i,n,c,a),n.child;case 6:return i===null&&zt&&((i=a=ie)&&(a=Zx(a,n.pendingProps,Fi),a!==null?(n.stateNode=a,Oe=n,ie=null,i=!0):i=!1),i||Zs(n)),null;case 13:return nm(i,n,a);case 4:return Ke(n,n.stateNode.containerInfo),c=n.pendingProps,i===null?n.child=Nn(n,null,c,a):Le(i,n,c,a),n.child;case 11:return Zg(i,n,n.type,n.pendingProps,a);case 7:return Le(i,n,n.pendingProps,a),n.child;case 8:return Le(i,n,n.pendingProps.children,a),n.child;case 12:return Le(i,n,n.pendingProps.children,a),n.child;case 10:return c=n.pendingProps,Ws(n,n.type,c.value),Le(i,n,c.children,a),n.child;case 9:return d=n.type._context,c=n.pendingProps.children,On(n),d=Ue(d),c=c(d),n.flags|=1,Le(i,n,c,a),n.child;case 14:return Wg(i,n,n.type,n.pendingProps,a);case 15:return Jg(i,n,n.type,n.pendingProps,a);case 19:return am(i,n,a);case 31:return _x(i,n,a);case 22:return Kg(i,n,a,n.pendingProps);case 24:return On(n),c=Ue(ve),i===null?(d=Mh(),d===null&&(d=Wt,p=Dh(),d.pooledCache=p,p.refCount++,p!==null&&(d.pooledCacheLanes|=a),d=p),n.memoizedState={parent:c,cache:d},Bh(n),Ws(n,ve,d)):((i.lanes&a)!==0&&(Ih(i,n),Da(n,null,null,a),Ea()),d=i.memoizedState,p=n.memoizedState,d.parent!==c?(d={parent:c,cache:c},n.memoizedState=d,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=d),Ws(n,ve,c)):(c=p.cache,Ws(n,ve,c),c!==d.cache&&Eh(n,[ve],a,!0))),Le(i,n,n.pendingProps.children,a),n.child;case 29:throw n.pendingProps}throw Error(s(156,n.tag))}function Cs(i){i.flags|=4}function pu(i,n,a,c,d){if((n=(i.mode&32)!==0)&&(n=!1),n){if(i.flags|=16777216,(d&335544128)===d)if(i.stateNode.complete)i.flags|=8192;else if(km())i.flags|=8192;else throw Fn=sl,Ph}else i.flags&=-16777217}function lm(i,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!w_(n))if(km())i.flags|=8192;else throw Fn=sl,Ph}function vl(i,n){n!==null&&(i.flags|=4),i.flags&16384&&(n=i.tag!==22?Hf():536870912,i.lanes|=n,kr|=n)}function ka(i,n){if(!zt)switch(i.tailMode){case"hidden":n=i.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?i.tail=null:a.sibling=null;break;case"collapsed":a=i.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?n||i.tail===null?i.tail=null:i.tail.sibling=null:c.sibling=null}}function se(i){var n=i.alternate!==null&&i.alternate.child===i.child,a=0,c=0;if(n)for(var d=i.child;d!==null;)a|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=i,d=d.sibling;else for(d=i.child;d!==null;)a|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=i,d=d.sibling;return i.subtreeFlags|=c,i.childLanes=a,n}function yx(i,n,a){var c=n.pendingProps;switch(bh(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return se(n),null;case 1:return se(n),null;case 3:return a=n.stateNode,c=null,i!==null&&(c=i.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),vs(ve),fe(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(i===null||i.child===null)&&(xr(n)?Cs(n):i===null||i.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Ch())),se(n),null;case 26:var d=n.type,p=n.memoizedState;return i===null?(Cs(n),p!==null?(se(n),lm(n,p)):(se(n),pu(n,d,null,c,a))):p?p!==i.memoizedState?(Cs(n),se(n),lm(n,p)):(se(n),n.flags&=-16777217):(i=i.memoizedProps,i!==c&&Cs(n),se(n),pu(n,d,i,c,a)),null;case 27:if(Po(n),a=St.current,d=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&Cs(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return se(n),null}i=lt.current,xr(n)?Hp(n):(i=g_(d,c,a),n.stateNode=i,Cs(n))}return se(n),null;case 5:if(Po(n),d=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&Cs(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return se(n),null}if(p=lt.current,xr(n))Hp(n);else{var _=zl(St.current);switch(p){case 1:p=_.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:p=_.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":p=_.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":p=_.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":p=_.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof c.is=="string"?_.createElement("select",{is:c.is}):_.createElement("select"),c.multiple?p.multiple=!0:c.size&&(p.size=c.size);break;default:p=typeof c.is=="string"?_.createElement(d,{is:c.is}):_.createElement(d)}}p[ze]=n,p[ri]=c;t:for(_=n.child;_!==null;){if(_.tag===5||_.tag===6)p.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===n)break t;for(;_.sibling===null;){if(_.return===null||_.return===n)break t;_=_.return}_.sibling.return=_.return,_=_.sibling}n.stateNode=p;t:switch(Fe(p,d,c),d){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break t;case"img":c=!0;break t;default:c=!1}c&&Cs(n)}}return se(n),pu(n,n.type,i===null?null:i.memoizedProps,n.pendingProps,a),null;case 6:if(i&&n.stateNode!=null)i.memoizedProps!==c&&Cs(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(s(166));if(i=St.current,xr(n)){if(i=n.stateNode,a=n.memoizedProps,c=null,d=Oe,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}i[ze]=n,i=!!(i.nodeValue===a||c!==null&&c.suppressHydrationWarning===!0||n_(i.nodeValue,a)),i||Zs(n,!0)}else i=zl(i).createTextNode(c),i[ze]=n,n.stateNode=i}return se(n),null;case 31:if(a=n.memoizedState,i===null||i.memoizedState!==null){if(c=xr(n),a!==null){if(i===null){if(!c)throw Error(s(318));if(i=n.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(557));i[ze]=n}else kn(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;se(n),i=!1}else a=Ch(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=a),i=!0;if(!i)return n.flags&256?(Ci(n),n):(Ci(n),null);if((n.flags&128)!==0)throw Error(s(558))}return se(n),null;case 13:if(c=n.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(d=xr(n),c!==null&&c.dehydrated!==null){if(i===null){if(!d)throw Error(s(318));if(d=n.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));d[ze]=n}else kn(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;se(n),d=!1}else d=Ch(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=d),d=!0;if(!d)return n.flags&256?(Ci(n),n):(Ci(n),null)}return Ci(n),(n.flags&128)!==0?(n.lanes=a,n):(a=c!==null,i=i!==null&&i.memoizedState!==null,a&&(c=n.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==d&&(c.flags|=2048)),a!==i&&a&&(n.child.flags|=8192),vl(n,n.updateQueue),se(n),null);case 4:return fe(),i===null&&Ou(n.stateNode.containerInfo),se(n),null;case 10:return vs(n.type),se(n),null;case 19:if(j(pe),c=n.memoizedState,c===null)return se(n),null;if(d=(n.flags&128)!==0,p=c.rendering,p===null)if(d)ka(c,!1);else{if(le!==0||i!==null&&(i.flags&128)!==0)for(i=n.child;i!==null;){if(p=ol(i),p!==null){for(n.flags|=128,ka(c,!1),i=p.updateQueue,n.updateQueue=i,vl(n,i),n.subtreeFlags=0,i=a,a=n.child;a!==null;)Op(a,i),a=a.sibling;return nt(pe,pe.current&1|2),zt&&As(n,c.treeForkCount),n.child}i=i.sibling}c.tail!==null&&Ai()>Sl&&(n.flags|=128,d=!0,ka(c,!1),n.lanes=4194304)}else{if(!d)if(i=ol(p),i!==null){if(n.flags|=128,d=!0,i=i.updateQueue,n.updateQueue=i,vl(n,i),ka(c,!0),c.tail===null&&c.tailMode==="hidden"&&!p.alternate&&!zt)return se(n),null}else 2*Ai()-c.renderingStartTime>Sl&&a!==536870912&&(n.flags|=128,d=!0,ka(c,!1),n.lanes=4194304);c.isBackwards?(p.sibling=n.child,n.child=p):(i=c.last,i!==null?i.sibling=p:n.child=p,c.last=p)}return c.tail!==null?(i=c.tail,c.rendering=i,c.tail=i.sibling,c.renderingStartTime=Ai(),i.sibling=null,a=pe.current,nt(pe,d?a&1|2:a&1),zt&&As(n,c.treeForkCount),i):(se(n),null);case 22:case 23:return Ci(n),Uh(),c=n.memoizedState!==null,i!==null?i.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(a&536870912)!==0&&(n.flags&128)===0&&(se(n),n.subtreeFlags&6&&(n.flags|=8192)):se(n),a=n.updateQueue,a!==null&&vl(n,a.retryQueue),a=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==a&&(n.flags|=2048),i!==null&&j(Un),null;case 24:return a=null,i!==null&&(a=i.memoizedState.cache),n.memoizedState.cache!==a&&(n.flags|=2048),vs(ve),se(n),null;case 25:return null;case 30:return null}throw Error(s(156,n.tag))}function vx(i,n){switch(bh(n),n.tag){case 1:return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 3:return vs(ve),fe(),i=n.flags,(i&65536)!==0&&(i&128)===0?(n.flags=i&-65537|128,n):null;case 26:case 27:case 5:return Po(n),null;case 31:if(n.memoizedState!==null){if(Ci(n),n.alternate===null)throw Error(s(340));kn()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 13:if(Ci(n),i=n.memoizedState,i!==null&&i.dehydrated!==null){if(n.alternate===null)throw Error(s(340));kn()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 19:return j(pe),null;case 4:return fe(),null;case 10:return vs(n.type),null;case 22:case 23:return Ci(n),Uh(),i!==null&&j(Un),i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 24:return vs(ve),null;case 25:return null;default:return null}}function cm(i,n){switch(bh(n),n.tag){case 3:vs(ve),fe();break;case 26:case 27:case 5:Po(n);break;case 4:fe();break;case 31:n.memoizedState!==null&&Ci(n);break;case 13:Ci(n);break;case 19:j(pe);break;case 10:vs(n.type);break;case 22:case 23:Ci(n),Uh(),i!==null&&j(Un);break;case 24:vs(ve)}}function za(i,n){try{var a=n.updateQueue,c=a!==null?a.lastEffect:null;if(c!==null){var d=c.next;a=d;do{if((a.tag&i)===i){c=void 0;var p=a.create,_=a.inst;c=p(),_.destroy=c}a=a.next}while(a!==d)}}catch(v){jt(n,n.return,v)}}function sn(i,n,a){try{var c=n.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var p=d.next;c=p;do{if((c.tag&i)===i){var _=c.inst,v=_.destroy;if(v!==void 0){_.destroy=void 0,d=n;var S=a,H=v;try{H()}catch(q){jt(d,S,q)}}}c=c.next}while(c!==p)}}catch(q){jt(n,n.return,q)}}function hm(i){var n=i.updateQueue;if(n!==null){var a=i.stateNode;try{tg(n,a)}catch(c){jt(i,i.return,c)}}}function um(i,n,a){a.props=Gn(i.type,i.memoizedProps),a.state=i.memoizedState;try{a.componentWillUnmount()}catch(c){jt(i,n,c)}}function Oa(i,n){try{var a=i.ref;if(a!==null){switch(i.tag){case 26:case 27:case 5:var c=i.stateNode;break;case 30:c=i.stateNode;break;default:c=i.stateNode}typeof a=="function"?i.refCleanup=a(c):a.current=c}}catch(d){jt(i,n,d)}}function ss(i,n){var a=i.ref,c=i.refCleanup;if(a!==null)if(typeof c=="function")try{c()}catch(d){jt(i,n,d)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(d){jt(i,n,d)}else a.current=null}function dm(i){var n=i.type,a=i.memoizedProps,c=i.stateNode;try{t:switch(n){case"button":case"input":case"select":case"textarea":a.autoFocus&&c.focus();break t;case"img":a.src?c.src=a.src:a.srcSet&&(c.srcset=a.srcSet)}}catch(d){jt(i,i.return,d)}}function gu(i,n,a){try{var c=i.stateNode;Gx(c,i.type,a,n),c[ri]=n}catch(d){jt(i,i.return,d)}}function fm(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&hn(i.type)||i.tag===4}function mu(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||fm(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&hn(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function _u(i,n,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(i,n):(n=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,n.appendChild(i),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=gs));else if(c!==4&&(c===27&&hn(i.type)&&(a=i.stateNode,n=null),i=i.child,i!==null))for(_u(i,n,a),i=i.sibling;i!==null;)_u(i,n,a),i=i.sibling}function xl(i,n,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?a.insertBefore(i,n):a.appendChild(i);else if(c!==4&&(c===27&&hn(i.type)&&(a=i.stateNode),i=i.child,i!==null))for(xl(i,n,a),i=i.sibling;i!==null;)xl(i,n,a),i=i.sibling}function pm(i){var n=i.stateNode,a=i.memoizedProps;try{for(var c=i.type,d=n.attributes;d.length;)n.removeAttributeNode(d[0]);Fe(n,c,a),n[ze]=i,n[ri]=a}catch(p){jt(i,i.return,p)}}var Ss=!1,we=!1,Au=!1,gm=typeof WeakSet=="function"?WeakSet:Set,Pe=null;function xx(i,n){if(i=i.containerInfo,Fu=Gl,i=Ep(i),uh(i)){if("selectionStart"in i)var a={start:i.selectionStart,end:i.selectionEnd};else t:{a=(a=i.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var d=c.anchorOffset,p=c.focusNode;c=c.focusOffset;try{a.nodeType,p.nodeType}catch{a=null;break t}var _=0,v=-1,S=-1,H=0,q=0,J=i,Q=null;e:for(;;){for(var V;J!==a||d!==0&&J.nodeType!==3||(v=_+d),J!==p||c!==0&&J.nodeType!==3||(S=_+c),J.nodeType===3&&(_+=J.nodeValue.length),(V=J.firstChild)!==null;)Q=J,J=V;for(;;){if(J===i)break e;if(Q===a&&++H===d&&(v=_),Q===p&&++q===c&&(S=_),(V=J.nextSibling)!==null)break;J=Q,Q=J.parentNode}J=V}a=v===-1||S===-1?null:{start:v,end:S}}else a=null}a=a||{start:0,end:0}}else a=null;for(Nu={focusedElem:i,selectionRange:a},Gl=!1,Pe=n;Pe!==null;)if(n=Pe,i=n.child,(n.subtreeFlags&1028)!==0&&i!==null)i.return=n,Pe=i;else for(;Pe!==null;){switch(n=Pe,p=n.alternate,i=n.flags,n.tag){case 0:if((i&4)!==0&&(i=n.updateQueue,i=i!==null?i.events:null,i!==null))for(a=0;a<i.length;a++)d=i[a],d.ref.impl=d.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&p!==null){i=void 0,a=n,d=p.memoizedProps,p=p.memoizedState,c=a.stateNode;try{var ct=Gn(a.type,d);i=c.getSnapshotBeforeUpdate(ct,p),c.__reactInternalSnapshotBeforeUpdate=i}catch(pt){jt(a,a.return,pt)}}break;case 3:if((i&1024)!==0){if(i=n.stateNode.containerInfo,a=i.nodeType,a===9)Qu(i);else if(a===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Qu(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=n.sibling,i!==null){i.return=n.return,Pe=i;break}Pe=n.return}}function mm(i,n,a){var c=a.flags;switch(a.tag){case 0:case 11:case 15:Es(i,a),c&4&&za(5,a);break;case 1:if(Es(i,a),c&4)if(i=a.stateNode,n===null)try{i.componentDidMount()}catch(_){jt(a,a.return,_)}else{var d=Gn(a.type,n.memoizedProps);n=n.memoizedState;try{i.componentDidUpdate(d,n,i.__reactInternalSnapshotBeforeUpdate)}catch(_){jt(a,a.return,_)}}c&64&&hm(a),c&512&&Oa(a,a.return);break;case 3:if(Es(i,a),c&64&&(i=a.updateQueue,i!==null)){if(n=null,a.child!==null)switch(a.child.tag){case 27:case 5:n=a.child.stateNode;break;case 1:n=a.child.stateNode}try{tg(i,n)}catch(_){jt(a,a.return,_)}}break;case 27:n===null&&c&4&&pm(a);case 26:case 5:Es(i,a),n===null&&c&4&&dm(a),c&512&&Oa(a,a.return);break;case 12:Es(i,a);break;case 31:Es(i,a),c&4&&ym(i,a);break;case 13:Es(i,a),c&4&&vm(i,a),c&64&&(i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(a=Mx.bind(null,a),Wx(i,a))));break;case 22:if(c=a.memoizedState!==null||Ss,!c){n=n!==null&&n.memoizedState!==null||we,d=Ss;var p=we;Ss=c,(we=n)&&!p?Ds(i,a,(a.subtreeFlags&8772)!==0):Es(i,a),Ss=d,we=p}break;case 30:break;default:Es(i,a)}}function _m(i){var n=i.alternate;n!==null&&(i.alternate=null,_m(n)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(n=i.stateNode,n!==null&&Xc(n)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var re=null,oi=!1;function Ts(i,n,a){for(a=a.child;a!==null;)Am(i,n,a),a=a.sibling}function Am(i,n,a){if(yi&&typeof yi.onCommitFiberUnmount=="function")try{yi.onCommitFiberUnmount(aa,a)}catch{}switch(a.tag){case 26:we||ss(a,n),Ts(i,n,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:we||ss(a,n);var c=re,d=oi;hn(a.type)&&(re=a.stateNode,oi=!1),Ts(i,n,a),Va(a.stateNode),re=c,oi=d;break;case 5:we||ss(a,n);case 6:if(c=re,d=oi,re=null,Ts(i,n,a),re=c,oi=d,re!==null)if(oi)try{(re.nodeType===9?re.body:re.nodeName==="HTML"?re.ownerDocument.body:re).removeChild(a.stateNode)}catch(p){jt(a,n,p)}else try{re.removeChild(a.stateNode)}catch(p){jt(a,n,p)}break;case 18:re!==null&&(oi?(i=re,h_(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,a.stateNode),Gr(i)):h_(re,a.stateNode));break;case 4:c=re,d=oi,re=a.stateNode.containerInfo,oi=!0,Ts(i,n,a),re=c,oi=d;break;case 0:case 11:case 14:case 15:sn(2,a,n),we||sn(4,a,n),Ts(i,n,a);break;case 1:we||(ss(a,n),c=a.stateNode,typeof c.componentWillUnmount=="function"&&um(a,n,c)),Ts(i,n,a);break;case 21:Ts(i,n,a);break;case 22:we=(c=we)||a.memoizedState!==null,Ts(i,n,a),we=c;break;default:Ts(i,n,a)}}function ym(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Gr(i)}catch(a){jt(n,n.return,a)}}}function vm(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Gr(i)}catch(a){jt(n,n.return,a)}}function bx(i){switch(i.tag){case 31:case 13:case 19:var n=i.stateNode;return n===null&&(n=i.stateNode=new gm),n;case 22:return i=i.stateNode,n=i._retryCache,n===null&&(n=i._retryCache=new gm),n;default:throw Error(s(435,i.tag))}}function bl(i,n){var a=bx(i);n.forEach(function(c){if(!a.has(c)){a.add(c);var d=Px.bind(null,i,c);c.then(d,d)}})}function li(i,n){var a=n.deletions;if(a!==null)for(var c=0;c<a.length;c++){var d=a[c],p=i,_=n,v=_;t:for(;v!==null;){switch(v.tag){case 27:if(hn(v.type)){re=v.stateNode,oi=!1;break t}break;case 5:re=v.stateNode,oi=!1;break t;case 3:case 4:re=v.stateNode.containerInfo,oi=!0;break t}v=v.return}if(re===null)throw Error(s(160));Am(p,_,d),re=null,oi=!1,p=d.alternate,p!==null&&(p.return=null),d.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)xm(n,i),n=n.sibling}var Xi=null;function xm(i,n){var a=i.alternate,c=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:li(n,i),ci(i),c&4&&(sn(3,i,i.return),za(3,i),sn(5,i,i.return));break;case 1:li(n,i),ci(i),c&512&&(we||a===null||ss(a,a.return)),c&64&&Ss&&(i=i.updateQueue,i!==null&&(c=i.callbacks,c!==null&&(a=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=a===null?c:a.concat(c))));break;case 26:var d=Xi;if(li(n,i),ci(i),c&512&&(we||a===null||ss(a,a.return)),c&4){var p=a!==null?a.memoizedState:null;if(c=i.memoizedState,a===null)if(c===null)if(i.stateNode===null){t:{c=i.type,a=i.memoizedProps,d=d.ownerDocument||d;e:switch(c){case"title":p=d.getElementsByTagName("title")[0],(!p||p[ca]||p[ze]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=d.createElement(c),d.head.insertBefore(p,d.querySelector("head > title"))),Fe(p,c,a),p[ze]=i,Me(p),c=p;break t;case"link":var _=x_("link","href",d).get(c+(a.href||""));if(_){for(var v=0;v<_.length;v++)if(p=_[v],p.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&p.getAttribute("rel")===(a.rel==null?null:a.rel)&&p.getAttribute("title")===(a.title==null?null:a.title)&&p.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){_.splice(v,1);break e}}p=d.createElement(c),Fe(p,c,a),d.head.appendChild(p);break;case"meta":if(_=x_("meta","content",d).get(c+(a.content||""))){for(v=0;v<_.length;v++)if(p=_[v],p.getAttribute("content")===(a.content==null?null:""+a.content)&&p.getAttribute("name")===(a.name==null?null:a.name)&&p.getAttribute("property")===(a.property==null?null:a.property)&&p.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&p.getAttribute("charset")===(a.charSet==null?null:a.charSet)){_.splice(v,1);break e}}p=d.createElement(c),Fe(p,c,a),d.head.appendChild(p);break;default:throw Error(s(468,c))}p[ze]=i,Me(p),c=p}i.stateNode=c}else b_(d,i.type,i.stateNode);else i.stateNode=v_(d,c,i.memoizedProps);else p!==c?(p===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):p.count--,c===null?b_(d,i.type,i.stateNode):v_(d,c,i.memoizedProps)):c===null&&i.stateNode!==null&&gu(i,i.memoizedProps,a.memoizedProps)}break;case 27:li(n,i),ci(i),c&512&&(we||a===null||ss(a,a.return)),a!==null&&c&4&&gu(i,i.memoizedProps,a.memoizedProps);break;case 5:if(li(n,i),ci(i),c&512&&(we||a===null||ss(a,a.return)),i.flags&32){d=i.stateNode;try{ur(d,"")}catch(ct){jt(i,i.return,ct)}}c&4&&i.stateNode!=null&&(d=i.memoizedProps,gu(i,d,a!==null?a.memoizedProps:d)),c&1024&&(Au=!0);break;case 6:if(li(n,i),ci(i),c&4){if(i.stateNode===null)throw Error(s(162));c=i.memoizedProps,a=i.stateNode;try{a.nodeValue=c}catch(ct){jt(i,i.return,ct)}}break;case 3:if(Ll=null,d=Xi,Xi=Ol(n.containerInfo),li(n,i),Xi=d,ci(i),c&4&&a!==null&&a.memoizedState.isDehydrated)try{Gr(n.containerInfo)}catch(ct){jt(i,i.return,ct)}Au&&(Au=!1,bm(i));break;case 4:c=Xi,Xi=Ol(i.stateNode.containerInfo),li(n,i),ci(i),Xi=c;break;case 12:li(n,i),ci(i);break;case 31:li(n,i),ci(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,bl(i,c)));break;case 13:li(n,i),ci(i),i.child.flags&8192&&i.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Cl=Ai()),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,bl(i,c)));break;case 22:d=i.memoizedState!==null;var S=a!==null&&a.memoizedState!==null,H=Ss,q=we;if(Ss=H||d,we=q||S,li(n,i),we=q,Ss=H,ci(i),c&8192)t:for(n=i.stateNode,n._visibility=d?n._visibility&-2:n._visibility|1,d&&(a===null||S||Ss||we||Qn(i)),a=null,n=i;;){if(n.tag===5||n.tag===26){if(a===null){S=a=n;try{if(p=S.stateNode,d)_=p.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{v=S.stateNode;var J=S.memoizedProps.style,Q=J!=null&&J.hasOwnProperty("display")?J.display:null;v.style.display=Q==null||typeof Q=="boolean"?"":(""+Q).trim()}}catch(ct){jt(S,S.return,ct)}}}else if(n.tag===6){if(a===null){S=n;try{S.stateNode.nodeValue=d?"":S.memoizedProps}catch(ct){jt(S,S.return,ct)}}}else if(n.tag===18){if(a===null){S=n;try{var V=S.stateNode;d?u_(V,!0):u_(S.stateNode,!1)}catch(ct){jt(S,S.return,ct)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===i)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break t;for(;n.sibling===null;){if(n.return===null||n.return===i)break t;a===n&&(a=null),n=n.return}a===n&&(a=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=i.updateQueue,c!==null&&(a=c.retryQueue,a!==null&&(c.retryQueue=null,bl(i,a))));break;case 19:li(n,i),ci(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,bl(i,c)));break;case 30:break;case 21:break;default:li(n,i),ci(i)}}function ci(i){var n=i.flags;if(n&2){try{for(var a,c=i.return;c!==null;){if(fm(c)){a=c;break}c=c.return}if(a==null)throw Error(s(160));switch(a.tag){case 27:var d=a.stateNode,p=mu(i);xl(i,p,d);break;case 5:var _=a.stateNode;a.flags&32&&(ur(_,""),a.flags&=-33);var v=mu(i);xl(i,v,_);break;case 3:case 4:var S=a.stateNode.containerInfo,H=mu(i);_u(i,H,S);break;default:throw Error(s(161))}}catch(q){jt(i,i.return,q)}i.flags&=-3}n&4096&&(i.flags&=-4097)}function bm(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var n=i;bm(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),i=i.sibling}}function Es(i,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)mm(i,n.alternate,n),n=n.sibling}function Qn(i){for(i=i.child;i!==null;){var n=i;switch(n.tag){case 0:case 11:case 14:case 15:sn(4,n,n.return),Qn(n);break;case 1:ss(n,n.return);var a=n.stateNode;typeof a.componentWillUnmount=="function"&&um(n,n.return,a),Qn(n);break;case 27:Va(n.stateNode);case 26:case 5:ss(n,n.return),Qn(n);break;case 22:n.memoizedState===null&&Qn(n);break;case 30:Qn(n);break;default:Qn(n)}i=i.sibling}}function Ds(i,n,a){for(a=a&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,d=i,p=n,_=p.flags;switch(p.tag){case 0:case 11:case 15:Ds(d,p,a),za(4,p);break;case 1:if(Ds(d,p,a),c=p,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(H){jt(c,c.return,H)}if(c=p,d=c.updateQueue,d!==null){var v=c.stateNode;try{var S=d.shared.hiddenCallbacks;if(S!==null)for(d.shared.hiddenCallbacks=null,d=0;d<S.length;d++)$p(S[d],v)}catch(H){jt(c,c.return,H)}}a&&_&64&&hm(p),Oa(p,p.return);break;case 27:pm(p);case 26:case 5:Ds(d,p,a),a&&c===null&&_&4&&dm(p),Oa(p,p.return);break;case 12:Ds(d,p,a);break;case 31:Ds(d,p,a),a&&_&4&&ym(d,p);break;case 13:Ds(d,p,a),a&&_&4&&vm(d,p);break;case 22:p.memoizedState===null&&Ds(d,p,a),Oa(p,p.return);break;case 30:break;default:Ds(d,p,a)}n=n.sibling}}function yu(i,n){var a=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),i=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(i=n.memoizedState.cachePool.pool),i!==a&&(i!=null&&i.refCount++,a!=null&&ba(a))}function vu(i,n){i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&ba(i))}function Zi(i,n,a,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)wm(i,n,a,c),n=n.sibling}function wm(i,n,a,c){var d=n.flags;switch(n.tag){case 0:case 11:case 15:Zi(i,n,a,c),d&2048&&za(9,n);break;case 1:Zi(i,n,a,c);break;case 3:Zi(i,n,a,c),d&2048&&(i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&ba(i)));break;case 12:if(d&2048){Zi(i,n,a,c),i=n.stateNode;try{var p=n.memoizedProps,_=p.id,v=p.onPostCommit;typeof v=="function"&&v(_,n.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(S){jt(n,n.return,S)}}else Zi(i,n,a,c);break;case 31:Zi(i,n,a,c);break;case 13:Zi(i,n,a,c);break;case 23:break;case 22:p=n.stateNode,_=n.alternate,n.memoizedState!==null?p._visibility&2?Zi(i,n,a,c):Ua(i,n):p._visibility&2?Zi(i,n,a,c):(p._visibility|=2,Pr(i,n,a,c,(n.subtreeFlags&10256)!==0||!1)),d&2048&&yu(_,n);break;case 24:Zi(i,n,a,c),d&2048&&vu(n.alternate,n);break;default:Zi(i,n,a,c)}}function Pr(i,n,a,c,d){for(d=d&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var p=i,_=n,v=a,S=c,H=_.flags;switch(_.tag){case 0:case 11:case 15:Pr(p,_,v,S,d),za(8,_);break;case 23:break;case 22:var q=_.stateNode;_.memoizedState!==null?q._visibility&2?Pr(p,_,v,S,d):Ua(p,_):(q._visibility|=2,Pr(p,_,v,S,d)),d&&H&2048&&yu(_.alternate,_);break;case 24:Pr(p,_,v,S,d),d&&H&2048&&vu(_.alternate,_);break;default:Pr(p,_,v,S,d)}n=n.sibling}}function Ua(i,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var a=i,c=n,d=c.flags;switch(c.tag){case 22:Ua(a,c),d&2048&&yu(c.alternate,c);break;case 24:Ua(a,c),d&2048&&vu(c.alternate,c);break;default:Ua(a,c)}n=n.sibling}}var La=8192;function Br(i,n,a){if(i.subtreeFlags&La)for(i=i.child;i!==null;)Cm(i,n,a),i=i.sibling}function Cm(i,n,a){switch(i.tag){case 26:Br(i,n,a),i.flags&La&&i.memoizedState!==null&&lb(a,Xi,i.memoizedState,i.memoizedProps);break;case 5:Br(i,n,a);break;case 3:case 4:var c=Xi;Xi=Ol(i.stateNode.containerInfo),Br(i,n,a),Xi=c;break;case 22:i.memoizedState===null&&(c=i.alternate,c!==null&&c.memoizedState!==null?(c=La,La=16777216,Br(i,n,a),La=c):Br(i,n,a));break;default:Br(i,n,a)}}function Sm(i){var n=i.alternate;if(n!==null&&(i=n.child,i!==null)){n.child=null;do n=i.sibling,i.sibling=null,i=n;while(i!==null)}}function Fa(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var c=n[a];Pe=c,Em(c,i)}Sm(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Tm(i),i=i.sibling}function Tm(i){switch(i.tag){case 0:case 11:case 15:Fa(i),i.flags&2048&&sn(9,i,i.return);break;case 3:Fa(i);break;case 12:Fa(i);break;case 22:var n=i.stateNode;i.memoizedState!==null&&n._visibility&2&&(i.return===null||i.return.tag!==13)?(n._visibility&=-3,wl(i)):Fa(i);break;default:Fa(i)}}function wl(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var c=n[a];Pe=c,Em(c,i)}Sm(i)}for(i=i.child;i!==null;){switch(n=i,n.tag){case 0:case 11:case 15:sn(8,n,n.return),wl(n);break;case 22:a=n.stateNode,a._visibility&2&&(a._visibility&=-3,wl(n));break;default:wl(n)}i=i.sibling}}function Em(i,n){for(;Pe!==null;){var a=Pe;switch(a.tag){case 0:case 11:case 15:sn(8,a,n);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var c=a.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:ba(a.memoizedState.cache)}if(c=a.child,c!==null)c.return=a,Pe=c;else t:for(a=i;Pe!==null;){c=Pe;var d=c.sibling,p=c.return;if(_m(c),c===a){Pe=null;break t}if(d!==null){d.return=p,Pe=d;break t}Pe=p}}}var wx={getCacheForType:function(i){var n=Ue(ve),a=n.data.get(i);return a===void 0&&(a=i(),n.data.set(i,a)),a},cacheSignal:function(){return Ue(ve).controller.signal}},Cx=typeof WeakMap=="function"?WeakMap:Map,Ht=0,Wt=null,Mt=null,It=0,Qt=0,Si=null,nn=!1,Ir=!1,xu=!1,Rs=0,le=0,rn=0,jn=0,bu=0,Ti=0,kr=0,Na=null,hi=null,wu=!1,Cl=0,Dm=0,Sl=1/0,Tl=null,an=null,Ee=0,on=null,zr=null,Ms=0,Cu=0,Su=null,Rm=null,Ha=0,Tu=null;function Ei(){return(Ht&2)!==0&&It!==0?It&-It:T.T!==null?Bu():Vf()}function Mm(){if(Ti===0)if((It&536870912)===0||zt){var i=ko;ko<<=1,(ko&3932160)===0&&(ko=262144),Ti=i}else Ti=536870912;return i=wi.current,i!==null&&(i.flags|=32),Ti}function ui(i,n,a){(i===Wt&&(Qt===2||Qt===9)||i.cancelPendingCommit!==null)&&(Or(i,0),ln(i,It,Ti,!1)),la(i,a),((Ht&2)===0||i!==Wt)&&(i===Wt&&((Ht&2)===0&&(jn|=a),le===4&&ln(i,It,Ti,!1)),ns(i))}function Pm(i,n,a){if((Ht&6)!==0)throw Error(s(327));var c=!a&&(n&127)===0&&(n&i.expiredLanes)===0||oa(i,n),d=c?Ex(i,n):Du(i,n,!0),p=c;do{if(d===0){Ir&&!c&&ln(i,n,0,!1);break}else{if(a=i.current.alternate,p&&!Sx(a)){d=Du(i,n,!1),p=!1;continue}if(d===2){if(p=n,i.errorRecoveryDisabledLanes&p)var _=0;else _=i.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){n=_;t:{var v=i;d=Na;var S=v.current.memoizedState.isDehydrated;if(S&&(Or(v,_).flags|=256),_=Du(v,_,!1),_!==2){if(xu&&!S){v.errorRecoveryDisabledLanes|=p,jn|=p,d=4;break t}p=hi,hi=d,p!==null&&(hi===null?hi=p:hi.push.apply(hi,p))}d=_}if(p=!1,d!==2)continue}}if(d===1){Or(i,0),ln(i,n,0,!0);break}t:{switch(c=i,p=d,p){case 0:case 1:throw Error(s(345));case 4:if((n&4194048)!==n)break;case 6:ln(c,n,Ti,!nn);break t;case 2:hi=null;break;case 3:case 5:break;default:throw Error(s(329))}if((n&62914560)===n&&(d=Cl+300-Ai(),10<d)){if(ln(c,n,Ti,!nn),Oo(c,0,!0)!==0)break t;Ms=n,c.timeoutHandle=l_(Bm.bind(null,c,a,hi,Tl,wu,n,Ti,jn,kr,nn,p,"Throttled",-0,0),d);break t}Bm(c,a,hi,Tl,wu,n,Ti,jn,kr,nn,p,null,-0,0)}}break}while(!0);ns(i)}function Bm(i,n,a,c,d,p,_,v,S,H,q,J,Q,V){if(i.timeoutHandle=-1,J=n.subtreeFlags,J&8192||(J&16785408)===16785408){J={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:gs},Cm(n,p,J);var ct=(p&62914560)===p?Cl-Ai():(p&4194048)===p?Dm-Ai():0;if(ct=cb(J,ct),ct!==null){Ms=p,i.cancelPendingCommit=ct(Nm.bind(null,i,n,p,a,c,d,_,v,S,q,J,null,Q,V)),ln(i,p,_,!H);return}}Nm(i,n,p,a,c,d,_,v,S)}function Sx(i){for(var n=i;;){var a=n.tag;if((a===0||a===11||a===15)&&n.flags&16384&&(a=n.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var c=0;c<a.length;c++){var d=a[c],p=d.getSnapshot;d=d.value;try{if(!xi(p(),d))return!1}catch{return!1}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function ln(i,n,a,c){n&=~bu,n&=~jn,i.suspendedLanes|=n,i.pingedLanes&=~n,c&&(i.warmLanes|=n),c=i.expirationTimes;for(var d=n;0<d;){var p=31-vi(d),_=1<<p;c[p]=-1,d&=~_}a!==0&&Gf(i,a,n)}function El(){return(Ht&6)===0?(Ga(0),!1):!0}function Eu(){if(Mt!==null){if(Qt===0)var i=Mt.return;else i=Mt,ys=zn=null,Qh(i),Tr=null,Ca=0,i=Mt;for(;i!==null;)cm(i.alternate,i),i=i.return;Mt=null}}function Or(i,n){var a=i.timeoutHandle;a!==-1&&(i.timeoutHandle=-1,Vx(a)),a=i.cancelPendingCommit,a!==null&&(i.cancelPendingCommit=null,a()),Ms=0,Eu(),Wt=i,Mt=a=_s(i.current,null),It=n,Qt=0,Si=null,nn=!1,Ir=oa(i,n),xu=!1,kr=Ti=bu=jn=rn=le=0,hi=Na=null,wu=!1,(n&8)!==0&&(n|=n&32);var c=i.entangledLanes;if(c!==0)for(i=i.entanglements,c&=n;0<c;){var d=31-vi(c),p=1<<d;n|=i[d],c&=~p}return Rs=n,Xo(),a}function Im(i,n){wt=null,T.H=Ba,n===Sr||n===il?(n=Zp(),Qt=3):n===Ph?(n=Zp(),Qt=4):Qt=n===ru?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Si=n,Mt===null&&(le=1,ml(i,Oi(n,i.current)))}function km(){var i=wi.current;return i===null?!0:(It&4194048)===It?Ni===null:(It&62914560)===It||(It&536870912)!==0?i===Ni:!1}function zm(){var i=T.H;return T.H=Ba,i===null?Ba:i}function Om(){var i=T.A;return T.A=wx,i}function Dl(){le=4,nn||(It&4194048)!==It&&wi.current!==null||(Ir=!0),(rn&134217727)===0&&(jn&134217727)===0||Wt===null||ln(Wt,It,Ti,!1)}function Du(i,n,a){var c=Ht;Ht|=2;var d=zm(),p=Om();(Wt!==i||It!==n)&&(Tl=null,Or(i,n)),n=!1;var _=le;t:do try{if(Qt!==0&&Mt!==null){var v=Mt,S=Si;switch(Qt){case 8:Eu(),_=6;break t;case 3:case 2:case 9:case 6:wi.current===null&&(n=!0);var H=Qt;if(Qt=0,Si=null,Ur(i,v,S,H),a&&Ir){_=0;break t}break;default:H=Qt,Qt=0,Si=null,Ur(i,v,S,H)}}Tx(),_=le;break}catch(q){Im(i,q)}while(!0);return n&&i.shellSuspendCounter++,ys=zn=null,Ht=c,T.H=d,T.A=p,Mt===null&&(Wt=null,It=0,Xo()),_}function Tx(){for(;Mt!==null;)Um(Mt)}function Ex(i,n){var a=Ht;Ht|=2;var c=zm(),d=Om();Wt!==i||It!==n?(Tl=null,Sl=Ai()+500,Or(i,n)):Ir=oa(i,n);t:do try{if(Qt!==0&&Mt!==null){n=Mt;var p=Si;e:switch(Qt){case 1:Qt=0,Si=null,Ur(i,n,p,1);break;case 2:case 9:if(qp(p)){Qt=0,Si=null,Lm(n);break}n=function(){Qt!==2&&Qt!==9||Wt!==i||(Qt=7),ns(i)},p.then(n,n);break t;case 3:Qt=7;break t;case 4:Qt=5;break t;case 7:qp(p)?(Qt=0,Si=null,Lm(n)):(Qt=0,Si=null,Ur(i,n,p,7));break;case 5:var _=null;switch(Mt.tag){case 26:_=Mt.memoizedState;case 5:case 27:var v=Mt;if(_?w_(_):v.stateNode.complete){Qt=0,Si=null;var S=v.sibling;if(S!==null)Mt=S;else{var H=v.return;H!==null?(Mt=H,Rl(H)):Mt=null}break e}}Qt=0,Si=null,Ur(i,n,p,5);break;case 6:Qt=0,Si=null,Ur(i,n,p,6);break;case 8:Eu(),le=6;break t;default:throw Error(s(462))}}Dx();break}catch(q){Im(i,q)}while(!0);return ys=zn=null,T.H=c,T.A=d,Ht=a,Mt!==null?0:(Wt=null,It=0,Xo(),le)}function Dx(){for(;Mt!==null&&!Jy();)Um(Mt)}function Um(i){var n=om(i.alternate,i,Rs);i.memoizedProps=i.pendingProps,n===null?Rl(i):Mt=n}function Lm(i){var n=i,a=n.alternate;switch(n.tag){case 15:case 0:n=em(a,n,n.pendingProps,n.type,void 0,It);break;case 11:n=em(a,n,n.pendingProps,n.type.render,n.ref,It);break;case 5:Qh(n);default:cm(a,n),n=Mt=Op(n,Rs),n=om(a,n,Rs)}i.memoizedProps=i.pendingProps,n===null?Rl(i):Mt=n}function Ur(i,n,a,c){ys=zn=null,Qh(n),Tr=null,Ca=0;var d=n.return;try{if(mx(i,d,n,a,It)){le=1,ml(i,Oi(a,i.current)),Mt=null;return}}catch(p){if(d!==null)throw Mt=d,p;le=1,ml(i,Oi(a,i.current)),Mt=null;return}n.flags&32768?(zt||c===1?i=!0:Ir||(It&536870912)!==0?i=!1:(nn=i=!0,(c===2||c===9||c===3||c===6)&&(c=wi.current,c!==null&&c.tag===13&&(c.flags|=16384))),Fm(n,i)):Rl(n)}function Rl(i){var n=i;do{if((n.flags&32768)!==0){Fm(n,nn);return}i=n.return;var a=yx(n.alternate,n,Rs);if(a!==null){Mt=a;return}if(n=n.sibling,n!==null){Mt=n;return}Mt=n=i}while(n!==null);le===0&&(le=5)}function Fm(i,n){do{var a=vx(i.alternate,i);if(a!==null){a.flags&=32767,Mt=a;return}if(a=i.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!n&&(i=i.sibling,i!==null)){Mt=i;return}Mt=i=a}while(i!==null);le=6,Mt=null}function Nm(i,n,a,c,d,p,_,v,S){i.cancelPendingCommit=null;do Ml();while(Ee!==0);if((Ht&6)!==0)throw Error(s(327));if(n!==null){if(n===i.current)throw Error(s(177));if(p=n.lanes|n.childLanes,p|=mh,ov(i,a,p,_,v,S),i===Wt&&(Mt=Wt=null,It=0),zr=n,on=i,Ms=a,Cu=p,Su=d,Rm=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,Bx(Bo,function(){return Vm(),null})):(i.callbackNode=null,i.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=T.T,T.T=null,d=b.p,b.p=2,_=Ht,Ht|=4;try{xx(i,n,a)}finally{Ht=_,b.p=d,T.T=c}}Ee=1,Hm(),Gm(),Qm()}}function Hm(){if(Ee===1){Ee=0;var i=on,n=zr,a=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||a){a=T.T,T.T=null;var c=b.p;b.p=2;var d=Ht;Ht|=4;try{xm(n,i);var p=Nu,_=Ep(i.containerInfo),v=p.focusedElem,S=p.selectionRange;if(_!==v&&v&&v.ownerDocument&&Tp(v.ownerDocument.documentElement,v)){if(S!==null&&uh(v)){var H=S.start,q=S.end;if(q===void 0&&(q=H),"selectionStart"in v)v.selectionStart=H,v.selectionEnd=Math.min(q,v.value.length);else{var J=v.ownerDocument||document,Q=J&&J.defaultView||window;if(Q.getSelection){var V=Q.getSelection(),ct=v.textContent.length,pt=Math.min(S.start,ct),qt=S.end===void 0?pt:Math.min(S.end,ct);!V.extend&&pt>qt&&(_=qt,qt=pt,pt=_);var U=Sp(v,pt),B=Sp(v,qt);if(U&&B&&(V.rangeCount!==1||V.anchorNode!==U.node||V.anchorOffset!==U.offset||V.focusNode!==B.node||V.focusOffset!==B.offset)){var N=J.createRange();N.setStart(U.node,U.offset),V.removeAllRanges(),pt>qt?(V.addRange(N),V.extend(B.node,B.offset)):(N.setEnd(B.node,B.offset),V.addRange(N))}}}}for(J=[],V=v;V=V.parentNode;)V.nodeType===1&&J.push({element:V,left:V.scrollLeft,top:V.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<J.length;v++){var Z=J[v];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}Gl=!!Fu,Nu=Fu=null}finally{Ht=d,b.p=c,T.T=a}}i.current=n,Ee=2}}function Gm(){if(Ee===2){Ee=0;var i=on,n=zr,a=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||a){a=T.T,T.T=null;var c=b.p;b.p=2;var d=Ht;Ht|=4;try{mm(i,n.alternate,n)}finally{Ht=d,b.p=c,T.T=a}}Ee=3}}function Qm(){if(Ee===4||Ee===3){Ee=0,Ky();var i=on,n=zr,a=Ms,c=Rm;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Ee=5:(Ee=0,zr=on=null,jm(i,i.pendingLanes));var d=i.pendingLanes;if(d===0&&(an=null),Yc(a),n=n.stateNode,yi&&typeof yi.onCommitFiberRoot=="function")try{yi.onCommitFiberRoot(aa,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=T.T,d=b.p,b.p=2,T.T=null;try{for(var p=i.onRecoverableError,_=0;_<c.length;_++){var v=c[_];p(v.value,{componentStack:v.stack})}}finally{T.T=n,b.p=d}}(Ms&3)!==0&&Ml(),ns(i),d=i.pendingLanes,(a&261930)!==0&&(d&42)!==0?i===Tu?Ha++:(Ha=0,Tu=i):Ha=0,Ga(0)}}function jm(i,n){(i.pooledCacheLanes&=n)===0&&(n=i.pooledCache,n!=null&&(i.pooledCache=null,ba(n)))}function Ml(){return Hm(),Gm(),Qm(),Vm()}function Vm(){if(Ee!==5)return!1;var i=on,n=Cu;Cu=0;var a=Yc(Ms),c=T.T,d=b.p;try{b.p=32>a?32:a,T.T=null,a=Su,Su=null;var p=on,_=Ms;if(Ee=0,zr=on=null,Ms=0,(Ht&6)!==0)throw Error(s(331));var v=Ht;if(Ht|=4,Tm(p.current),wm(p,p.current,_,a),Ht=v,Ga(0,!1),yi&&typeof yi.onPostCommitFiberRoot=="function")try{yi.onPostCommitFiberRoot(aa,p)}catch{}return!0}finally{b.p=d,T.T=c,jm(i,n)}}function Ym(i,n,a){n=Oi(a,n),n=nu(i.stateNode,n,2),i=$s(i,n,2),i!==null&&(la(i,2),ns(i))}function jt(i,n,a){if(i.tag===3)Ym(i,i,a);else for(;n!==null;){if(n.tag===3){Ym(n,i,a);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(an===null||!an.has(c))){i=Oi(a,i),a=qg(2),c=$s(n,a,2),c!==null&&(Xg(a,c,n,i),la(c,2),ns(c));break}}n=n.return}}function Ru(i,n,a){var c=i.pingCache;if(c===null){c=i.pingCache=new Cx;var d=new Set;c.set(n,d)}else d=c.get(n),d===void 0&&(d=new Set,c.set(n,d));d.has(a)||(xu=!0,d.add(a),i=Rx.bind(null,i,n,a),n.then(i,i))}function Rx(i,n,a){var c=i.pingCache;c!==null&&c.delete(n),i.pingedLanes|=i.suspendedLanes&a,i.warmLanes&=~a,Wt===i&&(It&a)===a&&(le===4||le===3&&(It&62914560)===It&&300>Ai()-Cl?(Ht&2)===0&&Or(i,0):bu|=a,kr===It&&(kr=0)),ns(i)}function qm(i,n){n===0&&(n=Hf()),i=Bn(i,n),i!==null&&(la(i,n),ns(i))}function Mx(i){var n=i.memoizedState,a=0;n!==null&&(a=n.retryLane),qm(i,a)}function Px(i,n){var a=0;switch(i.tag){case 31:case 13:var c=i.stateNode,d=i.memoizedState;d!==null&&(a=d.retryLane);break;case 19:c=i.stateNode;break;case 22:c=i.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(n),qm(i,a)}function Bx(i,n){return Gc(i,n)}var Pl=null,Lr=null,Mu=!1,Bl=!1,Pu=!1,cn=0;function ns(i){i!==Lr&&i.next===null&&(Lr===null?Pl=Lr=i:Lr=Lr.next=i),Bl=!0,Mu||(Mu=!0,kx())}function Ga(i,n){if(!Pu&&Bl){Pu=!0;do for(var a=!1,c=Pl;c!==null;){if(i!==0){var d=c.pendingLanes;if(d===0)var p=0;else{var _=c.suspendedLanes,v=c.pingedLanes;p=(1<<31-vi(42|i)+1)-1,p&=d&~(_&~v),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(a=!0,Jm(c,p))}else p=It,p=Oo(c,c===Wt?p:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(p&3)===0||oa(c,p)||(a=!0,Jm(c,p));c=c.next}while(a);Pu=!1}}function Ix(){Xm()}function Xm(){Bl=Mu=!1;var i=0;cn!==0&&jx()&&(i=cn);for(var n=Ai(),a=null,c=Pl;c!==null;){var d=c.next,p=Zm(c,n);p===0?(c.next=null,a===null?Pl=d:a.next=d,d===null&&(Lr=a)):(a=c,(i!==0||(p&3)!==0)&&(Bl=!0)),c=d}Ee!==0&&Ee!==5||Ga(i),cn!==0&&(cn=0)}function Zm(i,n){for(var a=i.suspendedLanes,c=i.pingedLanes,d=i.expirationTimes,p=i.pendingLanes&-62914561;0<p;){var _=31-vi(p),v=1<<_,S=d[_];S===-1?((v&a)===0||(v&c)!==0)&&(d[_]=av(v,n)):S<=n&&(i.expiredLanes|=v),p&=~v}if(n=Wt,a=It,a=Oo(i,i===n?a:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c=i.callbackNode,a===0||i===n&&(Qt===2||Qt===9)||i.cancelPendingCommit!==null)return c!==null&&c!==null&&Qc(c),i.callbackNode=null,i.callbackPriority=0;if((a&3)===0||oa(i,a)){if(n=a&-a,n===i.callbackPriority)return n;switch(c!==null&&Qc(c),Yc(a)){case 2:case 8:a=Ff;break;case 32:a=Bo;break;case 268435456:a=Nf;break;default:a=Bo}return c=Wm.bind(null,i),a=Gc(a,c),i.callbackPriority=n,i.callbackNode=a,n}return c!==null&&c!==null&&Qc(c),i.callbackPriority=2,i.callbackNode=null,2}function Wm(i,n){if(Ee!==0&&Ee!==5)return i.callbackNode=null,i.callbackPriority=0,null;var a=i.callbackNode;if(Ml()&&i.callbackNode!==a)return null;var c=It;return c=Oo(i,i===Wt?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c===0?null:(Pm(i,c,n),Zm(i,Ai()),i.callbackNode!=null&&i.callbackNode===a?Wm.bind(null,i):null)}function Jm(i,n){if(Ml())return null;Pm(i,n,!0)}function kx(){Yx(function(){(Ht&6)!==0?Gc(Lf,Ix):Xm()})}function Bu(){if(cn===0){var i=wr;i===0&&(i=Io,Io<<=1,(Io&261888)===0&&(Io=256)),cn=i}return cn}function Km(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:No(""+i)}function $m(i,n){var a=n.ownerDocument.createElement("input");return a.name=n.name,a.value=n.value,i.id&&a.setAttribute("form",i.id),n.parentNode.insertBefore(a,n),i=new FormData(i),a.parentNode.removeChild(a),i}function zx(i,n,a,c,d){if(n==="submit"&&a&&a.stateNode===d){var p=Km((d[ri]||null).action),_=c.submitter;_&&(n=(n=_[ri]||null)?Km(n.formAction):_.getAttribute("formAction"),n!==null&&(p=n,_=null));var v=new jo("action","action",null,c,d);i.push({event:v,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(cn!==0){var S=_?$m(d,_):new FormData(d);Kh(a,{pending:!0,data:S,method:d.method,action:p},null,S)}}else typeof p=="function"&&(v.preventDefault(),S=_?$m(d,_):new FormData(d),Kh(a,{pending:!0,data:S,method:d.method,action:p},p,S))},currentTarget:d}]})}}for(var Iu=0;Iu<gh.length;Iu++){var ku=gh[Iu],Ox=ku.toLowerCase(),Ux=ku[0].toUpperCase()+ku.slice(1);qi(Ox,"on"+Ux)}qi(Mp,"onAnimationEnd"),qi(Pp,"onAnimationIteration"),qi(Bp,"onAnimationStart"),qi("dblclick","onDoubleClick"),qi("focusin","onFocus"),qi("focusout","onBlur"),qi($v,"onTransitionRun"),qi(tx,"onTransitionStart"),qi(ex,"onTransitionCancel"),qi(Ip,"onTransitionEnd"),cr("onMouseEnter",["mouseout","mouseover"]),cr("onMouseLeave",["mouseout","mouseover"]),cr("onPointerEnter",["pointerout","pointerover"]),cr("onPointerLeave",["pointerout","pointerover"]),Dn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Dn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Dn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Dn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Dn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Dn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qa));function t_(i,n){n=(n&4)!==0;for(var a=0;a<i.length;a++){var c=i[a],d=c.event;c=c.listeners;t:{var p=void 0;if(n)for(var _=c.length-1;0<=_;_--){var v=c[_],S=v.instance,H=v.currentTarget;if(v=v.listener,S!==p&&d.isPropagationStopped())break t;p=v,d.currentTarget=H;try{p(d)}catch(q){qo(q)}d.currentTarget=null,p=S}else for(_=0;_<c.length;_++){if(v=c[_],S=v.instance,H=v.currentTarget,v=v.listener,S!==p&&d.isPropagationStopped())break t;p=v,d.currentTarget=H;try{p(d)}catch(q){qo(q)}d.currentTarget=null,p=S}}}}function Pt(i,n){var a=n[qc];a===void 0&&(a=n[qc]=new Set);var c=i+"__bubble";a.has(c)||(e_(n,i,2,!1),a.add(c))}function zu(i,n,a){var c=0;n&&(c|=4),e_(a,i,c,n)}var Il="_reactListening"+Math.random().toString(36).slice(2);function Ou(i){if(!i[Il]){i[Il]=!0,Xf.forEach(function(a){a!=="selectionchange"&&(Lx.has(a)||zu(a,!1,i),zu(a,!0,i))});var n=i.nodeType===9?i:i.ownerDocument;n===null||n[Il]||(n[Il]=!0,zu("selectionchange",!1,n))}}function e_(i,n,a,c){switch(M_(n)){case 2:var d=db;break;case 8:d=fb;break;default:d=Ju}a=d.bind(null,n,a,i),d=void 0,!ih||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),c?d!==void 0?i.addEventListener(n,a,{capture:!0,passive:d}):i.addEventListener(n,a,!0):d!==void 0?i.addEventListener(n,a,{passive:d}):i.addEventListener(n,a,!1)}function Uu(i,n,a,c,d){var p=c;if((n&1)===0&&(n&2)===0&&c!==null)t:for(;;){if(c===null)return;var _=c.tag;if(_===3||_===4){var v=c.stateNode.containerInfo;if(v===d)break;if(_===4)for(_=c.return;_!==null;){var S=_.tag;if((S===3||S===4)&&_.stateNode.containerInfo===d)return;_=_.return}for(;v!==null;){if(_=ar(v),_===null)return;if(S=_.tag,S===5||S===6||S===26||S===27){c=p=_;continue t}v=v.parentNode}}c=c.return}ap(function(){var H=p,q=th(a),J=[];t:{var Q=kp.get(i);if(Q!==void 0){var V=jo,ct=i;switch(i){case"keypress":if(Go(a)===0)break t;case"keydown":case"keyup":V=Pv;break;case"focusin":ct="focus",V=ah;break;case"focusout":ct="blur",V=ah;break;case"beforeblur":case"afterblur":V=ah;break;case"click":if(a.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":V=cp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":V=yv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":V=kv;break;case Mp:case Pp:case Bp:V=bv;break;case Ip:V=Ov;break;case"scroll":case"scrollend":V=_v;break;case"wheel":V=Lv;break;case"copy":case"cut":case"paste":V=Cv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":V=up;break;case"toggle":case"beforetoggle":V=Nv}var pt=(n&4)!==0,qt=!pt&&(i==="scroll"||i==="scrollend"),U=pt?Q!==null?Q+"Capture":null:Q;pt=[];for(var B=H,N;B!==null;){var Z=B;if(N=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||N===null||U===null||(Z=ua(B,U),Z!=null&&pt.push(ja(B,Z,N))),qt)break;B=B.return}0<pt.length&&(Q=new V(Q,ct,null,a,q),J.push({event:Q,listeners:pt}))}}if((n&7)===0){t:{if(Q=i==="mouseover"||i==="pointerover",V=i==="mouseout"||i==="pointerout",Q&&a!==$c&&(ct=a.relatedTarget||a.fromElement)&&(ar(ct)||ct[rr]))break t;if((V||Q)&&(Q=q.window===q?q:(Q=q.ownerDocument)?Q.defaultView||Q.parentWindow:window,V?(ct=a.relatedTarget||a.toElement,V=H,ct=ct?ar(ct):null,ct!==null&&(qt=l(ct),pt=ct.tag,ct!==qt||pt!==5&&pt!==27&&pt!==6)&&(ct=null)):(V=null,ct=H),V!==ct)){if(pt=cp,Z="onMouseLeave",U="onMouseEnter",B="mouse",(i==="pointerout"||i==="pointerover")&&(pt=up,Z="onPointerLeave",U="onPointerEnter",B="pointer"),qt=V==null?Q:ha(V),N=ct==null?Q:ha(ct),Q=new pt(Z,B+"leave",V,a,q),Q.target=qt,Q.relatedTarget=N,Z=null,ar(q)===H&&(pt=new pt(U,B+"enter",ct,a,q),pt.target=N,pt.relatedTarget=qt,Z=pt),qt=Z,V&&ct)e:{for(pt=Fx,U=V,B=ct,N=0,Z=U;Z;Z=pt(Z))N++;Z=0;for(var ft=B;ft;ft=pt(ft))Z++;for(;0<N-Z;)U=pt(U),N--;for(;0<Z-N;)B=pt(B),Z--;for(;N--;){if(U===B||B!==null&&U===B.alternate){pt=U;break e}U=pt(U),B=pt(B)}pt=null}else pt=null;V!==null&&i_(J,Q,V,pt,!1),ct!==null&&qt!==null&&i_(J,qt,ct,pt,!0)}}t:{if(Q=H?ha(H):window,V=Q.nodeName&&Q.nodeName.toLowerCase(),V==="select"||V==="input"&&Q.type==="file")var Ft=yp;else if(_p(Q))if(vp)Ft=Wv;else{Ft=Xv;var dt=qv}else V=Q.nodeName,!V||V.toLowerCase()!=="input"||Q.type!=="checkbox"&&Q.type!=="radio"?H&&Kc(H.elementType)&&(Ft=yp):Ft=Zv;if(Ft&&(Ft=Ft(i,H))){Ap(J,Ft,a,q);break t}dt&&dt(i,Q,H),i==="focusout"&&H&&Q.type==="number"&&H.memoizedProps.value!=null&&Jc(Q,"number",Q.value)}switch(dt=H?ha(H):window,i){case"focusin":(_p(dt)||dt.contentEditable==="true")&&(gr=dt,dh=H,ya=null);break;case"focusout":ya=dh=gr=null;break;case"mousedown":fh=!0;break;case"contextmenu":case"mouseup":case"dragend":fh=!1,Dp(J,a,q);break;case"selectionchange":if(Kv)break;case"keydown":case"keyup":Dp(J,a,q)}var Ct;if(lh)t:{switch(i){case"compositionstart":var kt="onCompositionStart";break t;case"compositionend":kt="onCompositionEnd";break t;case"compositionupdate":kt="onCompositionUpdate";break t}kt=void 0}else pr?gp(i,a)&&(kt="onCompositionEnd"):i==="keydown"&&a.keyCode===229&&(kt="onCompositionStart");kt&&(dp&&a.locale!=="ko"&&(pr||kt!=="onCompositionStart"?kt==="onCompositionEnd"&&pr&&(Ct=op()):(Ys=q,sh="value"in Ys?Ys.value:Ys.textContent,pr=!0)),dt=kl(H,kt),0<dt.length&&(kt=new hp(kt,i,null,a,q),J.push({event:kt,listeners:dt}),Ct?kt.data=Ct:(Ct=mp(a),Ct!==null&&(kt.data=Ct)))),(Ct=Gv?Qv(i,a):jv(i,a))&&(kt=kl(H,"onBeforeInput"),0<kt.length&&(dt=new hp("onBeforeInput","beforeinput",null,a,q),J.push({event:dt,listeners:kt}),dt.data=Ct)),zx(J,i,H,a,q)}t_(J,n)})}function ja(i,n,a){return{instance:i,listener:n,currentTarget:a}}function kl(i,n){for(var a=n+"Capture",c=[];i!==null;){var d=i,p=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||p===null||(d=ua(i,a),d!=null&&c.unshift(ja(i,d,p)),d=ua(i,n),d!=null&&c.push(ja(i,d,p))),i.tag===3)return c;i=i.return}return[]}function Fx(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function i_(i,n,a,c,d){for(var p=n._reactName,_=[];a!==null&&a!==c;){var v=a,S=v.alternate,H=v.stateNode;if(v=v.tag,S!==null&&S===c)break;v!==5&&v!==26&&v!==27||H===null||(S=H,d?(H=ua(a,p),H!=null&&_.unshift(ja(a,H,S))):d||(H=ua(a,p),H!=null&&_.push(ja(a,H,S)))),a=a.return}_.length!==0&&i.push({event:n,listeners:_})}var Nx=/\r\n?/g,Hx=/\u0000|\uFFFD/g;function s_(i){return(typeof i=="string"?i:""+i).replace(Nx,`
`).replace(Hx,"")}function n_(i,n){return n=s_(n),s_(i)===n}function Yt(i,n,a,c,d,p){switch(a){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||ur(i,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&ur(i,""+c);break;case"className":Lo(i,"class",c);break;case"tabIndex":Lo(i,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Lo(i,a,c);break;case"style":np(i,c,p);break;case"data":if(n!=="object"){Lo(i,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||a!=="href")){i.removeAttribute(a);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(a);break}c=No(""+c),i.setAttribute(a,c);break;case"action":case"formAction":if(typeof c=="function"){i.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(a==="formAction"?(n!=="input"&&Yt(i,n,"name",d.name,d,null),Yt(i,n,"formEncType",d.formEncType,d,null),Yt(i,n,"formMethod",d.formMethod,d,null),Yt(i,n,"formTarget",d.formTarget,d,null)):(Yt(i,n,"encType",d.encType,d,null),Yt(i,n,"method",d.method,d,null),Yt(i,n,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(a);break}c=No(""+c),i.setAttribute(a,c);break;case"onClick":c!=null&&(i.onclick=gs);break;case"onScroll":c!=null&&Pt("scroll",i);break;case"onScrollEnd":c!=null&&Pt("scrollend",i);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(d.children!=null)throw Error(s(60));i.innerHTML=a}}break;case"multiple":i.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":i.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){i.removeAttribute("xlink:href");break}a=No(""+c),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,""+c):i.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,""):i.removeAttribute(a);break;case"capture":case"download":c===!0?i.setAttribute(a,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,c):i.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?i.setAttribute(a,c):i.removeAttribute(a);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?i.removeAttribute(a):i.setAttribute(a,c);break;case"popover":Pt("beforetoggle",i),Pt("toggle",i),Uo(i,"popover",c);break;case"xlinkActuate":ps(i,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":ps(i,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":ps(i,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":ps(i,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":ps(i,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":ps(i,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":ps(i,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":ps(i,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":ps(i,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Uo(i,"is",c);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=gv.get(a)||a,Uo(i,a,c))}}function Lu(i,n,a,c,d,p){switch(a){case"style":np(i,c,p);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(d.children!=null)throw Error(s(60));i.innerHTML=a}}break;case"children":typeof c=="string"?ur(i,c):(typeof c=="number"||typeof c=="bigint")&&ur(i,""+c);break;case"onScroll":c!=null&&Pt("scroll",i);break;case"onScrollEnd":c!=null&&Pt("scrollend",i);break;case"onClick":c!=null&&(i.onclick=gs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Zf.hasOwnProperty(a))t:{if(a[0]==="o"&&a[1]==="n"&&(d=a.endsWith("Capture"),n=a.slice(2,d?a.length-7:void 0),p=i[ri]||null,p=p!=null?p[a]:null,typeof p=="function"&&i.removeEventListener(n,p,d),typeof c=="function")){typeof p!="function"&&p!==null&&(a in i?i[a]=null:i.hasAttribute(a)&&i.removeAttribute(a)),i.addEventListener(n,c,d);break t}a in i?i[a]=c:c===!0?i.setAttribute(a,""):Uo(i,a,c)}}}function Fe(i,n,a){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Pt("error",i),Pt("load",i);var c=!1,d=!1,p;for(p in a)if(a.hasOwnProperty(p)){var _=a[p];if(_!=null)switch(p){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Yt(i,n,p,_,a,null)}}d&&Yt(i,n,"srcSet",a.srcSet,a,null),c&&Yt(i,n,"src",a.src,a,null);return;case"input":Pt("invalid",i);var v=p=_=d=null,S=null,H=null;for(c in a)if(a.hasOwnProperty(c)){var q=a[c];if(q!=null)switch(c){case"name":d=q;break;case"type":_=q;break;case"checked":S=q;break;case"defaultChecked":H=q;break;case"value":p=q;break;case"defaultValue":v=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(s(137,n));break;default:Yt(i,n,c,q,a,null)}}tp(i,p,v,S,H,_,d,!1);return;case"select":Pt("invalid",i),c=_=p=null;for(d in a)if(a.hasOwnProperty(d)&&(v=a[d],v!=null))switch(d){case"value":p=v;break;case"defaultValue":_=v;break;case"multiple":c=v;default:Yt(i,n,d,v,a,null)}n=p,a=_,i.multiple=!!c,n!=null?hr(i,!!c,n,!1):a!=null&&hr(i,!!c,a,!0);return;case"textarea":Pt("invalid",i),p=d=c=null;for(_ in a)if(a.hasOwnProperty(_)&&(v=a[_],v!=null))switch(_){case"value":c=v;break;case"defaultValue":d=v;break;case"children":p=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(s(91));break;default:Yt(i,n,_,v,a,null)}ip(i,c,d,p);return;case"option":for(S in a)if(a.hasOwnProperty(S)&&(c=a[S],c!=null))switch(S){case"selected":i.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:Yt(i,n,S,c,a,null)}return;case"dialog":Pt("beforetoggle",i),Pt("toggle",i),Pt("cancel",i),Pt("close",i);break;case"iframe":case"object":Pt("load",i);break;case"video":case"audio":for(c=0;c<Qa.length;c++)Pt(Qa[c],i);break;case"image":Pt("error",i),Pt("load",i);break;case"details":Pt("toggle",i);break;case"embed":case"source":case"link":Pt("error",i),Pt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(H in a)if(a.hasOwnProperty(H)&&(c=a[H],c!=null))switch(H){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Yt(i,n,H,c,a,null)}return;default:if(Kc(n)){for(q in a)a.hasOwnProperty(q)&&(c=a[q],c!==void 0&&Lu(i,n,q,c,a,void 0));return}}for(v in a)a.hasOwnProperty(v)&&(c=a[v],c!=null&&Yt(i,n,v,c,a,null))}function Gx(i,n,a,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,p=null,_=null,v=null,S=null,H=null,q=null;for(V in a){var J=a[V];if(a.hasOwnProperty(V)&&J!=null)switch(V){case"checked":break;case"value":break;case"defaultValue":S=J;default:c.hasOwnProperty(V)||Yt(i,n,V,null,c,J)}}for(var Q in c){var V=c[Q];if(J=a[Q],c.hasOwnProperty(Q)&&(V!=null||J!=null))switch(Q){case"type":p=V;break;case"name":d=V;break;case"checked":H=V;break;case"defaultChecked":q=V;break;case"value":_=V;break;case"defaultValue":v=V;break;case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(s(137,n));break;default:V!==J&&Yt(i,n,Q,V,c,J)}}Wc(i,_,v,S,H,q,p,d);return;case"select":V=_=v=Q=null;for(p in a)if(S=a[p],a.hasOwnProperty(p)&&S!=null)switch(p){case"value":break;case"multiple":V=S;default:c.hasOwnProperty(p)||Yt(i,n,p,null,c,S)}for(d in c)if(p=c[d],S=a[d],c.hasOwnProperty(d)&&(p!=null||S!=null))switch(d){case"value":Q=p;break;case"defaultValue":v=p;break;case"multiple":_=p;default:p!==S&&Yt(i,n,d,p,c,S)}n=v,a=_,c=V,Q!=null?hr(i,!!a,Q,!1):!!c!=!!a&&(n!=null?hr(i,!!a,n,!0):hr(i,!!a,a?[]:"",!1));return;case"textarea":V=Q=null;for(v in a)if(d=a[v],a.hasOwnProperty(v)&&d!=null&&!c.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:Yt(i,n,v,null,c,d)}for(_ in c)if(d=c[_],p=a[_],c.hasOwnProperty(_)&&(d!=null||p!=null))switch(_){case"value":Q=d;break;case"defaultValue":V=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(s(91));break;default:d!==p&&Yt(i,n,_,d,c,p)}ep(i,Q,V);return;case"option":for(var ct in a)if(Q=a[ct],a.hasOwnProperty(ct)&&Q!=null&&!c.hasOwnProperty(ct))switch(ct){case"selected":i.selected=!1;break;default:Yt(i,n,ct,null,c,Q)}for(S in c)if(Q=c[S],V=a[S],c.hasOwnProperty(S)&&Q!==V&&(Q!=null||V!=null))switch(S){case"selected":i.selected=Q&&typeof Q!="function"&&typeof Q!="symbol";break;default:Yt(i,n,S,Q,c,V)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pt in a)Q=a[pt],a.hasOwnProperty(pt)&&Q!=null&&!c.hasOwnProperty(pt)&&Yt(i,n,pt,null,c,Q);for(H in c)if(Q=c[H],V=a[H],c.hasOwnProperty(H)&&Q!==V&&(Q!=null||V!=null))switch(H){case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(s(137,n));break;default:Yt(i,n,H,Q,c,V)}return;default:if(Kc(n)){for(var qt in a)Q=a[qt],a.hasOwnProperty(qt)&&Q!==void 0&&!c.hasOwnProperty(qt)&&Lu(i,n,qt,void 0,c,Q);for(q in c)Q=c[q],V=a[q],!c.hasOwnProperty(q)||Q===V||Q===void 0&&V===void 0||Lu(i,n,q,Q,c,V);return}}for(var U in a)Q=a[U],a.hasOwnProperty(U)&&Q!=null&&!c.hasOwnProperty(U)&&Yt(i,n,U,null,c,Q);for(J in c)Q=c[J],V=a[J],!c.hasOwnProperty(J)||Q===V||Q==null&&V==null||Yt(i,n,J,Q,c,V)}function r_(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Qx(){if(typeof performance.getEntriesByType=="function"){for(var i=0,n=0,a=performance.getEntriesByType("resource"),c=0;c<a.length;c++){var d=a[c],p=d.transferSize,_=d.initiatorType,v=d.duration;if(p&&v&&r_(_)){for(_=0,v=d.responseEnd,c+=1;c<a.length;c++){var S=a[c],H=S.startTime;if(H>v)break;var q=S.transferSize,J=S.initiatorType;q&&r_(J)&&(S=S.responseEnd,_+=q*(S<v?1:(v-H)/(S-H)))}if(--c,n+=8*(p+_)/(d.duration/1e3),i++,10<i)break}}if(0<i)return n/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Fu=null,Nu=null;function zl(i){return i.nodeType===9?i:i.ownerDocument}function a_(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function o_(i,n){if(i===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&n==="foreignObject"?0:i}function Hu(i,n){return i==="textarea"||i==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Gu=null;function jx(){var i=window.event;return i&&i.type==="popstate"?i===Gu?!1:(Gu=i,!0):(Gu=null,!1)}var l_=typeof setTimeout=="function"?setTimeout:void 0,Vx=typeof clearTimeout=="function"?clearTimeout:void 0,c_=typeof Promise=="function"?Promise:void 0,Yx=typeof queueMicrotask=="function"?queueMicrotask:typeof c_<"u"?function(i){return c_.resolve(null).then(i).catch(qx)}:l_;function qx(i){setTimeout(function(){throw i})}function hn(i){return i==="head"}function h_(i,n){var a=n,c=0;do{var d=a.nextSibling;if(i.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"||a==="/&"){if(c===0){i.removeChild(d),Gr(n);return}c--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")c++;else if(a==="html")Va(i.ownerDocument.documentElement);else if(a==="head"){a=i.ownerDocument.head,Va(a);for(var p=a.firstChild;p;){var _=p.nextSibling,v=p.nodeName;p[ca]||v==="SCRIPT"||v==="STYLE"||v==="LINK"&&p.rel.toLowerCase()==="stylesheet"||a.removeChild(p),p=_}}else a==="body"&&Va(i.ownerDocument.body);a=d}while(a);Gr(n)}function u_(i,n){var a=i;i=0;do{var c=a.nextSibling;if(a.nodeType===1?n?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(n?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),c&&c.nodeType===8)if(a=c.data,a==="/$"){if(i===0)break;i--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||i++;a=c}while(a)}function Qu(i){var n=i.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var a=n;switch(n=n.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Qu(a),Xc(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}i.removeChild(a)}}function Xx(i,n,a,c){for(;i.nodeType===1;){var d=a;if(i.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(c){if(!i[ca])switch(n){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(p=i.getAttribute("rel"),p==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(p!==d.rel||i.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||i.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||i.getAttribute("title")!==(d.title==null?null:d.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(p=i.getAttribute("src"),(p!==(d.src==null?null:d.src)||i.getAttribute("type")!==(d.type==null?null:d.type)||i.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&p&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(n==="input"&&i.type==="hidden"){var p=d.name==null?null:""+d.name;if(d.type==="hidden"&&i.getAttribute("name")===p)return i}else return i;if(i=Hi(i.nextSibling),i===null)break}return null}function Zx(i,n,a){if(n==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=Hi(i.nextSibling),i===null))return null;return i}function d_(i,n){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!n||(i=Hi(i.nextSibling),i===null))return null;return i}function ju(i){return i.data==="$?"||i.data==="$~"}function Vu(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function Wx(i,n){var a=i.ownerDocument;if(i.data==="$~")i._reactRetry=n;else if(i.data!=="$?"||a.readyState!=="loading")n();else{var c=function(){n(),a.removeEventListener("DOMContentLoaded",c)};a.addEventListener("DOMContentLoaded",c),i._reactRetry=c}}function Hi(i){for(;i!=null;i=i.nextSibling){var n=i.nodeType;if(n===1||n===3)break;if(n===8){if(n=i.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return i}var Yu=null;function f_(i){i=i.nextSibling;for(var n=0;i;){if(i.nodeType===8){var a=i.data;if(a==="/$"||a==="/&"){if(n===0)return Hi(i.nextSibling);n--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||n++}i=i.nextSibling}return null}function p_(i){i=i.previousSibling;for(var n=0;i;){if(i.nodeType===8){var a=i.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(n===0)return i;n--}else a!=="/$"&&a!=="/&"||n++}i=i.previousSibling}return null}function g_(i,n,a){switch(n=zl(a),i){case"html":if(i=n.documentElement,!i)throw Error(s(452));return i;case"head":if(i=n.head,!i)throw Error(s(453));return i;case"body":if(i=n.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function Va(i){for(var n=i.attributes;n.length;)i.removeAttributeNode(n[0]);Xc(i)}var Gi=new Map,m_=new Set;function Ol(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Ps=b.d;b.d={f:Jx,r:Kx,D:$x,C:tb,L:eb,m:ib,X:nb,S:sb,M:rb};function Jx(){var i=Ps.f(),n=El();return i||n}function Kx(i){var n=or(i);n!==null&&n.tag===5&&n.type==="form"?Ig(n):Ps.r(i)}var Fr=typeof document>"u"?null:document;function __(i,n,a){var c=Fr;if(c&&typeof n=="string"&&n){var d=ki(n);d='link[rel="'+i+'"][href="'+d+'"]',typeof a=="string"&&(d+='[crossorigin="'+a+'"]'),m_.has(d)||(m_.add(d),i={rel:i,crossOrigin:a,href:n},c.querySelector(d)===null&&(n=c.createElement("link"),Fe(n,"link",i),Me(n),c.head.appendChild(n)))}}function $x(i){Ps.D(i),__("dns-prefetch",i,null)}function tb(i,n){Ps.C(i,n),__("preconnect",i,n)}function eb(i,n,a){Ps.L(i,n,a);var c=Fr;if(c&&i&&n){var d='link[rel="preload"][as="'+ki(n)+'"]';n==="image"&&a&&a.imageSrcSet?(d+='[imagesrcset="'+ki(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(d+='[imagesizes="'+ki(a.imageSizes)+'"]')):d+='[href="'+ki(i)+'"]';var p=d;switch(n){case"style":p=Nr(i);break;case"script":p=Hr(i)}Gi.has(p)||(i=A({rel:"preload",href:n==="image"&&a&&a.imageSrcSet?void 0:i,as:n},a),Gi.set(p,i),c.querySelector(d)!==null||n==="style"&&c.querySelector(Ya(p))||n==="script"&&c.querySelector(qa(p))||(n=c.createElement("link"),Fe(n,"link",i),Me(n),c.head.appendChild(n)))}}function ib(i,n){Ps.m(i,n);var a=Fr;if(a&&i){var c=n&&typeof n.as=="string"?n.as:"script",d='link[rel="modulepreload"][as="'+ki(c)+'"][href="'+ki(i)+'"]',p=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=Hr(i)}if(!Gi.has(p)&&(i=A({rel:"modulepreload",href:i},n),Gi.set(p,i),a.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(qa(p)))return}c=a.createElement("link"),Fe(c,"link",i),Me(c),a.head.appendChild(c)}}}function sb(i,n,a){Ps.S(i,n,a);var c=Fr;if(c&&i){var d=lr(c).hoistableStyles,p=Nr(i);n=n||"default";var _=d.get(p);if(!_){var v={loading:0,preload:null};if(_=c.querySelector(Ya(p)))v.loading=5;else{i=A({rel:"stylesheet",href:i,"data-precedence":n},a),(a=Gi.get(p))&&qu(i,a);var S=_=c.createElement("link");Me(S),Fe(S,"link",i),S._p=new Promise(function(H,q){S.onload=H,S.onerror=q}),S.addEventListener("load",function(){v.loading|=1}),S.addEventListener("error",function(){v.loading|=2}),v.loading|=4,Ul(_,n,c)}_={type:"stylesheet",instance:_,count:1,state:v},d.set(p,_)}}}function nb(i,n){Ps.X(i,n);var a=Fr;if(a&&i){var c=lr(a).hoistableScripts,d=Hr(i),p=c.get(d);p||(p=a.querySelector(qa(d)),p||(i=A({src:i,async:!0},n),(n=Gi.get(d))&&Xu(i,n),p=a.createElement("script"),Me(p),Fe(p,"link",i),a.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(d,p))}}function rb(i,n){Ps.M(i,n);var a=Fr;if(a&&i){var c=lr(a).hoistableScripts,d=Hr(i),p=c.get(d);p||(p=a.querySelector(qa(d)),p||(i=A({src:i,async:!0,type:"module"},n),(n=Gi.get(d))&&Xu(i,n),p=a.createElement("script"),Me(p),Fe(p,"link",i),a.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(d,p))}}function A_(i,n,a,c){var d=(d=St.current)?Ol(d):null;if(!d)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(n=Nr(a.href),a=lr(d).hoistableStyles,c=a.get(n),c||(c={type:"style",instance:null,count:0,state:null},a.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){i=Nr(a.href);var p=lr(d).hoistableStyles,_=p.get(i);if(_||(d=d.ownerDocument||d,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(i,_),(p=d.querySelector(Ya(i)))&&!p._p&&(_.instance=p,_.state.loading=5),Gi.has(i)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Gi.set(i,a),p||ab(d,i,a,_.state))),n&&c===null)throw Error(s(528,""));return _}if(n&&c!==null)throw Error(s(529,""));return null;case"script":return n=a.async,a=a.src,typeof a=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Hr(a),a=lr(d).hoistableScripts,c=a.get(n),c||(c={type:"script",instance:null,count:0,state:null},a.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function Nr(i){return'href="'+ki(i)+'"'}function Ya(i){return'link[rel="stylesheet"]['+i+"]"}function y_(i){return A({},i,{"data-precedence":i.precedence,precedence:null})}function ab(i,n,a,c){i.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=i.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),Fe(n,"link",a),Me(n),i.head.appendChild(n))}function Hr(i){return'[src="'+ki(i)+'"]'}function qa(i){return"script[async]"+i}function v_(i,n,a){if(n.count++,n.instance===null)switch(n.type){case"style":var c=i.querySelector('style[data-href~="'+ki(a.href)+'"]');if(c)return n.instance=c,Me(c),c;var d=A({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return c=(i.ownerDocument||i).createElement("style"),Me(c),Fe(c,"style",d),Ul(c,a.precedence,i),n.instance=c;case"stylesheet":d=Nr(a.href);var p=i.querySelector(Ya(d));if(p)return n.state.loading|=4,n.instance=p,Me(p),p;c=y_(a),(d=Gi.get(d))&&qu(c,d),p=(i.ownerDocument||i).createElement("link"),Me(p);var _=p;return _._p=new Promise(function(v,S){_.onload=v,_.onerror=S}),Fe(p,"link",c),n.state.loading|=4,Ul(p,a.precedence,i),n.instance=p;case"script":return p=Hr(a.src),(d=i.querySelector(qa(p)))?(n.instance=d,Me(d),d):(c=a,(d=Gi.get(p))&&(c=A({},a),Xu(c,d)),i=i.ownerDocument||i,d=i.createElement("script"),Me(d),Fe(d,"link",c),i.head.appendChild(d),n.instance=d);case"void":return null;default:throw Error(s(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,Ul(c,a.precedence,i));return n.instance}function Ul(i,n,a){for(var c=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,p=d,_=0;_<c.length;_++){var v=c[_];if(v.dataset.precedence===n)p=v;else if(p!==d)break}p?p.parentNode.insertBefore(i,p.nextSibling):(n=a.nodeType===9?a.head:a,n.insertBefore(i,n.firstChild))}function qu(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.title==null&&(i.title=n.title)}function Xu(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.integrity==null&&(i.integrity=n.integrity)}var Ll=null;function x_(i,n,a){if(Ll===null){var c=new Map,d=Ll=new Map;d.set(a,c)}else d=Ll,c=d.get(a),c||(c=new Map,d.set(a,c));if(c.has(i))return c;for(c.set(i,null),a=a.getElementsByTagName(i),d=0;d<a.length;d++){var p=a[d];if(!(p[ca]||p[ze]||i==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var _=p.getAttribute(n)||"";_=i+_;var v=c.get(_);v?v.push(p):c.set(_,[p])}}return c}function b_(i,n,a){i=i.ownerDocument||i,i.head.insertBefore(a,n==="title"?i.querySelector("head > title"):null)}function ob(i,n,a){if(a===1||n.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return i=n.disabled,typeof n.precedence=="string"&&i==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function w_(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function lb(i,n,a,c){if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var d=Nr(c.href),p=n.querySelector(Ya(d));if(p){n=p._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(i.count++,i=Fl.bind(i),n.then(i,i)),a.state.loading|=4,a.instance=p,Me(p);return}p=n.ownerDocument||n,c=y_(c),(d=Gi.get(d))&&qu(c,d),p=p.createElement("link"),Me(p);var _=p;_._p=new Promise(function(v,S){_.onload=v,_.onerror=S}),Fe(p,"link",c),a.instance=p}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(a,n),(n=a.state.preload)&&(a.state.loading&3)===0&&(i.count++,a=Fl.bind(i),n.addEventListener("load",a),n.addEventListener("error",a))}}var Zu=0;function cb(i,n){return i.stylesheets&&i.count===0&&Hl(i,i.stylesheets),0<i.count||0<i.imgCount?function(a){var c=setTimeout(function(){if(i.stylesheets&&Hl(i,i.stylesheets),i.unsuspend){var p=i.unsuspend;i.unsuspend=null,p()}},6e4+n);0<i.imgBytes&&Zu===0&&(Zu=62500*Qx());var d=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&Hl(i,i.stylesheets),i.unsuspend)){var p=i.unsuspend;i.unsuspend=null,p()}},(i.imgBytes>Zu?50:800)+n);return i.unsuspend=a,function(){i.unsuspend=null,clearTimeout(c),clearTimeout(d)}}:null}function Fl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Hl(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Nl=null;function Hl(i,n){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Nl=new Map,n.forEach(hb,i),Nl=null,Fl.call(i))}function hb(i,n){if(!(n.state.loading&4)){var a=Nl.get(i);if(a)var c=a.get(null);else{a=new Map,Nl.set(i,a);for(var d=i.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<d.length;p++){var _=d[p];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(a.set(_.dataset.precedence,_),c=_)}c&&a.set(null,c)}d=n.instance,_=d.getAttribute("data-precedence"),p=a.get(_)||c,p===c&&a.set(null,d),a.set(_,d),this.count++,c=Fl.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),p?p.parentNode.insertBefore(d,p.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(d,i.firstChild)),n.state.loading|=4}}var Xa={$$typeof:P,Provider:null,Consumer:null,_currentValue:tt,_currentValue2:tt,_threadCount:0};function ub(i,n,a,c,d,p,_,v,S){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=jc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jc(0),this.hiddenUpdates=jc(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=p,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function C_(i,n,a,c,d,p,_,v,S,H,q,J){return i=new ub(i,n,a,_,S,H,q,J,v),n=1,p===!0&&(n|=24),p=bi(3,null,null,n),i.current=p,p.stateNode=i,n=Dh(),n.refCount++,i.pooledCache=n,n.refCount++,p.memoizedState={element:c,isDehydrated:a,cache:n},Bh(p),i}function S_(i){return i?(i=Ar,i):Ar}function T_(i,n,a,c,d,p){d=S_(d),c.context===null?c.context=d:c.pendingContext=d,c=Ks(n),c.payload={element:a},p=p===void 0?null:p,p!==null&&(c.callback=p),a=$s(i,c,n),a!==null&&(ui(a,i,n),Ta(a,i,n))}function E_(i,n){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var a=i.retryLane;i.retryLane=a!==0&&a<n?a:n}}function Wu(i,n){E_(i,n),(i=i.alternate)&&E_(i,n)}function D_(i){if(i.tag===13||i.tag===31){var n=Bn(i,67108864);n!==null&&ui(n,i,67108864),Wu(i,67108864)}}function R_(i){if(i.tag===13||i.tag===31){var n=Ei();n=Vc(n);var a=Bn(i,n);a!==null&&ui(a,i,n),Wu(i,n)}}var Gl=!0;function db(i,n,a,c){var d=T.T;T.T=null;var p=b.p;try{b.p=2,Ju(i,n,a,c)}finally{b.p=p,T.T=d}}function fb(i,n,a,c){var d=T.T;T.T=null;var p=b.p;try{b.p=8,Ju(i,n,a,c)}finally{b.p=p,T.T=d}}function Ju(i,n,a,c){if(Gl){var d=Ku(c);if(d===null)Uu(i,n,c,Ql,a),P_(i,c);else if(gb(d,i,n,a,c))c.stopPropagation();else if(P_(i,c),n&4&&-1<pb.indexOf(i)){for(;d!==null;){var p=or(d);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var _=En(p.pendingLanes);if(_!==0){var v=p;for(v.pendingLanes|=2,v.entangledLanes|=2;_;){var S=1<<31-vi(_);v.entanglements[1]|=S,_&=~S}ns(p),(Ht&6)===0&&(Sl=Ai()+500,Ga(0))}}break;case 31:case 13:v=Bn(p,2),v!==null&&ui(v,p,2),El(),Wu(p,2)}if(p=Ku(c),p===null&&Uu(i,n,c,Ql,a),p===d)break;d=p}d!==null&&c.stopPropagation()}else Uu(i,n,c,null,a)}}function Ku(i){return i=th(i),$u(i)}var Ql=null;function $u(i){if(Ql=null,i=ar(i),i!==null){var n=l(i);if(n===null)i=null;else{var a=n.tag;if(a===13){if(i=h(n),i!==null)return i;i=null}else if(a===31){if(i=u(n),i!==null)return i;i=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;i=null}else n!==i&&(i=null)}}return Ql=i,null}function M_(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch($y()){case Lf:return 2;case Ff:return 8;case Bo:case tv:return 32;case Nf:return 268435456;default:return 32}default:return 32}}var td=!1,un=null,dn=null,fn=null,Za=new Map,Wa=new Map,pn=[],pb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function P_(i,n){switch(i){case"focusin":case"focusout":un=null;break;case"dragenter":case"dragleave":dn=null;break;case"mouseover":case"mouseout":fn=null;break;case"pointerover":case"pointerout":Za.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wa.delete(n.pointerId)}}function Ja(i,n,a,c,d,p){return i===null||i.nativeEvent!==p?(i={blockedOn:n,domEventName:a,eventSystemFlags:c,nativeEvent:p,targetContainers:[d]},n!==null&&(n=or(n),n!==null&&D_(n)),i):(i.eventSystemFlags|=c,n=i.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),i)}function gb(i,n,a,c,d){switch(n){case"focusin":return un=Ja(un,i,n,a,c,d),!0;case"dragenter":return dn=Ja(dn,i,n,a,c,d),!0;case"mouseover":return fn=Ja(fn,i,n,a,c,d),!0;case"pointerover":var p=d.pointerId;return Za.set(p,Ja(Za.get(p)||null,i,n,a,c,d)),!0;case"gotpointercapture":return p=d.pointerId,Wa.set(p,Ja(Wa.get(p)||null,i,n,a,c,d)),!0}return!1}function B_(i){var n=ar(i.target);if(n!==null){var a=l(n);if(a!==null){if(n=a.tag,n===13){if(n=h(a),n!==null){i.blockedOn=n,Yf(i.priority,function(){R_(a)});return}}else if(n===31){if(n=u(a),n!==null){i.blockedOn=n,Yf(i.priority,function(){R_(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){i.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}i.blockedOn=null}function jl(i){if(i.blockedOn!==null)return!1;for(var n=i.targetContainers;0<n.length;){var a=Ku(i.nativeEvent);if(a===null){a=i.nativeEvent;var c=new a.constructor(a.type,a);$c=c,a.target.dispatchEvent(c),$c=null}else return n=or(a),n!==null&&D_(n),i.blockedOn=a,!1;n.shift()}return!0}function I_(i,n,a){jl(i)&&a.delete(n)}function mb(){td=!1,un!==null&&jl(un)&&(un=null),dn!==null&&jl(dn)&&(dn=null),fn!==null&&jl(fn)&&(fn=null),Za.forEach(I_),Wa.forEach(I_)}function Vl(i,n){i.blockedOn===n&&(i.blockedOn=null,td||(td=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,mb)))}var Yl=null;function k_(i){Yl!==i&&(Yl=i,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Yl===i&&(Yl=null);for(var n=0;n<i.length;n+=3){var a=i[n],c=i[n+1],d=i[n+2];if(typeof c!="function"){if($u(c||a)===null)continue;break}var p=or(a);p!==null&&(i.splice(n,3),n-=3,Kh(p,{pending:!0,data:d,method:a.method,action:c},c,d))}}))}function Gr(i){function n(S){return Vl(S,i)}un!==null&&Vl(un,i),dn!==null&&Vl(dn,i),fn!==null&&Vl(fn,i),Za.forEach(n),Wa.forEach(n);for(var a=0;a<pn.length;a++){var c=pn[a];c.blockedOn===i&&(c.blockedOn=null)}for(;0<pn.length&&(a=pn[0],a.blockedOn===null);)B_(a),a.blockedOn===null&&pn.shift();if(a=(i.ownerDocument||i).$$reactFormReplay,a!=null)for(c=0;c<a.length;c+=3){var d=a[c],p=a[c+1],_=d[ri]||null;if(typeof p=="function")_||k_(a);else if(_){var v=null;if(p&&p.hasAttribute("formAction")){if(d=p,_=p[ri]||null)v=_.formAction;else if($u(d)!==null)continue}else v=_.action;typeof v=="function"?a[c+1]=v:(a.splice(c,3),c-=3),k_(a)}}}function z_(){function i(p){p.canIntercept&&p.info==="react-transition"&&p.intercept({handler:function(){return new Promise(function(_){return d=_})},focusReset:"manual",scroll:"manual"})}function n(){d!==null&&(d(),d=null),c||setTimeout(a,20)}function a(){if(!c&&!navigation.transition){var p=navigation.currentEntry;p&&p.url!=null&&navigation.navigate(p.url,{state:p.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,d=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(a,100),function(){c=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),d!==null&&(d(),d=null)}}}function ed(i){this._internalRoot=i}ql.prototype.render=ed.prototype.render=function(i){var n=this._internalRoot;if(n===null)throw Error(s(409));var a=n.current,c=Ei();T_(a,c,i,n,null,null)},ql.prototype.unmount=ed.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var n=i.containerInfo;T_(i.current,2,null,i,null,null),El(),n[rr]=null}};function ql(i){this._internalRoot=i}ql.prototype.unstable_scheduleHydration=function(i){if(i){var n=Vf();i={blockedOn:null,target:i,priority:n};for(var a=0;a<pn.length&&n!==0&&n<pn[a].priority;a++);pn.splice(a,0,i),a===0&&B_(i)}};var O_=t.version;if(O_!=="19.2.3")throw Error(s(527,O_,"19.2.3"));b.findDOMNode=function(i){var n=i._reactInternals;if(n===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=g(n),i=i!==null?m(i):null,i=i===null?null:i.stateNode,i};var _b={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xl.isDisabled&&Xl.supportsFiber)try{aa=Xl.inject(_b),yi=Xl}catch{}}return to.createRoot=function(i,n){if(!r(i))throw Error(s(299));var a=!1,c="",d=Qg,p=jg,_=Vg;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(d=n.onUncaughtError),n.onCaughtError!==void 0&&(p=n.onCaughtError),n.onRecoverableError!==void 0&&(_=n.onRecoverableError)),n=C_(i,1,!1,null,null,a,c,null,d,p,_,z_),i[rr]=n.current,Ou(i),new ed(n)},to.hydrateRoot=function(i,n,a){if(!r(i))throw Error(s(299));var c=!1,d="",p=Qg,_=jg,v=Vg,S=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(p=a.onUncaughtError),a.onCaughtError!==void 0&&(_=a.onCaughtError),a.onRecoverableError!==void 0&&(v=a.onRecoverableError),a.formState!==void 0&&(S=a.formState)),n=C_(i,1,!0,n,a??null,c,d,S,p,_,v,z_),n.context=S_(null),a=n.current,c=Ei(),c=Vc(c),d=Ks(c),d.callback=null,$s(a,d,c),a=c,n.current.lanes=a,la(n,a),ns(n),i[rr]=n.current,Ou(i),new ql(n)},to.version="19.2.3",to}var Y_;function Mb(){if(Y_)return nd.exports;Y_=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),nd.exports=Rb(),nd.exports}var Pb=Mb();const Bb=af(Pb);/*! excalibur - 0.31.0 - 2025-9-26
https://github.com/excaliburjs/Excalibur
Copyright (c) 2025 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
Licensed BSD-2-Clause
@preserve */function W0(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(o){window.setInterval(o,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise((s,r)=>{t.call(this,e,s,r)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1),typeof window<"u"&&!window.requestIdleCallback&&(window.requestIdleCallback=window.requestIdleCallback||function(o){const t=Date.now();return setTimeout(function(){o({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(o){clearTimeout(o)})}const lf=class as{static useCanvasGraphicsContext(){as.enable("use-canvas-context")}static useLegacyImageRenderer(){as.enable("use-legacy-image-renderer")}static freeze(){as._FROZEN=!0}static _reset(){as._FROZEN=!1,as._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");as._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");as._FLAGS[t]=!1}static isEnabled(t){return!!as._FLAGS[t]}static show(){return Object.keys(as._FLAGS)}};lf._FROZEN=!1;lf._FLAGS={};let ic=lf;function Kr(o,t){return{type:o,value:t}}class bn{constructor(){this._isCompleted=!1,this.promise=new Promise((t,e)=>{this._resolver=t,this._rejecter=e})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}class ae{constructor(){this._paused=!1,this._empty=!0,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0,this._empty=!0}on(t,e){var s;return this._empty=!1,this._listeners[t]=(s=this._listeners[t])!=null?s:[],this._listeners[t].push(e),{close:()=>this.off(t,e)}}once(t,e){var s;return this._empty=!1,this._listenersOnce[t]=(s=this._listenersOnce[t])!=null?s:[],this._listenersOnce[t].push(e),{close:()=>this.off(t,e)}}off(t,e){var s,r;if(e){const l=(s=this._listeners[t])==null?void 0:s.filter(u=>u!==e);this._listeners[t]=l;const h=(r=this._listenersOnce[t])==null?void 0:r.filter(u=>u!==e);this._listenersOnce[t]=h}else delete this._listeners[t]}emit(t,e){if(this._empty||this._paused)return;const s=this._listeners[t];if(s)for(let l=0;l<s.length;l++)s[l](e);const r=this._listenersOnce[t];if(this._listenersOnce[t]=[],r)for(let l=0;l<r.length;l++)r[l](e);for(let l=0;l<this._pipes.length;l++)this._pipes[l].emit(t,e)}pipe(t){if(this===t)throw Error("Cannot pipe to self");return this._empty=!1,this._pipes.push(t),{close:()=>{const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}}}unpipe(t){const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var po=(o=>(o.Canvas="Canvas",o.Document="Document",o))(po||{}),Ae=(o=>(o.ShortestPath="shortest-path",o.LongestPath="longest-path",o.Clockwise="clockwise",o.CounterClockwise="counter-clockwise",o))(Ae||{});const ld=4294967295,Ib=Date.now();let kb=0;class J0{constructor(t){this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Ib+kb++)>>>0,this._seed=this._mt[0];for(let e=1;e<this._n;e++){const s=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((s&4294901760)>>>16)<<16)+this._f*(s&65535)+e>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,s=0;for(;s<this._n-this._m;s++)e=this._mt[s]&this._upperMask|this._mt[s+1]&this._lowerMask,this._mt[s]=this._mt[s+this._m]^e>>>1^t[e&1]&ld;for(;s<this._n-1;s++)e=this._mt[s]&this._upperMask|this._mt[s+1]&this._lowerMask,this._mt[s]=this._mt[s+(this._m-this._n)]^e>>>1^t[e&1]&ld;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[e&1]&ld,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,s=!1){return s?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const s=new Array(e);let r=0;const l=t.slice(0);for(;r<e;){const h=this.integer(0,l.length-1);s[r++]=l[h],l.splice(h,1)}return s}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const s=new Array(e);for(let r=0;r<e;r++)s[r]=this.pickOne(t);return s}shuffle(t){const e=t.slice(0);let s;for(let r=0;r<e.length-2;r++){const l=this.integer(r,e.length-1);s=e[r],e[r]=e[l],e[l]=s}return e}range(t,e,s){const r=new Array(t);for(let l=0;l<t;l++)r[l]=this.integer(e,s);return r}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}get seed(){return this._seed}}const Ge=Math.PI*2;function te(o){return o===0?0:o<0?-1:1}function Bt(o,t,e){return Math.min(Math.max(t,o),e)}function zb(o,t,e){return Math.abs(o-t)<e}function vn(o){let t=o;if(o>=Ge)for(;t>=Ge;)t-=Ge;if(o<0)for(;t<0;)t+=Ge;return t}function Ob(o){return 180/Math.PI*o}const K0=class Jt{constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}static get Zero(){return new Jt(0,0)}static get One(){return new Jt(1,1)}static get Half(){return new Jt(.5,.5)}static get Up(){return new Jt(0,-1)}static get Down(){return new Jt(0,1)}static get Left(){return new Jt(-1,0)}static get Right(){return new Jt(1,0)}static fromAngle(t){return new Jt(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new Jt(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new Jt(Math.max(t.x,e.x),Math.max(t.y,e.y))}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=Jt.EQUALS_EPSILON){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}squareDistance(t){t||(t=Jt.Zero);const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}clampMagnitude(t){const e=this.magnitude,s=Bt(e,0,t);return this.magnitude=s,this}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}get magnitude(){return this.distance()}set magnitude(t){this.normalize().scale(t,this)}normalize(){const t=this.distance();return t===0?Jt.Zero:new Jt(this.x/t,this.y/t)}average(t){return this.add(t).scale(.5)}scale(t,e){const s=e||new Jt(0,0);return t instanceof Jt?(s.x=this.x*t.x,s.y=this.y*t.y):(s.x=this.x*t,s.y=this.y*t),s}add(t,e){return e?(e.x=this.x+t.x,e.y=this.y+t.y,e):new Jt(this.x+t.x,this.y+t.y)}sub(t,e){const s=e||new Jt(0,0),r=this.x-t.x,l=this.y-t.y;return s.x=r,s.y=l,s}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof Jt)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new Jt(t*this.y,-t*this.x)}static cross(t,e){return new Jt(-t*e.y,t*e.x)}perpendicular(){return new Jt(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return vn(Math.atan2(this.y,this.x))}angleBetween(t,e){const s=this.toAngle(),r=vn(t);let l=0,h=0;switch(r>s?l=r-s:l=(Ge-s+r)%Ge,h=(l-Ge)%Ge,e){case Ae.ShortestPath:return Math.abs(l)<Math.abs(h)?l:h;case Ae.LongestPath:return Math.abs(l)>Math.abs(h)?l:h;case Ae.Clockwise:return l;case Ae.CounterClockwise:return h}}rotate(t,e,s){const r=s||new Jt(0,0);e||(e=new Jt(0,0));const l=Math.sin(t),h=Math.cos(t),u=h*(this.x-e.x)-l*(this.y-e.y)+e.x,f=l*(this.x-e.x)+h*(this.y-e.y)+e.y;return r.x=u,r.y=f,r}clone(t){const e=t??new Jt(0,0);return e.x=this.x,e.y=this.y,e}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}lerp(t,e){e=Bt(e,0,1);const s=new Jt(0,0);return s.x=this.x+(t.x-this.x)*e,s.y=this.y+(t.y-this.y)*e,s}};K0.EQUALS_EPSILON=.001;let z=K0;function I(o,t){return new z(o,t)}class ${constructor(t,e,s,r){this.r=t,this.g=e,this.b=s,this.a=r??1}static fromRGB(t,e,s,r){return new $(t,e,s,r)}static fromRGBString(t){const e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let s=null;if(s=t.match(e)){const r=parseInt(s[1],10),l=parseInt(s[2],10),h=parseInt(s[3],10);let u=1;return s[4]&&(u=parseFloat(s[4])),new $(r,l,h,u)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let s=null;if(s=t.match(e)){const r=parseInt(s[1],16),l=parseInt(s[2],16),h=parseInt(s[3],16);let u=1;return s[4]&&(u=parseInt(s[4],16)/255),new $(r,l,h,u)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,s,r=1){return new Wi(t,e,s,r).toRGBA()}lighten(t=.1){const e=Wi.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=Wi.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=Wi.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=Wi.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,s=t.g/255*this.g/255*255,r=t.b/255*this.b/255*255,l=t.a*this.a;return new $(e,s,r,l)}screen(t){const e=t.invert(),s=t.invert();return e.multiply(s).invert()}invert(){return new $(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,s=(t.g+this.g)/2,r=(t.b+this.b)/2,l=(t.a+this.a)/2;return new $(e,s,r,l)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=Math.max(Math.round(t),0).toString(16);return e.length===1?"0"+e:e}toHex(){let t="#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b);return this.a!==1&&(t+=this._componentToHex(this.a*255)),t}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return Wi.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(t){const e=t||new $(this.r,this.g,this.b,this.a);return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e}static get Black(){return $.fromHex("#000000")}static get White(){return $.fromHex("#FFFFFF")}static get Gray(){return $.fromHex("#808080")}static get LightGray(){return $.fromHex("#D3D3D3")}static get DarkGray(){return $.fromHex("#A9A9A9")}static get Yellow(){return $.fromHex("#FFFF00")}static get Orange(){return $.fromHex("#FFA500")}static get Red(){return $.fromHex("#FF0000")}static get Vermilion(){return $.fromHex("#FF5B31")}static get Rose(){return $.fromHex("#FF007F")}static get Pink(){return $.fromHex("#FFC0CB")}static get Magenta(){return $.fromHex("#FF00FF")}static get Violet(){return $.fromHex("#7F00FF")}static get Purple(){return $.fromHex("#800080")}static get Blue(){return $.fromHex("#0000FF")}static get Azure(){return $.fromHex("#007FFF")}static get Cyan(){return $.fromHex("#00FFFF")}static get Viridian(){return $.fromHex("#59978F")}static get Teal(){return $.fromHex("#008080")}static get Green(){return $.fromHex("#00FF00")}static get Chartreuse(){return $.fromHex("#7FFF00")}static get Transparent(){return $.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return $.fromHex("#176BAA")}static get Brown(){return $.fromHex("#964B00")}}class Wi{constructor(t,e,s,r){this.h=t,this.s=e,this.l=s,this.a=r}static hue2rgb(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}static fromRGBA(t,e,s,r){t/=255,e/=255,s/=255;const l=Math.max(t,e,s),h=Math.min(t,e,s);let u,f;const g=(l+h)/2;if(l===h)u=f=0;else{const m=l-h;switch(f=g>.5?m/(2-l-h):m/(l+h),l){case t:u=(e-s)/m+(e<s?6:0);break;case e:u=(s-t)/m+2;break;case s:u=(t-e)/m+4;break}u/=6}return new Wi(u,f,g,r)}toRGBA(){let t,e,s;if(this.s===0)t=e=s=this.l;else{const r=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,l=2*this.l-r;t=Wi.hue2rgb(l,r,this.h+1/3),e=Wi.hue2rgb(l,r,this.h),s=Wi.hue2rgb(l,r,this.h-1/3)}return new $(t*255,e*255,s*255,this.a)}toString(){const t=this.h.toFixed(0),e=this.s.toFixed(0),s=this.l.toFixed(0),r=this.a.toFixed(0);return`hsla(${t}, ${e}, ${s}, ${r})`}}var cf=(o=>(o[o.Debug=0]="Debug",o[o.Info=1]="Info",o[o.Warn=2]="Warn",o[o.Error=3]="Error",o[o.Fatal=4]="Fatal",o))(cf||{});const $0=class Is{constructor(){if(this._appenders=[],this.defaultLevel=1,this._logOnceSet=new Set,Is._INSTANCE)throw new Error("Logger is a singleton");return Is._INSTANCE=this,Is._INSTANCE.addAppender(new Ub),Is._INSTANCE}static getInstance(){return Is._INSTANCE==null&&(Is._INSTANCE=new Is),Is._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){t==null&&(t=this.defaultLevel);const s=this._appenders.length;for(let r=0;r<s;r++)t>=this.defaultLevel&&this._appenders[r].log(t,e)}_logOnce(t,e){const s=t+e.join("+");this._logOnceSet.has(s)||(this._logOnceSet.add(s),this._log(t,e))}debug(...t){this._log(0,t)}debugOnce(...t){this._logOnce(0,t)}info(...t){this._log(1,t)}infoOnce(...t){this._logOnce(1,t)}warn(...t){this._log(2,t)}warnOnce(...t){this._logOnce(2,t)}error(...t){this._log(3,t)}errorOnce(...t){this._logOnce(3,t)}fatal(...t){this._log(4,t)}fatalOnce(...t){this._logOnce(4,t)}};$0._INSTANCE=null;let vt=$0;class Ub{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const s=[];s.unshift.apply(s,e),s.unshift("["+cf[t]+"] : "),t<2?console.log.apply?console.log.apply(console,s):console.log(s.join(" ")):t<3?console.warn.apply?console.warn.apply(console,s):console.warn(s.join(" ")):console.error.apply?console.error.apply(console,s):console.error(s.join(" "))}}var mt=(o=>(o.PreventCollision="PreventCollision",o.Passive="Passive",o.Active="Active",o.Fixed="Fixed",o))(mt||{}),_i=(o=>(o.World="world",o.Screen="screen",o))(_i||{});class Mi{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,e,s,r,l,h){const u=new Mi;return u.data[0]=2/(e-t),u.data[1]=0,u.data[2]=0,u.data[3]=0,u.data[4]=0,u.data[5]=2/(r-s),u.data[6]=0,u.data[7]=0,u.data[8]=0,u.data[9]=0,u.data[10]=-2/(h-l),u.data[11]=0,u.data[12]=-(e+t)/(e-t),u.data[13]=-(r+s)/(r-s),u.data[14]=-(h+l)/(h-l),u.data[15]=1,u}clone(t){const e=t||new Mi;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e.data[6]=this.data[6],e.data[7]=this.data[7],e.data[8]=this.data[8],e.data[9]=this.data[9],e.data[10]=this.data[10],e.data[11]=this.data[11],e.data[12]=this.data[12],e.data[13]=this.data[13],e.data[14]=this.data[14],e.data[15]=this.data[15],e}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const e=new Mi;return e.data=t,e}static identity(){const t=new Mi;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const s=Mi.identity();return s.data[12]=t,s.data[13]=e,s}static scale(t,e){const s=Mi.identity();return s.data[0]=t,s.data[5]=e,s.data[10]=1,s.data[15]=1,s}static rotation(t){const e=Mi.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof z){const s=e||new z(0,0),r=t,l=r.x*this.data[0]+r.y*this.data[4]+this.data[12],h=r.x*this.data[1]+r.y*this.data[5]+this.data[13];return s.x=l,s.y=h,s}else{const s=e||new Mi,r=t,l=this.data[0],h=this.data[1],u=this.data[2],f=this.data[3],g=this.data[4],m=this.data[5],A=this.data[6],y=this.data[7],x=this.data[8],E=this.data[9],C=this.data[10],L=this.data[11],D=this.data[12],R=this.data[13],P=this.data[14],F=this.data[15],Y=r.data[0],et=r.data[1],k=r.data[2],rt=r.data[3],gt=r.data[4],_t=r.data[5],At=r.data[6],xt=r.data[7],O=r.data[8],K=r.data[9],X=r.data[10],T=r.data[11],b=r.data[12],tt=r.data[13],st=r.data[14],at=r.data[15];s.data[0]=l*Y+g*et+x*k+D*rt,s.data[1]=h*Y+m*et+E*k+R*rt,s.data[2]=u*Y+A*et+C*k+P*rt,s.data[3]=f*Y+y*et+L*k+F*rt,s.data[4]=l*gt+g*_t+x*At+D*xt,s.data[5]=h*gt+m*_t+E*At+R*xt,s.data[6]=u*gt+A*_t+C*At+P*xt,s.data[7]=f*gt+y*_t+L*At+F*xt,s.data[8]=l*O+g*K+x*X+D*T,s.data[9]=h*O+m*K+E*X+R*T,s.data[10]=u*O+A*K+C*X+P*T,s.data[11]=f*O+y*K+L*X+F*T,s.data[12]=l*b+g*tt+x*st+D*at,s.data[13]=h*b+m*tt+E*st+R*at,s.data[14]=u*b+A*tt+C*st+P*at,s.data[15]=f*b+y*tt+L*st+F*at;const w=this.getScale();return s._scaleSignX=te(w.x)*te(s._scaleSignX),s._scaleSignY=te(w.y)*te(s._scaleSignY),s}}translate(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3],u=this.data[4],f=this.data[5],g=this.data[6],m=this.data[7],A=this.data[8],y=this.data[9],x=this.data[10],E=this.data[11],C=this.data[12],L=this.data[13],D=this.data[14],R=this.data[15],P=0,F=1;return this.data[12]=s*t+u*e+A*P+C*F,this.data[13]=r*t+f*e+y*P+L*F,this.data[14]=l*t+g*e+x*P+D*F,this.data[15]=h*t+m*e+E*P+R*F,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return I(this.data[12],this.data[13])}rotate(t){const e=this.data[0],s=this.data[1],r=this.data[2],l=this.data[3],h=this.data[4],u=this.data[5],f=this.data[6],g=this.data[7],m=Math.sin(t),A=Math.cos(t);return this.data[0]=A*e+m*h,this.data[1]=A*s+m*u,this.data[2]=A*r+m*f,this.data[3]=A*l+m*g,this.data[4]=A*h-m*e,this.data[5]=A*u-m*s,this.data[6]=A*f-m*r,this.data[7]=A*g-m*l,this}scale(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3],u=this.data[4],f=this.data[5],g=this.data[6],m=this.data[7];return this.data[0]=s*t,this.data[1]=r*t,this.data[2]=l*t,this.data[3]=h*t,this.data[4]=u*e,this.data[5]=f*e,this.data[6]=g*e,this.data[7]=m*e,this}setRotation(t){const e=this.getScale(),s=Math.sin(t),r=Math.cos(t);this.data[0]=r*e.x,this.data[1]=s*e.y,this.data[4]=-s*e.x,this.data[5]=r*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return vn(t)}getScaleX(){const t=I(this.data[0],this.data[4]).magnitude;return this._scaleSignX*t}getScaleY(){const t=I(this.data[1],this.data[5]).magnitude;return this._scaleSignY*t}getScale(){return I(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=te(t);const e=I(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=te(t);const e=I(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const s=1/this.getBasisDeterminant(),r=this.data[0],l=this.data[4],h=this.data[1],u=this.data[5],f=t||Mi.identity();f.data[0]=u*s,f.data[1]=-h*s,f.data[4]=-l*s,f.data[5]=r*s;const g=this.data[12],m=this.data[13];return f.data[12]=-(g*f.data[0]+m*f.data[4]),f.data[13]=-(g*f.data[1]+m*f.data[5]),f}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class _e{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new _e;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,e){const s=_e.identity();return s.data[4]=t,s.data[5]=e,s}static scale(t,e){const s=_e.identity();return s.data[0]=t,s.data[3]=e,s._scale[0]=t,s._scale[1]=e,s}static rotation(t){const e=_e.identity();return e.data[0]=Math.cos(t),e.data[1]=Math.sin(t),e.data[2]=-Math.sin(t),e.data[3]=Math.cos(t),e}setPosition(t,e){this.data[4]=t,this.data[5]=e}getPosition(){return I(this.data[4],this.data[5])}rotate(t){const e=this.data[0],s=this.data[1],r=this.data[2],l=this.data[3],h=Math.sin(t),u=Math.cos(t);return this.data[0]=u*e+h*r,this.data[1]=u*s+h*l,this.data[2]=u*r-h*e,this.data[3]=u*l-h*s,this}translate(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3],u=this.data[4],f=this.data[5];return this.data[4]=s*t+l*e+u,this.data[5]=r*t+h*e+f,this}scale(t,e){const s=this.data[0],r=this.data[1],l=this.data[2],h=this.data[3];return this.data[0]=s*t,this.data[1]=r*t,this.data[2]=l*e,this.data[3]=h*e,this._scale[0]=t,this._scale[1]=e,this._scaleSignX=te(t),this._scaleSignY=te(e),this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const e=this.determinant();let s=e;e!==0&&(s=1/e);const r=this.data[0],l=this.data[2],h=this.data[1],u=this.data[3],f=t||_e.identity();f.data[0]=u*s,f.data[1]=-h*s,f.data[2]=-l*s,f.data[3]=r*s;const g=this.data[4],m=this.data[5];return f.data[4]=-(g*f.data[0]+m*f.data[2]),f.data[5]=-(g*f.data[1]+m*f.data[3]),f}multiply(t,e){if(t instanceof z){const s=e||new z(0,0),r=t,l=r.x*this.data[0]+r.y*this.data[2]+this.data[4],h=r.x*this.data[1]+r.y*this.data[3]+this.data[5];return s.x=l,s.y=h,s}else{const s=e||new _e,r=t,l=this.data[0],h=this.data[1],u=this.data[2],f=this.data[3],g=this.data[4],m=this.data[5],A=r.data[0],y=r.data[1],x=r.data[2],E=r.data[3],C=r.data[4],L=r.data[5];s.data[0]=l*A+u*y,s.data[1]=h*A+f*y,s.data[2]=l*x+u*E,s.data[3]=h*x+f*E,s.data[4]=l*C+u*L+g,s.data[5]=h*C+f*L+m;const D=this._scaleSignX,R=this._scaleSignY;return s._scaleSignX=D*te(s._scaleSignX),s._scaleSignY=R*te(s._scaleSignY),s}}multiplyQuadInPlace(t){const e=t[0]*this.data[0]+t[1]*this.data[2]+this.data[4],s=t[0]*this.data[1]+t[1]*this.data[3]+this.data[5];t[0]=e,t[1]=s;const r=t[2]*this.data[0]+t[3]*this.data[2]+this.data[4],l=t[2]*this.data[1]+t[3]*this.data[3]+this.data[5];t[2]=r,t[3]=l;const h=t[4]*this.data[0]+t[5]*this.data[2]+this.data[4],u=t[4]*this.data[1]+t[5]*this.data[3]+this.data[5];t[4]=h,t[5]=u;const f=t[6]*this.data[0]+t[7]*this.data[2]+this.data[4],g=t[6]*this.data[1]+t[7]*this.data[3]+this.data[5];t[6]=f,t[7]=g}to4x4(){const t=new Mi;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const e=this.getScale(),s=Math.sin(t),r=Math.cos(t);this.data[0]=r*e.x,this.data[1]=s*e.y,this.data[2]=-s*e.x,this.data[3]=r*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return vn(t)}getScaleX(){const t=this.data[0]*this.data[0]+this.data[2]*this.data[2];return t===1?this._scaleSignX:this._scaleSignX*Math.sqrt(t)}getScaleY(){const t=this.data[1]*this.data[1]+this.data[3]*this.data[3];return t===1?this._scaleSignY:this._scaleSignY*Math.sqrt(t)}getScale(){return I(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=te(t);const e=I(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[2]=e.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=te(t);const e=I(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[3]=e.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const e=t||new _e;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e._scaleSignX=this._scaleSignX,e._scaleSignY=this._scaleSignY,e}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class q_ extends z{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class yn extends z{constructor(t,e){super(t.x,t.y),this.original=t,this.change=e}get x(){return this._x=this.original.x}set x(t){t!==this._x&&(this.change(t,this._y),this._x=this.original.x=t)}get y(){return this._y=this.original.y}set y(t){t!==this._y&&(this.change(this._x,t),this._y=this.original.y=t)}setTo(t,e){this.x=t,this.y=e}}class wn{constructor(){this._parent=null,this._children=[],this._pos=new yn(I(0,0),()=>{this.flagDirty()}),this._globalPos=new q_({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:e}=this.parent.inverse.multiply(I(t,this.pos.y));this.pos.x=e}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:e}=this.parent.inverse.multiply(I(this.pos.x,t));this.pos.y=e}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}}),this._rotation=0,this._scale=new yn(I(1,1),()=>{this.flagDirty()}),this._globalScale=new q_({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.scale.x=t/e}else this.scale.x=t},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.scale.y=t/e}else this.scale.y=t}}),this._z=0,this._isDirty=!1,this._isInverseDirty=!1,this._matrix=_e.identity(),this._inverse=_e.identity(),this._scratch=_e.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const e=this._parent._children.indexOf(this);e>-1&&this._parent._children.splice(e,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){this._pos.x=t.x,this._pos.y=t.y}get pos(){return this._pos}set globalPos(t){let e=t.clone();this.parent&&(e=this.parent.inverse.multiply(t)),e.equals(this._pos)||(this._pos=e,this.flagDirty())}get globalPos(){return this._globalPos}set rotation(t){const e=vn(t);e!==this._rotation&&this.flagDirty(),this._rotation=e}get rotation(){return this._rotation}set globalRotation(t){let e=0;this.parent&&(e=this.parent.globalRotation);const s=vn(t+e);s!==this._rotation&&this.flagDirty(),this._rotation=s}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){this._scale.x=t.x,this._scale.y=t.y}get scale(){return this._scale}set globalScale(t){let e=I(1,1);this.parent&&(e=this.parent.globalScale),this.scale=t.scale(I(1/e.x,1/e.y))}get globalScale(){return this._globalScale}set z(t){this._z=t,this.flagDirty()}get z(){return this._z}set globalZ(t){this.parent?this.z=t-this.parent.globalZ:this.z=t}get globalZ(){return this.parent?this.z+this.parent.globalZ:this.z}get matrix(){return this._isDirty&&(this.parent===null?this._calculateMatrix().clone(this._matrix):this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this.matrix.inverse(this._inverse),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return this._scratch.data[0]=Math.cos(this._rotation),this._scratch.data[1]=Math.sin(this._rotation),this._scratch.data[2]=-Math.sin(this._rotation),this._scratch.data[3]=Math.cos(this.rotation),this._scratch.data[4]=this._pos.x,this._scratch.data[5]=this._pos.y,this._scratch.scale(this._scale.x,this._scale.y),this._scratch}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,e,s){this._pos.x=t.x,this._pos.y=t.y,this._rotation=vn(e),this._scale.x=s.x,this._scale.y=s.y,this.flagDirty()}isMirrored(){const t=te(this.scale.x)>>>31,e=te(this.scale.y)>>>31;return!!(t^e)}clone(t){const e=t??new wn;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.flagDirty(),e}cloneWithParent(t){const e=t??new wn;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.parent=this.parent,e.flagDirty(),e}toString(){return this.matrix.toString()}}function Lb(o){return!!o&&!!o.prototype&&!!o.prototype.constructor}function Fb(o){return!!(o!=null&&o.clone)}class ts{constructor(){this.owner=void 0}clone(){const t=new this.constructor;for(const e in this)if(this.hasOwnProperty(e)){const s=this[e];Fb(s)&&e!=="owner"&&e!=="clone"?t[e]=s.clone():t[e]=s}return t}}class gi{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);e!==-1&&this.subscriptions.splice(e,1)}notifyAll(t){const e=this.observers.length;for(let r=0;r<e;r++)this.observers[r].notify(t);const s=this.subscriptions.length;for(let r=0;r<s;r++)this.subscriptions[r](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class ot extends ts{constructor(){super(...arguments),this._logger=vt.getInstance(),this._parentComponent=null,this._transform=new wn,this._addChildTransform=t=>{const e=t.get(ot);e&&(e._transform.parent=this._transform,e._parentComponent=this)},this.zIndexChanged$=new gi,this._coordPlane=_i.World}get(){return this._transform}onAdd(t){for(const e of t.children)this._addChildTransform(e);t.childrenAdded$.subscribe(e=>this._addChildTransform(e)),t.childrenRemoved$.subscribe(e=>{const s=e.get(ot);s&&(s._transform.parent=null,s._parentComponent=null)})}onRemove(t){this._transform.parent=null,this._parentComponent=null}get z(){return this._transform.z}set z(t){const e=this._transform.z;this._transform.z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get globalZ(){return this._transform.globalZ}set globalZ(t){this._transform.globalZ=t}get coordPlane(){return this._parentComponent?this._parentComponent.coordPlane:this._coordPlane}set coordPlane(t){var e;this._parentComponent?this._logger.warn(`Cannot set coordinate plane on child entity ${(e=this.owner)==null?void 0:e.name}, children inherit their coordinate plane from their parents.`):this._coordPlane=t}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}clone(){const t=new ot;return t._transform=this._transform.clone(),t}}class Zt extends ts{constructor(){super(...arguments),this.vel=z.Zero,this.maxVel=z.One.scaleEqual(1/0),this.acc=z.Zero,this.scaleFactor=z.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}const Jn=class{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t)){const r=this._GROUPS.get(t);if(r.mask===e)return r;throw new Error(`Collision group ${t} already exists with a different mask!`)}const s=new $r(t,this._CURRENT_BIT,e!==void 0?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,s),s}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}};Jn._STARTING_BIT=1;Jn._MAX_GROUPS=32;Jn._CURRENT_GROUP=1;Jn._CURRENT_BIT=Jn._STARTING_BIT;Jn._GROUPS=new Map;let cd=Jn;const Cd=class{constructor(t,e,s){this._name=t,this._category=e,this._mask=s}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){const e=this.category&t.mask,s=this.mask&t.category;return e!==0&&s!==0}invert(){const t=cd.create("~("+this.name+")",~this.mask|0);return t._category=~this.category,t}static combine(t){const e=t.map(l=>l.name).join("+"),r=~t.reduce((l,h)=>h.category|l,0);return cd.create(e,r)}static collidesWith(t){const e=`collidesWith(${t.map(r=>r.name).join("+")})`,s=t.reduce((r,l)=>l.category|r,0);return cd.create(e,s)}toString(){return`
category: ${this.category.toString(2).padStart(32,"0")}
mask:     ${(this.mask>>>0).toString(2).padStart(32,"0")}
    `}};Cd.All=new Cd("Collide with all groups",-1,-1);let $r=Cd;class Rt{constructor(){this.other=null,this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class tA extends Rt{constructor(t){super(),this.self=t,this.target=t}}class Nb extends Rt{constructor(t){super(),this.self=t,this.target=t}}class Hb extends Rt{constructor(t){super(),this.self=t,this.target=t}}class Gb extends Rt{constructor(t){super(),this.self=t,this.target=t}}class Qb extends Rt{constructor(t){super(),this.self=t,this.target=t}}class Tc extends Rt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class Ec extends Rt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class jb extends Rt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class Vb extends Rt{constructor(t,e,s){super(),this.ctx=t,this.elapsed=e,this.self=s,this.target=s}}class Yb extends Rt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class qb extends Rt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class ia extends Rt{constructor(t,e,s){super(),this.engine=t,this.elapsed=e,this.self=s,this.target=s}}class sa extends Rt{constructor(t,e,s){super(),this.engine=t,this.elapsed=e,this.self=s,this.target=s}}class Xb extends Rt{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class Zb extends Rt{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class Wb extends Rt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Jb extends Rt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Kb extends Rt{constructor(t,e,s,r){super(),this.button=t,this.index=e,this.value=s,this.self=r,this.target=r}}class $b extends Rt{constructor(t,e,s){super(),this.axis=t,this.value=e,this.self=s,this.target=s}}class tw extends Rt{constructor(t){super(),this.self=t,this.target=t}}class ew extends Rt{constructor(t){super(),this.self=t,this.target=t}}class go extends Rt{constructor(t,e,s,r,l){super(),this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l,this.target=t}}class mo extends Rt{constructor(t,e,s,r,l){super(),this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l,this.target=t}}class X_{constructor(t,e,s,r){this.self=t,this.other=e,this.side=s,this.contact=r}}class Z_{constructor(t,e,s,r){this.self=t,this.other=e,this.side=s,this.lastContact=r}}class W_{constructor(t,e,s,r,l){this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l}}class J_{constructor(t,e,s,r,l){this.self=t,this.other=e,this.side=s,this.intersection=r,this.contact=l}}class Sd extends Rt{constructor(t,e,s,r){super(),this.self=t,this.other=e,this.side=s,this.contact=r,this.target=t}}class Td extends Rt{constructor(t,e,s,r){super(),this.self=t,this.other=e,this.side=s,this.lastContact=r,this.target=t}}class Dc extends Rt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class iw extends Rt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class sw extends Rt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class nw extends Rt{constructor(t){super(),this.self=t,this.target=t}}class rw extends Rt{constructor(t){super(),this.self=t,this.target=t}}class aw extends Rt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class ow extends Rt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class lw extends Rt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class cw extends Rt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class hw extends Rt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class uw extends Rt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}function dw(o){if(o.length===0)throw new Error("Cannot find minIndex of array.length == 0");let t=o[0],e=0;for(let s=1;s<o.length;s++)o[s]<t&&(t=o[s],e=s);return e}function Zl(o){if(o&&o.getBoundingClientRect){const t=o.getBoundingClientRect();return I(t.x+window.scrollX,t.y+window.scrollY)}return z.Zero}function To(o,t){let e=-1;return(e=t.indexOf(o))>-1?(t.splice(e,1),!0):!1}function fw(o,t){for(let e=0;e<o.length;e++)if(o[e]===t)return!0;return!1}function pw(o){throw new Error(o)}function Ed(o,t){var e;const s=new bn;return((e=t==null?void 0:t.schedule.bind(t))!=null?e:setTimeout)(()=>{s.resolve()},o),s.promise}function gw(o,t){const e={};for(const s in o)t.includes(s)||(e[s]=o[s]);return e}function hd(o){return o&&typeof o=="object"&&!Array.isArray(o)}function Dd(o,...t){if(!t.length)return o;const e=t.shift();if(hd(o)&&hd(e))for(const s in e)hd(e[s])?(o[s]||Object.assign(o,{[s]:{}}),Dd(o[s],e[s])):Object.assign(o,{[s]:e[s]});return Dd(o,...t)}const eA=class Rd{constructor(t,e){this.id=Rd._ID++,this.name=`Entity#${this.id}`,this.events=new ae,this._tags=new Set,this.componentAdded$=new gi,this.componentRemoved$=new gi,this.tagAdded$=new gi,this.tagRemoved$=new gi,this.components=new Map,this.componentValues=[],this._componentsToRemove=[],this.scene=null,this.isActive=!0,this._parent=null,this.childrenAdded$=new gi,this.childrenRemoved$=new gi,this._children=[],this._isInitialized=!1,this._isAdded=!1;let s,r;if(Array.isArray(t))s=t,r=e;else if(t&&typeof t=="object"){const{components:l,name:h}=t;s=l??[],r=h}if(r&&(this.name=r),s)for(const l of s)this.addComponent(l)}get active(){return this.isActive}set active(t){this.isActive=t}kill(){this.isActive&&(this.isActive=!1,this.unparent()),this.emit("kill",new tA(this))}isKilled(){return!this.isActive}get tags(){return this._tags}hasTag(t){return this._tags.has(t)}addTag(t){return this._tags.add(t),this.tagAdded$.notifyAll(t),this}removeTag(t){return this._tags.delete(t),this.tagRemoved$.notifyAll(t),this}get types(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}hasAll(t){for(let e=0;e<t.length;e++)if(!this.components.has(t[e]))return!1;return!0}hasAllTags(t){for(let e=0;e<t.length;e++)if(!this.tags.has(t[e]))return!1;return!0}get(t){return this.components.get(t)}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(To(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const s=e.pop();s&&(e=e.concat(s.children),t=t.concat(s.children))}return t}clone(){const t=new Rd;for(const e of this.types){const s=this.get(e);s&&t.addComponent(s.clone())}for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const s of t.getComponents())this.addComponent(s.clone(),e);for(const s of t.children)this.addChild(s.clone().addTemplate(s));return this}_getClassHierarchyRoot(t){var e,s;let r=t,l=(e=Object.getPrototypeOf(r.prototype))==null?void 0:e.constructor;for(;l&&l!==Object&&l!==ts;)r=l,l=(s=Object.getPrototypeOf(r.prototype))==null?void 0:s.constructor;return r}addComponent(t,e=!1){if(this.has(t.constructor))if(e)this.removeComponent(t.constructor,!0);else return this;if(t.dependencies&&t.dependencies.length)for(const r of t.dependencies)this.addComponent(new r);t.owner=this;const s=this._getClassHierarchyRoot(t.constructor);return this.components.set(s,t),this.components.set(t.constructor,t),this.componentValues.push(t),t.onAdd&&t.onAdd(this),this.componentAdded$.notifyAll(t),this}removeComponent(t,e=!1){let s;if(Lb(t)?s=t:s=t.constructor,e){const r=this.components.get(s);if(r){this.componentRemoved$.notifyAll(r),r.owner=void 0,r.onRemove&&r.onRemove(this);const h=this.componentValues.indexOf(r);h>-1&&this.componentValues.splice(h,1)}const l=this._getClassHierarchyRoot(s);this.components.delete(l),this.components.delete(s)}else this._componentsToRemove.push(s);return this}clearComponents(){const t=this.types;for(const e of t)this.removeComponent(e)}processComponentRemoval(){for(const t of this._componentsToRemove)this.removeComponent(t,!0);this._componentsToRemove.length=0}has(t){return this.components.has(t)}get isInitialized(){return this._isInitialized}get isAdded(){return this._isAdded}_initialize(t){this.isInitialized||(this.onInitialize(t),this.events.emit("initialize",new Dc(t,this)),this._isInitialized=!0)}_add(t){!this.isAdded&&this.isActive&&(this.onAdd(t),this.events.emit("add",new hw(t,this)),this._isAdded=!0)}_remove(t){this.isAdded&&!this.isActive&&(this.onRemove(t),this.events.emit("remove",new uw(t,this)),this._isAdded=!1)}_preupdate(t,e){this.events.emit("preupdate",new ia(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new sa(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onAdd(t){}onRemove(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e);for(const s of this.children)s.update(t,e);this._postupdate(t,e),this._remove(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}};eA._ID=0;let Ns=eA;class mw{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._childAddedHandlerMap=new Map,this._childRemovedHandlerMap=new Map,this._createChildAddedHandler=()=>e=>{this.addEntity(e)},this._createChildRemovedHandler=()=>e=>{this.removeEntity(e,!1)},this._entitiesToRemove=[]}updateEntities(t,e){for(let s=0;s<this.entities.length;s++){const r=this.entities[s];r.update(t.engine,e),r.isActive||this.removeEntity(r)}}findEntitiesForRemoval(){for(let t=0;t<this.entities.length;t++){const e=this.entities[t];e.isActive||this.removeEntity(e)}}addEntity(t){if(t.isActive=!0,t.scene=this._world.scene,t&&!this._entityIndex[t.id]){this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.children.forEach(r=>{r.scene=t.scene,this.addEntity(r)});const e=this._createChildAddedHandler();this._childAddedHandlerMap.set(t,e);const s=this._createChildRemovedHandler();this._childRemovedHandlerMap.set(t,s),t.childrenAdded$.subscribe(e),t.childrenRemoved$.subscribe(s)}}removeEntity(t,e=!0){var s,r;let l=0;t instanceof Ns?l=t.id:l=t;const h=this._entityIndex[l];if(h&&h.isActive&&(h.isActive=!1),h&&e){this._entitiesToRemove.push(h);return}if(delete this._entityIndex[l],h){h.scene=null,To(h,this.entities),this._world.queryManager.removeEntity(h),h.children.forEach(g=>{g.scene=null,this.removeEntity(g,e)});const u=this._childAddedHandlerMap.get(h);u&&(h.childrenAdded$.unsubscribe(u),this._childAddedHandlerMap.delete(h));const f=this._childRemovedHandlerMap.get(h);f&&(h.childrenRemoved$.unsubscribe(f),this._childRemovedHandlerMap.delete(h)),(r=(s=this._world)==null?void 0:s.scene)!=null&&r.engine&&this._world.scene.engine.stats.currFrame.actors.killed++}}processEntityRemovals(){for(let t=0;t<this._entitiesToRemove.length;t++){const e=this._entitiesToRemove[t];e.isActive||this.removeEntity(e,!1)}this._entitiesToRemove.length=0}processComponentRemovals(){for(let t=0;t<this.entities.length;t++)this.entities[t].processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(e=>e.name===t)}clear(){for(let t=this.entities.length-1;t>=0;t--)this.removeEntity(this.entities[t])}}class os{constructor(t){this.entities=[],this.entityAdded$=new gi,this.entityRemoved$=new gi,this.filter={components:{all:new Set,any:new Set,not:new Set},tags:{all:new Set,any:new Set,not:new Set}};var e,s,r,l,h,u,f,g,m,A,y,x;Array.isArray(t)&&(t={components:{all:t}}),this.filter.components.all=new Set((s=(e=t.components)==null?void 0:e.all)!=null?s:[]),this.filter.components.any=new Set((l=(r=t.components)==null?void 0:r.any)!=null?l:[]),this.filter.components.not=new Set((u=(h=t.components)==null?void 0:h.not)!=null?u:[]),this.filter.tags.all=new Set((g=(f=t.tags)==null?void 0:f.all)!=null?g:[]),this.filter.tags.any=new Set((A=(m=t.tags)==null?void 0:m.any)!=null?A:[]),this.filter.tags.not=new Set((x=(y=t.tags)==null?void 0:y.not)!=null?x:[]),this.id=os.createId(t)}static createId(t){var e,s,r,l,h,u,f,g,m,A,y,x;Array.isArray(t)&&(t={components:{all:t}});const E=(e=t.components)!=null&&e.any?`any_${os.hashComponents(new Set((s=t.components)==null?void 0:s.any))}`:"",C=(r=t.components)!=null&&r.all?`all_${os.hashComponents(new Set((l=t.components)==null?void 0:l.all))}`:"",L=(h=t.components)!=null&&h.not?`not_${os.hashComponents(new Set((u=t.components)==null?void 0:u.not))}`:"",D=(f=t.tags)!=null&&f.any?`any_${os.hashTags(new Set((g=t.tags)==null?void 0:g.any))}`:"",R=(m=t.tags)!=null&&m.all?`all_${os.hashTags(new Set((A=t.tags)==null?void 0:A.all))}`:"",P=(y=t.tags)!=null&&y.not?`not_${os.hashTags(new Set((x=t.tags)==null?void 0:x.not))}`:"";return[E,C,L,D,R,P].filter(Boolean).join("-")}static hashTags(t){return Array.from(t).map(e=>`t_${e}`).sort().join("-")}static hashComponents(t){return Array.from(t).map(e=>`c_${e.name}`).sort().join("-")}matches(t){for(const e of this.filter.components.all)if(!t.has(e))return!1;if(this.filter.components.any.size>0){let e=!1;for(const s of this.filter.components.any)if(t.has(s)){e=!0;break}if(!e)return!1}for(const e of this.filter.components.not)if(t.has(e))return!1;for(const e of this.filter.tags.all)if(!t.hasTag(e))return!1;if(this.filter.tags.any.size>0){let e=!1;for(const s of this.filter.tags.any)if(t.hasTag(s)){e=!0;break}if(!e)return!1}for(const e of this.filter.tags.not)if(t.hasTag(e))return!1;return!0}checkAndAdd(t){return this.matches(t)&&!this.entities.includes(t)?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class pc{constructor(t){if(this.requiredTags=t,this.tags=new Set,this.entities=[],this.entityAdded$=new gi,this.entityRemoved$=new gi,t.length===0)throw new Error("Cannot create tag query without tags");for(const e of t)this.tags.add(e);this.id=pc.createId(t)}static createId(t){return t.slice().sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAllTags(Array.from(this.tags))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class _w{constructor(t){this._world=t,this._queries=new Map,this._addComponentHandlers=new Map,this._removeComponentHandlers=new Map,this._componentToQueriesIndex=new Map,this._tagQueries=new Map,this._addTagHandlers=new Map,this._removeTagHandlers=new Map,this._tagToQueriesIndex=new Map,this._createAddComponentHandler=e=>s=>{this.addComponent(e,s)},this._createRemoveComponentHandler=e=>s=>{this.removeComponent(e,s)},this._createAddTagHandler=e=>s=>{this.addTag(e,s)},this._createRemoveTagHandler=e=>s=>{this.removeTag(e,s)}}createQuery(t){const e=os.createId(t);if(this._queries.has(e))return this._queries.get(e);const s=new os(t);this._queries.set(s.id,s);for(const r of[...s.filter.components.all,...s.filter.components.any,...s.filter.components.not]){const l=this._componentToQueriesIndex.get(r);l?l.push(s):this._componentToQueriesIndex.set(r,[s])}for(const r of this._world.entities)this.addEntity(r);return s}createTagQuery(t){const e=pc.createId(t);if(this._tagQueries.has(e))return this._tagQueries.get(e);const s=new pc(t);this._tagQueries.set(s.id,s);for(const r of t){const l=this._tagToQueriesIndex.get(r);l?l.push(s):this._tagToQueriesIndex.set(r,[s])}for(const r of this._world.entities)this.addEntity(r);return s}addEntity(t){const e=this._addComponentHandlers.get(t),s=this._removeComponentHandlers.get(t),r=e??this._createAddComponentHandler(t),l=s??this._createRemoveComponentHandler(t);this._addComponentHandlers.set(t,r),this._removeComponentHandlers.set(t,l);const h=this._addTagHandlers.get(t),u=this._removeTagHandlers.get(t),f=h??this._createAddTagHandler(t),g=u??this._createRemoveTagHandler(t);this._addTagHandlers.set(t,f),this._removeTagHandlers.set(t,g);for(const m of this._queries.values())m.checkAndAdd(t);for(const m of this._tagQueries.values())m.checkAndAdd(t);t.componentAdded$.subscribe(r),t.componentRemoved$.subscribe(l),t.tagAdded$.subscribe(f),t.tagRemoved$.subscribe(g)}removeEntity(t){const e=this._addComponentHandlers.get(t),s=this._removeComponentHandlers.get(t);for(const h of this._queries.values())h.removeEntity(t);e&&(t.componentAdded$.unsubscribe(e),this._addComponentHandlers.delete(t)),s&&(t.componentRemoved$.unsubscribe(s),this._removeComponentHandlers.delete(t));const r=this._addTagHandlers.get(t),l=this._removeTagHandlers.get(t);for(const h of this._tagQueries.values())h.removeEntity(t);r&&(t.tagAdded$.unsubscribe(r),this._addTagHandlers.delete(t)),l&&(t.tagRemoved$.unsubscribe(l),this._removeTagHandlers.delete(t))}addComponent(t,e){var s;const r=(s=this._componentToQueriesIndex.get(e.constructor))!=null?s:[];for(const l of r)l.checkAndAdd(t)}removeComponent(t,e){var s;const r=(s=this._componentToQueriesIndex.get(e.constructor))!=null?s:[];for(const l of r)l.removeEntity(t)}addTag(t,e){var s;const r=(s=this._tagToQueriesIndex.get(e))!=null?s:[];for(const l of r)l.checkAndAdd(t)}removeTag(t,e){var s;const r=(s=this._tagToQueriesIndex.get(e))!=null?s:[];for(const l of r)l.removeEntity(t)}}const Hs={Higher:-5,Average:0,Lower:5,Lowest:1/0};var Vi=(o=>(o.Update="update",o.Draw="draw",o))(Vi||{});class Yi{}Yi.priority=Hs.Average;function Aw(o){var t,e;return!!(o!=null&&o.prototype)&&!!((e=(t=o==null?void 0:o.prototype)==null?void 0:t.constructor)!=null&&e.name)}class yw{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(e=>e instanceof t)}addSystem(t){let e;t instanceof Yi?e=t:e=new t(this._world),this.systems.push(e),this.systems.sort((s,r)=>s.constructor.priority-r.constructor.priority),this.initialized&&e.initialize&&e.initialize(this._world,this._world.scene)}removeSystem(t){To(t,this.systems)}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world,this._world.scene)}}updateSystems(t,e,s){const r=this.systems.filter(l=>l.systemType===t);for(const l of r)l.preupdate&&l.preupdate(e,s);for(const l of r)l.update(s);for(const l of r)l.postupdate&&l.postupdate(e,s)}clear(){for(let t=this.systems.length-1;t>=0;t--)this.removeSystem(this.systems[t])}}class vw{constructor(t){this.scene=t,this._logger=vt.getInstance(),this.queryManager=new _w(this),this.entityManager=new mw(this),this.systemManager=new yw(this)}query(t){return this.queryManager.createQuery(t)}queryTags(t){return this.queryManager.createTagQuery(t)}update(t,e){t===Vi.Update&&this.entityManager.updateEntities(this.scene,e),this.systemManager.updateSystems(t,this.scene,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){if(t instanceof Ns){this.entityManager.addEntity(t);return}if(t instanceof Yi||Aw(t)){this.systemManager.addSystem(t);return}this._logger.warn(`Could not add entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get(t){return this.systemManager.get(t)}remove(t,e=!0){if(t instanceof Ns){this.entityManager.removeEntity(t,e);return}if(t instanceof Yi){this.systemManager.removeSystem(t);return}this._logger.warn(`Could not remove entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get entities(){return this.entityManager.entities}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}var Kt=(o=>(o.None="None",o.Top="Top",o.Bottom="Bottom",o.Left="Left",o.Right="Right",o))(Kt||{});(o=>{function t(s){return s==="Top"?"Bottom":s==="Bottom"?"Top":s==="Left"?"Right":s==="Right"?"Left":"None"}o.getOpposite=t;function e(s){return Math.abs(s.x)>=Math.abs(s.y)?s.x<=0?"Left":"Right":s.y<=0?"Top":"Bottom"}o.fromDirection=e})(Kt||(Kt={}));const iA=class Ye{constructor(t=0,e=0,s=0,r=0){this._points=[],typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=e,this.right=s,this.bottom=r)}clone(t){const e=t||new Ye(0,0,0,0);return e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e}reset(){this.left=0,this.top=0,this.bottom=0,this.right=0}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?Kt.Right:Kt.Left:t.y<0?Kt.Bottom:Kt.Top:Kt.None}static fromPoints(t){let e=1/0,s=1/0,r=-1/0,l=-1/0;for(let h=0;h<t.length;h++)t[h].x<e&&(e=t[h].x),t[h].x>r&&(r=t[h].x),t[h].y<s&&(s=t[h].y),t[h].y>l&&(l=t[h].y);return new Ye(e,s,r,l)}static fromDimension(t,e,s=z.Half,r=z.Zero){return new Ye(-t*s.x+r.x,-e*s.y+r.y,t-t*s.x+r.x,e-e*s.y+r.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new z((this.left+this.right)/2,(this.top+this.bottom)/2)}get topLeft(){return new z(this.left,this.top)}get bottomRight(){return new z(this.right,this.bottom)}get topRight(){return new z(this.right,this.top)}get bottomLeft(){return new z(this.left,this.bottom)}translate(t){return new Ye(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=z.Zero){const s=this.getPoints().map(r=>r.rotate(t,e));return Ye.fromPoints(s)}scale(t,e=z.Zero){const s=this.translate(e);return new Ye(s.left*t.x,s.top*t.y,s.right*t.x,s.bottom*t.y)}transform(t){const e=t.data[0]*this.left,s=t.data[1]*this.left,r=t.data[0]*this.right,l=t.data[1]*this.right,h=t.data[2]*this.top,u=t.data[3]*this.top,f=t.data[2]*this.bottom,g=t.data[3]*this.bottom,m=t.getPosition(),A=Math.min(e,r)+Math.min(h,f)+m.x,y=Math.min(s,l)+Math.min(u,g)+m.y,x=Math.max(e,r)+Math.max(h,f)+m.x,E=Math.max(s,l)+Math.max(u,g)+m.y;return new Ye({left:A,top:y,right:x,bottom:E})}getPerimeter(){const t=this.width,e=this.height;return 2*(t+e)}getPoints(){return(this._left!==this.left||this._right!==this.right||this._top!==this.top||this._bottom!==this.bottom)&&(this._points.length=0,this._points.push(new z(this.left,this.top)),this._points.push(new z(this.right,this.top)),this._points.push(new z(this.right,this.bottom)),this._points.push(new z(this.left,this.bottom)),this._left=this.left,this._right=this.right,this._top=this.top,this._bottom=this.bottom),this._points}rayCast(t,e=1/0){let s,r;const l=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,h=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,u=(this.left-t.pos.x)*l,f=(this.right-t.pos.x)*l;r=Math.min(u,f),s=Math.max(u,f);const g=(this.top-t.pos.y)*h,m=(this.bottom-t.pos.y)*h;return r=Math.max(r,Math.min(g,m)),s=Math.min(s,Math.max(g,m)),s>=0&&s>=r&&r<e}rayCastTime(t,e=1/0){let s,r;const l=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,h=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,u=(this.left-t.pos.x)*l,f=(this.right-t.pos.x)*l;r=Math.min(u,f),s=Math.max(u,f);const g=(this.top-t.pos.y)*h,m=(this.bottom-t.pos.y)*h;return r=Math.max(r,Math.min(g,m)),s=Math.min(s,Math.max(g,m)),s>=0&&s>=r&&r<e?r:-1}contains(t){return t instanceof z?this.left<=t.x&&this.top<=t.y&&t.y<=this.bottom&&t.x<=this.right:t instanceof Ye?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t,e){const s=e||new Ye(0,0,0,0),r=Math.min(this.left,t.left),l=Math.min(this.top,t.top),h=Math.max(this.right,t.right),u=Math.max(this.bottom,t.bottom);return s.left=r,s.top=l,s.right=h,s.bottom=u,s}get dimensions(){return new z(this.width,this.height)}overlaps(t,e){const s=e||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const r=this.combine(t);return r.width+s<t.width+this.width&&r.height+s<t.height+this.height}intersect(t){if(this.bottom<=t.top||t.bottom<=this.top||this.right<=t.left||t.right<=this.left)return null;const e=this.bottom-t.top;Ye._SCRATCH_INTERSECT[0]=e;const s=t.bottom-this.top;Ye._SCRATCH_INTERSECT[1]=s;const r=this.right-t.left;Ye._SCRATCH_INTERSECT[2]=r;const l=t.right-this.left;Ye._SCRATCH_INTERSECT[3]=l;const h=dw(Ye._SCRATCH_INTERSECT);switch(h){case 0:return new z(0,-e);case 1:return new z(0,s);case 2:return new z(-r,0);case 3:return new z(l,0);default:const u=h;throw new Error(`Unreachable index: [${u}] on bounding box intersection!`)}}intersectWithSide(t){const e=this.intersect(t);return Ye.getSideFromIntersection(e)}draw(t,e=$.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}};iA._SCRATCH_INTERSECT=[0,0,0,0];let Et=iA;class ei{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=ei.calculatePairHash(t.id,e.id)}static canCollide(t,e){var s,r;if(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions())return!1;const l=(s=t==null?void 0:t.owner)==null?void 0:s.get($t),h=(r=e==null?void 0:e.owner)==null?void 0:r.get($t);return!(!l||!h||!l.group.canCollide(h.group)||l.collisionType===mt.Fixed&&h.collisionType===mt.Fixed||h.collisionType===mt.PreventCollision||l.collisionType===mt.PreventCollision||!l.isActive||!h.isActive)}get canCollide(){const t=this.colliderA,e=this.colliderB;return ei.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class Rc{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class K_{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new Et,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class sA{constructor(t,e=new Et(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this._config=t,this.worldBounds=e,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const e=t.bounds;let s=this.root;for(;!s.isLeaf();){const u=s.left,f=s.right,g=s.bounds.getPerimeter(),A=s.bounds.combine(e).getPerimeter(),y=2*A,x=2*(A-g);let E=0;const C=e.combine(u.bounds);let L,D;u.isLeaf()?E=C.getPerimeter()+x:(D=u.bounds.getPerimeter(),L=C.getPerimeter(),E=L-D+x);let R=0;const P=e.combine(f.bounds);if(f.isLeaf()?R=P.getPerimeter()+x:(D=f.bounds.getPerimeter(),L=P.getPerimeter(),R=L-D+x),y<E&&y<R)break;E<R?s=u:s=f}const r=s.parent,l=new K_(r);l.bounds=e.combine(s.bounds),l.height=s.height+1,r!==null?(r.left===s?r.left=l:r.right=l,l.left=s,l.right=t,s.parent=l,t.parent=l):(l.left=s,l.right=t,s.parent=l,t.parent=l,this.root=l);let h=t.parent;for(;h;){if(h=this._balance(h),!h.left)throw new Error("Parent of current leaf cannot have a null left child"+h);if(!h.right)throw new Error("Parent of current leaf cannot have a null right child"+h);h.height=1+Math.max(h.left.height,h.right.height),h.bounds=h.left.bounds.combine(h.right.bounds),h=h.parent}}_remove(t){if(t===this.root){this.root=null;return}const e=t.parent,s=e.parent;let r;if(e.left===t?r=e.right:r=e.left,s){s.left===e?s.left=r:s.right=r,r.parent=s;let l=s;for(;l;)l=this._balance(l),l.bounds=l.left.bounds.combine(l.right.bounds),l.height=1+Math.max(l.left.height,l.right.height),l=l.parent}else this.root=r,r.parent=null}trackCollider(t){const e=new K_;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const s=this.nodes[t.id.value];if(!s)return!1;const r=t.bounds;if(!this.worldBounds.contains(r))return vt.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(s.bounds.contains(r))return!1;if(this._remove(s),r.left-=this._config.boundsPadding,r.top-=this._config.boundsPadding,r.right+=this._config.boundsPadding,r.bottom+=this._config.boundsPadding,t.owner){const l=(e=t.owner)==null?void 0:e.get($t);if(l){const h=l.vel.x*32/1e3*this._config.velocityMultiplier,u=l.vel.y*32/1e3*this._config.velocityMultiplier;h<0?r.left+=h:r.right+=h,u<0?r.top+=u:r.bottom+=u}}return s.bounds=r,this._insert(s),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,s=t.right,r=t,l=e,h=s,u=e.left,f=e.right,g=s.left,m=s.right,A=h.height-l.height;if(A>1)return h.left=r,h.parent=r.parent,r.parent=h,h.parent?h.parent.left===r?h.parent.left=h:h.parent.right=h:this.root=h,g.height>m.height?(h.right=g,r.right=m,m.parent=r,r.bounds=l.bounds.combine(m.bounds),h.bounds=r.bounds.combine(g.bounds),r.height=1+Math.max(l.height,m.height),h.height=1+Math.max(r.height,g.height)):(h.right=m,r.right=g,g.parent=r,r.bounds=l.bounds.combine(g.bounds),h.bounds=r.bounds.combine(m.bounds),r.height=1+Math.max(l.height,g.height),h.height=1+Math.max(r.height,m.height)),h;if(A<-1){if(l.left=r,l.parent=r.parent,r.parent=l,l.parent)if(l.parent.left===r)l.parent.left=l;else{if(l.parent.right!==r)throw"Error rotating Dynamic Tree";l.parent.right=l}else this.root=l;return u.height>f.height?(l.right=u,r.left=f,f.parent=r,r.bounds=h.bounds.combine(f.bounds),l.bounds=r.bounds.combine(u.bounds),r.height=1+Math.max(h.height,f.height),l.height=1+Math.max(r.height,u.height)):(l.right=f,r.left=u,u.parent=r,r.bounds=h.bounds.combine(u.bounds),l.bounds=r.bounds.combine(f.bounds),r.height=1+Math.max(h.height,u.height),l.height=1+Math.max(r.height,f.height)),l}return t}getHeight(){return this.root===null?0:this.root.height}query(t,e){const s=t.bounds,r=l=>{if(l&&l.bounds.overlaps(s))if(l.isLeaf()&&l.data!==t){if(e.call(t,l.data))return!0}else return r(l.left)||r(l.right);return!1};r(this.root)}rayCastQuery(t,e=1/0,s){const r=l=>{if(l&&l.bounds.rayCast(t,e))if(l.isLeaf()){if(s.call(t,l.data))return!0}else return r(l.left)||r(l.right);return!1};r(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=s=>{s&&(s.isLeaf()?s.bounds.draw(t,$.Green):s.bounds.draw(t,$.White),s.left&&e(s.left),s.right&&e(s.right))};e(this.root)}}class Xr{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&e.cross(this.dir)!==0)return-1;const s=this.dir.cross(t.getSlope());if(s===0)return-1;const r=e.cross(t.getSlope())/s;if(r>=0){const l=e.cross(this.dir)/s/t.getLength();if(l>=0&&l<=1)return r}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class Md{constructor(t){this._config=t,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[],this._dynamicCollisionTree=new sA(t.dynamicTree)}getColliders(){return this._colliders}query(t){const e=[];return t instanceof Et?this._dynamicCollisionTree.query({id:Kr("collider",-1),owner:null,bounds:t},s=>(e.push(s),!1)):this._dynamicCollisionTree.query({id:Kr("collider",-1),owner:null,bounds:new Et(t.x,t.y,t.x,t.y)},s=>(e.push(s),!1)),e}rayCast(t,e){var s,r,l;const h=[],u=(s=e==null?void 0:e.maxDistance)!=null?s:1/0,f=e==null?void 0:e.collisionGroup,g=f?f.category:(r=e==null?void 0:e.collisionMask)!=null?r:$r.All.category,m=(l=e==null?void 0:e.searchAllColliders)!=null?l:!1;return this._dynamicCollisionTree.rayCastQuery(t,u,A=>{const x=A.owner.get($t);if(e!=null&&e.ignoreCollisionGroupAll&&x.group===$r.All)return!1;const E=(g&x.group.category)!==0;if(x!=null&&x.group&&!E)return!1;const C=A.rayCast(t,u);if(C){if(e!=null&&e.filter){if(e.filter(C)&&(h.push(C),!m))return!0}else if(h.push(C),!m)return!0}return!1}),h}track(t){if(!t){vt.getInstance().warn("Cannot track null collider");return}if(t instanceof Qe){const e=t.getColliders();for(const s of e)s.owner=t.owner,this._colliders.push(s),this._dynamicCollisionTree.trackCollider(s)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){vt.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof Qe){const e=t.getColliders();for(const s of e){const r=this._colliders.indexOf(s);r!==-1&&this._colliders.splice(r,1),this._dynamicCollisionTree.untrackCollider(s)}}else{const e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,e){const s=ei.calculatePairHash(t.id,e.id);return this._pairs.has(s)}broadphase(t,e,s){const r=e/1e3,l=t.filter(u=>{var f,g;const m=(f=u.owner)==null?void 0:f.get($t);return((g=u.owner)==null?void 0:g.isActive)&&m.collisionType!==mt.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let h;for(let u=0,f=l.length;u<f;u++)h=l[u],this._dynamicCollisionTree.query(h,g=>{if(!this._pairExists(h,g)&&ei.canCollide(h,g)){const m=new ei(h,g);this._pairs.add(m.id),this._collisionPairCache.push(m)}return!1});if(s&&(s.physics.pairs=this._collisionPairCache.length),this._config.continuous.checkForFastBodies)for(const u of l){const f=u.owner.get($t);if((f==null?void 0:f.collisionType)!==mt.Active)continue;const g=f.vel.magnitude*r+f.acc.magnitude*.5*r*r,m=Math.min(u.bounds.height,u.bounds.width);if(this._config.continuous.disableMinimumSpeedForFastBody||g>m/2){s&&s.physics.fastBodies++;const A=f.globalPos.sub(f.oldPos),y=u.center,x=u.getFurthestPoint(f.vel),E=x.sub(A),C=new Xr(E,f.vel);C.pos=C.pos.add(C.dir.scale(-2*this._config.continuous.surfaceEpsilon));let L,D=new z(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(C,g+this._config.continuous.surfaceEpsilon*2,R=>{if(!this._pairExists(u,R)&&ei.canCollide(u,R)){const P=R.rayCast(C,g+this._config.continuous.surfaceEpsilon*10);if(P){const F=P.point.sub(E);F.magnitude<D.magnitude&&(D=F,L=R)}}return!1}),L&&z.isValid(D)){const R=new ei(u,L);this._pairs.has(R.id)||(this._pairs.add(R.id),this._collisionPairCache.push(R));const P=y.sub(x);f.globalPos=E.add(P).add(D).add(C.dir.scale(10*this._config.continuous.surfaceEpsilon)),u.update(f.transform.get()),s&&s.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let s=[];for(let r=0;r<t.length;r++){const l=t[r].collide();if(s=s.concat(l),e&&l.length>0)for(const h of l)e.physics.contacts.set(h.id,h)}return e&&(e.physics.collisions+=s.length),s}update(t){let e=0;const s=t.length;for(let r=0;r<s;r++)this._dynamicCollisionTree.updateCollider(t[r])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}const nA=class rA{constructor(){this.id=Kr("collider",rA._ID++),this.composite=null,this.events=new ae,this.offset=z.Zero}touching(t){const e=this.collide(t);return!!(e&&e.length>0)}};nA._ID=0;let Mc=nA;var hf=(o=>(o.Arcade="arcade",o.Realistic="realistic",o))(hf||{}),Kn=(o=>(o.None="none",o.VerticalFirst="vertical-first",o.HorizontalFirst="horizontal-first",o))(Kn||{});const aA={vertical:1,horizontal:2},oA={horizontal:1,vertical:2},lA={horizontal:0,vertical:0};var gc=(o=>(o.DynamicTree="dynamic-tree",o.SparseHashGrid="sparse-hash-grid",o))(gc||{});const xn=()=>({enabled:!0,gravity:I(0,0).clone(),solver:hf.Arcade,substep:1,colliders:{compositeStrategy:"together"},continuous:{checkForFastBodies:!0,disableMinimumSpeedForFastBody:!1,surfaceEpsilon:.1},bodies:{canSleepByDefault:!1,sleepEpsilon:.07,wakeThreshold:.07*3,sleepBias:.9,defaultMass:10},spatialPartition:gc.SparseHashGrid,sparseHashGrid:{size:100},dynamicTree:{boundsPadding:5,velocityMultiplier:2},arcade:{contactSolveBias:Kn.None},realistic:{contactSolveBias:Kn.None,positionIterations:3,velocityIterations:8,slop:1,steeringFactor:.2,warmStart:!0}});class Qe extends Mc{constructor(t){super(),this._collisionProcessor=new Md({...xn()}),this._dynamicAABBTree=new sA({boundsPadding:5,velocityMultiplier:2}),this._colliders=[];for(const e of t)this.addCollider(e)}set compositeStrategy(t){this._compositeStrategy=t}get compositeStrategy(){return this._compositeStrategy}clearColliders(){this._colliders=[]}addCollider(t){let e;t instanceof Qe?(e=t.getColliders(),e.forEach(s=>s.offset.addEqual(t.offset))):e=[t];for(const s of e)s.events.pipe(this.events),s.composite=this,this._colliders.push(s),this._collisionProcessor.track(s),this._dynamicAABBTree.trackCollider(s)}removeCollider(t){t.events.pipe(this.events),t.composite=null,To(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return((e=(t=this._transform)==null?void 0:t.pos)!=null?e:z.Zero).add(this.offset)}get center(){var t,e;return((e=(t=this._transform)==null?void 0:t.pos)!=null?e:z.Zero).add(this.offset)}get bounds(){var t,e;const s=this.getColliders();return s.reduce((l,h)=>l.combine(h.bounds),(e=(t=s[0])==null?void 0:t.bounds)!=null?e:new Et().translate(this.worldPos)).translate(this.offset)}get localBounds(){var t,e;const s=this.getColliders();return s.reduce((l,h)=>l.combine(h.localBounds),(e=(t=s[0])==null?void 0:t.localBounds)!=null?e:new Et)}get axes(){const t=this.getColliders();let e=[];for(const s of t)e=e.concat(s.axes);return e}getFurthestPoint(t){const e=this.getColliders(),s=[];for(const h of e)s.push(h.getFurthestPoint(t));let r=s[0],l=-Number.MAX_VALUE;for(const h of s){const u=h.dot(t);u>l&&(r=h,l=u)}return r}getInertia(t){const e=this.getColliders();let s=0;for(const r of e)s+=r.getInertia(t);return s}collide(t){let e=[t];t instanceof Qe&&(e=t.getColliders());const s=[];for(const l of e)this._dynamicAABBTree.query(l,h=>(s.push(new ei(l,h)),!1));let r=[];for(const l of s)r=r.concat(l.collide());return r}getClosestLineBetween(t){const e=this.getColliders(),s=[];if(t instanceof Qe){const r=t.getColliders();for(const l of e)for(const h of r){const u=l.getClosestLineBetween(h);u&&s.push(u)}}else for(const r of e){const l=t.getClosestLineBetween(r);l&&s.push(l)}if(s.length){let r=s[0].getLength(),l=s[0];for(const h of s){const u=h.getLength();u<r&&(r=u,l=h)}return l}return null}contains(t){const e=this.getColliders();for(const s of e)if(s.contains(t))return!0;return!1}rayCast(t,e){const s=this.getColliders(),r=[];for(const l of s){const h=l.rayCast(t,e);h&&r.push(h)}if(r.length){let l=r[0],h=l.point.dot(t.dir);for(const u of r){const f=t.dir.dot(u.point);f<h&&(l=u,h=f)}return l}return null}project(t){const e=this.getColliders(),s=[];for(const r of e){const l=r.project(t);l&&s.push(l)}if(s.length){const r=new Rc(s[0].min,s[0].max);for(const l of s)r.min=Math.min(l.min,r.min),r.max=Math.max(l.max,r.max);return r}return null}update(t){if(t){const e=this.getColliders();for(const s of e)s.owner=this.owner,s.update(t)}}debug(t,e,s){const r=this.getColliders();t.save(),t.translate(this.offset.x,this.offset.y);for(const l of r)l.debug(t,e,s);t.restore()}clone(){const t=new Qe(this._colliders.map(e=>e.clone()));return t.offset=this.offset.clone(),t}}class ye{constructor(t,e){this.begin=t,this.end=e}clone(t){const e=t||new ye(this.begin.clone(),this.end.clone());return e.begin=this.begin.clone(e.begin),e.end=this.end.clone(e.end),e}transform(t,e){const s=e||new ye(z.Zero,z.Zero);return s.begin=t.multiply(this.begin,s.begin),s.end=t.multiply(this.end,s.end),s}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,e=this.end,s=t.distance(e);return this._slope=e.sub(t).scale(1/s)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new ye(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e,s=!0){let r=t;s&&(r=r.normalize());const l=r.dot(this.begin)-e,h=r.dot(this.end)-e,u=[];if(l<=0&&u.push(this.begin),h<=0&&u.push(this.end),l*h<0){const f=l/(l-h);u.push(this.begin.add(this.end.sub(this.begin).scale(f)))}return u.length!==2?null:new ye(u[0],u[1])}distanceToPoint(t,e=!1){const s=t.x,r=t.y,l=this.getLength(),h=this.end.y-this.begin.y,u=this.end.x-this.begin.x,f=(h*s-u*r+this.end.x*this.begin.y-this.end.y*this.begin.x)/l;return e?f:Math.abs(f)}findVectorToPoint(t){const e=this.begin.sub(t),s=this.getSlope();return e.sub(s.scale(e.dot(s)))}findPoint(t=null,e=null){const s=this.slope,r=this.intercept;if(t!==null)return new z(t,s*t+r);if(e!==null)return new z((e-r)/s,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new z(arguments[0],arguments[1]),e=arguments[2]||0;else if(arguments[0]instanceof z)t=arguments[0],e=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const s=t.x-this.begin.x,r=t.y-this.begin.y,l=this.end.x-this.begin.x,h=this.end.y-this.begin.y,u=s*h-r*l;return Math.abs(u)>e?!1:Math.abs(l)>=Math.abs(h)?l>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:h>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function ud(o,t){const s=o.dir(),r=t.dir(),l=s.dot(s),h=r.dot(r);if(l<1e-9&&h<1e-9)return new ye(o.begin,t.begin);if(l<1e-9){const L=Bt(r.dot(o.begin.sub(t.begin))/h,0,1),D=t.begin.add(r.scale(L));return new ye(o.begin,D)}if(h<1e-9){const L=Bt(s.dot(t.begin.sub(o.begin))/l,0,1),D=o.begin.add(s.scale(L));return new ye(D,t.begin)}const u=o.begin.sub(t.begin),f=l,g=h,m=r.dot(u),A=f*g-Math.pow(s.dot(r),2);let y=0,x=0;Math.abs(A)>1e-9?y=Bt((s.dot(r)*m-g*s.dot(u))/A,0,1):y=Bt(s.dot(u)/f,0,1),Math.abs(g)>1e-9?x=Bt((s.dot(r)*y+m)/g,0,1):x=0;const E=o.begin.add(s.scale(y)),C=t.begin.add(r.scale(x));return new ye(E,C)}const Ls={PolygonPolygonClosestLine(o,t){const e=o.getSides(),s=t.getSides();let r=Number.MAX_VALUE,l=null;for(let h=0;h<e.length;h++)for(let u=0;u<s.length;u++){const f=ud(e[h],s[u]),g=f.getLength();g<r&&(r=g,l=f)}return l},PolygonEdgeClosestLine(o,t){const s=t.worldPos.sub(o.worldPos),r=new Xr(o.worldPos,s),l=o.rayCast(r).point.add(r.dir.scale(.1)),h=o.getClosestFace(l),u=t.asLine();return ud(h.face,u)},PolygonCircleClosestLine(o,t){const e=t.worldPos,s=e.sub(o.worldPos),r=new Xr(o.worldPos,s.normalize()),l=o.rayCast(r).point.add(r.dir.scale(.1)),h=o.getClosestFace(l),u=h.face.begin,f=h.face.getEdge();let g=(f.x*(e.x-u.x)+f.y*(e.y-u.y))/(f.x*f.x+f.y*f.y);g>1?g=1:g<0&&(g=0);const m=Math.sqrt(Math.pow(u.x+f.x*g-e.x,2)+Math.pow(u.y+f.y*g-e.y,2))-t.radius,A=(u.x+f.x*g-e.x)*t.radius/(t.radius+m),y=(u.y+f.y*g-e.y)*t.radius/(t.radius+m);return new ye(f.scale(g).add(u),new z(e.x+A,e.y+y))},CircleCircleClosestLine(o,t){const s=t.worldPos.sub(o.worldPos),l=o.worldPos.sub(t.worldPos),h=new Xr(o.worldPos,s),u=new Xr(t.worldPos,l),f=o.rayCast(h),g=t.rayCast(u);return new ye(f.point,g.point)},CircleEdgeClosestLine(o,t){const e=o.worldPos,s=t.asLine(),r=s.begin,l=s.getEdge(),h=r,u=l;let f=(u.x*(e.x-h.x)+u.y*(e.y-h.y))/(u.x*u.x+u.y*u.y);f>1?f=1:f<0&&(f=0);const g=Math.sqrt(Math.pow(h.x+u.x*f-e.x,2)+Math.pow(h.y+u.y*f-e.y,2))-o.radius,m=(h.x+u.x*f-e.x)*o.radius/(o.radius+g),A=(h.y+u.y*f-e.y)*o.radius/(o.radius+g);return new ye(u.scale(f).add(h),new z(e.x+m,e.y+A))},EdgeEdgeClosestLine(o,t){const e=o.asLine(),s=t.asLine();return ud(e,s)}};class Xe extends Mc{constructor(t){super(),this.offset=z.Zero,this._globalMatrix=_e.identity(),this._localBoundsDirty=!0,this.offset=t.offset||z.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;if(this._radius)return this._radius;const e=this._transform,s=(t=e==null?void 0:e.globalScale)!=null?t:z.One;return this._radius=this._naturalRadius*Math.min(s.x,s.y)}set radius(t){var e;const s=this._transform,r=(e=s==null?void 0:s.globalScale)!=null?e:z.One;this._naturalRadius=t/Math.min(r.x,r.y),this._localBoundsDirty=!0,this._radius=t}clone(){return new Xe({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var e,s;return((s=(e=this._transform)==null?void 0:e.pos)!=null?s:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){var s,r;const l=this.center,h=t.dir,u=t.pos,f=l.sub(u),g=h.scale(f.dot(h)),A=f.sub(g).magnitude;if(A>this.radius)return null;{let y=0;if(zb(A,this.radius,1e-4)){if(y=-h.dot(u.sub(l)),y>0&&y<e){const x=t.getPoint(y);return{point:x,normal:x.sub(l).normalize(),collider:this,body:(s=this.owner)==null?void 0:s.get($t),distance:y}}return null}else{const x=Math.sqrt(Math.pow(h.dot(u.sub(l)),2)-Math.pow(u.sub(l).distance(),2)+Math.pow(this.radius,2)),E=-h.dot(u.sub(l))+x,C=-h.dot(u.sub(l))-x,L=[];E>=0&&L.push(E),C>=0&&L.push(C);const D=Math.min(...L);if(D<=e){const R=t.getPoint(D);return{point:R,normal:R.sub(l).normalize(),collider:this,body:(r=this.owner)==null?void 0:r.get($t),distance:D}}return null}}}getClosestLineBetween(t){if(t instanceof Xe)return Ls.CircleCircleClosestLine(this,t);if(t instanceof Ne)return Ls.PolygonCircleClosestLine(t,this).flip();if(t instanceof Pi)return Ls.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Xe)return hs.CollideCircleCircle(this,t);if(t instanceof Ne)return hs.CollideCirclePolygon(this,t);if(t instanceof Pi)return hs.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=new Et(-this._naturalRadius,-this._naturalRadius,+this._naturalRadius,+this._naturalRadius),this._localBoundsDirty=!1),this._localBounds}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var e;this._transform=t,((e=t.matrix)!=null?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y),this._radius=void 0}project(t){const e=[],r=this.center.dot(t);return e.push(r),e.push(r+this.radius),e.push(r-this.radius),new Rc(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e,s){var r,l,h,u;const{lineWidth:f}={lineWidth:1,...s},g=this._transform,m=(r=g==null?void 0:g.globalScale)!=null?r:z.One,A=(l=g==null?void 0:g.globalRotation)!=null?l:0,y=(h=g==null?void 0:g.globalPos)!=null?h:z.Zero;t.save(),t.translate(y.x,y.y),t.rotate(A),t.scale(m.x,m.y),t.drawCircle((u=this.offset)!=null?u:z.Zero,this._naturalRadius,$.Transparent,e,f),t.restore()}}class Qr{constructor(t,e,s,r,l,h,u,f){this._canceled=!1,this.bodyA=null,this.bodyB=null;var g,m,A,y,x,E;if(this.colliderA=t,this.colliderB=e,this.mtv=s,this.normal=r,this.tangent=l,this.points=h,this.localPoints=u,this.info=f,this.id=ei.calculatePairHash(t.id,e.id),t.composite||e.composite){const C=((g=t.composite)==null?void 0:g.compositeStrategy)==="separate"?t.id:(A=(m=t.composite)==null?void 0:m.id)!=null?A:t.id,L=((y=e.composite)==null?void 0:y.compositeStrategy)==="separate"?e.id:(E=(x=e.composite)==null?void 0:x.id)!=null?E:e.id;this.id+="|"+ei.calculatePairHash(C,L)}this.colliderA.owner&&(this.bodyA=this.colliderA.owner.get($t)),this.colliderB.owner&&(this.bodyB=this.colliderB.owner.get($t))}matchAwake(){const t=this.bodyA,e=this.bodyB;t&&e&&t.isSleeping!==e.isSleeping&&(t.isSleeping&&t.collisionType!==mt.Fixed&&e.sleepMotion>=t.wakeThreshold&&(t.isSleeping=!1),e.isSleeping&&e.collisionType!==mt.Fixed&&t.sleepMotion>=e.wakeThreshold&&(e.isSleeping=!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}bias(t){if(t!==this.colliderA&&t!==this.colliderB)throw new Error("Collider must be either colliderA or colliderB from this contact");if(t===this.colliderA)return this;const e=this.colliderA,s=this.colliderB;return this.colliderB=e,this.colliderA=s,this.mtv=this.mtv.negate(),this.normal=this.normal.negate(),this.tangent=this.tangent.negate(),this}}class uf{constructor(t,e,s=100){this.builder=t,this.recycler=e,this.maxObjects=s,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=vt.getInstance()}dispose(){this.objects.length=0}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){const e=this.get();t(e),this.index--}get(){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler?this.recycler(this.objects[this.index++]):this.objects[this.index++]:(this.totalAllocations++,this.objects[this.index++]=this.builder())}done(...t){this.index=0;for(const e of t){const s=this.objects.indexOf(e);this.objects[s]=this.builder(),this.totalAllocations++}return t}}class xw{constructor(){this.axis=I(0,0),this.localAxis=I(0,0),this.side=new ye(I(0,0),I(0,0)),this.localSide=new ye(I(0,0),I(0,0)),this.point=I(0,0),this.localPoint=I(0,0)}}const tr=class ks{static findPolygonPolygonSeparation(t,e){if(e.transform.matrix.determinant()===0)return ks.findPolygonPolygonSeparationDegenerate(t,e);let s=-Number.MAX_VALUE,r=-1,l;const h=e.transform.inverse.multiply(t.transform.matrix,ks._SCRATCH_MATRIX),u=h.getRotation(),f=t.normals,g=t.points,m=e.points;for(let x=0;x<g.length;x++){const E=f[x].rotate(u,ks._ZERO,ks._SCRATCH_NORMAL),C=h.multiply(g[x],ks._SCRATCH_POINT);let L=Number.MAX_VALUE,D;for(let R=0;R<m.length;R++){const P=E.dot(m[R].sub(C,ks._SCRATCH_SUB_POINT));P<L&&(L=P,D=m[R])}L>s&&(s=L,r=x,l=D)}const A=(r+1)%g.length,y=ks.SeparationPool.get();return y.collider=t,y.separation=s,s>0||(f[r].clone(y.localAxis),f[r].rotate(t.transform.rotation,ks._ZERO,y.axis),t.transform.matrix.multiply(g[r],y.side.begin),t.transform.matrix.multiply(g[A],y.side.end),e.transform.matrix.multiply(l,y.point),y.sideId=r,l.clone(y.localPoint),g[r].clone(y.localSide.begin),g[A].clone(y.localSide.end)),y}static findCirclePolygonSeparation(t,e){const s=e.axes,l=e.center.sub(t.worldPos),h=e.getFurthestPoint(l.negate());s.push(h.sub(t.worldPos).normalize());let u=Number.MAX_VALUE,f=null,g=-1;for(let m=0;m<s.length;m++){const A=e.project(s[m]),y=t.project(s[m]),x=A.getOverlap(y);if(x<=0)return null;x<u&&(u=x,f=s[m],g=m)}return g<0?null:f.normalize().scale(u)}static findPolygonPolygonSeparationDegenerate(t,e){let s=-Number.MAX_VALUE,r=null,l=null,h=-1,u=null;const f=t.getSides(),g=t.getLocalSides();for(let m=0;m<f.length;m++){const A=f[m],y=A.normal(),x=e.getFurthestPoint(y.negate()),E=A.distanceToPoint(x,!0);E>s&&(s=E,r=A,l=y,h=m,u=x)}return{collider:t,separation:l?s:99,axis:l,side:r,localSide:g[h],sideId:h,point:u,localPoint:l?e.getFurthestLocalPoint(l.negate()):null}}};tr.SeparationPool=new uf(()=>new xw,o=>o,500);tr._ZERO=I(0,0);tr._SCRATCH_POINT=I(0,0);tr._SCRATCH_SUB_POINT=I(0,0);tr._SCRATCH_NORMAL=I(0,0);tr._SCRATCH_MATRIX=_e.identity();let ao=tr;ao.SeparationPool.disableWarnings=!0;const bw=z.Zero,ww=z.Zero,Cw=_e.identity(),hs={CollideCircleCircle(o,t){const e=o.worldPos,s=t.worldPos,r=o.radius+t.radius,l=e.distance(s);if(l>r)return[];const h=r-l,u=s.sub(e).normalize(),f=u.perpendicular(),g=u.scale(h),m=o.getFurthestPoint(u),A=o.getFurthestLocalPoint(u),y={collider:o,separation:h,axis:u,point:m};return[new Qr(o,t,g,u,f,[m],[A],y)]},CollideCirclePolygon(o,t){var e,s;let r=ao.findCirclePolygonSeparation(o,t);if(!r)return[];r=r.dot(t.center.sub(o.center))<0?r.negate():r;const h=o.getFurthestPoint(r),f=((s=(e=o.owner)==null?void 0:e.get(ot))!=null?s:new ot).applyInverse(h),g=r.normalize(),m={collider:o,separation:-r.magnitude,axis:g,point:h,localPoint:f,side:t.findSide(g.negate()),localSide:t.findLocalSide(g.negate())};return[new Qr(o,t,r,g,g.perpendicular(),[h],[f],m)]},CollideCircleEdge(o,t){const e=o.center,s=t.asLine(),r=s.end.sub(s.begin),l=r.dot(s.end.sub(e)),h=r.dot(e.sub(s.begin)),u=t.asLine(),f=t.asLocalLine();if(h<=0){const D=s.begin.sub(e),R=D.dot(D);if(R>o.radius*o.radius)return[];const P=D.normalize(),F=o.radius-Math.sqrt(R),Y={collider:o,separation:F,axis:P,point:u.begin,side:u,localSide:f};return[new Qr(o,t,P.scale(F),P,P.perpendicular(),[u.begin],[f.begin],Y)]}if(l<=0){const D=s.end.sub(e),R=D.dot(D);if(R>o.radius*o.radius)return[];const P=D.normalize(),F=o.radius-Math.sqrt(R),Y={collider:o,separation:F,axis:P,point:u.end,side:u,localSide:f};return[new Qr(o,t,P.scale(F),P,P.perpendicular(),[u.end],[f.end],Y)]}const g=r.dot(r),m=s.begin.scale(l).add(s.end.scale(h)).scale(1/g),A=e.sub(m),y=A.dot(A);if(y>o.radius*o.radius)return[];let x=r.perpendicular();x.dot(e.sub(s.begin))<0&&(x.x=-x.x,x.y=-x.y),x=x.normalize();const E=o.radius-Math.sqrt(y),C=x.scale(E),L={collider:o,separation:E,axis:x,point:m,side:u,localSide:f};return[new Qr(o,t,C,x.negate(),x.negate().perpendicular(),[m],[m.sub(t.worldPos)],L)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(o,t){var e;const s=o.center,l=t.center.sub(s).normalize(),h=new Ne({points:[t.begin,t.end,t.end.add(l.scale(100)),t.begin.add(l.scale(100))],offset:t.offset});h.owner=t.owner,((e=t.owner)==null?void 0:e.get(ot))&&h.update(t.owner.get(ot).get());const f=this.CollidePolygonPolygon(o,h);return f.length&&(f[0].colliderB=t,f[0].id=ei.calculatePairHash(o.id,t.id)),f},CollidePolygonPolygon(o,t){const e=ao.findPolygonPolygonSeparation(o,t);if(e.separation>0)return[];const s=ao.findPolygonPolygonSeparation(t,o);if(s.separation>0)return[];const r=e.separation>s.separation?e:s,l=r.collider===o?t:o,h=r.collider===o?o:t,u=l.transform.inverse.multiply(h.transform.matrix,Cw),f=u.getRotation(),g=h.normals[r.sideId].rotate(f,bw,ww);let m=Number.MAX_VALUE,A=0;for(let D=0;D<l.normals.length;D++){const R=g.dot(l.normals[D]);R<m&&(m=R,A=D)}if(!r.localSide||!r.localAxis||!r.axis)return[];const y=r.localSide.transform(u),x=r.localAxis.perpendicular().negate().rotate(f),C=new ye(l.points[A],l.points[(A+1)%l.points.length]).clip(x.negate(),-x.dot(y.begin),!1);let L=null;if(C&&(L=C.clip(x,x.dot(y.end),!1)),L){const D=[],R=[],P=L.getPoints();for(let et=0;et<P.length;et++){const k=P[et];y.below(k)&&(D.push(k),R.push(l.transform.apply(k)))}let F=r.axis,Y=F.perpendicular();return t.center.sub(o.center).dot(F)<0&&(F=F.negate(),Y=F.perpendicular()),[new Qr(o,t,F.scale(-r.separation),F,Y,R,D,r)]}return[]},FindContactSeparation(o,t){var e,s,r,l;const h=o.colliderA,u=(s=(e=o.bodyA)==null?void 0:e.transform)!=null?s:new ot,f=o.colliderB,g=(l=(r=o.bodyB)==null?void 0:r.transform)!=null?l:new ot;if(h instanceof Xe&&f instanceof Xe){const m=h.radius+f.radius,A=u.pos.distance(g.pos);return-(m-A)}if(h instanceof Ne&&f instanceof Ne&&o.info.localSide){let m,A;return o.info.collider===h?(m=new ye(u.apply(o.info.localSide.begin).add(h.offset),u.apply(o.info.localSide.end).add(h.offset)),A=g.apply(t).add(f.offset)):(m=new ye(g.apply(o.info.localSide.begin).add(f.offset),g.apply(o.info.localSide.end).add(f.offset)),A=u.apply(t).add(h.offset)),m.distanceToPoint(A,!0)}if(h instanceof Ne&&f instanceof Xe||f instanceof Ne&&h instanceof Xe){const m=u.apply(t);if(o.info.side)return o.info.side.distanceToPoint(m,!0)}if(h instanceof Pi&&f instanceof Ne||f instanceof Pi&&h instanceof Ne){let m;if(o.info.collider===h?m=g.apply(t):m=u.apply(t),o.info.side)return o.info.side.distanceToPoint(m,!0)}if(h instanceof Xe&&f instanceof Pi||f instanceof Xe&&h instanceof Pi){const m=g.apply(t);let A;h instanceof Xe&&(A=h.getFurthestPoint(o.normal));const y=m.distance(A);if(o.info.side)return y>0?-y:0}return 0}};class Pi extends Mc{constructor(t){var e;super(),this._globalMatrix=_e.identity(),this.begin=t.begin||z.Zero,this.end=t.end||z.Zero,this.offset=(e=t.offset)!=null?e:z.Zero}clone(){return new Pi({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return(t=e==null?void 0:e.globalPos.add(this.offset))!=null?t:this.offset}get center(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.average(e)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),s=t.distance(e);return e.sub(t).scale(1/s)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){var s;const r=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&r.cross(t.dir)!==0)return null;const l=t.dir.cross(this.getSlope());if(l===0)return null;const h=r.cross(this.getSlope())/l;if(h>=0&&h<=e){const u=r.cross(t.dir)/l/this.getLength();if(u>=0&&u<=1)return{distance:h,normal:this.asLine().normal(),collider:this,body:(s=this.owner)==null?void 0:s.get($t),point:t.getPoint(h)}}return null}getClosestLineBetween(t){if(t instanceof Xe)return Ls.CircleEdgeClosestLine(t,this);if(t instanceof Ne)return Ls.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Pi)return Ls.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Xe)return hs.CollideCircleEdge(t,this);if(t instanceof Ne)return hs.CollidePolygonEdge(t,this);if(t instanceof Pi)return hs.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),s=this._getTransformedEnd();return t.dot(e)>0?e:s}_boundsFromBeginEnd(t,e,s=10){return new Et(Math.min(t.x,e.x)-s,Math.min(t.y,e.y)-s,Math.max(t.x,e.x)+s,Math.max(t.y,e.y)+s)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new ye(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new ye(this.begin,this.end)}get axes(){const e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),s=[];return s.push(e),s.push(e.negate()),s.push(e.normal()),s.push(e.normal().negate()),s}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){var e;this._transform=t,((e=t.matrix)!=null?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],s=[this._getTransformedBegin(),this._getTransformedEnd()],r=s.length;for(let l=0;l<r;l++)e.push(s[l].dot(t));return new Rc(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){const s=this._getTransformedBegin(),r=this._getTransformedEnd();t.drawLine(s,r,e,2),t.drawCircle(s,2,e),t.drawCircle(r,2,e)}}class Ne extends Mc{constructor(t){var e;super(),this._logger=vt.getInstance(),this._transform=new wn,this._transformedPoints=[],this._sides=[],this._localSides=[],this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(e=t.offset)!=null?e:z.Zero,this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y,this.points=t.points,this.isConvex()||t.suppressConvexWarning||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}flagDirty(){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._transformedPointsDirty=!0,this._sidesDirty=!0}get normals(){return this._normals}set points(t){if(t.length<3)throw new Error("PolygonCollider cannot be created with less that 3 points");this._points=t,this._checkAndUpdateWinding(this._points),this._calculateNormals(),this.flagDirty()}_calculateNormals(){const t=[];for(let e=0;e<this._points.length;e++)t.push(this._points[(e+1)%this._points.length].sub(this._points[e]).normal());this._normals=t}get points(){return this._points}get transform(){return this._transform}_checkAndUpdateWinding(t){this._isCounterClockwiseWinding(t)||t.reverse()}_isCounterClockwiseWinding(t){let e=0;for(let s=0;s<t.length;s++)e+=(t[(s+1)%t.length].x-t[s].x)*(t[(s+1)%t.length].y+t[s].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],s=Math.atan2(e.y-t.y,e.x-t.x),r=0,l=0,h=0;for(const[u,f]of this.points.entries()){if(t=e,r=s,e=f,s=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let g=s-r;if(g<=-Math.PI?g+=Math.PI*2:g>Math.PI&&(g-=Math.PI*2),u===0){if(g===0)return!1;l=g>0?1:-1}else if(l*g<=0)return!1;h+=g}return Math.abs(Math.round(h/(Math.PI*2)))===1}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new Qe(t.map(e=>Ze.Polygon(e)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");const t=[],e=[...this.points].reverse();let s=e.length;function r(A){return A===0?s-1:A-1}function l(A){return A===s-1?0:A+1}function h(A){const y=r(A),x=l(A),E=e[y],C=e[A],L=e[x],D=E.sub(C),R=L.sub(C);return!(D.cross(R)<0)}const u=e.map((A,y)=>h(y));function f(A,y,x,E){const C=x.sub(y),L=E.sub(x),D=y.sub(E),R=A.sub(y),P=A.sub(x),F=A.sub(E),Y=C.cross(R),et=L.cross(P),k=D.cross(F);return!(Y>0||et>0||k>0)}function g(){for(let A=0;A<s;A++)if(u[A]){const y=r(A),x=l(A),E=e[y],C=e[A],L=e[x];let D=!0;for(let R=0;R<s;R++){if(R===A||R===y||R===x)continue;const P=e[R];if(f(P,E,C,L)){D=!1;break}}if(D)return A}for(let A=0;A<s;A++)if(u[A])return A;return 0}function m(A){const y=r(A),x=l(A),E=e[y],C=e[A],L=e[x];t.push([E,C,L]),e.splice(A,1),u.splice(A,1),s--}for(;s>3;){const A=g();m(A);for(let y=0;y<s;y++)u[y]=h(y)}return t.push([e[0],e[1],e[2]]),new Qe(t.map(A=>Ze.Polygon(A,z.Zero,!0)))}clone(){return new Ne({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform.pos}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,e=t.length;this._transformedPoints.length=0;for(let s=0;s<e;s++)this._transformedPoints[s]=this._transform.apply(t[s].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],e=this.getTransformedPoints(),s=e.length;for(let r=0;r<s;r++)t.push(new ye(e[r],e[(r+1)%s]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],e=this.points,s=e.length;for(let r=0;r<s;r++)t.push(new ye(e[r],e[(r+1)%s]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const e=this.getSides();let s=e[0],r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=e[l],f=h.normal().dot(t);f>r&&(s=h,r=f)}return s}findLocalSide(t){const e=this.getLocalSides();let s=e[0],r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=e[l],f=h.normal().dot(t);f>r&&(s=h,r=f)}return s}get axes(){const t=[],e=this.getSides();for(let s=0;s<e.length;s++)t.push(e[s].normal());return t}update(t){t&&(t.cloneWithParent(this._transform),this._transformedPointsDirty=!0,this._sidesDirty=!0,(this.offset.x!==0||this.offset.y!==0)&&(this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y),this._transform.isMirrored()&&(this.points=this.points.map(e=>I(e.x*te(this._transform.scale.x),e.y*te(this._transform.scale.y))),this._transform.scale.x=Math.abs(this._transform.scale.x),this._transform.scale.y=Math.abs(this._transform.scale.y)))}contains(t){const e=this._transform.applyInverse(t),s=new Xr(e,new z(1,0));let r=0;const l=this.getLocalSides();for(let h=0;h<l.length;h++){const u=l[h];s.intersect(u)>=0&&r++}return r%2!==0}getClosestLineBetween(t){if(t instanceof Xe)return Ls.PolygonCircleClosestLine(this,t);if(t instanceof Ne)return Ls.PolygonPolygonClosestLine(this,t);if(t instanceof Pi)return Ls.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Xe)return hs.CollideCirclePolygon(t,this);if(t instanceof Ne)return hs.CollidePolygonPolygon(this,t);if(t instanceof Pi)return hs.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let s=null,r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=t.dot(e[l]);h>r&&(r=h,s=e[l])}return s}getFurthestLocalPoint(t){const e=this.points;let s=e[0],r=-Number.MAX_VALUE;for(let l=0;l<e.length;l++){const h=t.dot(e[l]);h>r&&(r=h,s=e[l])}return s}getClosestFace(t){const e=this.getSides();let s=Number.POSITIVE_INFINITY,r=-1,l=-1;for(let h=0;h<e.length;h++){const u=e[h].distanceToPoint(t);u<s&&(s=u,r=h,l=u)}return r!==-1?{distance:e[r].normal().scale(l),face:e[r]}:null}get bounds(){return this.localBounds.transform(this._transform.matrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=Et.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let e=0,s=0;const r=this.points;for(let l=0;l<r.length;l++){const h=(l+1)%r.length,u=r[h].cross(r[l]);e+=u*(r[l].dot(r[l])+r[l].dot(r[h])+r[h].dot(r[h])),s+=u}return this._cachedMass=t,this._cachedInertia=t/6*(e/s)}rayCast(t,e=1/0){var s;const r=this.getSides(),l=r.length;let h=Number.MAX_VALUE,u,f=-1;for(let g=0;g<l;g++){const m=t.intersect(r[g]);m>=0&&m<h&&m<=e&&(h=m,u=r[g],f=g)}return f>=0?{collider:this,distance:h,body:(s=this.owner)==null?void 0:s.get($t),point:t.getPoint(h),normal:u.normal()}:null}project(t){const e=this.getTransformedPoints(),s=e.length;let r=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let h=0;h<s;h++){const u=e[h].dot(t);r=Math.min(r,u),l=Math.max(l,u)}return new Rc(r,l)}debug(t,e,s){const r=this.getTransformedPoints();PA.drawPolygon(r,{color:e})}}class Ze{static Box(t,e,s=z.Half,r=z.Zero){return new Ne({points:new Et(-t*s.x,-e*s.y,t-t*s.x,e-e*s.y).getPoints().slice(),offset:r})}static Polygon(t,e=z.Zero,s=!1){return new Ne({points:t,offset:e,suppressConvexWarning:s})}static Circle(t,e=z.Zero){return new Xe({radius:t,offset:e})}static Edge(t,e){return new Pi({begin:t,end:e})}static Capsule(t,e,s=z.Zero){const r=vt.getInstance();if(t===e&&r.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),e>=t){const h=new Qe([Ze.Circle(t/2,I(0,-e/2+t/2).add(s)),Ze.Box(t,e-t,z.Half,s),Ze.Circle(t/2,I(0,e/2-t/2).add(s))]);return h.compositeStrategy="together",h}else{const h=new Qe([Ze.Circle(e/2,I(-t/2+e/2,0).add(s)),Ze.Box(t-e,e,z.Half,s),Ze.Circle(e/2,I(t/2-e/2,0).add(s))]);return h.compositeStrategy="together",h}}}function Ki(o,t){return o&&(o.__isProxy===void 0?new Proxy(o,{set:(e,s,r)=>(e[s]!==r&&(e[s]=r,typeof s=="string"&&s[0]!=="_"&&t(e)),!0),get:(e,s)=>s!=="__isProxy"?e[s]:!0}):o)}const cA=(o=[],t,e)=>({get:(s,r)=>r==="__isProxy"?!0:typeof s[r]=="object"&&s[r]!=null?new Proxy(s[r],cA([...o,r],t,e)):s[r],set:(s,r,l)=>(typeof r=="string"&&r[0]!=="_"&&t(e),s[r]=l,!0)});function Sw(o,t){return o&&(o.__isProxy===void 0?new Proxy(o,cA([],t,o)):o)}const hA=class uA{constructor(t){this.id=uA._ID++,this.transform=_e.identity(),this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=z.One,this._width=0,this._height=0;var e,s,r,l,h,u,f;t&&(this.origin=(e=t.origin)!=null?e:this.origin,this.flipHorizontal=(s=t.flipHorizontal)!=null?s:this.flipHorizontal,this.flipVertical=(r=t.flipVertical)!=null?r:this.flipVertical,this.rotation=(l=t.rotation)!=null?l:this.rotation,this.opacity=(h=t.opacity)!=null?h:this.opacity,this.scale=(u=t.scale)!=null?u:this.scale,this.tint=(f=t.tint)!=null?f:this.tint,t.width&&(this._width=t.width),t.height&&(this._height=t.height))}isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=Ki(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){t&&(this._origin=Ki(t,()=>{this._transformStale=!0})),this._transformStale=!0}cloneGraphicOptions(){return{width:this.width/this.scale.x,height:this.height/this.scale.y,origin:this.origin?this.origin.clone():void 0,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():void 0,tint:this.tint?this.tint.clone():void 0}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return Et.fromDimension(this.width,this.height,z.Zero)}draw(t,e,s){this._preDraw(t,e,s),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,s){t.save(),t.translate(e,s),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var e;const s=this.scale.x>0?1:-1,r=this.scale.y>0?1:-1,l=(e=this.origin)!=null?e:I(this.width/2,this.height/2);t.translate(l.x,l.y),t.rotate(this.rotation),t.scale(s,r),t.translate(-l.x,-l.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}};hA._ID=0;let He=hA;var Pd=(o=>(o.End="end",o.Loop="loop",o.PingPong="pingpong",o.Freeze="freeze",o))(Pd||{});const dA=class Bd extends He{constructor(t){var e,s,r;super(t),this.events=new ae,this.frames=[],this.strategy="loop",this.frameDuration=100,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._speed=1,this._wasResetDuringFrameCalc=!1,this._reversed=!1,this.frames=t.frames,this.speed=(e=t.speed)!=null?e:this.speed,this.strategy=(s=t.strategy)!=null?s:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(r=t.frameDuration)!=null?r:this.frameDuration,this.data=t.data?new Map(Object.entries(t.data)):new Map,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){const t=this.constructor;return new t({frames:this.frames.map(e=>({...e})),frameDuration:this.frameDuration,speed:this.speed,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,s,r="loop",l){const h=t.sprites.length-1,u=e.filter(f=>f<0||f>h);return u.length&&Bd._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${u.join(",")} no frame will be shown`),new this({frames:t.sprites.filter((f,g)=>e.indexOf(g)>-1).map(f=>({graphic:f,duration:s})),strategy:r,data:l})}static fromSpriteSheetCoordinates(t){var e;const{spriteSheet:s,frameCoordinates:r,durationPerFrame:l,durationPerFrameMs:h,speed:u,strategy:f,reverse:g,data:m}=t,A=(e=l??h)!=null?e:100,y=[];for(const x of r){const{x:E,y:C,duration:L,options:D}=x,R=s.getSprite(E,C,D);R?y.push({graphic:R,duration:L??A}):Bd._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${E}, ${C}), please check your SpriteSheet to confirm that sprite exists`)}return new this({frames:y,strategy:f,speed:u,reverse:g,data:m})}get speed(){return this._speed}set speed(t){this._speed=Bt(Math.abs(t),0,1/0)}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get currentFrameTimeLeft(){return this._timeLeftInFrame}get isPlaying(){return this._playing}get isReversed(){return this._reversed}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?"backward":"forward"}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._wasResetDuringFrameCalc=!0,this._done=!1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=this.frameDuration;const t=this.frames[this._currentFrame];t&&(this._timeLeftInFrame=(t==null?void 0:t.duration)||this.frameDuration)}get canFinish(){switch(this.strategy){case"end":case"freeze":return!0;default:return!1}}get done(){return this._done}goToFrame(t,e){this._currentFrame=t,this._timeLeftInFrame=e??this.frameDuration;const s=this.frames[this._currentFrame];s&&!this._done&&(this._timeLeftInFrame=e??((s==null?void 0:s.duration)||this.frameDuration),this.events.emit("frame",{...s,frameIndex:this.currentFrameIndex}))}_nextFrame(){this._wasResetDuringFrameCalc=!1;const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case"loop":{e=(t+1)%this.frames.length,e===0&&this.events.emit("loop",this);break}case"end":{e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case"freeze":{e=Bt(t+1,0,this.frames.length-1),t+1>=this.frames.length&&(this._done=!0,this.events.emit("end",this));break}case"pingpong":{t+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),t+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),e=t+this._pingPongDirection%this.frames.length;break}}return this._wasResetDuringFrameCalc?(this._wasResetDuringFrameCalc=!1,this._currentFrame):e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=t*this._speed,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,s){this.currentFrame&&this.currentFrame.graphic&&this.currentFrame.graphic.draw(t,e,s)}};dA._LOGGER=vt.getInstance();let fA=dA;class Cn extends He{constructor(t){var e;super(t),this._logger=vt.getInstance(),this.useAnchor=!0,this.members=[],this.members=t.members,this.useAnchor=(e=t.useAnchor)!=null?e:this.useAnchor,this._updateDimensions()}clone(){return new Cn({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){const t=this.localBounds;return this.width=t.width,this.height=t.height,t}get localBounds(){const t=new Et;for(const e of this.members)if(e instanceof He)e.localBounds.combine(t,t);else{const{graphic:s,offset:r,useBounds:l}=e;s?(l===void 0?!0:l)&&s.localBounds.translate(r).combine(t,t):this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(e)}.`)}return t}_isAnimationOrGroup(t){return t instanceof fA||t instanceof Cn}tick(t,e){for(const s of this.members){let r;s instanceof He?r=s:r=s.graphic,this._isAnimationOrGroup(r)&&r.tick(t,e)}}reset(){for(const t of this.members){let e;t instanceof He?e=t:e=t.graphic,this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,s){this._updateDimensions(),super._preDraw(t,this.useAnchor?e:0,this.useAnchor?s:0)}_drawImage(t,e,s){const r=z.Zero;for(const l of this.members){let h;l instanceof He?h=l:(h=l.graphic,l.offset.clone(r)),h&&(t.save(),t.translate(e,s),h.draw(t,r.x,r.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore())}}}class Pc extends He{constructor(t){var e,s,r,l,h,u,f,g,m,A;super(gw({...t},["width","height"])),this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=Ki($.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(e=t.quality)!=null?e:this.quality,this.color=(s=t.color)!=null?s:$.Black,this.strokeColor=t==null?void 0:t.strokeColor,this.smoothing=(r=t.smoothing)!=null?r:this.smoothing,this.lineWidth=(l=t.lineWidth)!=null?l:this.lineWidth,this.lineDash=(h=t.lineDash)!=null?h:this.lineDash,this.lineCap=(u=t.lineCap)!=null?u:this.lineCap,this.padding=(f=t.padding)!=null?f:this.padding,this.filtering=(g=t.filtering)!=null?g:this.filtering),this._bitmap=document.createElement("canvas");const y=(m=t==null?void 0:t.width)!=null?m:this._bitmap.width,x=(A=t==null?void 0:t.height)!=null?A:this._bitmap.height;this.width=y,this.height=x;const E=this._bitmap.getContext("2d");if(E)this._ctx=E;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():void 0,strokeColor:this.strokeColor?this.strokeColor.clone():void 0,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!=null?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!=null?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return Et.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,z.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=Ki(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),t&&(this._strokeColor=Ki(t,()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(t){var e,s,r,l;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((e=this.lineDash)!=null?e:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(r=(s=this.strokeColor)==null?void 0:s.toString())!=null?r:"",t.fillStyle=(l=this.color)==null?void 0:l.toString()}_drawImage(t,e,s){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,e,s)}}var pA=(o=>(o.Em="em",o.Rem="rem",o.Px="px",o.Pt="pt",o.Percent="%",o))(pA||{}),gA=(o=>(o.Left="left",o.Right="right",o.Center="center",o.Start="start",o.End="end",o))(gA||{}),mA=(o=>(o.Top="top",o.Hanging="hanging",o.Middle="middle",o.Alphabetic="alphabetic",o.Ideographic="ideographic",o.Bottom="bottom",o))(mA||{}),_A=(o=>(o.Normal="normal",o.Italic="italic",o.Oblique="oblique",o))(_A||{}),AA=(o=>(o.LeftToRight="ltr",o.RightToLeft="rtl",o))(AA||{}),ii=(o=>(o.Pixel="Pixel",o.Blended="Blended",o))(ii||{});function Eo(o){switch(o){case"Pixel":return"Pixel";case"Blended":return"Blended";default:return}}function $_(o,t=$.Red,e,s,r,l,h=1,u="butt"){o.save(),o.beginPath(),o.lineWidth=h,o.lineCap=u,o.strokeStyle=t.toString(),o.moveTo(e,s),o.lineTo(r,l),o.closePath(),o.stroke(),o.restore()}function t0(o,t,e,s,r,l=5,h=$.White,u=null){let f;if(typeof l=="number")f={tl:l,tr:l,br:l,bl:l};else{const g={tl:0,tr:0,br:0,bl:0};for(const m in g)if(g.hasOwnProperty(m)){const A=m;f[A]=l[A]||g[A]}}o.beginPath(),o.moveTo(t+f.tl,e),o.lineTo(t+s-f.tr,e),o.quadraticCurveTo(t+s,e,t+s,e+f.tr),o.lineTo(t+s,e+r-f.br),o.quadraticCurveTo(t+s,e+r,t+s-f.br,e+r),o.lineTo(t+f.bl,e+r),o.quadraticCurveTo(t,e+r,t,e+r-f.bl),o.lineTo(t,e+f.tl),o.quadraticCurveTo(t,e,t+f.tl,e),o.closePath(),u&&(o.fillStyle=u.toString(),o.fill()),h&&(o.strokeStyle=h.toString(),o.stroke())}class Bc{constructor(t,e,s=1){this.builder=t,this.cleaner=e,this._pool=[],this._size=0,this.grow(s)}grow(t){if(t>0){this._size+=t;for(let e=0;e<t;e++)this._pool.push(this.builder())}}rent(t=!1){return this._pool.length===0&&this.grow(this._size),t?this.cleaner(this._pool.pop()):this._pool.pop()}return(t){this._pool.push(t)}}class Tw{constructor(){this._pool=new Bc(()=>_e.identity(),t=>t.reset(),100),this._transforms=[],this._currentTransform=this._pool.rent(!0)}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone(this._pool.rent())}restore(){this._pool.return(this._currentTransform),this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}reset(){this._currentTransform.reset()}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class Ew{constructor(){this.opacity=1,this.z=0,this.tint=$.White,this.material=null}}class yA{constructor(){this._pool=new Bc(()=>new Ew,t=>(t.opacity=1,t.z=0,t.tint=$.White,t.material=null,t),100),this.current=this._pool.rent(!0),this._states=[]}_cloneState(t){var e;return t.opacity=this.current.opacity,t.z=this.current.z,t.tint=(e=this.current.tint)==null?void 0:e.clone(),t.material=this.current.material,t}save(){this._states.push(this.current),this.current=this._cloneState(this._pool.rent())}restore(){this._pool.return(this.current),this.current=this._states.pop()}}class vA{constructor(t,e,s=!1){this.path=t,this.responseType=e,this.bustCache=s,this.data=null,this.logger=vt.getInstance(),this.events=new ae}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const s=new XMLHttpRequest;s.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),s.responseType=this.responseType,s.addEventListener("loadstart",r=>this.events.emit("loadstart",r)),s.addEventListener("progress",r=>this.events.emit("progress",r)),s.addEventListener("error",r=>this.events.emit("error",r)),s.addEventListener("load",r=>this.events.emit("load",r)),s.addEventListener("load",()=>{if(s.status!==0&&s.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",s.status),this.events.emit("error",s.response),e(new Error(s.statusText));return}if(s.response instanceof Blob&&s.response.type==="text/html"){const r=`Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!

Check your server configuration, for example Vite serves static files from the /public folder`;this.events.emit("error",s.response),e(new Error(r));return}this.data=s.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),s.send()})}}class qe extends He{constructor(t){var e,s;super(t),this._logger=vt.getInstance(),this._dirty=!0,this.image=t.image;const{width:r,height:l}=t;this.sourceView=(e=t.sourceView)!=null?e:{x:0,y:0,width:r??0,height:l??0},this.destSize=(s=t.destSize)!=null?s:{width:r??0,height:l??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}static from(t,e){return new qe({image:t,...e})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,s,r,l,h;const{width:u,height:f}=this.image;this.sourceView.width=((t=this.sourceView)==null?void 0:t.width)||u,this.sourceView.height=((e=this.sourceView)==null?void 0:e.height)||f,this.destSize.width=((s=this.destSize)==null?void 0:s.width)||((r=this.sourceView)==null?void 0:r.width)||u,this.destSize.height=((l=this.destSize)==null?void 0:l.height)||((h=this.sourceView)==null?void 0:h.height)||f,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,s){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,s)}_drawImage(t,e,s){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,s,this.destSize.width,this.destSize.height):this._logger.warnOnce(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}clone(){return new qe({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var We=(o=>(o.Clamp="Clamp",o.Repeat="Repeat",o.Mirror="Mirror",o))(We||{});function ds(o){switch(o){case"Clamp":return"Clamp";case"Repeat":return"Repeat";case"Mirror":return"Mirror";default:return"Clamp"}}const Do=class Ri{constructor(t,e){this._garbageCollector=e,this._textureMap=new Map,this._collect=r=>{var l;if(this._gl){const h=(l=r.dataset.originalSrc)!=null?l:r.constructor.name;return Ri._LOGGER.debug(`WebGL Texture for ${h} collected`),this.delete(r),!0}return!1};var s;this._gl=t,Ri._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),this._garbageCollector&&(Ri._LOGGER.debug("WebGL Texture collection interval:",this._garbageCollector.collectionInterval),(s=this._garbageCollector.garbageCollector)==null||s.registerCollector("texture",this._garbageCollector.collectionInterval,this._collect))}dispose(){for(const[t]of this._textureMap)this.delete(t);this._textureMap.clear(),this._gl=null}get(t){return this._textureMap.get(t)}has(t){return this._textureMap.has(t)}load(t,e,s=!1){var r,l;const h=this._gl;if(!h)return null;const{filtering:u,wrapping:f}={...e};let g=null;if(this.has(t)&&(g=this.get(t)),g)return s&&(h.bindTexture(h.TEXTURE_2D,g),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t)),(r=this._garbageCollector)==null||r.garbageCollector.touch(t),g;g=h.createTexture(),Ri.checkImageSizeSupportedAndLog(t),h.bindTexture(h.TEXTURE_2D,g),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let m;f&&(typeof f=="string"?m={x:f,y:f}:m={x:f.x,y:f.y});const{x:A,y}=m??Ri.wrapping;switch(A){case We.Clamp:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);break;case We.Repeat:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT);break;case We.Mirror:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.MIRRORED_REPEAT);break;default:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE)}switch(y){case We.Clamp:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);break;case We.Repeat:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT);break;case We.Mirror:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.MIRRORED_REPEAT);break;default:h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)}const x=u??Ri.filtering;return h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,x===ii.Pixel?h.NEAREST:h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,x===ii.Pixel?h.NEAREST:h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t),this._textureMap.set(t,g),(l=this._garbageCollector)==null||l.garbageCollector.addCollectableResource("texture",t),g}delete(t){const e=this._gl;if(e&&this.has(t)){const s=this.get(t);s&&(this._textureMap.delete(t),e.deleteTexture(s))}}static checkImageSizeSupportedAndLog(t){var e;const s=(e=t.dataset.originalSrc)!=null?e:"internal canvas bitmap";return t.width>Ri._MAX_TEXTURE_SIZE||t.height>Ri._MAX_TEXTURE_SIZE?(Ri._LOGGER.error(`The image [${s}] provided to Excalibur is too large for the device's maximum texture size of (${Ri._MAX_TEXTURE_SIZE}x${Ri._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&Ri._LOGGER.warn(`The image [${s}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}};Do._LOGGER=vt.getInstance();Do.filtering=ii.Blended;Do.wrapping={x:We.Clamp,y:We.Clamp};Do._MAX_TEXTURE_SIZE=4096;let oo=Do;const Gt={Filtering:"filtering",WrappingX:"wrapping-x",WrappingY:"wrapping-y"};class pi{constructor(t,e,s){this._logger=vt.getInstance(),this.data=new Image,this._readyFuture=new bn,this.ready=this._readyFuture.promise,this.path=t;let r=!1,l;typeof e=="boolean"?r=e:{filtering:s,wrapping:l,bustCache:r}={...e},this._resource=new vA(t,"blob",r),this.filtering=s??this.filtering,typeof l=="string"?this.wrapping={x:l,y:l}:this.wrapping=l??this.wrapping,t.endsWith(".gif")&&this._logger.warn(`Use the ex.Gif type to load gifs, you may have mixed results with ${t} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`)}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}static fromHtmlImageElement(t,e){const s=new pi("");if(s._src="image-element",s.data=t,s.data.setAttribute("data-original-src","image-element"),e!=null&&e.filtering?s.data.setAttribute(Gt.Filtering,e==null?void 0:e.filtering):s.data.setAttribute(Gt.Filtering,ii.Blended),e!=null&&e.wrapping){let r;typeof e.wrapping=="string"?r={x:e.wrapping,y:e.wrapping}:r={x:e.wrapping.x,y:e.wrapping.y},s.data.setAttribute(Gt.WrappingX,r.x),s.data.setAttribute(Gt.WrappingY,r.y)}else s.data.setAttribute(Gt.WrappingX,We.Clamp),s.data.setAttribute(Gt.WrappingY,We.Clamp);return oo.checkImageSizeSupportedAndLog(t),s._readyFuture.resolve(t),s}static fromHtmlCanvasElement(t,e){const s=new pi("");if(s._src="canvas-element-blob",s.data.setAttribute("data-original-src","canvas-element-blob"),e!=null&&e.filtering?s.data.setAttribute(Gt.Filtering,e==null?void 0:e.filtering):s.data.setAttribute(Gt.Filtering,ii.Blended),e!=null&&e.wrapping){let r;typeof e.wrapping=="string"?r={x:e.wrapping,y:e.wrapping}:r={x:e.wrapping.x,y:e.wrapping.y},s.data.setAttribute(Gt.WrappingX,r.x),s.data.setAttribute(Gt.WrappingY,r.y)}else s.data.setAttribute(Gt.WrappingX,We.Clamp),s.data.setAttribute(Gt.WrappingY,We.Clamp);return oo.checkImageSizeSupportedAndLog(t),t.toBlob(r=>{const l=URL.createObjectURL(r);s.image.onload=()=>{URL.revokeObjectURL(l),s.data=s.image,s._readyFuture.resolve(s.image)},s.image.src=l}),s}static fromSvgString(t,e){const s=new Blob([t],{type:"image/svg+xml"}),r=URL.createObjectURL(s);return new pi(r,e)}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){var t,e,s,r;if(this.isLoaded())return this.data;try{let l;if(this.path.includes("data:image/"))l=this.path;else{const f=await this._resource.load();l=URL.createObjectURL(f)}const h=new Image,u=new bn;h.onload=()=>u.resolve(),h.src=l,h.setAttribute("data-original-src",this.path),await u.promise,this.data=h,oo.checkImageSizeSupportedAndLog(this.data)}catch(l){throw`Error loading ImageSource from path '${this.path}' with error [${l.message}]`}return this.data.setAttribute(Gt.Filtering,this.filtering),this.data.setAttribute(Gt.WrappingX,(e=(t=this.wrapping)==null?void 0:t.x)!=null?e:We.Clamp),this.data.setAttribute(Gt.WrappingY,(r=(s=this.wrapping)==null?void 0:s.y)!=null?r:We.Clamp),this._readyFuture.resolve(this.data),this.data}toSprite(t){return qe.from(this,t)}unload(){this.data=new Image}}class Ic extends He{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=void 0,this.caseInsensitive=!1,this.spacing=0,this.lineHeight=void 0,this._logger=vt.getInstance();const{alphabet:e,spriteSheet:s,caseInsensitive:r,spacing:l,shadow:h,lineHeight:u}=t;this.alphabet=e,this.spriteSheet=s,this.caseInsensitive=r??this.caseInsensitive,this.spacing=l??this.spacing,this.shadow=h??this.shadow,this.lineHeight=u??this.lineHeight}_getCharacterSprites(t){const e=[],s=this.caseInsensitive?t.toLocaleLowerCase():t,r=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let l=0;l<s.length;l++){const h=s[l];let u=r.indexOf(h);u===-1&&(u=0,this._logger.warnOnce(`SpriteFont - Cannot find letter '${h}' in configured alphabet '${r}'.`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."));const f=this.spriteSheet.sprites[u];f?e.push(f):(this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${h}' at index '${u}' in configured SpriteSheet`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."))}return e}measureText(t,e){const s=this._getLinesFromText(t,e),r=s.reduce((f,g)=>f.length>g.length?f:g),l=this._getCharacterSprites(r);let h=0,u=0;for(const f of l)h+=f.width+this.spacing,u=Math.max(u,f.height);return Et.fromDimension(h*this.scale.x,u*s.length*this.scale.y,z.Zero)}_drawImage(t,e,s,r){var l;let h=0,u=0,f=0;const g=this._getLinesFromText(this._text,r);for(const m of g){for(const A of this._getCharacterSprites(m))A.draw(t,e+h,s+u),h+=A.width+this.spacing,f=Math.max(f,A.height);h=0,u+=(l=this.lineHeight)!=null?l:f}}render(t,e,s,r,l,h){this._text=e;const u=this.measureText(e,h);this.width=u.width,this.height=u.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,r,l),this._drawImage(t,0,0,h),this._postDraw(t),t.restore()),this._preDraw(t,r,l),this._drawImage(t,0,0,h),this._postDraw(t)}clone(){return new Ic({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,e){var s;if(this._cachedText===t&&this._cachedRenderWidth===e&&((s=this._cachedLines)!=null&&s.length))return this._cachedLines;const r=t.split(`
`);if(e==null)return r;for(let l=0;l<r.length;l++){let h=r[l],u="";if(this.measureText(h).width>e){for(;this.measureText(h).width>e;)u=h[h.length-1]+u,h=h.slice(0,-1);r[l]=h,r[l+1]=u}}return this._cachedText=t,this._cachedLines=r,this._cachedRenderWidth=e,r}}class df extends qe{constructor(t){super({image:t.image,sourceView:t.sourceView,destSize:{width:t.width,height:t.height},flipHorizontal:t.flipHorizontal,flipVertical:t.flipVertical,rotation:t.rotation,scale:t.scale,opacity:t.opacity,tint:t.tint,origin:t.origin}),this._ready=new bn,this.ready=this._ready.promise,this._options=t,this.image.isLoaded()?this._applyTiling():this.image.ready.then(()=>this._applyTiling())}static fromSprite(t,e){return new df({sourceView:{...t.sourceView},width:t.width,height:t.height,...e,image:t.image})}_applyTiling(){const{width:t,height:e,filtering:s,wrapping:r}={...this._options},l=document.createElement("canvas");l.width=this.sourceView.width,l.height=this.sourceView.height,l.getContext("2d").drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,0,0,this.sourceView.width,this.sourceView.height);const u=pi.fromHtmlCanvasElement(l,{wrapping:r??We.Repeat,filtering:s});t&&(this.destSize.width=t,this.sourceView.width=t),e&&(this.destSize.height=e,this.sourceView.height=e),this.sourceView.x=0,this.sourceView.y=0,this.image=u,this.image.ready.then(()=>this._ready.resolve())}}class $i{constructor(t){this.sprites=[];const{sprites:e,rows:s,columns:r}=t;this.sprites=e,this.rows=s??1,this.columns=r??this.sprites.length}getSprite(t,e,s){var r,l,h,u,f,g,m,A,y;if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const x=t+e*this.columns,E=this.sprites[x];if(E){if(s){const C=E.clone();return C.flipHorizontal=(r=s.flipHorizontal)!=null?r:C.flipHorizontal,C.flipVertical=(l=s.flipVertical)!=null?l:C.flipVertical,C.width=(h=s.width)!=null?h:C.width,C.height=(u=s.height)!=null?u:C.height,C.rotation=(f=s.rotation)!=null?f:C.rotation,C.scale=(g=s.scale)!=null?g:C.scale,C.opacity=(m=s.opacity)!=null?m:C.opacity,C.tint=(A=s.tint)!=null?A:C.tint,C.origin=(y=s.origin)!=null?y:C.origin,C}return E}throw Error(`Invalid sprite coordinates (${t}, ${e})`)}getTiledSprite(t,e,s){if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const r=t+e*this.columns,l=this.sprites[r];if(l)return df.fromSprite(l,s);throw Error(`Invalid sprite coordinates (${t}, ${e})`)}static fromImageSourceWithSourceViews(t){const e=t.sourceViews.map(s=>new qe({image:t.image,sourceView:s}));return new $i({sprites:e})}static fromImageSource(t){var e;const s=[];t.spacing=(e=t.spacing)!=null?e:{};const{image:r,grid:{rows:l,columns:h,spriteWidth:u,spriteHeight:f},spacing:{originOffset:g,margin:m}}=t;let A,y;g instanceof z?y={x:g.x,y:g.y}:g&&(y={x:g.x,y:g.y}),m instanceof z?A={x:m.x,y:m.y}:m&&(A={x:m.x,y:m.y});const x={x:0,y:0,...y},E={x:0,y:0,...A};for(let C=0;C<h;C++)for(let L=0;L<l;L++)s[C+L*h]=new qe({image:r,sourceView:{x:C*u+E.x*C+x.x,y:L*f+E.y*L+x.y,width:u,height:f},destSize:{height:f,width:u}});return new $i({sprites:s,rows:l,columns:h})}clone(){return new $i({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}const Dw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAAAAXNSR0IArs4c6QAABlFJREFUeJztndmy4yoMRcWt/v9fdr8EWoDAaDD4JntVpeqcxBrMIGQDNhEAAAAAAAAAAAAAAOCrSbMfr+u6yoEpTY+906GV57YtPkjyXj9WZZ+wHWHfo2N3/bU6Tte9Rv6ptruqRyMvKvvIX/zY3I/vjLeqsg6l/CWdp0KHKO/1Y1H2EdsR9j06Ntdfp+N03SvkH2u7i3pu5XkQ+DNTkgNJSok+/183xpcdWZHjgUzpQ2pGD67vaf//KRAGAq3tdhCy2tcMQKPyXyz7iPqrdBjbX5h9g7xbtvWf4ZJvM4D/BKG24Sd+IkQ0TC9aW5NM5FbO2HgrPVzW2vmN50DZNv/QWtl5bfPy85SBtdy9dFmjsf2F2SehTBVE+u+tkE5+lAGcJlFwGuodwRRU2Qe3rx0FhPNflc3HWC7BEh8EDGVR5IMCiLnDONtPp87qhxVH/S/LvzUAuDs/kyGimA5oSONKR1w8vsLpv+v+S9vhmS71JRiX1xB5CWZNw7m6rMrllMag/RJyWb67BEgpDVMWSydc+K47pr35w05kWd7ReEq6116KaG4CsbJ7OmV9PdZLEKkONiC1/7ZONVgDsajLIJPYp2OUAXRpnPcGmnIE6eSK4nv5YQqqSYO52JqnYfYj/PdQXQIY7XszuMofMgZRT/1LdeC5h2I5/0EdWDMY2Yb05WDE1RodVdpSA5r85slArAVnSf+89iP896St0f5bZKVA7Gk/3ja8q+152/+wrLqBWZTem3IBADbRBoDuHgAA4HdAAADgh0EAAOCHQQAA4IdBAADgh0EAAOCHuVsKbJ3P9M7jjuxHzGfv8j9iDt47Dx7hP8cjq5F/o/0T62Aer//ZOgDrajBp6aNlOWTEajKLjgj/Pcs/vfZD/a++3Pc8hNfZ966EVeh5vP75luDRJUAl0KzJfnopaqbaTuzZiulc2BS5lltFXntu3dcQsXadl59Wn1H+dfYNtrt2d6D/LDF9HkCQw6eXFbr8P9X5W/un5Ol8gz1t39p5pWOPn0vLynbgdnfe8maEQw+UIPJdfxdOd/4oTtVD0IYg8wDywGas0I04T5O3P8/qf2UWwPpkn1PbOT1bN2tFe59EM7TvKf+TRFw+erZ2ey4hpS3hp9qBkqq/tjsSU1OYqucBWB1yynt5QxC42Mdk30pAEIio//zRG3feBzLUX+TTjCKwlH83aI/KbpQBVEHgUGF0j/SitcLofHem8q6AyH0wBhFv4WszuOjy0yK2vc/oRWQoP2X9ve78jfaLnpncbBqQSC6s0HnIRT0a2yNZjfxT8+ir8t+yDsDTWaS6X70GP33+d77stp+I5HtBdwEAAPBl8ECApcAA/DBvfSowAGAB7/05ZAAA/DAIAADMMU3fOuS2ggAAwBjrorKoxWiPBxHMAgAg490Ts0VeePdA+ZfJDKcCh7sBqY88mmjklZeOt9iXPrvx2I2QPRnN2/qzyJ84h4gNcbtfasq5mM1rZr+bBWh2A+bIIX13Z9wqL+nQvFno7v3oq4tJItCed7isUT6C/I7BUn9KP95wDicYBYpcjncrO2c/dmW4tBtw4RiRld1IDxDyYsoXMHxF1w3dyz0Nne8033AOFsT6VgRCafl89fenTZUfbm8CGhrgdDcS7anAsvnkkP0IeCfQ+JzYunky6jhNYj5bl7++4fJvN9WDSKS/292A0wyANyKDI91bfkm3kcH7ckaP/SKW/VHKRZAcI14pP3beu0fPyn/DuZQbWMogNnsc16sziE96f7H/iai7uTf0/3N8lwFz/e13T00Djt4OrInCnkeChXT+qOcKOLA21tJpsv/G8/COnGnw97J9QwbTvd6djYSv7fxEVTuV/LzNhj7nOawv6bfbAGCYEpQ6HxFtuxs6sq9tzOYHobQ6Nje+6vo5BwFrPZ4OgMayS4PPt1NlzdLfbRCYBoBc+NaO4JWPwLEf33oN3unY3InKPQBW6Z7nEZzEmrl4iZjC804lqgePPEOguQcwWghUphxm343wyt/pWpWR0OrR+jvyxavHajfb9pTjbt9bH07Z5/expM4TLWfwb7QQqMoC+UDWXZo/4RgA38LOgUvLJAAQ1Td9y9//0ylxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+g79apuVUsS5ZmwAAAABJRU5ErkJggg==";class xA{constructor(){this.fontSheet=Dw,this.size=16,this.load()}load(){return this._imageSource=new pi(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=$i.fromImageSource({image:this._imageSource,grid:{rows:4,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new Ic({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+# `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,e,s){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,s.x,s.y)}}class Rw{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class Wl{constructor(t){this.antialias=!1,this.samples=1;var e,s;this._gl=t.gl,this.width=t.width,this.height=t.height,this.transparency=t.transparency,this.antialias=(e=t.antialias)!=null?e:this.antialias,this.samples=(s=t.samples)!=null?s:this._gl.getParameter(this._gl.MAX_SAMPLES);const r=this._gl;r.drawingBufferFormat?this.bufferFormat=r.drawingBufferFormat:this.transparency?this.bufferFormat=r.RGBA8:this.bufferFormat=r.RGB8,this._setupRenderBuffer(),this._setupFramebuffer()}setResolution(t,e){const s=this._gl;this.width=t,this.height=e,s.bindTexture(s.TEXTURE_2D,this._frameTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.width,this.height,0,s.RGBA,s.UNSIGNED_BYTE,null),this._renderBuffer&&(s.bindRenderbuffer(s.RENDERBUFFER,this._renderBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,Math.min(this.samples,s.getParameter(s.MAX_SAMPLES)),this.bufferFormat,this.width,this.height))}get renderBuffer(){return this._renderBuffer}get renderFrameBuffer(){return this._renderFrameBuffer}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupRenderBuffer(){if(this.antialias){const t=this._gl;this._renderBuffer=t.createRenderbuffer(),this._renderFrameBuffer=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,Math.min(this.samples,t.getParameter(t.MAX_SAMPLES)),this.bufferFormat,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this._renderBuffer)}}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return this.renderBuffer&&this.blitRenderBufferToFrameBuffer(),new Rw(this._gl,this._frameTexture)}blitToScreen(){const t=this._gl;this._renderBuffer?(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)):(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR))}blitRenderBufferToFrameBuffer(){if(this._renderBuffer){const t=this._gl;t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.frameBuffer),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)}}copyToTexture(t){const e=this._gl;this._renderBuffer&&this.blitRenderBufferToFrameBuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,this.width,this.height,0)}use(){const t=this._gl;this.antialias?t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}const Mw=`#version 300 es
in vec2 a_position;
in vec4 a_color;

out lowp vec4 v_color;

uniform mat4 u_matrix;

void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Passthrough the color
   v_color = a_color;
}`,Pw=`#version 300 es
precision mediump float;

// Color
in lowp vec4 v_color;

out vec4 fragColor;

void main() {
  fragColor = v_color;
}`;class bA extends ts{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e}}class ff extends ts{constructor(t){super(),this.parallaxFactor=I(1,1),this.parallaxFactor=t??this.parallaxFactor}}const na=class Ce{static measureText(t,e,s){const r=Wr.getHashCode(e,t);if(Ce._MEASURE_CACHE.has(r))return Ce._MEASURE_CACHE.get(r);Ce._LOGGER.debug("Font text measurement cache miss");const l=e.measureTextWithoutCache(t,s);return Ce._MEASURE_CACHE.set(r,l),l}static getTextInstance(t,e,s){const r=Wr.getHashCode(e,t,s);let l=Ce._TEXT_CACHE.get(r);return l||(l=new Wr(e,t,s),Ce._TEXT_CACHE.set(r,l),Ce._LOGGER.debug("Font text instance cache miss")),Ce._TEXT_USAGE.set(l,performance.now()),l}static checkAndClearCache(){const t=[],e=new Set;for(const[r,l]of Ce._TEXT_USAGE.entries())if(l+Ce.FONT_TIMEOUT<performance.now())Ce._LOGGER.debug(`Text cache entry timed out ${r.text}`),t.push(r),r.dispose();else{const h=r.getHashCode(!1);e.add(h)}t.forEach(r=>{Ce._TEXT_USAGE.delete(r)}),this._TEXT_CACHE.clear();for(const[r]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(r.getHashCode(),r);const s=new Map;for(const r of e)Ce._MEASURE_CACHE.has(r)&&s.set(r,Ce._MEASURE_CACHE.get(r));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=s}static get cacheSize(){return Ce._TEXT_USAGE.size}static clearCache(){for(const[t]of Ce._TEXT_USAGE.entries())t.dispose();Ce._TEXT_USAGE.clear(),Ce._TEXT_CACHE.clear(),Ce._MEASURE_CACHE.clear()}};na.FONT_TIMEOUT=500;na._LOGGER=vt.getInstance();na._TEXT_USAGE=new Map;na._TEXT_CACHE=new Map;na._MEASURE_CACHE=new Map;let Id=na;function Bw(o,t,e,s){if(o.parent!==t.parent){const m=o.clone(),A=o.globalPos.clone(),y=o.globalScale.clone(),x=o.globalRotation;m.parent=t.parent,m.globalPos=A,m.globalScale=y,m.globalRotation=x,o=m}let r=t.pos,l=t.scale,h=t.rotation;r=t.pos.scale(e).add(o.pos.scale(1-e)),l=t.scale.scale(e).add(o.scale.scale(1-e));const u=(1-e)*Math.cos(o.rotation)+e*Math.cos(t.rotation),f=(1-e)*Math.sin(o.rotation)+e*Math.sin(t.rotation);h=Math.atan2(f,u);const g=s??new wn;return g.setTransform(r,h,l),g}class wA extends Yi{constructor(t){super(),this.world=t,this.systemType=Vi.Draw,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this._targetInterpolationTransform=new wn,this.query=this.world.query([ot,je]),this.query.entityAdded$.subscribe(e=>{const s=e.get(ot);this._sortedTransforms.push(s),s.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{const s=e.get(ot);s.zIndexChanged$.unsubscribe(this._zIndexUpdate);const r=this._sortedTransforms.indexOf(s);r>-1&&this._sortedTransforms.splice(r,1)})}get sortedTransforms(){return this._sortedTransforms}initialize(t,e){this._camera=e.camera,this._engine=e.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>t.globalZ-e.globalZ),this._zHasChanged=!1)}update(t){this._token++;let e;Id.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(let s=0;s<this._sortedTransforms.length;s++){const r=this._sortedTransforms[s],l=r.owner;if(l.hasTag("ex.offscreen")||(e=l.get(je),!e.isVisible))continue;e.onPreTransformDraw&&e.onPreTransformDraw(this._graphicsContext,t),l.events.emit("pretransformdraw",new jb(this._graphicsContext,t,l)),r.coordPlane===_i.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),r.coordPlane===_i.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),e.update(t,this._token);const h=l.get(ff);if(h){const u=z.One.sub(h.parallaxFactor),f=this._camera.drawPos.scale(u);this._graphicsContext.translate(f.x,f.y)}this._applyTransform(l),e.material&&(this._graphicsContext.material=e.material),e.onPreDraw&&e.onPreDraw(this._graphicsContext,t),l.events.emit("predraw",new Tc(this._graphicsContext,t,l)),this._applyOpacity(l),this._drawGraphicsComponent(e,r),e.onPostDraw&&e.onPostDraw(this._graphicsContext,t),l.events.emit("postdraw",new Ec(this._graphicsContext,t,l)),this._graphicsContext.restore(),r.coordPlane===_i.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext)),e.onPostTransformDraw&&e.onPostTransformDraw(this._graphicsContext,t),l.events.emit("posttransformdraw",new Vb(this._graphicsContext,t,l))}this._graphicsContext.restore()}_drawGraphicsComponent(t,e){var s,r;if(t.isVisible){const l=t.flipHorizontal,h=t.flipVertical,u=t.current,f=(s=t.currentOptions)!=null?s:{};if(u){let g=t.anchor,m=t.offset,A=1,y=1;f!=null&&f.anchor&&(g=f.anchor),f!=null&&f.offset&&(m=f.offset);const x=e.globalScale;A*=u.scale.x*x.x,y*=u.scale.y*x.y;const E=-u.width*g.x+m.x*A,C=-u.height*g.y+m.y*y,L=u.flipHorizontal,D=u.flipVertical;if((l||h)&&(u.flipHorizontal=l?!L:L,u.flipVertical=h?!D:D),u==null||u.draw(this._graphicsContext,E,C),(l||h)&&(u.flipHorizontal=L,u.flipVertical=D),(r=this._engine)!=null&&r.isDebug&&this._engine.debug.graphics.showBounds){const R=I(E,C);if(u instanceof Cn)for(const P of u.members){let F,Y=z.Zero;P instanceof He?F=P:(F=P.graphic,Y=P.offset),u.useAnchor?F==null||F.localBounds.translate(R.add(Y)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor):F==null||F.localBounds.translate(Y).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}else u==null||u.localBounds.translate(R).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(t){const e=t.getAncestors();for(let s=0;s<e.length;s++){const r=e[s],l=r==null?void 0:r.get(ot),h=r==null?void 0:r.get($t);if(l){let u=l.get();if(h&&this._engine.fixedUpdateTimestep&&h.__oldTransformCaptured&&h.enableFixedUpdateInterpolate){const f=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep;u=Bw(h.oldTransform,l.get(),f,this._targetInterpolationTransform)}this._graphicsContext.z=l.globalZ,this._graphicsContext.translate(u.pos.x,u.pos.y),this._graphicsContext.scale(u.scale.x,u.scale.y),this._graphicsContext.rotate(u.rotation)}}}_applyOpacity(t){var e;const s=t.getAncestors();for(let r=0;r<s.length;r++){const l=s[r],h=l==null?void 0:l.get(je);this._graphicsContext.opacity*=(e=h==null?void 0:h.opacity)!=null?e:1}}}wA.priority=Hs.Average;class CA extends Yi{constructor(t){super(),this.world=t,this.systemType=Vi.Draw,this.query=this.world.query([ot,je])}initialize(t,e){this._camera=e.camera,this._screen=e.engine.screen}update(){this._worldBounds=this._screen.getWorldBounds();let t,e,s;for(let r=0;r<this.query.entities.length;r++){const l=this.query.entities[r];e=l.get(je),t=l.get(ot),s=l.get(ff);let h;if(s){const f=z.One.sub(s.parallaxFactor);h=this._camera.pos.scale(f)}const u=this._isOffscreen(t,e,h);u&&!l.hasTag("ex.offscreen")&&(l.events.emit("exitviewport",new nw(l)),l.addTag("ex.offscreen")),!u&&l.hasTag("ex.offscreen")&&(l.events.emit("enterviewport",new rw(l)),l.removeTag("ex.offscreen"))}}_isOffscreen(t,e,s){if(e.forceOnScreen)return!1;if(t.coordPlane===_i.World){let r=e.localBounds;s&&(r=r.translate(s));const l=r.transform(t.get().matrix);return!this._worldBounds.overlaps(l)}else return!1}}CA.priority=Hs.Higher;class pf extends Pc{constructor(t){var e,s,r;super(t),this._radius=0;const l=(e=t.lineWidth)!=null?e:t.strokeColor?1:0;this.padding=(s=t.padding)!=null?s:2+l/2,this.radius=t.radius,this.filtering=(r=t.filtering)!=null?r:ii.Blended,this.rasterize()}get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}clone(){return new pf({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class Ro extends Pc{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new Ro({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class gf extends Pc{constructor(t={}){super(t),this._options=t}get ctx(){return this._ctx}clone(){return new gf({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,s;(e=this._options)!=null&&e.draw&&((s=this._options)==null||s.draw(t)),this._options.cache||this.flagDirty()}}const Iw={pixelArtSampler:!1,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:ii.Blended,canvasImageRendering:"auto"},kw={pixelArtSampler:!0,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:ii.Blended,canvasImageRendering:"auto"},mf=class kd{static clear(){kd.DrawCallCount=0,kd.DrawnImagesCount=0}};mf.DrawCallCount=0;mf.DrawnImagesCount=0;let Se=mf;const ue=1e-4;class zw{constructor(t){this._ex=t,this._debugText=new xA}drawRect(t,e,s,r){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+ue):t,this._ex.snapToPixel?~~(e+ue):e,this._ex.snapToPixel?~~(s+ue):s,this._ex.snapToPixel?~~(r+ue):r),this._ex.__ctx.restore()}drawLine(t,e,s={color:$.Black}){var r,l;this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=(l=(r=s.color)==null?void 0:r.toString())!=null?l:"",this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+ue):t.x,this._ex.snapToPixel?~~(t.y+ue):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(e.x+ue):e.x,this._ex.snapToPixel?~~(e.y+ue):e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:$.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+ue):t.x,this._ex.snapToPixel?~~(t.y+ue):t.y,e.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class zd{constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=$.ExcaliburBlue,this._state=new yA,this.snapToPixel=!1,this.debug=new zw(this);const{canvasElement:e,context:s,enableTransparency:r,snapToPixel:l,antialiasing:h,backgroundColor:u}=t;if(this.__ctx=s??e.getContext("2d",{alpha:r??!0}),!this.__ctx)throw new Error("Cannot build new ExcaliburGraphicsContext2D for some reason!");this.backgroundColor=u??this.backgroundColor,this.snapToPixel=l??this.snapToPixel,this.smoothing=h??this.smoothing}get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,s,r,l,h,u,f,g){if(r===0||l===0)return;if(f===0||g===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const m=[t,e,s,r,l,h,u,f,g].filter(A=>A!==void 0).map(A=>typeof A=="number"&&this.snapToPixel?~~A:A);this.__ctx.drawImage.apply(this.__ctx,m),Se.DrawCallCount++,Se.DrawnImagesCount=1}drawLine(t,e,s,r=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=s.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+ue):t.x,this.snapToPixel?~~(t.y+ue):t.y),this.__ctx.lineTo(this.snapToPixel?~~(e.x+ue):e.x,this.snapToPixel?~~(e.y+ue):e.y),this.__ctx.lineWidth=r,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,s,r){this.__ctx.save(),this.__ctx.fillStyle=r.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+ue):t.x,this.snapToPixel?~~(t.y+ue):t.y,this.snapToPixel?~~(e+ue):e,this.snapToPixel?~~(s+ue):s),this.__ctx.restore()}drawCircle(t,e,s,r,l){this.__ctx.save(),this.__ctx.beginPath(),r&&(this.__ctx.strokeStyle=r.toString()),l&&(this.__ctx.lineWidth=l),this.__ctx.fillStyle=s.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+ue):t.x,this.snapToPixel?~~(t.y+ue):t.y,e,0,Math.PI*2),this.__ctx.fill(),r&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save(),this._state.save()}restore(){this.__ctx.restore(),this._state.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~(t+ue):t,this.snapToPixel?~~(e+ue):e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}updatePostProcessors(t){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),Se.clear()}flush(){}dispose(){this.__ctx=void 0}}class Ow{constructor(t){this.type="static";const{gl:e,size:s,type:r,data:l}=t;if(this._gl=e,this.buffer=e.createBuffer(),this._maxFloats=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE)/32,!l&&!s)throw Error("Must either provide data or a size to the UniformBuffer");if(l?this.bufferData=l:this.bufferData=new Float32Array(s),this.bufferData.length>this._maxFloats)throw Error(`UniformBuffer exceeds browsers allowed number of floats ${this._maxFloats}`);this.type=r??this.type,e.bindBuffer(e.UNIFORM_BUFFER,this.buffer),e.bufferData(e.UNIFORM_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.UNIFORM_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.UNIFORM_BUFFER,null)}upload(t){const e=this._gl;e.bindBuffer(e.UNIFORM_BUFFER,this.buffer),t?e.bufferSubData(e.UNIFORM_BUFFER,0,this.bufferData,0,t):e.bufferData(e.UNIFORM_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}function e0(o,t){switch(t){case o.INT:case o.UNSIGNED_INT:case o.FLOAT:return 4;case o.SHORT:return 2;case o.UNSIGNED_SHORT:return 2;case o.BYTE:return 1;case o.UNSIGNED_BYTE:return 1;default:return 1}}function Uw(o,t){const e=`(?<type>[a-z0-9]+)\\s+${t};`,r=new RegExp(e,"g").exec(o);return(r==null?void 0:r.length)>0}function Lw(o,t,e){var s;const r=`(?<type>[a-z0-9]+)\\s+${e};`,h=new RegExp(r,"g").exec(t);switch((s=h==null?void 0:h.groups)==null?void 0:s.type){case"float":case"vec2":case"vec3":case"vec4":return o.FLOAT;case"int":case"ivec2":case"ivec3":case"ivec4":return o.INT;case"uint":case"uvec2":case"uvec3":case"uvec4":return o.UNSIGNED_INT;case"bool":case"bvec2":case"bvec3":case"bvec4":return o.BOOL;case"short":return o.SHORT;case"ushort":return o.UNSIGNED_SHORT;case"ubyte":return o.UNSIGNED_BYTE;case"byte":return o.BYTE;default:return o.FLOAT}}function Fw(o,t){switch(t){case o.LOW_FLOAT:case o.HIGH_FLOAT:case o.FLOAT:return 1;case o.FLOAT_VEC2:return 2;case o.FLOAT_VEC3:return 3;case o.FLOAT_VEC4:return 4;case o.BYTE:return 1;case o.UNSIGNED_BYTE:return 1;case o.UNSIGNED_SHORT:case o.SHORT:return 1;default:return 1}}function Nw(o,t){switch(t){case o.LOW_FLOAT:case o.HIGH_FLOAT:case o.FLOAT:case o.FLOAT_VEC2:case o.FLOAT_VEC3:case o.FLOAT_VEC4:return o.FLOAT;case o.BYTE:return o.BYTE;case o.UNSIGNED_BYTE:return o.UNSIGNED_BYTE;case o.SHORT:return o.SHORT;case o.UNSIGNED_SHORT:return o.UNSIGNED_SHORT;default:return o.FLOAT}}function SA(o,t){const e=r=>{const l=`#version 300 es
    precision mediump float;
    out vec4 fragColor;
    void main() {
      float index = 1.01;
      %%complexity%%
    }`;let h="";for(let u=0;u<r;u++)u===0?h+=`if (index <= ${u}.5) {
`:h+=`   else if (index <= ${u}.5) {
`,h+=`      fragColor = vec4(1.0);
`,h+=`   }
`;return l.replace("%%complexity%%",h)};let s=!1;do{const r=e(t),l=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(l,r),o.compileShader(l),s=o.getShaderParameter(l,o.COMPILE_STATUS),s||(t=t/2|0)}while(!s);return t}function Hw(o,t){switch(t){case o.FLOAT:return"uniform1f";case o.FLOAT_VEC2:return"uniform2f";case o.FLOAT_VEC3:return"uniform3f";case o.FLOAT_VEC4:return"uniform4f";case o.INT:return"uniform1i";case o.INT_VEC2:return"uniform2i";case o.INT_VEC3:return"uniform3i";case o.INT_VEC4:return"uniform4i";case o.BOOL:return"uniform1i";case o.BOOL_VEC2:return"uniform2i";case o.BOOL_VEC3:return"uniform3i";case o.BOOL_VEC4:return"uniform4i";case o.FLOAT_MAT2:return"uniform1f";case o.FLOAT_MAT3:return"uniform1f";case o.FLOAT_MAT4:return"uniform1f";case o.SAMPLER_2D:return"uniform1f";case o.SAMPLER_CUBE:return"uniform1f";case o.UNSIGNED_INT:return"uniform1ui";case o.UNSIGNED_INT_VEC2:return"uniform2ui";case o.UNSIGNED_INT_VEC3:return"uniform3ui";case o.UNSIGNED_INT_VEC4:return"uniform4ui";case o.FLOAT_MAT2x3:return"uniformMatrix2x3fv";case o.FLOAT_MAT2x4:return"uniformMatrix2x4fv";case o.FLOAT_MAT3x2:return"uniformMatrix3x2fv";case o.FLOAT_MAT3x4:return"uniformMatrix3x4fv";case o.FLOAT_MAT4x2:return"uniformMatrix4x2fv";case o.FLOAT_MAT4x3:return"uniformMatrix4x3fv";case o.SAMPLER_2D_ARRAY:return"uniform1fv";case o.SAMPLER_2D_ARRAY_SHADOW:return"uniform1f";case o.SAMPLER_CUBE_SHADOW:return"uniform1f";case o.INT_SAMPLER_2D:return"uniform1f";case o.INT_SAMPLER_3D:return"uniform1f";case o.INT_SAMPLER_CUBE:return"uniform1f";case o.INT_SAMPLER_2D_ARRAY:return"uniform1f";case o.UNSIGNED_INT_SAMPLER_2D:return"uniform1ui";default:throw new Error(`Unknown uniform type: ${t}`)}}const TA=class io{constructor(t){this.name="anonymous shader",this._logger=vt.getInstance(),this._textures=new Map,this.attributes={},this._uniforms={},this._uniformBuffers={},this._compiled=!1,this._dirtyUniforms=!0,this._startingTextureSlot=0,this.uniforms=Ki({},()=>this.flagUniformsDirty()),this.images={};const{name:e,graphicsContext:s,vertexSource:r,fragmentSource:l,onPreLink:h,onPostCompile:u,uniforms:f,images:g,startingTextureSlot:m}=t;if(this.name=e??this.name,!(s instanceof Fs))throw new Error(`ExcaliburGraphicsContext provided to a shader ${this.name} must be WebGL`);this._gl=s.__gl,this._startingTextureSlot=m??this._startingTextureSlot,this._maxTextureSlots=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS)-this._startingTextureSlot,this.vertexSource=r,this.fragmentSource=l,this.uniforms=Ki(f??this.uniforms,()=>this.flagUniformsDirty()),this.images=g??this.images,Object.keys(this.images).length>=this._maxTextureSlots&&this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`),this._textureLoader=s.textureLoader,this._onPreLink=h,this._onPostCompile=u}flagUniformsDirty(){this._dirtyUniforms=!0}get compiled(){return this._compiled}dispose(){this._gl.deleteProgram(this.program),this._gl=null}use(){this._gl.useProgram(this.program),io._ACTIVE_SHADER_INSTANCE=this,this._dirtyUniforms&&(this._setUniforms(),this._dirtyUniforms=!1),this._setImages()}unuse(){const t=this._gl;io._ACTIVE_SHADER_INSTANCE=null,t.useProgram(null)}isCurrentlyBound(){return io._ACTIVE_SHADER_INSTANCE===this}_setUniforms(){const t=this._gl,e=Object.entries(this.uniforms);if(e.length){const s=this.getUniformDefinitions();for(const[r,l]of e)if(l instanceof Float32Array)this.setUniformBuffer(r,l);else if(Array.isArray(l)&&l[0]instanceof Float32Array&&typeof l[1]=="number")this.setUniformBuffer(r,l[0],l[1]);else if(typeof l=="number")this.trySetUniformFloat(r,l);else if(typeof l=="boolean")this.trySetUniformBoolean(r,l);else if(l instanceof z)this.trySetUniformFloatVector(r,l);else if(l instanceof $)this.trySetUniformFloatColor(r,l);else if(l instanceof _e)this.setUniformAffineMatrix(r,l);else{const h=s.find(u=>u.name===r);if(h){const u=Hw(t,h.glType);this.trySetUniform(u,r,l)}else this._logger.warnOnce(`Could not locate uniform named ${r}, this can happen if the uniform is unused in the shader code some GPUs will remove this as an optimization.`)}}}_loadImageSource(t){const e=t.image,s=e.getAttribute(Gt.Filtering),r=s?Eo(s):void 0,l=ds(e.getAttribute(Gt.WrappingX)),h=ds(e.getAttribute(Gt.WrappingY)),u=e.getAttribute("forceUpload")==="true",f=this._textureLoader.load(e,{filtering:r,wrapping:{x:l,y:h}},u);return e.removeAttribute("forceUpload"),this._textures.has(t)||this._textures.set(t,f),f}_setImages(t=!1){const e=this._gl;let s=this._startingTextureSlot;for(const[r,l]of Object.entries(this.images)){if(!l.isLoaded()){t||this._logger.warnOnce(`Image named ${r} in not loaded, nothing will be uploaded to the shader. Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);continue}const h=this._loadImageSource(l);h||t||this._logger.warnOnce(`Image ${r} (${l.image.src}) could not be loaded for some reason in shader ${this.name}`),e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,h),this.trySetUniformInt(r,s),s++}}compile(){if(this._compiled)return this.program;const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),s=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,s);const r=this.getAttributeDefinitions();for(const h of r)this.attributes[h.name]=h;const l=this.getUniformDefinitions();for(const h of l)this._uniforms[h.name]=h;return this._compiled=!0,this._onPostCompile&&this._onPostCompile(this),t.useProgram(this.program),io._ACTIVE_SHADER_INSTANCE=this,this._dirtyUniforms&&(this._setUniforms(),this._dirtyUniforms=!1),this._setImages(!0),this.unuse(),this.program}getUniformDefinitions(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),s=[];for(let r=0;r<e;r++){const l=t.getActiveUniform(this.program,r),h=t.getUniformLocation(this.program,l.name);s.push({name:l.name,glType:l.type,location:h})}return s}getAttributeDefinitions(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),s=[];for(let r=0;r<e;r++){const l=t.getActiveAttrib(this.program,r),h=t.getAttribLocation(this.program,l.name);s.push({name:l.name,glType:Nw(t,l.type),size:Fw(t,l.type),location:h,normalized:!1})}return s}addImageSource(t,e){Object.keys(this.images).length<this._maxTextureSlots?this.images[t]=e:this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`)}removeImageSource(t){const e=this.images[t];e&&(this._textureLoader.delete(e.image),delete this.images[t])}setTexture(t,e){const s=this._gl;s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,e)}setUniformBuffer(t,e,s=0){const r=this._gl,l=r.getUniformBlockIndex(this.program,t);l===r.INVALID_INDEX&&this._logger.warnOnce(`Invalid block name ${t}`);let h;this._uniformBuffers[t]?(h=this._uniformBuffers[t],h.bufferData.set(e),h.upload()):(h=new Ow({gl:r,data:e}),this._uniformBuffers[t]=h),r.uniformBlockBinding(this.program,l,s),r.bindBufferBase(r.UNIFORM_BUFFER,s,h.buffer)}trySetUniformBuffer(t,e,s=0){return this._compiled?this.isCurrentlyBound()?this._gl.getUniformBlockIndex(this.program,t)?(this.setUniformBuffer(t,e,s),!0):!1:(this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1):(this._logger.warn(`Must compile shader before setting a uniform block ${t} at binding point ${s}`),!1)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}trySetUniformInt(t,e){return this.trySetUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}trySetUniformIntArray(t,e){return this.trySetUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}trySetUniformBoolean(t,e){return this.trySetUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}trySetUniformFloat(t,e){return this.trySetUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}trySetUniformFloatArray(t,e){return this.trySetUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}trySetUniformFloatVector(t,e){return this.trySetUniform("uniform2f",t,e.x,e.y)}setUniformFloatColor(t,e){this.setUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}trySetUniformFloatColor(t,e){return this.trySetUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniformAffineMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,[e.data[0],e.data[1],0,0,e.data[2],e.data[3],0,0,0,0,1,0,e.data[4],e.data[5],0,1])}trySetUniformMatrix(t,e){return this.trySetUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...s){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const l=this._gl.getUniformLocation(this.program,e);if(l){const h=[l,...s];this._gl[t].apply(this._gl,h)}else throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(t,e,...s){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${t}:${e}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;const l=this._gl.getUniformLocation(this.program,e);if(l){const h=[l,...s];this._gl[t].apply(this._gl,h)}else return!1;return!0}_createProgram(t,e,s){const r=t.createProgram();if(r===null)throw Error("Could not create graphics shader program");if(t.attachShader(r,e),t.attachShader(r,s),this._onPreLink&&this._onPreLink(r),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(r)}]`);return r}_compileShader(t,e,s){const r=t.VERTEX_SHADER===s?"vertex":"fragment",l=t.createShader(s);if(l===null)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(l,e),t.compileShader(l),!t.getShaderParameter(l,t.COMPILE_STATUS)){const u=t.getShaderInfoLog(l);throw Error(`Could not compile ${r} shader:

${u}${this._processSourceForError(e,u)}`)}return l}_processSourceForError(t,e){if(!t)return e;const s=t.split(`
`),r=e.search(/\d:\d/),l=e.indexOf(" ",r),[h,u]=e.slice(r,l).split(":").map(f=>Number(f));for(let f=0;f<s.length;f++)s[f]=`${f+1}: ${s[f]}${u===f+1?" <----- ERROR!":""}`;return`

Source:
`+s.join(`
`)}};TA._ACTIVE_SHADER_INSTANCE=null;let fs=TA;const Gw=`#version 300 es
precision mediump float;

uniform float deltaMs;
uniform float maxLifeMs;
uniform vec2 gravity;
uniform vec2 focus;
uniform float focusAccel;
uniform mat4 u_matrix;
uniform mat4 u_transform;
uniform float startSize;
uniform float endSize;
// uniform sampler2D obstacle;

layout(location=0)in vec2 position;
layout(location=1)in vec2 velocity;
layout(location=2)in float rotation;
layout(location=3)in float angularVelocity;
layout(location=4)in float lifeMs;

// TODO z index to handle buffer wrapping?

// DO NOT RE-ORDER
out vec2 finalPosition;
out vec2 finalVelocity;
out float finalRotation;
out float finalAngularVelocity;
out float finalLifeMs;
void main(){
  // Evolve particle
  float seconds = deltaMs / 1000.;
  // euler integration
  // Weird artifact of re-using the same buffer layout for update/draw
  // we need differently named variables
  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;
  finalVelocity = velocity + finalGravity * seconds;
  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;
  finalRotation = rotation + angularVelocity * seconds;
  finalAngularVelocity = angularVelocity;
  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);

  // Collision mask sampling
  // vec2 samplePoint = finalPosition / vec2(width, height);
  // vec4 collides = texture(obstacle, samplePoint);
  // if (distance(collides,vec4(0.)) > .01) {
  //   // non opaque means we collide! recalc final pos/vel
  //   vec2 newVelocity = velocity * -.1;// lose energy
  //   finalVelocity = newVelocity + gravity * seconds;
  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;
  // }

  float lifePercent = finalLifeMs / maxLifeMs;
  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;
  float scale = sqrt(u_transform[0][0] * u_transform[0][0] + u_transform[1][1] * u_transform[1][1]);
  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z
  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent) * scale;
}`,Qw=`#version 300 es
precision mediump float;

uniform sampler2D graphic;
uniform bool useTexture;
uniform float maxLifeMs;

uniform vec4 beginColor;
uniform vec4 endColor;
uniform bool fade;
uniform float startOpacity;

in float finalRotation;
in float finalLifeMs;
out vec4 fragColor;

void main(){

  float lifePct = finalLifeMs / maxLifeMs;

  if (useTexture) {
    /** Draw texture */
    if (lifePct <= 0.) discard;
    float mid = .5;
    float cosine = cos(finalRotation);
    float sine = sin(finalRotation);
    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,
                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);
    vec4 color = texture(graphic, rotated);
    fragColor = color * (fade ? lifePct : 1.0);
  } else {
    /** Draw circle */
    if (lifePct <= 0.) discard;
    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;
    float dist = 1.0 - length(uv);
    float edge = fwidth(dot(uv, uv));
    float circle = smoothstep(-edge/2.0, edge/2.0, dist);
    vec3 color = mix(beginColor.rgb, endColor.rgb, 1.0 - lifePct);
    fragColor.rgb = color;
    fragColor.a = startOpacity * circle * (fade ? lifePct : 1.0);// * mix(beginColor.a, endColor.a, 1.0 - lifePct);
    fragColor.rgb *= fragColor.a;
  }
}`;class _o{constructor(t,e,s){this.worldPos=t,this.pagePos=e,this.screenPos=s}static fromPagePosition(t,e,s){let r,l,h,u;arguments.length===3?(r=t,l=e,h=new z(r,l),u=s):(h=t,r=h.x,l=h.y,u=e);const f=u.screen.pageToScreenCoordinates(h),g=u.screen.screenToWorldCoordinates(f);return new _o(g,h,f)}}function jw(o,t,e){return(1-e)*o+t*e}function EA(o,t,e,s){const r=(o-t+Ge)%Ge>=Math.PI,l=Math.abs(t-o),h=Ge-l;let u=0,f=0;l>h?(u=h,f=l):(u=l,f=h);let g=0,m=1;switch(e){case Ae.ShortestPath:g=u,m=r?1:-1;break;case Ae.LongestPath:g=f,m=r?-1:1;break;case Ae.Clockwise:m=1,g=r?u:f;break;case Ae.CounterClockwise:m=-1,g=r?f:u;break}return o+m*(g*s)}function _f(o,t,e){return o.scale(1-e).add(t.scale(e))}function Vw(o,t,e){return(e-o)/(t-o)}function Gs(o,t,e,s,r){const l=Vw(o,t,r);return jw(e,s,l)}class kc{constructor(t){this._distLookup=[],this.quality=4;var e;if(t.controlPoints.length!==4)throw new Error("Only cubic bezier curves are supported");this._controlPoints=[...t.controlPoints],this.quality=(e=t.quality)!=null?e:this.quality,this._calculateLookup()}get arcLength(){return this._arcLength}get controlPoints(){return this._controlPoints}set controlPoints(t){this._controlPoints=[...t],this._calculateLookup()}setControlPoint(t,e){this._controlPoints[t]=e,this._calculateLookup()}_calculateLookup(){let t=0;this._distLookup.length=0;let e=this.controlPoints[0];const s=this.controlPoints.length*this.quality;for(let r=0;r<s;r++){const l=r/(s-1),h=this.getPoint(l),u=e.distance(h);t+=u,this._distLookup.push(t),e=h}this._arcLength=t}_getTimeGivenDistance(t){const e=this._distLookup.length,s=this.arcLength;if(t>=0&&t<s){for(let r=0;r<e-1;r++)if(this._distLookup[r]<=t&&t<this._distLookup[r+1])return Gs(this._distLookup[r],this._distLookup[r+1],r/(e-1),(r+1)/(e-1),t)}return t/s}getPoint(t){const e=[...this.controlPoints];for(let s=1;s<e.length;s++)for(let r=0;r<e.length-s;r++)e[r]=_f(e[r],e[r+1],t);return e[0]}getTangent(t){const e=t*t,s=this.controlPoints[0],r=this.controlPoints[1],l=this.controlPoints[2],h=this.controlPoints[3];return s.scale(-3*e+6*t-3).add(r.scale(9*e-12*t+3).add(l.scale(-9*e+6*t).add(h.scale(3*e)))).normalize()}getUniformTangent(t){const e=t*this.arcLength,s=this._getTimeGivenDistance(e);return this.getTangent(s)}getNormal(t){return this.getTangent(t).normal()}getUniformNormal(t){return this.getUniformTangent(t).normal()}getUniformPoint(t){const e=t*this.arcLength,s=this._getTimeGivenDistance(e);return this.getPoint(s)}clone(){return new kc({controlPoints:[...this.controlPoints],quality:this.quality})}}new J0;const er=class _n{static integrate(t,e,s,r){const l=r/1e3;e.vel.addEqual(s.scale(l,_n._ACC)),e.vel.setTo(Bt(e.vel.x,-e.maxVel.x,e.maxVel.x),Bt(e.vel.y,-e.maxVel.y,e.maxVel.y)),t.pos.add(e.vel.scale(l,_n._VEL),_n._POS).addEqual(s.scale(.5*l*l,_n._VEL_ACC)),e.angularVelocity+=e.torque*(1/e.inertia)*l;const h=t.rotation+e.angularVelocity*l;t.scale.add(e.scaleFactor.scale(l,this._SCALE_FACTOR),_n._SCALE),t.get().setTransform(_n._POS,h,_n._SCALE)}};er._POS=new z(0,0);er._SCALE=new z(1,1);er._ACC=new z(0,0);er._VEL=new z(0,0);er._VEL_ACC=new z(0,0);er._SCALE_FACTOR=new z(0,0);let DA=er;class RA extends Ns{constructor(t){super(),this.beginColor=$.White,this.endColor=$.White,this.life=300,this.fade=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=$.White,this.size=5,this.sizeRate=0,this.visible=!0,this.isOffscreen=!1,this.particleTransform="global",this.name=`Particle#${this.id}`,this.addComponent(this.transform=new ot),this.addComponent(this.motion=new Zt),this.addComponent(this.graphics=new je),this.configure(t)}registerEmitter(t){if(this._emitter=t,this.particleTransform==="global"){const e=this._emitter.transform.globalPos;this.transform.pos=this.transform.pos.add(e),this.motion.vel=this.motion.vel.rotate(this._emitter.transform.globalRotation)}}configure(t){var e,s,r,l,h,u,f,g,m,A,y,x,E,C,L;this.particleTransform=(e=t.transform)!=null?e:this.particleTransform,this.life=(s=t.life)!=null?s:this.life,this.fade=(r=t.fade)!=null?r:this.fade,this.size=(l=t.size)!=null?l:this.size,this.endColor=(h=t.endColor)!=null?h:this.endColor.clone(),this.beginColor=(u=t.beginColor)!=null?u:this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.graphic=t.graphic,this.graphics.opacity=(f=t.opacity)!=null?f:this.graphics.opacity,this.transform.pos=(g=t.pos)!=null?g:this.transform.pos,this.transform.rotation=(m=t.rotation)!=null?m:0,this.transform.scale=I(1,1),this.transform.z=(A=t.z)!=null?A:0,this.motion.vel=(y=t.vel)!=null?y:this.motion.vel,this.motion.angularVelocity=(x=t.angularVelocity)!=null?x:0,this.motion.acc=(E=t.acc)!=null?E:this.motion.acc,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.graphics.opacity/this.life,this.startSize=(C=t.startSize)!=null?C:0,this.endSize=(L=t.endSize)!=null?L:0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.size=this.startSize),this.graphic?(this.graphics.use(this.graphic),this.graphics.onPostDraw=void 0):(this.graphics.localBounds=Et.fromDimension(this.size,this.size,z.Half),this.graphics.onPostDraw=D=>{D.save(),D.debug.drawPoint(I(0,0),{color:this._currentColor,size:this.size}),D.restore()})}kill(){var t;(t=this._emitter)!=null&&t.isActive?this._emitter.removeParticle(this):super.kill()}update(t,e){this.life=this.life-e,this.life<0&&this.kill(),this.fade&&(this.graphics.opacity=Bt(this._aRate*this.life,1e-4,1)),this.startSize&&this.endSize&&this.startSize>0&&this.endSize>0&&(this.size=Bt(this.sizeRate*e+this.size,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=Bt(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=Bt(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=Bt(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=this.graphics.opacity;let s=this.motion.acc;this.focus&&(s=this.focus.sub(this.transform.pos).normalize().scale(this.focusAccel||0).scale(e/1e3)),DA.integrate(this.transform,this.motion,s,e)}}RA.DefaultConfig={beginColor:$.White,endColor:$.White,life:300,fade:!1,size:5,graphic:void 0,startSize:void 0,endSize:void 0};var MA=(o=>(o.Global="global",o.Local="local",o))(MA||{});class Yw{constructor(){this.type="ex.particle",this.priority=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new fs({graphicsContext:e,vertexSource:Gw,fragmentSource:Qw,onPreLink:s=>{t.transformFeedbackVaryings(s,["finalPosition","finalVelocity","finalRotation","finalAngularVelocity","finalLifeMs"],t.INTERLEAVED_ATTRIBS)}}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho)}_getTexture(t){const e=t.getAttribute(Gt.Filtering),s=e?Eo(e):void 0,r=ds(t.getAttribute(Gt.WrappingX)),l=ds(t.getAttribute(Gt.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);return t.removeAttribute("forceUpload"),u}draw(t,e){var s,r,l,h,u,f,g,m,A;const y=this._gl;this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho);const x=t.particle.transform===MA.Local?this._context.getTransform():this._context.getTransform().multiply(t.emitter.transform.get().inverse);this._shader.setUniformAffineMatrix("u_transform",x),this._shader.setUniformBoolean("fade",!!t.particle.fade),this._shader.setUniformBoolean("useTexture",!!t.particle.graphic),this._shader.setUniformFloat("maxLifeMs",(s=t.particle.life)!=null?s:2e3),this._shader.setUniformFloat("deltaMs",e),this._shader.setUniformFloatVector("gravity",(r=t.particle.acc)!=null?r:I(0,0)),this._shader.setUniformFloatColor("beginColor",(l=t.particle.beginColor)!=null?l:$.Transparent),this._shader.setUniformFloatColor("endColor",(h=t.particle.endColor)!=null?h:$.Transparent);let E=(u=t.particle.startSize)!=null?u:0,C=(f=t.particle.endSize)!=null?f:0;const L=(g=t.particle.size)!=null?g:0;if(L>0&&(E=L,C=L),this._shader.setUniformFloat("startSize",E??10),this._shader.setUniformFloat("endSize",C??10),this._shader.setUniformFloat("startOpacity",(m=t.particle.opacity)!=null?m:1),t.particle.focus&&(this._shader.setUniformFloatVector("focus",t.particle.focus),this._shader.setUniformFloat("focusAccel",(A=t.particle.focusAccel)!=null?A:0)),t.particle.graphic){const D=t.particle.graphic,R=this._getTexture(D.image.image);y.activeTexture(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,R),this._shader.setUniformInt("graphic",0)}t.draw(y)}hasPendingDraws(){return!1}flush(){}dispose(){}}class Qs{constructor(t){this.type="dynamic";const{gl:e,size:s,type:r,data:l}=t;if(this._gl=e,this.buffer=this._gl.createBuffer(),!l&&!s)throw Error("Must either provide data or a size to the VertexBuffer");l?this.bufferData=l:this.bufferData=new Float32Array(s),this.type=r??this.type,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,null)}upload(t){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),t?e.bufferSubData(e.ARRAY_BUFFER,0,this.bufferData,0,t):e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}class Sn{constructor(t){this._logger=vt.getInstance(),this._suppressWarnings=!1,this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0,this._initialized=!1;const{gl:e,shader:s,vertexBuffer:r,attributes:l,suppressWarnings:h}=t;this._gl=e,this._vertexBuffer=r,this._attributes=l,this._shader=s,this._suppressWarnings=h,s&&this.initialize()}get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(t){t&&this._shader!==t&&(this._shader=t,this.initialize())}get shader(){return this._shader}initialize(){if(this._initialized||!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._vertexTotalSizeBytes=0,this._layout.length=0;const t=this._shader.attributes;for(const l of this._attributes){const h=t[l[0]];if(!h){if(!Uw(this._shader.vertexSource,l[0]))throw Error(`The attribute named: ${l[0]} size ${l[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);this._suppressWarnings||this._logger.warn(`The attribute named: ${l[0]} size ${l[1]} not found in the compiled shader. This is possibly a bug:
 1. Not a bug, but should remove unused code - attribute "${l[0]}" is unused in vertex/fragment and has been automatically removed by glsl compiler.
 2. Definitely a bug, attribute "${l[0]}" in layout has been mistyped or is missing in shader, check vertex/fragment source.`);const u=Lw(this._gl,this._shader.vertexSource,l[0]);this._layout.push({name:l[0],glType:u,size:l[1],location:-1,normalized:!1})}if(h){if(h.size!==l[1])throw Error(`VertexLayout size definition for attribute: [${l[0]}, ${l[1]}], doesn't match shader source size ${h.size}:
 ${this._shader.vertexSource}`);this._layout.push(h)}}let e=0;for(const l of this._layout){const h=e0(this._gl,l.glType);this._vertexTotalSizeBytes+=h*l.size,e+=l.size}this._vertexBuffer.bufferData.length%e!==0&&this._logger.warn(`The vertex component size (${e})  does NOT divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`);const s=this._gl;this._vao=s.createVertexArray(),s.bindVertexArray(this._vao),this._vertexBuffer.bind();let r=0;for(const l of this._layout)l.location!==-1&&(l.glType===s.INT?s.vertexAttribIPointer(l.location,l.size,l.glType,this.totalVertexSizeBytes,r):s.vertexAttribPointer(l.location,l.size,l.glType,l.normalized,this.totalVertexSizeBytes,r),s.enableVertexAttribArray(l.location)),r+=e0(s,l.glType)*l.size;s.bindVertexArray(null),this._vertexBuffer.unbind(),this._initialized=!0}use(t=!1,e){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");const s=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(e),s.bindVertexArray(this._vao)}}class qw{constructor(t,e){e.includes("v_texcoord")&&vt.getInstance().warn(`ScreenShader: "v_texcoord" is deprecated in postprocessing fragment shaders will be removed in v1.0, use "v_uv" instead. Source [${e}]`);const s=t.__gl;this._shader=new fs({graphicsContext:t,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_uv;
      out vec2 v_texcoord;
      out vec2 v_uv;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_uv;
        v_uv = a_uv;
      }`,fragmentSource:e}),this._shader.compile(),this._buffer=new Qs({gl:s,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Sn({gl:s,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}var lo=(o=>(o.Protanope="Protanope",o.Deuteranope="Deuteranope",o.Tritanope="Tritanope",o))(lo||{});const Xw=`#version 300 es
precision mediump float;
// our texture
uniform sampler2D u_image;
// the texCoords passed in from the vertex shader.
in vec2 v_texcoord;

// color blind type
uniform int u_type;

// simulation?
uniform bool u_simulate;

out vec4 fragColor;

void main() {
  vec4 o =  texture(u_image, v_texcoord);
  // RGB to LMS matrix conversion
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);
  // Simulate color blindness
  float l;
  float m;
  float s;
  //MODE CODE//
  if (u_type == 0) {
    // Protanope
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;
    m = 0.0 * L + 1.0 * M + 0.0 * S;
    s = 0.0 * L + 0.0 * M + 1.0 * S;;
  } else if (u_type == 1) {
    // Deuteranope
    l = 1.0 * L + 0.0 * M + 0.0 * S;
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;
    s = 0.0 * L + 0.0 * M + 1.0 * S;
  } else if (u_type == 2) {
    // Tritanope
    l = 1.0 * L + 0.0 * M + 0.0 * S;
    m = 0.0 * L + 1.0 * M + 0.0 * S;
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;
  }

  // LMS to RGB matrix conversion
  vec4 error; // simulate the colors
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);
  error.a = 1.0;
  vec4 diff = o - error;
  vec4 correction; // correct the colors
  correction.r = 0.0;
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);
  correction = o + correction;
  correction.a = o.a;
  //SIMULATE//

  // sim 
  if (u_simulate) {
    fragColor = error.rgba;
  } else {
    fragColor = correction.rgba;
  }
}`;class Zw{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new qw(t,Xw),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const e=this._shader.getShader();e.use(),this._colorBlindnessMode===lo.Protanope?e.setUniformInt("u_type",0):this._colorBlindnessMode===lo.Deuteranope?e.setUniformInt("u_type",1):this._colorBlindnessMode===lo.Tritanope&&e.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class zc{constructor(t,e,s){this._logger=vt.getInstance(),this._gl=t,this.buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer);const r=e*6;if(!s)this.bufferData=new Uint32Array(r);else{const u=Math.floor(16383.5);this.bufferGlType=t.UNSIGNED_SHORT,this.bufferData=new Uint16Array(r),e>u&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${u}) requested quads(${e})`)}let l=0;for(let h=0;h<r;h+=6)this.bufferData[h+0]=l+0,this.bufferData[h+1]=l+1,this.bufferData[h+2]=l+2,this.bufferData[h+3]=l+2,this.bufferData[h+4]=l+1,this.bufferData[h+5]=l+3,l+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}const Ww=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

in vec2 a_screenuv;
out vec2 v_screenuv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
  v_screenuv = a_screenuv;
}
`;class Jw{constructor(t){this._logger=vt.getInstance(),this._color=$.Transparent,this._initialized=!1,this._images={},this._uniforms={};const{color:e,name:s,vertexSource:r,fragmentSource:l,graphicsContext:h,images:u,uniforms:f}=t;if(this._name=s??"anonymous material",this._vertexSource=r??Ww,this._fragmentSource=l,this._color=e??this._color,this._uniforms=f??this._uniforms,this._images=u??this._images,!h)throw Error(`Material ${s} must be provided an excalibur webgl graphics context`);h instanceof Fs?this._initialize(h):this._logger.warn(`Material ${s} was created in 2D Canvas mode, currently only WebGL is supported`)}_initialize(t){this._initialized||(this._shader=t.createShader({name:this._name,vertexSource:this._vertexSource,fragmentSource:this._fragmentSource,uniforms:this._uniforms,images:this._images,startingTextureSlot:this.isUsingScreenTexture?2:1}),this._initialized=!0)}get uniforms(){return this._shader.uniforms}get images(){return this._shader.images}get color(){return this._color}set color(t){this._color=t}get name(){return this._name}get isUsingScreenTexture(){return this._fragmentSource.includes("u_screen_texture")}update(t){this._shader&&(this._shader.use(),t(this._shader))}getShader(){return this._shader}addImageSource(t,e){this._shader.addImageSource(t,e)}removeImageSource(t){this._shader.removeImageSource(t)}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}const Af=class di{static registerGraphicsContext(t){di._ctx=t}static draw(t){this._drawCalls.push(t)}static drawPoint(t,e){di.draw(s=>{s.debug.drawPoint(t,e)})}static drawLine(t,e,s){di.draw(r=>{r.debug.drawLine(t,e,s)})}static drawLines(t,e){t.length>1&&di.draw(s=>{for(let r=0;r<t.length-1;r++)s.debug.drawLine(t[r],t[r+1],e)})}static drawText(t,e){di.draw(s=>{s.debug.drawText(t,e)})}static drawPolygon(t,e){t.length>1&&di.draw(s=>{const r=t[0],l=[...t,r];for(let h=0;h<l.length-1;h++)s.debug.drawLine(l[h],l[h+1],e)})}static drawCircle(t,e,s){const{color:r,strokeColor:l,width:h}={color:$.Black,strokeColor:void 0,width:void 0,...s};di.draw(u=>{u.drawCircle(t,e,r,l,h)})}static drawBounds(t,e){di.draw(s=>{s.debug.drawRect(t.left,t.top,t.width,t.height,e)})}static drawRay(t,e){const{distance:s,color:r}={color:$.Blue,distance:10,...e};di.draw(l=>{const h=t.pos,u=t.pos.add(t.dir.scale(s));l.debug.drawLine(h,u,{color:r})})}static flush(t){t.save(),t.z=di.z;for(const e of di._drawCalls)e(t);t.restore(),di.clear()}static clear(){di._drawCalls.length=0}};Af._drawCalls=[];Af.z=1/0;let PA=Af;class Kw{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0,this._startScratch=I(0,0),this._endScratch=I(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new fs({graphicsContext:e,vertexSource:Mw,fragmentSource:Pw}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new Qs({gl:t,size:12*this._maxLines,type:"dynamic"}),this._layout=new Sn({gl:t,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}dispose(){this._vertexBuffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,s){this._isFull()&&this.flush(),this._lineCount++;const r=this._context.getTransform(),l=r.multiply(t,this._startScratch),h=r.multiply(e,this._endScratch),u=this._vertexBuffer.bufferData;u[this._vertexIndex++]=l.x,u[this._vertexIndex++]=l.y,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=h.x,u[this._vertexIndex++]=h.y,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),Se.DrawnImagesCount+=this._lineCount,Se.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const $w=`#version 300 es
in vec2 a_position;
in vec4 a_color;
in float a_size;
out lowp vec4 v_color;
uniform mat4 u_matrix;

void main() {
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);
  gl_PointSize = a_size * 2.0;
  v_color = a_color;
}`,tC=`#version 300 es

precision mediump float;
in lowp vec4 v_color;

out vec4 fragColor;

void main() {
  float r = 0.0, delta = 0.0, alpha = 1.0;
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;
  r = dot(cxy, cxy);

  delta = fwidth(r);
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
  // "premultiply" the color by alpha
  vec4 color = v_color;
  color.a = color.a * alpha;
  color.rgb = color.rgb * color.a;
  fragColor = color;
}`;class eC{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new fs({graphicsContext:e,vertexSource:$w,fragmentSource:tC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new Qs({gl:t,size:7*this._maxPoints,type:"dynamic"}),this._layout=new Sn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}dispose(){this._buffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,s){this._isFull()&&this.flush(),this._pointCount++;const r=this._context.getTransform(),l=this._context.opacity,h=this._context.snapToPixel,u=r.multiply(t);h&&(u.x=~~(u.x+Tt),u.y=~~(u.y+Tt));const f=this._buffer.bufferData;f[this._vertexIndex++]=u.x,f[this._vertexIndex++]=u.y,f[this._vertexIndex++]=e.r/255,f[this._vertexIndex++]=e.g/255,f[this._vertexIndex++]=e.b/255,f[this._vertexIndex++]=e.a*l,f[this._vertexIndex++]=s*Math.max(r.getScaleX(),r.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),Se.DrawnImagesCount+=this._pointCount,Se.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const iC=`#version 300 es
in vec2 a_position;

in vec2 a_texcoord;
out vec2 v_texcoord;

void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);

  // Pass the texcoord to the fragment shader.
  v_texcoord = a_texcoord;
}`,sC=`#version 300 es
precision mediump float;

// Passed in from the vertex shader.
in vec2 v_texcoord;

// The texture.
uniform sampler2D u_texture;

out vec4 fragColor;

void main() {
   fragColor = texture(u_texture, v_texcoord);
}`;class nC{constructor(t){const e=t.__gl;this._gl=e,this._shader=new fs({graphicsContext:t,vertexSource:iC,fragmentSource:sC}),this._shader.compile(),this._buffer=new Qs({gl:e,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Sn({gl:e,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl,s=t.getShader();s.use(),t.getLayout().use(),e.activeTexture(e.TEXTURE0),s.trySetUniformInt("u_image",0),t.onDraw&&t.onDraw(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}const rC=`#version 300 es
precision mediump float;

// UV coord
in vec2 v_texcoord;

// Texture index
in lowp float v_textureIndex;

// Textures in the current draw
uniform sampler2D u_textures[%%count%%];

uniform bool u_pixelart;

// Opacity
in float v_opacity;

in vec4 v_tint;

in vec2 v_res;

out vec4 fragColor;

// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {
  vec2 pixel = uv * texture_size;
  
  vec2 seam=floor(pixel+.5);
  vec2 dudv=fwidth(pixel);
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);
  
  return pixel/texture_size;
}

void main(){
  // In order to support the most efficient sprite batching, we have multiple
  // textures loaded into the gpu (usually 8) this picker logic skips over textures
  // that do not apply to a particular sprite.
  
  vec4 color=vec4(1.,0,0,1.);
  
  // GLSL is templated out to pick the right texture and set the vec4 color
  %%texture_picker%%
  
  color.rgb=color.rgb*v_opacity;
  color.a=color.a*v_opacity;
  fragColor=color*v_tint;
}`,aC=`#version 300 es
in vec2 a_position;

// Opacity
in float a_opacity;
out float v_opacity;

// UV coordinate
in vec2 a_texcoord;
out vec2 v_texcoord;

// Texture res
in vec2 a_res;
out vec2 v_res;

// Texture number
in lowp float a_textureIndex;
out lowp float v_textureIndex;

in vec4 a_tint;
out vec4 v_tint;

uniform mat4 u_matrix;

void main(){
  // Set the vertex position using the ortho transform matrix
  gl_Position=u_matrix*vec4(a_position,0.,1.);
  
  // Pass through the Opacity to the fragment shader
  v_opacity=a_opacity;
  // Pass through the UV coord to the fragment shader
  v_texcoord=a_texcoord;

  v_res = a_res;

  // Pass through the texture number to the fragment shader
  v_textureIndex=a_textureIndex;
  // Pass through the tint
  v_tint=a_tint;
}`;class oC{constructor(t){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._quad=[0,0,0,0,0,0,0,0],this._defaultTint=$.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r=SA(t,s);this._maxTextures=Math.min(s,r);const l=this._transformFragmentSource(rC,this._maxTextures);this._shader=new fs({graphicsContext:e,fragmentSource:l,vertexSource:aC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((h,u)=>u)),this._buffer=new Qs({gl:t,size:48*this._maxImages,type:"dynamic"}),this._layout=new Sn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_res",2],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new zc(t,this._maxImages,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let s=t.replace("%%count%%",e.toString()),r="";for(let l=0;l<e;l++)l===0?r+=`if (v_textureIndex <= ${l}.5) {
`:r+=`   else if (v_textureIndex <= ${l}.5) {
`,r+=`      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;
`,r+=`      color = texture(u_textures[${l}], uv);
`,r+=`   }
`;return s=s.replace("%%texture_picker%%",r),s}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(Gt.Filtering),s=e?Eo(e):void 0,r=ds(t.getAttribute(Gt.WrappingX)),l=ds(t.getAttribute(Gt.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);t.removeAttribute("forceUpload"),this._textures.indexOf(u)===-1&&(this._textures.push(u),this._textureToIndex.set(u,this._textureIndex++),this._images.add(t))}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const s=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(s))!=null?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,s,r,l,h,u,f,g){var m,A,y,x;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const E=this._getImageWidth(t),C=this._getImageHeight(t);let L=E||r||0,D=C||l||0;this._view[0]=0,this._view[1]=0,this._view[2]=(m=r??E)!=null?m:0,this._view[3]=(A=l??C)!=null?A:0,this._dest[0]=e??1,this._dest[1]=s??1,h!==void 0&&u!==void 0&&f!==void 0&&g!==void 0&&(this._view[0]=e??1,this._view[1]=s??1,this._view[2]=(y=r??E)!=null?y:0,this._view[3]=(x=l??C)!=null?x:0,this._dest[0]=h,this._dest[1]=u,L=f,D=g),e=this._view[0],s=this._view[1];const R=this._view[2],P=this._view[3],F=this._context.getTransform(),Y=this._context.opacity,et=this._context.snapToPixel;this._quad[0]=this._dest[0],this._quad[1]=this._dest[1],this._quad[2]=this._dest[0]+L,this._quad[3]=this._dest[1],this._quad[4]=this._dest[0],this._quad[5]=this._dest[1]+D,this._quad[6]=this._dest[0]+L,this._quad[7]=this._dest[1]+D,F.multiplyQuadInPlace(this._quad),et&&(this._quad[0]=~~(this._quad[0]+te(this._quad[0])*Tt),this._quad[1]=~~(this._quad[1]+te(this._quad[1])*Tt),this._quad[2]=~~(this._quad[2]+te(this._quad[2])*Tt),this._quad[3]=~~(this._quad[3]+te(this._quad[3])*Tt),this._quad[4]=~~(this._quad[4]+te(this._quad[4])*Tt),this._quad[5]=~~(this._quad[5]+te(this._quad[5])*Tt),this._quad[6]=~~(this._quad[6]+te(this._quad[6])*Tt),this._quad[7]=~~(this._quad[7]+te(this._quad[7])*Tt));const k=this._context.tint||this._defaultTint,rt=this._getTextureIdForImage(t),gt=E||L,_t=C||D,At=(e+this.uvPadding)/gt,xt=(s+this.uvPadding)/_t,O=(e+R-this.uvPadding)/gt,K=(s+P-this.uvPadding)/_t,X=E,T=C,b=this._layout.vertexBuffer.bufferData;b[this._vertexIndex++]=this._quad[0],b[this._vertexIndex++]=this._quad[1],b[this._vertexIndex++]=Y,b[this._vertexIndex++]=X,b[this._vertexIndex++]=T,b[this._vertexIndex++]=At,b[this._vertexIndex++]=xt,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a,b[this._vertexIndex++]=this._quad[4],b[this._vertexIndex++]=this._quad[5],b[this._vertexIndex++]=Y,b[this._vertexIndex++]=X,b[this._vertexIndex++]=T,b[this._vertexIndex++]=At,b[this._vertexIndex++]=K,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a,b[this._vertexIndex++]=this._quad[2],b[this._vertexIndex++]=this._quad[3],b[this._vertexIndex++]=Y,b[this._vertexIndex++]=X,b[this._vertexIndex++]=T,b[this._vertexIndex++]=O,b[this._vertexIndex++]=xt,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a,b[this._vertexIndex++]=this._quad[6],b[this._vertexIndex++]=this._quad[7],b[this._vertexIndex++]=Y,b[this._vertexIndex++]=X,b[this._vertexIndex++]=T,b[this._vertexIndex++]=O,b[this._vertexIndex++]=K,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,48*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),Se.DrawnImagesCount+=this._imageCount,Se.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const lC=`#version 300 es

precision mediump float;

// UV coord
in vec2 v_uv;

in vec2 v_size; // in pixels

// Color coord to blend with image
in lowp vec4 v_color;

// Stroke color if used
in lowp vec4 v_strokeColor;

// Stroke thickness if used
in lowp float v_strokeThickness; // in pixels

// Opacity
in float v_opacity;

out vec4 fragColor;

void main() {
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border
    vec2 uv = v_uv;
    vec2 fragCoord = uv * v_size;
    float maxX = v_size.x - v_strokeThickness;
    float minX = v_strokeThickness;
    float maxY = v_size.y - v_strokeThickness;
    float minY = v_strokeThickness;

    if (fragCoord.x < maxX && fragCoord.x > minX &&
        fragCoord.y < maxY && fragCoord.y > minY) {
      fragColor = v_color;
    } else {
      fragColor = v_strokeColor;
    }
    fragColor.a *= v_opacity;
    fragColor.rgb *= fragColor.a;

    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;

    // float fHalfBorderDist      = 0.0;
    // float fHalfBorderThickness = 0.0;

    // if (fragCoord.x > max(v_radius, v_strokeThickness) && 
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))
    // {
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;
    //     fHalfBorderThickness = v_strokeThickness / 2.0;
    // }
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && 
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))
    // {
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;
    //     fHalfBorderThickness = v_strokeThickness / 2.0;
    // }
    // else
    // {
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));
        
    //     float ellipse_ab    = v_radius-v_strokeThickness;
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); 
            
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);
    // }

    // vec4 v4FromColor = v_strokeColor;
    // v4FromColor.rgb *= v4FromColor.a;
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent
    // if (fHalfBorderDist < 0.0) {
    //     v4ToColor = v_color;
    //     v4ToColor.rgb *= v4ToColor.a;
    // }

    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;

    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);
    // gl_FragColor = finalColor;
}`,cC=`#version 300 es
in vec2 a_position;

// UV coordinate
in vec2 a_uv;
out vec2 v_uv;

in vec2 a_size;
out vec2 v_size;

// Opacity 
in float a_opacity;
out float v_opacity;

in vec4 a_color;
out vec4 v_color;

in vec4 a_strokeColor;
out vec4 v_strokeColor;

in float a_strokeThickness;
out float v_strokeThickness;

uniform mat4 u_matrix;


void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Pass through UV coords
   v_uv = a_uv;
   // Pass through size
   v_size = a_size;
   // Pass through the Opacity to the fragment shader
   v_opacity = a_opacity;
   // Pass through the color to the fragment shader
   v_color = a_color;
   // Pass through the stroke color to the fragment shader
   v_strokeColor = a_strokeColor;
   // Pass through the stroke thickenss to the fragment shader
   v_strokeThickness = a_strokeThickness;
}`;class hC{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0,this._transparent=$.Transparent,this._scratch1=I(0,0),this._scratch2=I(0,0),this._scratch3=I(0,0),this._scratch4=I(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new fs({graphicsContext:e,fragmentSource:lC,vertexSource:cC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Qs({gl:t,size:64*this._maxRectangles,type:"dynamic"}),this._layout=new Sn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new zc(t,this._maxRectangles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof z&&t[1]instanceof z?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,s,r=1){this._isFull()&&this.flush(),this._rectangleCount++;const l=this._context.getTransform(),h=this._context.opacity,u=this._context.snapToPixel,f=e.sub(t),g=f.magnitude,m=f.normalize().perpendicular(),A=r/2,y=l.multiply(m.scale(A,this._scratch1).add(t,this._scratch1),this._scratch1),x=l.multiply(m.scale(-A,this._scratch2).add(t,this._scratch2),this._scratch2),E=l.multiply(m.scale(A,this._scratch3).add(e,this._scratch3),this._scratch3),C=l.multiply(m.scale(-A,this._scratch4).add(e,this._scratch4),this._scratch4);u&&(y.x=~~(y.x+Tt),y.y=~~(y.y+Tt),E.x=~~(E.x+Tt),E.y=~~(E.y+Tt),x.x=~~(x.x+Tt),x.y=~~(x.y+Tt),C.x=~~(C.x+Tt),C.y=~~(C.y+Tt));const L=0,D=0,R=1,P=1,F=this._transparent,Y=0,et=1,k=this._layout.vertexBuffer.bufferData;k[this._vertexIndex++]=y.x,k[this._vertexIndex++]=y.y,k[this._vertexIndex++]=L,k[this._vertexIndex++]=D,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=F.r/255,k[this._vertexIndex++]=F.g/255,k[this._vertexIndex++]=F.b/255,k[this._vertexIndex++]=F.a,k[this._vertexIndex++]=Y/et,k[this._vertexIndex++]=x.x,k[this._vertexIndex++]=x.y,k[this._vertexIndex++]=L,k[this._vertexIndex++]=P,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=F.r/255,k[this._vertexIndex++]=F.g/255,k[this._vertexIndex++]=F.b/255,k[this._vertexIndex++]=F.a,k[this._vertexIndex++]=Y/et,k[this._vertexIndex++]=E.x,k[this._vertexIndex++]=E.y,k[this._vertexIndex++]=R,k[this._vertexIndex++]=D,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=F.r/255,k[this._vertexIndex++]=F.g/255,k[this._vertexIndex++]=F.b/255,k[this._vertexIndex++]=F.a,k[this._vertexIndex++]=Y/et,k[this._vertexIndex++]=C.x,k[this._vertexIndex++]=C.y,k[this._vertexIndex++]=R,k[this._vertexIndex++]=P,k[this._vertexIndex++]=g,k[this._vertexIndex++]=r,k[this._vertexIndex++]=h,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=F.r/255,k[this._vertexIndex++]=F.g/255,k[this._vertexIndex++]=F.b/255,k[this._vertexIndex++]=F.a,k[this._vertexIndex++]=Y/et}drawRectangle(t,e,s,r,l=$.Transparent,h=0){this._isFull()&&this.flush(),this._rectangleCount++;const u=this._context.getTransform(),f=this._context.opacity,g=this._context.snapToPixel,m=u.multiply(t.add(I(0,0))),A=u.multiply(t.add(I(e,0))),y=u.multiply(t.add(I(e,s))),x=u.multiply(t.add(I(0,s)));g&&(m.x=~~(m.x+Tt),m.y=~~(m.y+Tt),A.x=~~(A.x+Tt),A.y=~~(A.y+Tt),x.x=~~(x.x+Tt),x.y=~~(x.y+Tt),y.x=~~(y.x+Tt),y.y=~~(y.y+Tt));const E=0,C=0,L=1,D=1,R=this._layout.vertexBuffer.bufferData;R[this._vertexIndex++]=m.x,R[this._vertexIndex++]=m.y,R[this._vertexIndex++]=E,R[this._vertexIndex++]=C,R[this._vertexIndex++]=e,R[this._vertexIndex++]=s,R[this._vertexIndex++]=f,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l.r/255,R[this._vertexIndex++]=l.g/255,R[this._vertexIndex++]=l.b/255,R[this._vertexIndex++]=l.a,R[this._vertexIndex++]=h,R[this._vertexIndex++]=x.x,R[this._vertexIndex++]=x.y,R[this._vertexIndex++]=E,R[this._vertexIndex++]=D,R[this._vertexIndex++]=e,R[this._vertexIndex++]=s,R[this._vertexIndex++]=f,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l.r/255,R[this._vertexIndex++]=l.g/255,R[this._vertexIndex++]=l.b/255,R[this._vertexIndex++]=l.a,R[this._vertexIndex++]=h,R[this._vertexIndex++]=A.x,R[this._vertexIndex++]=A.y,R[this._vertexIndex++]=L,R[this._vertexIndex++]=C,R[this._vertexIndex++]=e,R[this._vertexIndex++]=s,R[this._vertexIndex++]=f,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l.r/255,R[this._vertexIndex++]=l.g/255,R[this._vertexIndex++]=l.b/255,R[this._vertexIndex++]=l.a,R[this._vertexIndex++]=h,R[this._vertexIndex++]=y.x,R[this._vertexIndex++]=y.y,R[this._vertexIndex++]=L,R[this._vertexIndex++]=D,R[this._vertexIndex++]=e,R[this._vertexIndex++]=s,R[this._vertexIndex++]=f,R[this._vertexIndex++]=r.r/255,R[this._vertexIndex++]=r.g/255,R[this._vertexIndex++]=r.b/255,R[this._vertexIndex++]=r.a,R[this._vertexIndex++]=l.r/255,R[this._vertexIndex++]=l.g/255,R[this._vertexIndex++]=l.b/255,R[this._vertexIndex++]=l.a,R[this._vertexIndex++]=h}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),Se.DrawnImagesCount+=this._rectangleCount,Se.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const uC=`#version 300 es
precision highp float;

// UV coord
in vec2 v_uv;

// Color coord to blend with image
in lowp vec4 v_color;

// Stroke color if used
in lowp vec4 v_strokeColor;

// Stroke thickness if used
in lowp float v_strokeThickness;

// Opacity
in float v_opacity;

out vec4 fragColor;

void main() {
  // make (0, 0) the center the uv 
  vec2 uv = v_uv * 2.0 - 1.0;

  vec4 color = v_color;
  vec4 strokeColor = v_strokeColor;

  // circle border is at radius 1.0 
  // dist is > 0 when inside the circle 
  float d = length(uv);
  float dist = 1.0 - length(uv);

  // Fade based on fwidth
  float fade = fwidth(dot(uv, uv));

  // if dist is greater than 0 step to 1;
  // when we cross this 0 threshold add a smooth fade
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);

  // if dist is greater than the stroke thickness step to 1
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);

  strokeColor.a *= fill * stroke;
  strokeColor.rgb *= strokeColor.a;

  color.a *= fill * (1.0 - stroke);
  color.rgb *= color.a;

  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);
  finalColor.rgb = finalColor.rgb * v_opacity;
  finalColor.a = finalColor.a * v_opacity;
  fragColor = finalColor;
}`,dC=`#version 300 es
in vec2 a_position;

// UV coordinate
in vec2 a_uv;
out vec2 v_uv;

// Opacity 
in float a_opacity;
out float v_opacity;

in vec4 a_color;
out vec4 v_color;

in vec4 a_strokeColor;
out vec4 v_strokeColor;

in float a_strokeThickness;
out float v_strokeThickness;

uniform mat4 u_matrix;


void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Pass through UV coords
   v_uv = a_uv;
   // Pass through the Opacity to the fragment shader
   v_opacity = a_opacity;
   // Pass through the color to the fragment shader
   v_color = a_color;
   // Pass through the stroke color to the fragment shader
   v_strokeColor = a_strokeColor;
   // Pass through the stroke thickenss to the fragment shader
   v_strokeThickness = a_strokeThickness;
}`;class fC{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new fs({graphicsContext:e,fragmentSource:uC,vertexSource:dC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Qs({gl:t,size:56*this._maxCircles,type:"dynamic"}),this._layout=new Sn({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new zc(t,this._maxCircles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,s,r=$.Transparent,l=0){this._isFull()&&this.flush(),this._circleCount++;const h=this._context.getTransform(),u=this._context.opacity,f=this._context.snapToPixel,g=h.multiply(t.add(I(-e,-e))),m=h.multiply(t.add(I(e,-e))),A=h.multiply(t.add(I(e,e))),y=h.multiply(t.add(I(-e,e)));f&&(g.x=~~(g.x+Tt),g.y=~~(g.y+Tt),m.x=~~(m.x+Tt),m.y=~~(m.y+Tt),y.x=~~(y.x+Tt),y.y=~~(y.y+Tt),A.x=~~(A.x+Tt),A.y=~~(A.y+Tt));const x=0,E=0,C=1,L=1,D=this._layout.vertexBuffer.bufferData;D[this._vertexIndex++]=g.x,D[this._vertexIndex++]=g.y,D[this._vertexIndex++]=x,D[this._vertexIndex++]=E,D[this._vertexIndex++]=u,D[this._vertexIndex++]=s.r/255,D[this._vertexIndex++]=s.g/255,D[this._vertexIndex++]=s.b/255,D[this._vertexIndex++]=s.a,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=l/e,D[this._vertexIndex++]=y.x,D[this._vertexIndex++]=y.y,D[this._vertexIndex++]=x,D[this._vertexIndex++]=L,D[this._vertexIndex++]=u,D[this._vertexIndex++]=s.r/255,D[this._vertexIndex++]=s.g/255,D[this._vertexIndex++]=s.b/255,D[this._vertexIndex++]=s.a,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=l/e,D[this._vertexIndex++]=m.x,D[this._vertexIndex++]=m.y,D[this._vertexIndex++]=C,D[this._vertexIndex++]=E,D[this._vertexIndex++]=u,D[this._vertexIndex++]=s.r/255,D[this._vertexIndex++]=s.g/255,D[this._vertexIndex++]=s.b/255,D[this._vertexIndex++]=s.a,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=l/e,D[this._vertexIndex++]=A.x,D[this._vertexIndex++]=A.y,D[this._vertexIndex++]=C,D[this._vertexIndex++]=L,D[this._vertexIndex++]=u,D[this._vertexIndex++]=s.r/255,D[this._vertexIndex++]=s.g/255,D[this._vertexIndex++]=s.b/255,D[this._vertexIndex++]=s.a,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=l/e}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),Se.DrawnImagesCount+=this._circleCount,Se.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class pC{constructor(){this.z=0,this.priority=0,this.renderer="",this.transform=_e.identity(),this.state={z:0,opacity:1,tint:$.White,material:null},this.args=new Array(10)}}class i0{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(t,e){this._gl=t,this._context=e,this._buffer=new Qs({gl:t,size:24,type:"dynamic"}),this._layout=new Sn({gl:t,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_screenuv",2]],suppressWarnings:!0}),this._quads=new zc(t,1,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._textures.length=0,this._context=null,this._gl=null}draw(t,e,s,r,l,h,u,f,g){var m,A,y,x;const E=this._gl,C=this._context.material;if(!C)return;const L=this._context.getTransform(),D=this._context.opacity,R=C.getShader(),P=this._layout.vertexBuffer.bufferData;let F=0,Y=(t==null?void 0:t.width)||r||0,et=(t==null?void 0:t.height)||l||0,k=[0,0,(m=r??(t==null?void 0:t.width))!=null?m:0,(A=l??(t==null?void 0:t.height))!=null?A:0],rt=[e??1,s??1];h!==void 0&&u!==void 0&&f!==void 0&&g!==void 0&&(k=[e??1,s??1,(y=r??(t==null?void 0:t.width))!=null?y:0,(x=l??(t==null?void 0:t.height))!=null?x:0],rt=[h,u],Y=f,et=g),e=k[0],s=k[1];const gt=k[2],_t=k[3],At=I(rt[0],rt[1]),xt=I(rt[0]+Y,rt[1]),O=I(rt[0],rt[1]+et),K=I(rt[0]+Y,rt[1]+et),X=t.width||Y,T=t.height||et,b=e/X,tt=s/T,st=(e+gt-.01)/X,at=(s+_t-.01)/T,w=L.getPosition(),j=w.add(K),nt=w.x/this._context.width,lt=w.y/this._context.height,yt=j.x/this._context.width,St=j.y/this._context.height;P[F++]=At.x,P[F++]=At.y,P[F++]=b,P[F++]=tt,P[F++]=nt,P[F++]=lt,P[F++]=O.x,P[F++]=O.y,P[F++]=b,P[F++]=at,P[F++]=nt,P[F++]=St,P[F++]=xt.x,P[F++]=xt.y,P[F++]=st,P[F++]=tt,P[F++]=yt,P[F++]=lt,P[F++]=K.x,P[F++]=K.y,P[F++]=st,P[F++]=at,P[F++]=yt,P[F++]=St;const Lt=this._addImageAsTexture(t);C.use(),this._layout.shader=R,this._layout.use(!0),R.trySetUniformFloat("u_time_ms",performance.now()),R.trySetUniformFloat("u_opacity",D),R.trySetUniformFloatVector("u_resolution",I(this._context.width,this._context.height)),R.trySetUniformFloatVector("u_graphic_resolution",I(X,T)),R.trySetUniformFloatVector("u_size",I(gt,_t)),R.trySetUniformMatrix("u_matrix",this._context.ortho),R.trySetUniformMatrix("u_transform",L.to4x4()),E.activeTexture(E.TEXTURE0+0),E.bindTexture(E.TEXTURE_2D,Lt),R.trySetUniformInt("u_graphic",0),C.isUsingScreenTexture&&(E.activeTexture(E.TEXTURE0+1),E.bindTexture(E.TEXTURE_2D,this._context.materialScreenTexture),R.trySetUniformInt("u_screen_texture",1)),this._quads.bind(),E.drawElements(E.TRIANGLES,6,this._quads.bufferGlType,0),Se.DrawnImagesCount++,Se.DrawCallCount++}_addImageAsTexture(t){const e=t.getAttribute(Gt.Filtering),s=e?Eo(e):void 0,r=ds(t.getAttribute(Gt.WrappingX)),l=ds(t.getAttribute(Gt.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);return t.removeAttribute("forceUpload"),this._textures.indexOf(u)===-1&&this._textures.push(u),u}hasPendingDraws(){return!1}flush(){}}const gC=`#version 300 es
precision mediump float;

// UV coord
in vec2 v_texcoord;

// Textures in the current draw
uniform sampler2D u_textures[%%count%%];

uniform bool u_pixelart;

in float v_texture_index;

in float v_opacity;

in vec4 v_tint;

// texture resolution
in vec2 v_res;

in vec2 v_size;

in vec2 v_uv_min;
in vec2 v_uv_max;

out vec4 fragColor;

// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {
  vec2 pixel = uv * texture_size;

  vec2 seam=floor(pixel+.5);
  vec2 dudv=fwidth(pixel);
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);

  return pixel/texture_size;
}

float lerp(float from, float to, float rel){
  return ((1. - rel) * from) + (rel * to);
}

float invLerp(float from, float to, float value){
  return (value - from) / (to - from);
}

float remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){
  float rel = invLerp(origFrom, origTo, value);
  return lerp(targetFrom, targetTo, rel);
}

void main(){
  // In order to support the most efficient sprite batching, we have multiple
  // textures loaded into the gpu (usually 8) this picker logic skips over textures
  // that do not apply to a particular sprite.

  vec4 color=vec4(1.,0,0,1.);
  vec2 remapped_uv = v_texcoord;
  remapped_uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, v_texcoord.x);
  remapped_uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, v_texcoord.y);
  vec2 uv = u_pixelart ? uv_iq(remapped_uv, v_size) : remapped_uv;

  // GLSL is templated out to pick the right texture and set the vec4 color
  %%texture_picker%%

  color.rgb = color.rgb * v_opacity;
  color.a = color.a * v_opacity;
  fragColor = color * v_tint;
}`,mC=`#version 300 es
layout(location=0) in vec2 pos;
layout(location=1) in vec2 a_texcoord;
out vec2 v_texcoord;

layout(location=2) in vec2 a_offset;
layout(location=3) in vec2 a_mat_column1;
layout(location=4) in vec2 a_mat_column2;
layout(location=5) in vec2 a_mat_column3;

layout(location=6) in float a_opacity;
out float v_opacity;

// Texture resolution (could be bigger than a_size)
layout(location=7) in vec2 a_res;
out vec2 v_res;

// Final size of graphic
layout(location=8) in vec2 a_size;
out vec2 v_size;

layout(location=9) in lowp float a_texture_index;
out lowp float v_texture_index;

layout(location=10) in vec2 a_uv_min;
out vec2 v_uv_min;

layout(location=11) in vec2 a_uv_max;
out vec2 v_uv_max;

layout(location=12) in vec4 a_tint;
out vec4 v_tint;

uniform mat4 u_matrix;

void main(){
  mat4 world_mat = mat4(
    a_mat_column1.x, a_mat_column1.y, 0., 0.,
    a_mat_column2.x, a_mat_column2.y, 0., 0.,
    0.             , 0.             , 1., 0.,
    a_mat_column3.x, a_mat_column3.y, 0., 1.
  );

  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);
  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);

  v_opacity = a_opacity;
  v_texcoord = a_texcoord;
  v_uv_min = a_uv_min;
  v_uv_max = a_uv_max;
  v_res = a_res;
  v_size = a_size;
  v_texture_index = a_texture_index;
  v_tint = a_tint;
}`;class _C{constructor(t){this.type="ex.image-v2",this.priority=0,this._maxImages=2e4,this._maxTextures=0,this._components=22,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._defaultTint=$.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r=SA(t,s);this._maxTextures=Math.min(s,r);const l=this._transformFragmentSource(gC,this._maxTextures);this._shader=new fs({graphicsContext:e,fragmentSource:l,vertexSource:mC}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((A,y)=>y)),this._vao=t.createVertexArray(),t.bindVertexArray(this._vao),this._quadMesh=new Float32Array([0,0,0,0,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,1,1,1,1]),this._meshBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._meshBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadMesh,t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,16,0),t.enableVertexAttribArray(0),t.vertexAttribPointer(1,2,t.FLOAT,!1,16,8),t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,null);const h=this._components;this._transformData=new Qs({gl:t,size:h*this._maxImages,type:"dynamic"}),this._transformData.bind();let u=0,f=2;const g=4,m=h*4;t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(2),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(3),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(4),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(5),u+=2*g,t.vertexAttribPointer(f++,1,t.FLOAT,!1,m,u),t.enableVertexAttribArray(6),u+=1*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(7),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(8),u+=2*g,t.vertexAttribPointer(f++,1,t.FLOAT,!1,m,u),t.enableVertexAttribArray(9),u+=1*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(10),u+=2*g,t.vertexAttribPointer(f++,2,t.FLOAT,!1,m,u),t.enableVertexAttribArray(11),u+=2*g,t.vertexAttribPointer(f++,4,t.FLOAT,!1,m,u),t.enableVertexAttribArray(12),u+=4*g,t.vertexAttribDivisor(2,1),t.vertexAttribDivisor(3,1),t.vertexAttribDivisor(4,1),t.vertexAttribDivisor(5,1),t.vertexAttribDivisor(6,1),t.vertexAttribDivisor(7,1),t.vertexAttribDivisor(8,1),t.vertexAttribDivisor(9,1),t.vertexAttribDivisor(10,1),t.vertexAttribDivisor(11,1),t.vertexAttribDivisor(12,1),t.bindVertexArray(null)}_bindData(t){const e=this._components;this._transformData.bind(),this._transformData.upload(e*this._imageCount),t.bindVertexArray(this._vao)}dispose(){this._transformData.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let s=t.replace("%%count%%",e.toString()),r="";for(let l=0;l<e;l++)l===0?r+=`if (v_texture_index <= ${l}.5) {
`:r+=`   else if (v_texture_index <= ${l}.5) {
`,r+=`      color = texture(u_textures[${l}], uv);
`,r+=`   }
`;return s=s.replace("%%texture_picker%%",r),s}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(Gt.Filtering),s=e?Eo(e):void 0,r=ds(t.getAttribute(Gt.WrappingX)),l=ds(t.getAttribute(Gt.WrappingY)),h=t.getAttribute("forceUpload")==="true",u=this._context.textureLoader.load(t,{filtering:s,wrapping:{x:r,y:l}},h);t.removeAttribute("forceUpload"),this._textures.indexOf(u)===-1&&(this._textures.push(u),this._textureToIndex.set(u,this._textureIndex++),this._images.add(t))}_bindTextures(t){const e=Math.min(this._textureIndex,this._maxTextures);for(let s=0;s<e;s++)t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,this._textures[s]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const s=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(s))!=null?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,s,r,l,h,u,f,g){var m,A,y,x;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const E=this._getImageWidth(t),C=this._getImageHeight(t);let L=E||r||0,D=C||l||0;this._view[0]=0,this._view[1]=0,this._view[2]=(m=r??E)!=null?m:0,this._view[3]=(A=l??C)!=null?A:0,this._dest[0]=e??1,this._dest[1]=s??1,h!==void 0&&u!==void 0&&f!==void 0&&g!==void 0&&(this._view[0]=e??1,this._view[1]=s??1,this._view[2]=(y=r??E)!=null?y:0,this._view[3]=(x=l??C)!=null?x:0,this._dest[0]=h,this._dest[1]=u,L=f,D=g),e=this._view[0],s=this._view[1];const R=this._view[2],P=this._view[3],F=this._context.getTransform(),Y=this._context.opacity;this._context.snapToPixel&&(this._dest[0]=~~(this._dest[0]+Tt),this._dest[1]=~~(this._dest[1]+Tt));const k=this._context.tint||this._defaultTint,rt=this._getTextureIdForImage(t),gt=E||L,_t=C||D,At=(e+this.uvPadding)/gt,xt=(s+this.uvPadding)/_t,O=(e+R-this.uvPadding)/gt,K=(s+P-this.uvPadding)/_t,X=E,T=C,b=this._transformData.bufferData;b[this._vertexIndex++]=this._dest[0],b[this._vertexIndex++]=this._dest[1],b[this._vertexIndex++]=F.data[0],b[this._vertexIndex++]=F.data[1],b[this._vertexIndex++]=F.data[2],b[this._vertexIndex++]=F.data[3],b[this._vertexIndex++]=F.data[4],b[this._vertexIndex++]=F.data[5],b[this._vertexIndex++]=Y,b[this._vertexIndex++]=L,b[this._vertexIndex++]=D,b[this._vertexIndex++]=X,b[this._vertexIndex++]=T,b[this._vertexIndex++]=rt,b[this._vertexIndex++]=At,b[this._vertexIndex++]=xt,b[this._vertexIndex++]=O,b[this._vertexIndex++]=K,b[this._vertexIndex++]=k.r/255,b[this._vertexIndex++]=k.g/255,b[this._vertexIndex++]=k.b/255,b[this._vertexIndex++]=k.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._bindData(t),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),t.drawArraysInstanced(t.TRIANGLES,0,6,this._imageCount),Se.DrawnImagesCount+=this._imageCount,Se.DrawCallCount++,t.bindVertexArray(null),this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const Tt=1e-4;class AC{constructor(t){this._webglCtx=t,this._debugText=new xA}drawRect(t,e,s,r,l={color:$.Black}){this.drawLine(I(t,e),I(t+s,e),{...l}),this.drawLine(I(t+s,e),I(t+s,e+r),{...l}),this.drawLine(I(t+s,e+r),I(t,e+r),{...l}),this.drawLine(I(t,e+r),I(t,e),{...l})}drawLine(t,e,s){var r;this._webglCtx.draw("ex.line",t,e,(r=s==null?void 0:s.color)!=null?r:$.Black)}drawPoint(t,e={color:$.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class Fs{constructor(t){this._logger=vt.getInstance(),this._renderers=new Map,this._lazyRenderersFactory=new Map,this.imageRenderer=ic.isEnabled("use-legacy-image-renderer")?"ex.image":"ex.image-v2",this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new uf(()=>new pC,void 0,4e3),this._drawCallIndex=0,this._drawCalls=new Array(4e3).fill(null),this._postProcessTargets=[],this._postprocessors=[],this._transform=new Tw,this._state=new yA,this.snapToPixel=!1,this.smoothing=!1,this.pixelArtSampler=!1,this.uvPadding=.01,this.backgroundColor=$.ExcaliburBlue,this.multiSampleAntialiasing=!0,this.transparency=!0,this._isContextLost=!1,this._disposed=!1,this._imageToWidth=new Map,this._imageToHeight=new Map,this.debug=new AC(this),this._totalPostProcessorTime=0;const{canvasElement:e,context:s,enableTransparency:r,antialiasing:l,uvPadding:h,multiSampleAntialiasing:u,pixelArtSampler:f,powerPreference:g,snapToPixel:m,backgroundColor:A,useDrawSorting:y,garbageCollector:x,handleContextLost:E,handleContextRestored:C}=t;if(this.__gl=s??e.getContext("webgl2",{antialias:l??this.smoothing,premultipliedAlpha:!1,alpha:r??this.transparency,depth:!1,powerPreference:g??"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");E&&this.__gl.canvas.addEventListener("webglcontextlost",E,!1),C&&this.__gl.canvas.addEventListener("webglcontextrestored",C,!1),this.__gl.canvas.addEventListener("webglcontextlost",()=>{this._isContextLost=!0}),this.__gl.canvas.addEventListener("webglcontextrestored",()=>{this._isContextLost=!1}),this.textureLoader=new oo(this.__gl,x),this.snapToPixel=m??this.snapToPixel,this.smoothing=l??this.smoothing,this.transparency=r??this.transparency,this.pixelArtSampler=f??this.pixelArtSampler,this.uvPadding=h??this.uvPadding,this.multiSampleAntialiasing=typeof u=="boolean"?u:this.multiSampleAntialiasing,this.samples=typeof u=="object"?u.samples:void 0,this.backgroundColor=A??this.backgroundColor,this.useDrawSorting=y??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}dispose(){if(!this._disposed){this._disposed=!0,this.textureLoader.dispose();for(const t of this._renderers.values())t.dispose();this._renderers.clear(),this._drawCallPool.dispose(),this._drawCalls.length=0,this.__gl=null}}_init(){const t=this.__gl;if(this._ortho=Mi.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!1),this.register(new oC({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.register(new i0),this.register(new hC),this.register(new fC),this.register(new eC),this.register(new Kw),this.lazyRegister("ex.particle",()=>new Yw),this.register(new _C({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.materialScreenTexture=t.createTexture(),!this.materialScreenTexture)throw new Error("Could not create screen texture!");t.bindTexture(t.TEXTURE_2D,this.materialScreenTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this._screenRenderer=new nC(this),this._renderTarget=new Wl({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new Wl({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),new Wl({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height})],this._msaaTarget=new Wl({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height,antialias:this.multiSampleAntialiasing,samples:this.samples})}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}lazyRegister(t,e){this._lazyRenderersFactory.set(t,e)}get(t){let e=this._renderers.get(t);if(!e){const s=this._lazyRenderersFactory.get(t);s&&(this._logger.debug("lazy init renderer:",t),e=s(),this.register(e))}return e}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){if(e.length>9)throw new Error("Only 10 or less renderer arguments are supported!;");if(this._isDrawLifecycle||this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._isContextLost){this._logger.errorOnce(`Unable to draw ${t}, the webgl context is lost`);return}const s=this.get(t);if(s)if(this.useDrawSorting){const r=this._drawCallPool.get();r.z=this._state.current.z,r.priority=s.priority,r.renderer=t,this.getTransform().clone(r.transform),r.state.z=this._state.current.z,r.state.opacity=this._state.current.opacity,r.state.tint=this._state.current.tint,r.state.material=this._state.current.material,r.args[0]=e[0],r.args[1]=e[1],r.args[2]=e[2],r.args[3]=e[3],r.args[4]=e[4],r.args[5]=e[5],r.args[6]=e[6],r.args[7]=e[7],r.args[8]=e[8],r.args[9]=e[9],this._drawCalls[this._drawCallIndex++]=r}else this._currentRenderer||(this._currentRenderer=s),this._isCurrentRenderer(s)||this._currentRenderer.flush(),s.draw(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]),this._currentRenderer=s;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.reset()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=Mi.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._msaaTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height)}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}drawImage(t,e,s,r,l,h,u,f,g){if(!(r===0||l===0)){{if(f===0||g===0)return;if(this._getImageWidth(t)===0||this._getImageHeight(t)===0)return}if(!t){vt.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",t,e,s,r,l,h,u,f,g):this.imageRenderer==="ex.image"?this.draw(this.imageRenderer,t,e,s,r,l,h,u,f,g):this.draw(this.imageRenderer,t,e,s,r,l,h,u,f,g)}}drawLine(t,e,s,r=1){this.draw("ex.rectangle",t,e,s,r)}drawRectangle(t,e,s,r,l,h){this.draw("ex.rectangle",t,e,s,r,l,h)}drawCircle(t,e,s,r,l){this.draw("ex.circle",t,e,s,r,l)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~(t+Tt):t,this.snapToPixel?~~(e+Tt):e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);e!==-1&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(t){for(const e of this._postprocessors){const s=e.getShader();s.use();const r=s.getUniformDefinitions();this._totalPostProcessorTime+=t,r.find(l=>l.name==="u_time_ms")&&s.setUniformFloat("u_time_ms",this._totalPostProcessorTime),r.find(l=>l.name==="u_elapsed_ms")&&s.setUniformFloat("u_elapsed_ms",t),r.find(l=>l.name==="u_resolution")&&s.setUniformFloatVector("u_resolution",I(this.width,this.height)),e.onUpdate&&e.onUpdate(t)}}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return new Jw({...t,graphicsContext:this})}createShader(t){const{name:e,vertexSource:s,fragmentSource:r,uniforms:l,images:h,startingTextureSlot:u}=t,f=new fs({name:e,graphicsContext:this,vertexSource:s,fragmentSource:r,uniforms:l,images:h,startingTextureSlot:u});return f.compile(),f}clear(){const t=this.__gl;(this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget).use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){var t;if(this._isContextLost){this._logger.errorOnce("Unable to flush the webgl context is lost");return}let e=this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget;if(e.use(),this.useDrawSorting){for(let h=this._drawCallIndex;h<this._drawCalls.length;h++)this._drawCalls[h]=null;const s=new Map;for(const[h]of this._renderers){let u=0;for(u=0;u<this._drawCallIndex&&this._drawCalls[u].renderer!==h;u++);s.set(h,u)}this._drawCalls.sort((h,u)=>{if(h===null||u===null)return 0;const f=h.z-u.z,g=s.get(h.renderer)-s.get(u.renderer),m=h.priority-u.priority;return f===0?m===0?g:m:f});const r=this._transform.current,l=this._state.current;if(this._drawCalls.length&&this._drawCallIndex){let h=this._drawCalls[0].renderer,u=this.get(h);for(let f=0;f<this._drawCallIndex;f++)this._transform.current=this._drawCalls[f].transform,this._state.current=this._drawCalls[f].state,this._drawCalls[f].renderer!==h&&(u.flush(),h=this._drawCalls[f].renderer,u=this.get(h)),u instanceof i0&&((t=this.material)!=null&&t.isUsingScreenTexture)&&(e.copyToTexture(this.materialScreenTexture),e.use()),u.draw(...this._drawCalls[f].args);u.hasPendingDraws()&&u.flush()}this._transform.current=r,this._state.current=l,this._drawCallPool.done(),this._drawCallIndex=0,this._imageToHeight.clear(),this._imageToWidth.clear()}else for(const s of this._renderers.values())s.hasPendingDraws()&&s.flush();e.disable(),this._postprocessors.length>0&&e.toRenderSource().use();for(let s=0;s<this._postprocessors.length;s++)e=this._postProcessTargets[s%2],this._postProcessTargets[s%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[s]),this._postProcessTargets[s%2].toRenderSource().use();e.blitToScreen()}}class Wr{constructor(t,e,s,r){this.font=t,this.text=e,this.color=s,this.maxWidth=r,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas");const l=this.canvas.getContext("2d");if(!l)throw new Error("Unable to create FontTextInstance, internal canvas failed to create");this.ctx=l,this.dimensions=this.measureText(e),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,e){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let s=null;e!=null?s=this._getLinesFromText(t,e):s=t.split(`
`);const r=s.reduce((y,x)=>y.length>x.length?y:x);this._applyFont(this.ctx);const l=this.ctx.measureText(r);let h=Math.abs(l.actualBoundingBoxAscent)+Math.abs(l.actualBoundingBoxDescent);const u=h*s.length;h=u;const f=u-Math.abs(l.actualBoundingBoxAscent),g=0,m=0;return new Et({left:g-Math.abs(l.actualBoundingBoxLeft)-this.font.padding,top:m-Math.abs(l.actualBoundingBoxAscent)-this.font.padding,bottom:m+f+this.font.padding,right:g+Math.abs(l.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,e){let s=1;this.font.lineHeight&&(s=this.font.lineHeight/this.font.size),e.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,e.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality*s}static getHashCode(t,e,s){var r;return e+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+t.lineHeight+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((r=t.strokeColor)==null?void 0:r.toString())+(s?s.toString():t.color.toString()))}getHashCode(t=!0){return Wr.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var e,s,r;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((e=this.font.lineDash)!=null?e:t.getLineDash()),t.strokeStyle=(r=(s=this.font.strokeColor)==null?void 0:s.toString())!=null?r:"",t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(this.font.shadow.color&&(t.shadowColor=this.font.shadow.color.toString()),this.font.shadow.blur&&(t.shadowBlur=this.font.shadow.blur),this.font.shadow.offset&&(t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y))}_drawText(t,e,s){this._applyRasterProperties(t),this._applyFont(t);for(let r=0;r<e.length;r++){const l=e[r];this.color&&t.fillText(l,0,r*s),this.font.strokeColor&&t.strokeText(l,0,r*s)}this.font.showDebug&&($_(t,$.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),$_(t,$.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){const e=[];let s=0,r=0;const l=Math.min(4096,t.canvas.width),h=Math.min(4096,t.canvas.height);for(;s<t.canvas.width;){for(;r<t.canvas.height;){const u=document.createElement("canvas");u.width=l,u.height=h;const f=u.getContext("2d");if(!f)throw new Error("Unable to split internal FontTextInstance bitmap, failed to create internal canvas");f.drawImage(t.canvas,s,r,l,h,0,0,l,h),e.push({x:s,y:r,canvas:u}),r+=h}s+=l,r=0}return e}flagDirty(){this._dirty=!0}render(t,e,s,r){var l;if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=t;const h=this.getHashCode();if(this._lastHashCode!==h&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,r),this._setDimension(this.dimensions,this.ctx);const u=this._getLinesFromText(this.text,r),f=(l=this.font.lineHeight)!=null?l:this.dimensions.height/u.length;if(this._drawText(this.ctx,u,f),t instanceof Fs)for(const g of this._textFragments)t.textureLoader.delete(g.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),t instanceof Fs)for(const g of this._textFragments)t.textureLoader.load(g.canvas,{filtering:this.font.filtering},!0);this._lastHashCode=h,this._dirty=!1}for(const u of this._textFragments)t.drawImage(u.canvas,0,0,u.canvas.width,u.canvas.height,u.x/this.font.quality+e-this.ctx.canvas.width/this.font.quality/2,u.y/this.font.quality+s-this.ctx.canvas.height/this.font.quality/2,u.canvas.width/this.font.quality,u.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof Fs)for(const t of this._textFragments)this._ex.textureLoader.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,e){var s;if(this._cachedText===t&&this._cachedRenderWidth===e&&((s=this._cachedLines)!=null&&s.length))return this._cachedLines;const r=t.split(`
`);if(e==null)return r;for(let l=0;l<r.length;l++){let h=r[l],u="";if(this.measureText(h).width>e){for(;this.measureText(h).width>e;)u=h[h.length-1]+u,h=h.slice(0,-1);r[l]=h,r[l+1]=u}}return this._cachedText=t,this._cachedLines=r,this._cachedRenderWidth=e,r}}class mc extends He{constructor(t={}){var e,s,r,l,h,u,f,g,m,A,y,x,E,C,L,D,R,P,F,Y;super(t),this.filtering=ii.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=$.Black,this.family="sans-serif",this.style=_A.Normal,this.bold=!1,this.unit=pA.Px,this.textAlign=gA.Left,this.baseAlign=mA.Top,this.direction=AA.LeftToRight,this.lineHeight=void 0,this.size=10,this._textBounds=new Et,this.smoothing=(e=t==null?void 0:t.smoothing)!=null?e:this.smoothing,this.padding=(s=t==null?void 0:t.padding)!=null?s:this.padding,this.color=(r=t==null?void 0:t.color)!=null?r:this.color,this.strokeColor=(l=t==null?void 0:t.strokeColor)!=null?l:this.strokeColor,this.lineDash=(h=t==null?void 0:t.lineDash)!=null?h:this.lineDash,this.lineWidth=(u=t==null?void 0:t.lineWidth)!=null?u:this.lineWidth,this.filtering=(f=t==null?void 0:t.filtering)!=null?f:this.filtering,this.family=(g=t==null?void 0:t.family)!=null?g:this.family,this.style=(m=t==null?void 0:t.style)!=null?m:this.style,this.bold=(A=t==null?void 0:t.bold)!=null?A:this.bold,this.size=(y=t==null?void 0:t.size)!=null?y:this.size,this.unit=(x=t==null?void 0:t.unit)!=null?x:this.unit,this.textAlign=(E=t==null?void 0:t.textAlign)!=null?E:this.textAlign,this.baseAlign=(C=t==null?void 0:t.baseAlign)!=null?C:this.baseAlign,this.direction=(L=t==null?void 0:t.direction)!=null?L:this.direction,this.lineHeight=(D=t==null?void 0:t.lineHeight)!=null?D:this.lineHeight,this.quality=(R=t==null?void 0:t.quality)!=null?R:this.quality,t!=null&&t.shadow&&(this.shadow={},this.shadow.blur=(P=t.shadow.blur)!=null?P:this.shadow.blur,this.shadow.offset=(F=t.shadow.offset)!=null?F:this.shadow.offset,this.shadow.color=(Y=t.shadow.color)!=null?Y:this.shadow.color),this._textMeasurement=new Wr(this,"",$.Black)}clone(){return new mc({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:void 0})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,s){}_rotate(t){var e;const s=(e=this.origin)!=null?e:this._textBounds.center;t.translate(s.x,s.y),t.rotate(this.rotation),t.translate(-s.x,-s.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,e){return this._textMeasurement.measureText(t,e)}measureText(t,e){return Id.measureText(t,this,e)}_postDraw(t){t.restore()}render(t,e,s,r,l,h){const u=Id.getTextInstance(e,this,s);this._textBounds=u.dimensions,this._preDraw(t,r,l),u.render(t,r,l,h),this._postDraw(t)}}class Ao extends He{constructor(t){var e,s;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(e=t.font)!=null?e:new mc,this.color=(s=t.color)!=null?s:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,e;return new Ao({text:this.text.slice(),color:(e=(t=this.color)==null?void 0:t.clone())!=null?e:$.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_preDraw(t,e,s){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(t,e,s)}_drawImage(t,e,s){var r;let l=$.Black;this.font instanceof mc&&(l=(r=this.color)!=null?r:this.font.color);const{width:h,height:u}=this.font.measureText(this._text,this.maxWidth);this._textWidth=h,this._textHeight=u,this.font.render(t,this._text,l,e,s,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(e-h,s-u,h*2,u*2),this.maxWidth!=null&&t.debug.drawRect(e,s,this.maxWidth,this.height,{color:$.Yellow}))}}function BA(o){return!!o.tick}class je extends ts{constructor(t){super(),this._logger=vt.getInstance(),this._current="default",this._graphics={},this._options={},this.material=null,this.isVisible=!0,this.forceOnScreen=!1,this.opacity=1,this._offset=new yn(z.Zero,()=>this.recalculateBounds()),this._anchor=new yn(z.Half,()=>this.recalculateBounds()),this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,t={visible:this.isVisible,graphics:{},...t};const{current:e,anchor:s,color:r,opacity:l,visible:h,graphics:u,offset:f,copyGraphics:g,onPreDraw:m,onPostDraw:A,onPreTransformDraw:y,onPostTransformDraw:x}=t;for(const[E,C]of Object.entries(u))C instanceof He?this._graphics[E]=C:(this._graphics[E]=C.graphic,this._options[E]=C.options);this.offset=f??this.offset,this.opacity=l??this.opacity,this.anchor=s??this.anchor,this.color=r??this.color,this.copyGraphics=g??this.copyGraphics,this.onPreDraw=m??this.onPreDraw,this.onPostDraw=A??this.onPostDraw,this.onPreDraw=y??this.onPreTransformDraw,this.onPostTransformDraw=x??this.onPostTransformDraw,this.isVisible=!!h,this._current=e??this._current,e&&this._graphics[e]&&this.use(e)}get visible(){return this.isVisible}set visible(t){this.isVisible=t}get offset(){return this._offset}set offset(t){this._offset=new yn(t,()=>this.recalculateBounds()),this.recalculateBounds()}get anchor(){return this._anchor}set anchor(t){this._anchor=new yn(t,()=>this.recalculateBounds()),this.recalculateBounds()}get color(){return this._color}set color(t){if(t){this._color=t.clone();const e=this.current;(e instanceof Pc||e instanceof Ao)&&(e.color=this._color)}}getGraphic(t){return this._graphics[t]}getOptions(t){return this._options[t]}getNames(){return Object.keys(this._graphics)}get current(){return this._graphics[this._current]}get currentOptions(){return this._options[this._current]}get graphics(){return this._graphics}get options(){return this._options}add(t,e,s){let r="default",l=null,h;if(typeof t=="string"&&e instanceof He&&(r=t,l=e,h=s),t instanceof He&&!(e instanceof He)&&(l=t,h=e),!l)throw new Error("Need to provide a graphic or valid graphic string");return this._graphics[r]=this.copyGraphics?l.clone():l,this._options[r]=this.copyGraphics?{...h}:h,r==="default"&&this.use("default"),l}remove(t){delete this._graphics[t],delete this._options[t],this._current===t&&(this._current="default",this.recalculateBounds())}use(t,e){var s;if(t instanceof He){let r=t;this.copyGraphics&&(r=t.clone()),this._current="default",this._graphics[this._current]=r,this._options[this._current]=e}else this._current=t,this._options[this._current]=e,this._current in this._graphics||this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(s=this.owner)==null?void 0:s.name}. Nothing will be drawn.`);return this.recalculateBounds(),this.current}hide(){this._current="ex.none"}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new Et;const e=this._graphics[this._current],s=this._options[this._current];if(!e){this._localBounds=t;return}let r=this.anchor,l=this.offset;s!=null&&s.anchor&&(r=s.anchor),s!=null&&s.offset&&(l=s.offset);const h=e.localBounds,u=-h.width*r.x+l.x,f=-h.height*r.y+l.y;e instanceof Cn&&!e.useAnchor?t=e==null?void 0:e.localBounds.combine(t):t=e==null?void 0:e.localBounds.translate(I(u,f)).combine(t),this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}get bounds(){let t=this.localBounds;if(this.owner){const e=this.owner.get(ot);e&&(t=t.transform(e.get().matrix))}return t}update(t,e=0){const s=this.current;s&&BA(s)&&s.tick(t,e)}clone(){const t=new je;return t._graphics={...this._graphics},t._options={...this._options},t.offset=this.offset.clone(),this.color&&(t.color=this.color.clone()),t.opacity=this.opacity,t.anchor=this.anchor.clone(),t.copyGraphics=this.copyGraphics,t.onPreDraw=this.onPreDraw,t.onPostDraw=this.onPostDraw,t.isVisible=this.isVisible,t}}class yo extends ts{constructor(t){var e,s;super(),this.useColliderShape=!0,this.useGraphicsBounds=!0,this.useColliderShape=(e=t==null?void 0:t.useColliderShape)!=null?e:this.useColliderShape,this.useGraphicsBounds=(s=t==null?void 0:t.useGraphicsBounds)!=null?s:this.useGraphicsBounds,this.localBounds=t==null?void 0:t.localBounds}}const si=class{static CreateReversibleEasingFunction(t){return(e,s,r,l)=>r<s?s-(t(e,r,s,l)-r):t(e,s,r,l)}static CreateVectorEasingFunction(t){return(e,s,r,l)=>new z(t(e,s.x,r.x,l),t(e,s.y,r.y,l))}};si.Linear=si.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,e*o/s+t));si.EaseInQuad=si.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,e*o*o+t));si.EaseOutQuad=si.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,-e*o*(o-2)+t));si.EaseInOutQuad=si.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s/2,o<1?e/2*o*o+t:(o--,-e/2*(o*(o-2)-1)+t)));si.EaseInCubic=si.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,e*o*o*o+t));si.EaseOutCubic=si.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s,o--,e*(o*o*o+1)+t));si.EaseInOutCubic=si.CreateReversibleEasingFunction((o,t,e,s)=>(e=e-t,o/=s/2,o<1?e/2*o*o*o+t:(o-=2,e/2*(o*o*o+2)+t)));let Us=si;class yC{constructor(t){this._actions=[],this._currentAction=null,this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}getIncompleteActions(){return this._actions}getCurrentAction(){return this._currentAction}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){if(this._actions.length>0&&(this._currentAction!==this._actions[0]&&(this._currentAction=this._actions[0],this._entity.emit("actionstart",new lw(this._currentAction,this._entity))),this._currentAction.update(t),this._currentAction.isComplete(this._entity))){this._entity.emit("actioncomplete",new cw(this._currentAction,this._entity));const e=this._actions.shift();e&&this._completedActions.push(e)}}}let vC=0;function ee(){return vC++}class xC{constructor(t,e,s){this.id=ee(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new yf(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=s,this._originalRepeat=s,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class bC{constructor(t,e){this.id=ee(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new yf(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}function wC(o){return o.offset instanceof z&&typeof o.duration=="number"}class CC{constructor(t,e){this.entity=t,this.id=ee(),this._started=!1,this._stopped=!1,this._easing=Us.Linear;var s;if(this._offset=e.offset,this._easing=(s=e.easing)!=null?s:this._easing,this._tx=t.get(ot),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._end=this._start.add(this._offset),this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=this._tx.pos,r=this._easing(e,this._start.x,this._end.x,1),l=this._easing(e,this._start.y,this._end.y,1),h=t/1e3,u=h===0?0:(r-s.x)/h,f=h===0?0:(l-s.y)/h;this._motion.vel.x=u,this._motion.vel.y=f,this.isComplete(this.entity)&&(this._tx.pos=I(this._end.x,this._end.y),this._motion.vel=I(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=I(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class s0{constructor(t,e,s,r){if(this.id=ee(),this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(ot),this._motion=t.get(Zt),this._speed=r,this._offset=new z(e,s),r<=0)throw vt.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+r),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new z(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.magnitude,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=I(this._end.x,this._end.y),this._motion.vel=I(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(ot);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=I(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function SC(o){return o.pos instanceof z&&typeof o.duration=="number"}class TC{constructor(t,e){this.entity=t,this.id=ee(),this._started=!1,this._stopped=!1,this._easing=Us.Linear;var s;if(this._end=e.pos,this._easing=(s=e.easing)!=null?s:this._easing,this._tx=t.get(ot),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=this._tx.pos,r=this._easing(e,this._start.x,this._end.x,1),l=this._easing(e,this._start.y,this._end.y,1),h=t/1e3,u=h===0?0:(r-s.x)/h,f=h===0?0:(l-s.y)/h;this._motion.vel.x=u,this._motion.vel.y=f,this.isComplete(this.entity)&&(this._tx.pos=I(this._end.x,this._end.y),this._motion.vel=I(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=I(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class n0{constructor(t,e,s,r){this.entity=t,this.id=ee(),this._started=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._end=new z(e,s),this._speed=r}update(t){this._started||(this._started=!0,this._start=new z(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=I(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=I(this._end.x,this._end.y),this._motion.vel=I(0,0))}isComplete(t){const e=t.get(ot);return this._stopped||new z(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=I(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class EC{constructor(t,e){this.entity=t,this.id=ee(),this._started=!1,this._stopped=!1,this._endAngle=0,this._startAngle=0;var s;if(this._endAngle=e.angle,this._tx=t.get(ot),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(s=e.rotationType)!=null?s:Ae.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=EA(this._startAngle,this._endAngle,this._rotationType,e),r=this._tx.rotation,l=t/1e3,h=l===0?0:(s-r)/l;this._motion.angularVelocity=h,this.isComplete(this.entity)&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class DC{constructor(t,e,s,r){this.id=ee(),this._started=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._end=e,this._speed=s,this._rotationType=r||Ae.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const e=Math.abs(this._end-this._start),s=Ge-e;switch(e>s?(this._shortDistance=s,this._longDistance=e):(this._shortDistance=e,this._longDistance=s),this._shortestPathIsPositive=(this._start-this._end+Ge)%Ge>=Math.PI,this._rotationType){case Ae.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case Ae.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case Ae.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case Ae.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class RC{constructor(t,e){this.entity=t,this.id=ee(),this._started=!1,this._stopped=!1,this._offset=0,this._startAngle=0,this._endAngle=0;var s;if(this._offset=e.angleRadiansOffset,this._tx=t.get(ot),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(s=e.rotationType)!=null?s:Ae.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._endAngle=vn(this._startAngle+this._offset),this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=EA(this._startAngle,this._endAngle,this._rotationType,e),r=this._tx.rotation,l=t/1e3,h=l===0?0:(s-r)/l;this._motion.angularVelocity=h,this.isComplete()&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class MC{constructor(t,e,s,r){this.id=ee(),this._started=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._speed=s,this._offset=e,this._rotationType=r||Ae.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const e=Math.abs(this._end-this._start),s=Ge-e;switch(e>s?(this._shortDistance=s,this._longDistance=e):(this._shortDistance=e,this._longDistance=s),this._shortestPathIsPositive=(this._start-this._end+Ge)%Ge>=Math.PI,this._rotationType){case Ae.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case Ae.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case Ae.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case Ae.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}function PC(o){return typeof o.scale=="object"&&typeof o.duration=="number"}class BC{constructor(t,e){if(this.entity=t,this.id=ee(),this._started=!1,this._stopped=!1,this._endScale=I(1,1),this._startScale=I(1,1),this._endScale=e.scale,this._tx=t.get(ot),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=_f(this._startScale,this._endScale,e),r=this._tx.scale,l=t/1e3,h=s.sub(r).scale(l===0?0:1/l);this._motion.scaleFactor=h,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=z.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class IC{constructor(t,e,s,r,l){this.id=ee(),this._started=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._endX=e,this._endY=s,this._speedX=r,this._speedY=l}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*e}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*e}this.isComplete()&&(this._tx.scale=I(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function kC(o){return typeof o.scaleOffset=="object"&&typeof o.duration=="number"}class zC{constructor(t,e){if(this.entity=t,this.id=ee(),this._started=!1,this._stopped=!1,this._endScale=I(1,1),this._scaleOffset=I(0,0),this._startScale=I(1,1),this._scaleOffset=e.scaleOffset,this._tx=t.get(ot),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._endScale=this._startScale.add(this._scaleOffset),this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),s=_f(this._startScale,this._endScale,e),r=this._tx.scale,l=t/1e3,h=s.sub(r).scale(l===0?0:1/l);this._motion.scaleFactor=h,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=z.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class OC{constructor(t,e,s,r){this.id=ee(),this._started=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._offset=new z(e,s),this._speedX=this._speedY=r}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class r0{constructor(t){this.id=ee(),this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class UC{constructor(t,e,s,r,l){this.easingFcn=l,this.id=ee(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new z(0,0),this._lerpEnd=new z(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._lerpDuration=r,this._lerpEnd=new z(e,s)}_initialize(){this._lerpStart=new z(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,s=this._tx.pos.y;if(this._currentLerpTime<this._lerpDuration){this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?s=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):s=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration);const r=t/1e3;this._motion.vel=I(r===0?0:(e-this._tx.pos.x)/r,r===0?0:(s-this._tx.pos.y)/r)}else this._tx.pos=I(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=z.Zero}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=I(0,0),this._stopped=!0}}class LC{constructor(t,e,s,r,l){this.easingFcn=l,this.id=ee(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new z(0,0),this._lerpEnd=new z(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._lerpDuration=r,this._offset=new z(e,s)}_initialize(){this._lerpStart=new z(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,s=this._tx.pos.y;if(this._currentLerpTime<this._lerpDuration){this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?s=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):s=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration);const r=t/1e3;this._motion.vel=I(r===0?0:(e-this._tx.pos.x)/r,r===0?0:(s-this._tx.pos.y)/r)}else this._tx.pos=I(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=z.Zero}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=I(0,0),this._stopped=!0}}class FC{constructor(t,e,s,r=1){this.id=ee(),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(je),this._timeVisible=e,this._timeNotVisible=s,this._duration=(e+s)*r}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.isVisible&&this._elapsedTime>=this._timeVisible&&(this._graphics.isVisible=!1,this._elapsedTime=0),!this._graphics.isVisible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.isVisible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.isVisible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class NC{constructor(t,e,s){this.id=ee(),this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(je),this._endOpacity=e,this._remainingTime=this._originalTime=s}update(t){this._graphics&&(this._started||(this._started=!0,this._remainingTime=this._originalTime,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._remainingTime>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._remainingTime),this._remainingTime-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),vt.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||this._remainingTime<=0}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._remainingTime=this._originalTime}}class HC{constructor(t){this.id=ee(),this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class GC{constructor(t){this.id=ee(),this._stopped=!1,this._entity=t}update(t){this._entity.get(co).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class a0{constructor(t,e,s){this.id=ee(),this._started=!1,this._stopped=!1,this._tx=t.get(ot),this._motion=t.get(Zt),this._followTx=e.get(ot),this._followMotion=e.get(Zt),this._current=new z(this._tx.pos.x,this._tx.pos.y),this._end=new z(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=s!==void 0?s:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(e!==0&&(this._speed=e),this._current=I(this._tx.pos.x,this._tx.pos.y),this._end=I(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const s=this._dir.scale(this._speed);this._motion.vel=I(s.x,s.y)}else this._motion.vel=I(0,0);this.isComplete()&&(this._tx.pos=I(this._end.x,this._end.y),this._motion.vel=I(0,0))}stop(){this._motion.vel=I(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class dd{constructor(t,e,s,r){this.id=ee(),this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tolerance=1,this._tx=t.get(ot),this._motion=t.get(Zt),this._meetTx=e.get(ot),this._meetMotion=e.get(Zt),this._current=new z(this._tx.pos.x,this._tx.pos.y),this._end=new z(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=s||0,s!==void 0&&(this._speedWasSpecified=!0),r!==void 0&&(this._tolerance=r)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));e!==0&&!this._speedWasSpecified&&(this._speed=e),this._current=I(this._tx.pos.x,this._tx.pos.y),this._end=I(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const s=this._dir.scale(this._speed);this._motion.vel=I(s.x,s.y),this.isComplete()&&(this._tx.pos=I(this._end.x,this._end.y),this._motion.vel=I(0,0))}isComplete(){return this._stopped||this._distanceBetween<=this._tolerance}stop(){this._motion.vel=I(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=1/0}}class QC{constructor(t,e,s=1e3){this.id=ee(),this._stopped=!1,this._started=!1,this._total=0,this._currentDuration=0;var r;this._graphics=t.get(je),this._duration=s,this._entity=t,this._material=(r=t.scene)==null?void 0:r.engine.graphicsContext.createMaterial({name:"flash-material",color:e,fragmentSource:`#version 300 es
    
        precision mediump float;
        uniform float u_blend;
        uniform sampler2D u_graphic;
        uniform vec4 u_color;
    
        in vec2 v_uv; 
        out vec4 color;
    
        void main() { 
            vec4 textureColor = texture(u_graphic, v_uv); 
            color = mix(textureColor, u_color, u_blend * textureColor.a);
            color.rgb = color.rgb * color.a;
        }`}),this._total=s}update(t){var e;this._started||(this._started=!0,this._total=this._duration,this._currentDuration=this._duration,this._entity.graphics.material=this._material),this._graphics&&(this._currentDuration-=t,this._graphics&&((e=this._material)==null||e.update(s=>{s.trySetUniformFloat("u_blend",this._currentDuration/this._total)})),this.isComplete()&&(this._entity.graphics.material=null))}isComplete(){return this._stopped||this._currentDuration<=0}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class jC{constructor(t,e){this.id=ee(),this._started=!1,this._stopped=!1,this._mode="dynamic";var s;if(this._entity=t,this._tx=this._entity.get(ot),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=new kc({controlPoints:[I(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(s=e.mode)!=null?s:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos.clone()),this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0,this._currentMs=0}}class VC{constructor(t,e){this.id=ee(),this._started=!1,this._stopped=!1,this._mode="dynamic";var s;if(this._entity=t,this._tx=this._entity.get(ot),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=this._curve=new kc({controlPoints:[I(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(s=e.mode)!=null?s:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos),this._curve.setControlPoint(1,this._curve.controlPoints[1].add(this._tx.globalPos)),this._curve.setControlPoint(2,this._curve.controlPoints[2].add(this._tx.globalPos)),this._curve.setControlPoint(3,this._curve.controlPoints[3].add(this._tx.globalPos)),this._started=!0),this._currentMs-=t;const e=Bt(Gs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0}}class yf{constructor(t){this._entity=t,this._queue=new yC(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}curveBy(t){return this._queue.add(new VC(this._entity,t)),this}curveTo(t){return this._queue.add(new jC(this._entity,t)),this}easeTo(...t){var e,s;let r=0,l=0,h=0,u=Us.Linear;return t[0]instanceof z?(r=t[0].x,l=t[0].y,h=t[1],u=(e=t[2])!=null?e:u):(r=t[0],l=t[1],h=t[2],u=(s=t[3])!=null?s:u),this._queue.add(new UC(this._entity,r,l,h,u)),this}easeBy(...t){var e,s;let r=0,l=0,h=0,u=Us.Linear;return t[0]instanceof z?(r=t[0].x,l=t[0].y,h=t[1],u=(e=t[2])!=null?e:u):(r=t[0],l=t[1],h=t[2],u=(s=t[3])!=null?s:u),this._queue.add(new LC(this._entity,r,l,h,u)),this}moveTo(t,e,s){let r=0,l=0,h=0;return t instanceof z?(r=t.x,l=t.y,h=+(e??0),this._queue.add(new n0(this._entity,r,l,h))):typeof t=="number"&&typeof e=="number"&&typeof s=="number"?(r=t,l=e,h=s,this._queue.add(new n0(this._entity,r,l,h))):SC(t)&&this._queue.add(new TC(this._entity,t)),this}moveBy(t,e,s){let r=0,l=0,h=0;return t instanceof z&&typeof e=="number"?(r=t.x,l=t.y,h=e,this._queue.add(new s0(this._entity,r,l,h))):typeof t=="number"&&typeof e=="number"&&typeof s=="number"?(r=t,l=e,h=s,this._queue.add(new s0(this._entity,r,l,h))):wC(t)&&this._queue.add(new CC(this._entity,t)),this}rotateTo(t,e,s){return typeof t=="number"&&typeof e=="number"?this._queue.add(new DC(this._entity,t,e,s)):typeof t=="object"&&this._queue.add(new EC(this._entity,t)),this}rotateBy(t,e,s){return typeof t=="object"?this._queue.add(new RC(this._entity,t)):this._queue.add(new MC(this._entity,t,e,s)),this}scaleTo(t,e,s,r){let l=1,h=1,u=0,f=0;return PC(t)?(this._queue.add(new BC(this._entity,t)),this):(t instanceof z&&e instanceof z&&(l=t.x,h=t.y,u=e.x,f=e.y),typeof t=="number"&&typeof e=="number"&&(l=t,h=e,u=s,f=r),this._queue.add(new IC(this._entity,l,h,u,f)),this)}scaleBy(t,e,s){if(kC(t))return this._queue.add(new zC(this._entity,t)),this;let r=1,l=1;return t instanceof z&&(r=t.x,l=t.y,s=e),typeof t=="number"&&typeof e=="number"&&(r=t,l=e),this._queue.add(new OC(this._entity,r,l,s)),this}blink(t,e,s=1){return this._queue.add(new FC(this._entity,t,e,s)),this}fade(t,e){return this._queue.add(new NC(this._entity,t,e)),this}flash(t,e=1e3){return this._queue.add(new QC(this._entity,t,e)),this}delay(t){return this._queue.add(new HC(t)),this}die(){return this._queue.add(new GC(this._entity)),this}callMethod(t){return this._queue.add(new r0(t)),this}repeat(t,e){return e?(this._queue.add(new xC(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new bC(this._entity,t)),this}follow(t,e){return e===void 0?this._queue.add(new a0(this._entity,t)):this._queue.add(new a0(this._entity,t,e)),this}meet(t,e,s){return e===void 0&&s===void 0?this._queue.add(new dd(this._entity,t)):s===void 0?this._queue.add(new dd(this._entity,t,e)):this._queue.add(new dd(this._entity,t,e,s)),this}toPromise(){return new Promise(e=>{this._queue.add(new r0(()=>{e()}))})}}class co extends ts{constructor(){super(...arguments),this.dependencies=[ot,Zt],this._ctx=null}onAdd(t){this._ctx=new yf(t)}onRemove(){this._ctx=null}_getCtx(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no context available");return this._ctx}getQueue(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no queue available");return this._ctx.getQueue()}runAction(t){if(!this._ctx)throw new Error("Actions component not attached to an entity, cannot run action");return this._ctx.runAction(t)}update(t){var e;return(e=this._ctx)==null?void 0:e.update(t)}clearActions(){var t;(t=this._ctx)==null||t.clearActions()}curveBy(t){return this._getCtx().curveBy.apply(this._ctx,[t])}curveTo(t){return this._getCtx().curveTo.apply(this._ctx,[t])}easeTo(...t){return this._getCtx().easeTo.apply(this._ctx,t)}easeBy(...t){return this._getCtx().easeBy.apply(this._ctx,t)}moveTo(t,e,s){return this._getCtx().moveTo.apply(this._ctx,[t,e,s])}moveBy(t,e,s){return this._getCtx().moveBy.apply(this._ctx,[t,e,s])}rotateTo(t,e,s){return this._getCtx().rotateTo.apply(this._ctx,[t,e,s])}rotateBy(t,e,s){return this._getCtx().rotateBy.apply(this._ctx,[t,e,s])}scaleTo(t,e,s,r){return this._getCtx().scaleTo.apply(this._ctx,[t,e,s,r])}scaleBy(t,e,s){return this._getCtx().scaleBy.apply(this._ctx,[t,e,s])}blink(t,e,s){return this._getCtx().blink(t,e,s)}fade(t,e){return this._getCtx().fade(t,e)}flash(t,e=1e3){return this._getCtx().flash(t,e)}delay(t){return this._getCtx().delay(t)}die(){return this._getCtx().die()}callMethod(t){return this._getCtx().callMethod(t)}repeat(t,e){return this._getCtx().repeat(t,e)}repeatForever(t){return this._getCtx().repeatForever(t)}follow(t,e){return this._getCtx().follow(t,e)}meet(t,e){return this._getCtx().meet(t,e)}toPromise(){return this._getCtx().toPromise()}}const IA=class Od extends Ns{constructor(t){super(),this.events=new ae,this._anchor=Ki(z.Half,rt=>this._handleAnchorChange(rt)),this._offset=Ki(z.Zero,rt=>this._handleOffsetChange(rt)),this.logger=vt.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=rt=>{this._dragging&&(this.pos=rt.worldPos)},this._pointerDragLeaveHandler=rt=>{this._dragging&&(this.pos=rt.worldPos)};const{name:e,x:s,y:r,pos:l,coordPlane:h,scale:u,width:f,height:g,radius:m,collider:A,vel:y,acc:x,rotation:E,angularVelocity:C,z:L,color:D,visible:R,opacity:P,anchor:F,offset:Y,collisionType:et,collisionGroup:k}={...t};this.name=e??this.name,this.anchor=F??Od.defaults.anchor.clone(),this.offset=Y??z.Zero,this.transform=new ot,this.addComponent(this.transform),this.pos=l??I(s??0,r??0),this.rotation=E??0,this.scale=u??I(1,1),this.z=L??0,this.transform.coordPlane=h??_i.World,this.pointer=new yo,this.addComponent(this.pointer),this.graphics=new je({anchor:this.anchor,offset:this.offset,opacity:P}),this.addComponent(this.graphics),this.motion=new Zt,this.addComponent(this.motion),this.vel=y??z.Zero,this.acc=x??z.Zero,this.angularVelocity=C??0,this.actions=new co,this.addComponent(this.actions),this.body=new $t,this.addComponent(this.body),this.body.collisionType=et??mt.Passive,k&&(this.body.group=k),D&&(this.color=D),A?(this.collider=new Ie(A),this.addComponent(this.collider)):m?(this.collider=new Ie(Ze.Circle(m)),this.addComponent(this.collider),D&&this.graphics.add(new pf({color:D,radius:m}))):f>0&&g>0?(this.collider=new Ie(Ze.Box(f,g,this.anchor)),this.addComponent(this.collider),D&&f&&g&&this.graphics.add(new Ro({color:D,width:f,height:g}))):(this.collider=new Ie,this.addComponent(this.collider)),this.graphics.isVisible=R??!0}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}get oldGlobalPos(){return this.body.oldGlobalPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(ot).scale}set scale(t){this.get(ot).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=Ki(t,e=>this._handleAnchorChange(e)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get offset(){return this._offset}set offset(t){this._offset=Ki(t,e=>this._handleOffsetChange(e)),this._handleOffsetChange(t)}_handleOffsetChange(t){this.graphics&&(this.graphics.offset=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this.graphics.color}set color(t){this.graphics.color=t}clone(){const t=new Od({color:this.color.clone(),anchor:this.anchor.clone(),offset:this.offset.clone()});t.clearComponents(),t.processComponentRemoval(),t.addComponent(t.transform=this.transform.clone(),!0),t.addComponent(t.pointer=this.pointer.clone(),!0),t.addComponent(t.graphics=this.graphics.clone(),!0),t.addComponent(t.motion=this.motion.clone(),!0),t.addComponent(t.actions=this.actions.clone(),!0),t.addComponent(t.body=this.body.clone(),!0),this.collider.get()&&t.addComponent(t.collider=this.collider.clone(),!0);const e=[this.transform,this.pointer,this.graphics,this.motion,this.actions,this.body,this.collider],s=this.getComponents();for(const r of s)e.includes(r)||t.addComponent(r.clone(),!0);return t}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_prekill(t){this.events.emit("prekill",new Nb(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){this.events.emit("postkill",new Hb(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new tA(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.isActive=!0}isKilled(){return!this.isActive}get z(){return this.get(ot).z}set z(t){this.get(ot).z=t}get center(){const t=this.getGlobalPos();return new z(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new z(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(ot).globalRotation}get globalRotation(){return this.get(ot).globalRotation}getGlobalPos(){return this.get(ot).globalPos}get globalPos(){return this.get(ot).globalPos}getGlobalScale(){return this.get(ot).globalScale}get globalScale(){return this.get(ot).globalScale}get globalZ(){return this.get(ot).globalZ}contains(t,e,s=!1){const r=I(t,e),l=this.get(Ie);l.update();const h=l.get();if(!h)return!1;const u=h.contains(r);return s?u||this.children.some(f=>f.contains(t,e,!0)):u}within(t,e){const s=this.get(Ie),r=t.get(Ie),l=s.get(),h=r.get();return l&&h?l.getClosestLineBetween(h).getLength()<=e:!1}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e),this._postupdate(t,e),this._remove(t)}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreCollisionResolve(t,e,s,r){}onPostCollisionResolve(t,e,s,r){}onCollisionStart(t,e,s,r){}onCollisionEnd(t,e,s,r){}_preupdate(t,e){this.events.emit("preupdate",new ia(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new sa(t,e,this)),this.onPostUpdate(t,e)}};IA.defaults={anchor:z.Half};let Bi=IA;class Ie extends ts{constructor(t){super(),this.events=new ae,this.$colliderAdded=new gi,this.$colliderRemoved=new gi,this._collidersToRemove=[],this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,t.events.pipe(this.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this._collidersToRemove.push(this._collider),this._collider=null)}processColliderRemoval(){for(const t of this._collidersToRemove)t.events.unpipe(this.events),this.$colliderRemoved.notifyAll(t),t.owner=null}clone(){return new Ie(this._collider.clone())}get bounds(){var t,e;return(e=(t=this._collider)==null?void 0:t.bounds)!=null?e:new Et}get localBounds(){var t,e;return(e=(t=this._collider)==null?void 0:t.localBounds)!=null?e:new Et}update(){var t;const e=(t=this.owner)==null?void 0:t.get(ot);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e.get()))}collide(t){let e=this._collider,s=t._collider;if(!e||!s)return[];let r=!1;if(s instanceof Qe&&(e=s,s=this._collider,r=!0),this._collider){const l=e.collide(s);return l?(r&&l.forEach(h=>{h.mtv=h.mtv.negate(),h.normal=h.normal.negate(),h.tangent=h.normal.perpendicular(),h.colliderA=this._collider,h.colliderB=t._collider}),l):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",e=>{const s=e;t.events.emit("precollision",new go(s.self,s.other,s.side,s.intersection,s.contact)),t instanceof Bi&&t.onPreCollisionResolve(s.self,s.other,s.side,s.contact)}),this.events.on("postcollision",e=>{const s=e;t.events.emit("postcollision",new mo(s.self,s.other,s.side,s.intersection,s.contact)),t instanceof Bi&&t.onPostCollisionResolve(s.self,s.other,s.side,s.contact)}),this.events.on("collisionstart",e=>{const s=e;t.events.emit("collisionstart",new Sd(s.self,s.other,s.side,s.contact)),t instanceof Bi&&t.onCollisionStart(s.self,s.other,s.side,s.contact)}),this.events.on("collisionend",e=>{const s=e;t.events.emit("collisionend",new Td(s.self,s.other,s.side,s.lastContact)),t instanceof Bi&&t.onCollisionEnd(s.self,s.other,s.side,s.lastContact)})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,s=z.Half,r=z.Zero){const l=Ze.Box(t,e,s,r);return this.set(l)}usePolygonCollider(t,e=z.Zero){const s=Ze.Polygon(t,e);return this.set(s)}useCircleCollider(t,e=z.Zero){const s=Ze.Circle(t,e);return this.set(s)}useEdgeCollider(t,e){const s=Ze.Edge(t,e);return this.set(s)}useCompositeCollider(t){return this.set(new Qe(t))}}var Vn=(o=>(o.Rotation="rotation",o.X="x",o.Y="y",o))(Vn||{});const vf=class sc extends ts{constructor(t){var e,s,r;super(),this.dependencies=[ot,Zt],this.id=Kr("body",sc._ID++),this.events=new ae,this.oldTransform=new wn,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=mt.PreventCollision,this.group=$r.All,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this._oldGlobalPos=z.Zero,this.oldVel=new z(0,0),this.oldAcc=z.Zero,this._impulseScratch=I(0,0),this._distanceFromCenterScratch=I(0,0),t?(this.collisionType=(e=t.type)!=null?e:this.collisionType,this.group=(s=t.group)!=null?s:this.group,this.useGravity=(r=t.useGravity)!=null?r:this.useGravity,this._bodyConfig={...xn().bodies,...t.config}):this._bodyConfig={...xn().bodies},this.updatePhysicsConfig(this._bodyConfig),this._mass=sc._DEFAULT_CONFIG.defaultMass}get matrix(){return this.transform.get().matrix}updatePhysicsConfig(t){this._bodyConfig={...xn().bodies,...t},this.canSleep=this._bodyConfig.canSleepByDefault,this.sleepMotion=this._bodyConfig.sleepEpsilon*5,this.wakeThreshold=this._bodyConfig.wakeThreshold}static updateDefaultPhysicsConfig(t){sc._DEFAULT_CONFIG=t}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===mt.Fixed?0:1/this.mass}get sleeping(){return this.isSleeping}get isSleeping(){return this._sleeping}setSleeping(t){this.isSleeping=t}set isSleeping(t){this._sleeping=t,t?(this.vel=z.Zero,this.acc=z.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=this._bodyConfig.sleepEpsilon*5}updateMotion(){this._sleeping&&(this.isSleeping=!0);const t=this.vel.magnitude*this.vel.magnitude+Math.abs(this.angularVelocity*this.angularVelocity),e=this._bodyConfig.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=Bt(this.sleepMotion,0,10*this._bodyConfig.sleepEpsilon),this.canSleep&&this.sleepMotion<this._bodyConfig.sleepEpsilon&&(this.isSleeping=!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(Ie);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const e=t.get();if(e)return this._cachedInertia=e.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===mt.Fixed?0:1/this.inertia}get active(){var t;return!!((t=this.owner)!=null&&t.isActive)}get isActive(){var t;return!!((t=this.owner)!=null&&t.isActive)}get center(){return this.globalPos}onAdd(t){var e,s;this.transform=(e=this.owner)==null?void 0:e.get(ot),this.motion=(s=this.owner)==null?void 0:s.get(Zt)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this.oldTransform.pos}get oldGlobalPos(){return this._oldGlobalPos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this.oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this.oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==mt.Active)return;const s=e.scale(this.inverseMass,this._impulseScratch);if(this.limitDegreeOfFreedom.indexOf("x")>-1&&(s.x=0),this.limitDegreeOfFreedom.indexOf("y")>-1&&(s.y=0),this.vel.addEqual(s),!this.limitDegreeOfFreedom.includes("rotation")){const r=t.sub(this.globalPos,this._distanceFromCenterScratch);this.angularVelocity+=this.inverseInertia*r.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==mt.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes("x")&&(e.x=0),this.limitDegreeOfFreedom.includes("y")&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===mt.Active&&!this.limitDegreeOfFreedom.includes("rotation")){const s=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*s.cross(e)}}captureOldTransform(){this.__oldTransformCaptured=!0;const t=this.transform.get();t.clone(this.oldTransform),this.oldTransform.parent=t.parent,this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldGlobalPos.setTo(this.globalPos.x,this.globalPos.y)}clone(){return super.clone()}};vf._ID=0;vf._DEFAULT_CONFIG={...xn().bodies};let $t=vf;class kA{constructor(t,e){this.object=t,this.id=-1,this.cells=[],this.hasZeroBounds=!1,this.gridSize=e,this.bounds=t.bounds,this.hasZeroBounds=this.bounds.hasZeroDimensions(),this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize)}hasChanged(){const t=this.object.bounds,e=Math.floor(t.left/this.gridSize),s=Math.floor(t.right/this.gridSize),r=Math.floor(t.bottom/this.gridSize),l=Math.floor(t.top/this.gridSize);return this.leftX!==e||this.rightX!==s||this.bottomY!==r||this.topY!==l}clear(){for(const t of this.cells){const e=t.proxies.indexOf(this);e>-1&&t.proxies.splice(e,1)}}updateBounds(){this.bounds=this.object.bounds}update(){this.bounds=this.object.bounds,this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize),this.hasZeroBounds=this.object.bounds.hasZeroDimensions()}}class Os{constructor(){this.proxies=[]}configure(t,e){this.x=t,this.y=e,this.key=Os.calculateHashKey(t,e)}static calculateHashKey(t,e){return`${t}+${e}`}}class zA{constructor(t){this.bounds=new Et,this._hashGridCellPool=new Bc(()=>new Os,e=>(e.configure(0,0),e.proxies.length=0,e),1e3),this.gridSize=t.size,this.sparseHashGrid=new Map,this.objectToProxy=new Map,t.proxyFactory?this._buildProxy=e=>t.proxyFactory(e,this.gridSize):this._buildProxy=e=>new kA(e,this.gridSize)}query(t){const e=new Set;if(t instanceof Et){const s=t,r=Math.floor(s.left/this.gridSize),l=Math.floor(s.right/this.gridSize),h=Math.floor(s.bottom/this.gridSize),u=Math.floor(s.top/this.gridSize);for(let f=r;f<=l;f++)for(let g=u;g<=h;g++){const m=Os.calculateHashKey(f,g),A=this.sparseHashGrid.get(m);if(A)for(let y=0;y<A.proxies.length;y++)A.proxies[y].updateBounds(),A.proxies[y].bounds.intersect(s)&&e.add(A.proxies[y].object)}}else{const s=t,r=Os.calculateHashKey(Math.floor(s.x/this.gridSize),Math.floor(s.y/this.gridSize)),l=this.sparseHashGrid.get(r);if(l)for(let h=0;h<l.proxies.length;h++)l.proxies[h].updateBounds(),l.proxies[h].bounds.contains(s)&&e.add(l.proxies[h].object)}return Array.from(e)}get(t,e){const s=Os.calculateHashKey(t,e);return this.sparseHashGrid.get(s)}_insert(t,e,s){const r=Os.calculateHashKey(t,e);let l=this.sparseHashGrid.get(r);l||(l=this._hashGridCellPool.rent(),l.configure(t,e),this.sparseHashGrid.set(l.key,l)),l.proxies.push(s),s.cells.push(l),this.bounds.combine(s.bounds,this.bounds)}_remove(t,e,s){const r=Os.calculateHashKey(t,e),l=this.sparseHashGrid.get(r);if(l){const h=l.proxies.indexOf(s);h>-1&&l.proxies.splice(h,1);const u=s.cells.indexOf(l);u>-1&&s.cells.splice(u,1),l.proxies.length===0&&(this._hashGridCellPool.return(l),this.sparseHashGrid.delete(r))}}track(t){const e=this._buildProxy(t);this.objectToProxy.set(t,e);for(let s=e.leftX;s<=e.rightX;s++)for(let r=e.topY;r<=e.bottomY;r++)this._insert(s,r,e)}untrack(t){const e=this.objectToProxy.get(t);e&&(e.clear(),this.objectToProxy.delete(t))}update(t){let e=0;for(const s of t){const r=this.objectToProxy.get(s);if(r&&r.hasChanged()){for(let l=r.leftX;l<=r.rightX;l++)for(let h=r.topY;h<=r.bottomY;h++)this._remove(l,h,r);r.update();for(let l=r.leftX;l<=r.rightX;l++)for(let h=r.topY;h<=r.bottomY;h++)this._insert(l,h,r);e++}}return e}debug(t,e){const s=$.Transparent,r=$.White;for(const l of this.sparseHashGrid.values())t.drawRectangle(I(l.x*this.gridSize,l.y*this.gridSize),this.gridSize,this.gridSize,s,r,2)}}class YC extends kA{constructor(t,e){var s,r,l;super(t,e),this.collider=t,this.id=-1,this.hasZeroBounds=!1,this.cells=[],this.gridSize=e;const h=t.bounds;this.hasZeroBounds=h.hasZeroDimensions(),this.leftX=Math.floor(h.left/this.gridSize),this.rightX=Math.floor(h.right/this.gridSize),this.bottomY=Math.floor(h.bottom/this.gridSize),this.topY=Math.floor(h.top/this.gridSize),this.owner=t.owner,this.body=(s=this.owner)==null?void 0:s.get($t),this.collisionType=(l=(r=this.body)==null?void 0:r.collisionType)!=null?l:mt.PreventCollision}update(){var t,e,s;super.update(),this.body=(t=this.owner)==null?void 0:t.get($t),this.collisionType=(s=(e=this.body)==null?void 0:e.collisionType)!=null?s:mt.PreventCollision,this.hasZeroBounds=this.collider.localBounds.hasZeroDimensions()}}class o0{constructor(t){this._pairs=new Set,this._nonPairs=new Set,this._pairPool=new uf(()=>new ei({id:Kr("collider",0)},{id:Kr("collider",0)}),e=>(e.colliderA=null,e.colliderB=null,e),200),this.gridSize=t.size,this.hashGrid=new zA({size:this.gridSize,proxyFactory:(e,s)=>new YC(e,s)}),this._pairPool.disableWarnings=!0}getColliders(){return Array.from(this.hashGrid.objectToProxy.keys())}query(t){return this.hashGrid.query(t)}rayCast(t,e){var s,r,l;const h=[],u=(s=e==null?void 0:e.maxDistance)!=null?s:1/0,f=e==null?void 0:e.collisionGroup,g=f?f.category:(r=e==null?void 0:e.collisionMask)!=null?r:$r.All.category,m=(l=e==null?void 0:e.searchAllColliders)!=null?l:!1,A=t.dir.normalize(),y=A.y/A.x,x=A.x/A.y,E=Math.sqrt(1+y*y)*this.gridSize,C=Math.sqrt(1+x*x)*this.gridSize,L=t.pos.x/this.gridSize,D=t.pos.y/this.gridSize,R=I(1,1);let P=~~L,F=~~D,Y=0,et=0;A.x<0?(R.x=-1,Y=(L-P)*E):(R.x=1,Y=(P+1-L)*E),A.y<0?(R.y=-1,et=(D-F)*C):(R.y=1,et=(F+1-D)*C);const k=new Set;let rt=!1,gt=9999;for(;!rt&&gt>0&&(gt--,!!this.hashGrid.bounds.contains(I(P*this.gridSize,F*this.gridSize)));){const _t=Os.calculateHashKey(P,F),At=this.hashGrid.sparseHashGrid.get(_t);if(At){const xt=[];for(let O=0;O<At.proxies.length;O++){const K=At.proxies[O];if(!k.has(K.collider.id.value)){if(k.add(K.collider.id.value),K.body){if(e!=null&&e.ignoreCollisionGroupAll&&K.body.group===$r.All)continue;const T=(g&K.body.group.category)!==0;if(K.body.group&&!T)continue}const X=K.collider.rayCast(t,u);X&&xt.push(X)}}xt.sort((O,K)=>O.distance-K.distance);for(let O=0;O<xt.length;O++){const K=xt[O];if(e!=null&&e.filter){if(e.filter(K)&&(h.push(K),!m)){rt=!0;break}}else if(h.push(K),!m){rt=!0;break}}}Y<et?(P+=R.x,Y+=E):(F+=R.y,et+=C)}return h.sort((_t,At)=>_t.distance-At.distance),!m&&h.length?[h[0]]:h}track(t){let e=[t];if(t instanceof Qe){const s=t.getColliders();for(const r of s)r.owner=t.owner;e=s}for(const s of e)this.hashGrid.track(s)}untrack(t){let e=[t];t instanceof Qe&&(e=t.getColliders());for(const s of e)this.hashGrid.untrack(s)}_canCollide(t,e){return!(t.collider.id===e.collider.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.hasZeroBounds||e.hasZeroBounds||t.body&&e.body&&!t.body.group.canCollide(e.body.group)||t.collisionType===mt.Fixed&&e.collisionType===mt.Fixed||t.collisionType===mt.PreventCollision||e.collisionType===mt.PreventCollision||!t.owner.isActive||!e.owner.isActive)}broadphase(t,e){const s=[];this._pairs.clear(),this._nonPairs.clear();let r=0;for(const l of this.hashGrid.objectToProxy.values())if(l.id=r++,!(!l.owner.isActive||l.collisionType===mt.PreventCollision))for(let h=0;h<l.cells.length;h++){const u=l.cells[h];for(let f=0;f<u.proxies.length;f++){const g=u.proxies[f];if(g.id===l.id)continue;const m=ei.calculatePairHash(l.collider.id,g.collider.id);if(!this._nonPairs.has(m))if(!this._pairs.has(m)&&this._canCollide(l,g)&&l.object.bounds.overlaps(g.object.bounds)){const A=this._pairPool.get();A.colliderA=l.collider,A.colliderB=g.collider,A.id=m,this._pairs.add(m),s.push(A)}else this._nonPairs.add(m)}}return s}narrowphase(t,e){const s=[];for(let r=0;r<t.length;r++){const l=t[r].collide();for(let h=0;h<l.length;h++){const u=l[h];s.push(u),e&&e.physics.contacts.set(u.id,u)}}return this._pairPool.done(),e&&(e.physics.collisions+=s.length),s}update(t,e){return this.hashGrid.update(t)}debug(t,e){this.hashGrid.debug(t,e)}}class l0{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map,this._compositeContactsIds=new Set}solve(t){this.preSolve(t),t=t.filter(s=>!s.isCanceled());let e;switch(this.config.contactSolveBias){case Kn.HorizontalFirst:{e=oA;break}case Kn.VerticalFirst:{e=aA;break}default:e=lA}t.sort((s,r)=>{const l=this.directionMap.get(s.id),h=this.directionMap.get(r.id),u=this.distanceMap.get(s.id),f=this.distanceMap.get(r.id);return e[l]-e[h]||u-f});for(const s of t)this.solvePosition(s),this.solveVelocity(s);return this.postSolve(t),t}preSolve(t){for(let s=0;s<t.length;s++){const r=t[s],l=r.id.indexOf("|");if(l>0){const g=r.id.substring(l+1);if(this._compositeContactsIds.has(g)){r.cancel();continue}this._compositeContactsIds.add(g)}if(Math.abs(r.mtv.x)<1e-4&&Math.abs(r.mtv.y)<1e-4){r.cancel();continue}const h=Kt.fromDirection(r.mtv),u=r.mtv.negate(),f=Math.abs(r.info.separation);this.distanceMap.set(r.id,f),this.directionMap.set(r.id,h===Kt.Left||h===Kt.Right?"horizontal":"vertical"),r.colliderA.events.emit("precollision",new go(r.colliderA,r.colliderB,h,u,r)),r.colliderB.events.emit("precollision",new go(r.colliderB,r.colliderA,Kt.getOpposite(h),u.negate(),r))}this._compositeContactsIds.clear()}postSolve(t){var e,s;for(let r=0;r<t.length;r++){const l=t[r];if(l.isCanceled())continue;const h=l.colliderA,u=l.colliderB,f=(e=h.owner)==null?void 0:e.get($t),g=(s=u.owner)==null?void 0:s.get($t);if(f&&g&&(f.collisionType===mt.Passive||g.collisionType===mt.Passive))continue;const m=Kt.fromDirection(l.mtv),A=l.mtv.negate();l.colliderA.events.emit("postcollision",new mo(l.colliderA,l.colliderB,m,A,l)),l.colliderB.events.emit("postcollision",new mo(l.colliderB,l.colliderA,Kt.getOpposite(m),A.negate(),l))}}solvePosition(t){var e,s;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let l=t.mtv;const h=t.colliderA,u=t.colliderB,f=(e=h.owner)==null?void 0:e.get($t),g=(s=u.owner)==null?void 0:s.get($t);if(f&&g){if(f.collisionType===mt.Passive||g.collisionType===mt.Passive)return;f.collisionType===mt.Active&&g.collisionType===mt.Active&&(l=l.scale(.5)),f.collisionType===mt.Active&&(f.globalPos.x-=l.x,f.globalPos.y-=l.y,h.update(f.transform.get())),g.collisionType===mt.Active&&(g.globalPos.x+=l.x,g.globalPos.y+=l.y,u.update(g.transform.get()))}}solveVelocity(t){var e,s;if(t.isCanceled())return;const r=t.colliderA,l=t.colliderB,h=(e=r.owner)==null?void 0:e.get($t),u=(s=l.owner)==null?void 0:s.get($t);if(h&&u){if(h.collisionType===mt.Passive||u.collisionType===mt.Passive)return;const f=t.normal,g=f.negate();if(h.collisionType===mt.Active&&h.vel.normalize().dot(g)<0){const m=f.scale(f.dot(h.vel.negate()));h.vel=h.vel.add(m)}if(u.collisionType===mt.Active&&u.vel.normalize().dot(f)<0){const m=g.scale(g.dot(u.vel.negate()));u.vel=u.vel.add(m)}}}}class qC{constructor(t,e,s){this.point=t,this.local=e,this.contact=s,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new z(0,0),this.bToContact=new z(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){const t=this.contact.bodyA,e=this.contact.colliderA,s=this.contact.bodyB,r=this.contact.colliderB;if(t&&s){const l=this.contact.normal,h=this.contact.tangent;this.aToContact=this.point.sub(e.center),this.bToContact=this.point.sub(r.center);const u=this.aToContact.cross(l),f=this.bToContact.cross(l);this.normalMass=t.inverseMass+s.inverseMass+t.inverseInertia*u*u+s.inverseInertia*f*f;const g=this.aToContact.cross(h),m=this.bToContact.cross(h);this.tangentMass=t.inverseMass+s.inverseMass+t.inverseInertia*g*g+s.inverseInertia*m*m}return this}getRelativeVelocity(){const t=this.contact.bodyA,e=this.contact.bodyB;if(t&&e){const s=t.vel.add(z.cross(t.angularVelocity,this.aToContact));return e.vel.add(z.cross(e.angularVelocity,this.bToContact)).sub(s)}return z.Zero}}class c0{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map,this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return(e=this.idToContactConstraint.get(t))!=null?e:[]}solve(t){this.preSolve(t),t=t.filter(s=>!s.isCanceled());let e;switch(this.config.contactSolveBias){case Kn.HorizontalFirst:{e=oA;break}case Kn.VerticalFirst:{e=aA;break}default:e=lA}return t.sort((s,r)=>{const l=this.directionMap.get(s.id),h=this.directionMap.get(r.id),u=this.distanceMap.get(s.id),f=this.distanceMap.get(r.id);return e[l]-e[h]||u-f}),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var e,s,r,l;for(let f=0;f<t.length;f++){const g=t[f];if(Math.abs(g.mtv.x)<1e-4&&Math.abs(g.mtv.y)<1e-4){g.cancel();continue}const m=Kt.fromDirection(g.mtv),A=Math.abs(((e=g==null?void 0:g.info)==null?void 0:e.separation)||0);this.distanceMap.set(g.id,A),this.directionMap.set(g.id,m===Kt.Left||m===Kt.Right?"horizontal":"vertical"),g.colliderA.events.emit("precollision",new go(g.colliderA,g.colliderB,m,g.mtv,g)),g.colliderA.events.emit("beforecollisionresolve",new W_(g.colliderA,g.colliderB,m,g.mtv,g)),g.colliderB.events.emit("precollision",new go(g.colliderB,g.colliderA,Kt.getOpposite(m),g.mtv.negate(),g)),g.colliderB.events.emit("beforecollisionresolve",new W_(g.colliderB,g.colliderA,Kt.getOpposite(m),g.mtv.negate(),g)),g.matchAwake()}const u=Array.from(this.idToContactConstraint.keys());for(let f=0;f<t.length;f++){const g=t[f],m=u.indexOf(g.id);m>-1&&u.splice(m,1);const A=(s=this.idToContactConstraint.get(g.id))!=null?s:[];let y=0;const x=g.bodyA,E=g.colliderA,C=g.bodyB,L=g.colliderB;if(x&&C)for(let D=0;D<g.points.length;D++){const R=g.points[D],P=g.normal,F=g.tangent,Y=R.sub(E.center),et=R.sub(L.center),k=Y.cross(P),rt=et.cross(P),gt=x.inverseMass+C.inverseMass+x.inverseInertia*k*k+C.inverseInertia*rt*rt,_t=Y.cross(F),At=et.cross(F),xt=x.inverseMass+C.inverseMass+x.inverseInertia*_t*_t+C.inverseInertia*At*At;A[y]&&((l=(r=A[y])==null?void 0:r.point)==null?void 0:l.squareDistance(R))<4?(A[y].point=R,A[y].local=g.localPoints[y]):A[y]=new qC(R,g.localPoints[y],g),A[y].aToContact=Y,A[y].bToContact=et,A[y].normalMass=1/gt,A[y].tangentMass=1/xt;const O=x.bounciness>C.bounciness?x.bounciness:C.bounciness,K=g.normal.dot(A[y].getRelativeVelocity());A[y].originalVelocityAndRestitution=0,K<-.1&&(A[y].originalVelocityAndRestitution=-O*K),y++}this.idToContactConstraint.set(g.id,A)}for(const f of u)this.idToContactConstraint.delete(f);if(this.config.warmStart)this.warmStart(t);else for(let f=0;f<t.length;f++){const g=t[f],m=this.getContactConstraints(g.id);for(const A of m)A.normalImpulse=0,A.tangentImpulse=0}}postSolve(t){for(let e=0;e<t.length;e++){const s=t[e],r=s.bodyA,l=s.bodyB;if(r&&l){if(r.collisionType===mt.Passive||l.collisionType===mt.Passive)continue;r.updateMotion(),l.updateMotion()}const h=Kt.fromDirection(s.mtv);s.colliderA.events.emit("postcollision",new mo(s.colliderA,s.colliderB,h,s.mtv,s)),s.colliderA.events.emit("aftercollisionresolve",new J_(s.colliderA,s.colliderB,h,s.mtv,s)),s.colliderB.events.emit("postcollision",new mo(s.colliderB,s.colliderA,Kt.getOpposite(h),s.mtv.negate(),s)),s.colliderB.events.emit("aftercollisionresolve",new J_(s.colliderB,s.colliderA,Kt.getOpposite(h),s.mtv.negate(),s))}this.lastFrameContacts.clear();for(let e=0;e<t.length;e++){const s=t[e];this.lastFrameContacts.set(s.id,s)}}warmStart(t){var e;for(let s=0;s<t.length;s++){const r=t[s],l=r.bodyA,h=r.bodyB;if(l&&h){const u=(e=this.idToContactConstraint.get(r.id))!=null?e:[];for(const f of u)if(this.config.warmStart){const g=r.normal.scale(f.normalImpulse),m=r.tangent.scale(f.tangentImpulse),A=g.add(m);l.applyImpulse(f.point,A.negate()),h.applyImpulse(f.point,A)}else f.normalImpulse=0,f.tangentImpulse=0}}}solvePosition(t){var e;for(let s=0;s<this.config.positionIterations;s++)for(let r=0;r<t.length;r++){const l=t[r],h=l.bodyA,u=l.bodyB;if(h&&u){if(h.collisionType===mt.Passive||u.collisionType===mt.Passive)continue;const f=(e=this.idToContactConstraint.get(l.id))!=null?e:[];for(const g of f){const m=l.normal,A=hs.FindContactSeparation(l,g.local),y=this.config.steeringFactor,x=-5,E=this.config.slop,C=Bt(y*(A+E),x,0),L=m.scale(-C*g.normalMass);if(h.collisionType===mt.Active){const D=L.negate().scale(h.inverseMass);h.limitDegreeOfFreedom.includes(Vn.X)&&(D.x=0),h.limitDegreeOfFreedom.includes(Vn.Y)&&(D.y=0),h.globalPos=h.globalPos.add(D),h.limitDegreeOfFreedom.includes(Vn.Rotation)||(h.rotation-=g.aToContact.cross(L)*h.inverseInertia)}if(u.collisionType===mt.Active){const D=L.scale(u.inverseMass);u.limitDegreeOfFreedom.includes(Vn.X)&&(D.x=0),u.limitDegreeOfFreedom.includes(Vn.Y)&&(D.y=0),u.globalPos=u.globalPos.add(D),u.limitDegreeOfFreedom.includes(Vn.Rotation)||(u.rotation+=g.bToContact.cross(L)*u.inverseInertia)}}}}}solveVelocity(t){var e;for(let s=0;s<this.config.velocityIterations;s++)for(let r=0;r<t.length;r++){const l=t[r],h=l.bodyA,u=l.bodyB;if(h&&u){if(h.collisionType===mt.Passive||u.collisionType===mt.Passive)continue;const f=Math.min(h.friction,u.friction),g=(e=this.idToContactConstraint.get(l.id))!=null?e:[];for(const m of g){let x=-m.getRelativeVelocity().dot(l.tangent)*m.tangentMass;const E=f*m.normalImpulse,C=Bt(m.tangentImpulse+x,-E,E);x=C-m.tangentImpulse,m.tangentImpulse=C;const L=l.tangent.scale(x);h.applyImpulse(m.point,L.negate()),u.applyImpulse(m.point,L)}for(const m of g){const y=m.getRelativeVelocity().dot(l.normal);let x=-m.normalMass*(y-m.originalVelocityAndRestitution);const E=Math.max(m.normalImpulse+x,0);x=E-m.normalImpulse,m.normalImpulse=E;const C=l.normal.scale(x);h.applyImpulse(m.point,C.negate()),u.applyImpulse(m.point,C)}}}}}class xf extends Yi{constructor(t,e){super(),this.world=t,this.physics=e,this.systemType=Vi.Update,this._physicsConfigDirty=!1,e.$configUpdate.subscribe(()=>this._physicsConfigDirty=!0),this.query=this.world.query([ot,Zt])}update(t){let e,s;const r=this.query.entities,l=this.physics.config.substep;for(let h=0;h<r.length;h++){e=r[h].get(ot),s=r[h].get(Zt);const u=r[h].get($t);if(this._physicsConfigDirty&&u&&u.updatePhysicsConfig(this.physics.config.bodies),u!=null&&u.isSleeping)continue;const f=s.acc.clone();(u==null?void 0:u.collisionType)===mt.Active&&(u!=null&&u.useGravity)&&f.addEqual(this.physics.config.gravity),r[h].parent||this.captureOldTransformWithChildren(r[h]),DA.integrate(e,s,f,t/l)}this._physicsConfigDirty=!1}captureOldTransformWithChildren(t){var e;(e=t.get($t))==null||e.captureOldTransform();for(let s=0;s<t.children.length;s++)this.captureOldTransformWithChildren(t.children[s])}}xf.priority=Hs.Higher;class bf extends Yi{constructor(t,e){super(),this._physics=e,this.systemType=Vi.Update,this._configDirty=!1,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._arcadeSolver=new l0(e.config.arcade),this._realisticSolver=new c0(e.config.realistic),this._physics.$configUpdate.subscribe(()=>this._configDirty=!0),this._trackCollider=s=>this._processor.track(s),this._untrackCollider=s=>this._processor.untrack(s),this.query=t.query([ot,Ie]),this.query.entityAdded$.subscribe(s=>{const r=s.get(Ie);r.$colliderAdded.subscribe(this._trackCollider),r.$colliderRemoved.subscribe(this._untrackCollider);const l=r.get();l&&this._processor.track(l)}),this.query.entityRemoved$.subscribe(s=>{const r=s.get(Ie),l=r.get();r&&l&&this._processor.untrack(l)}),this._motionSystem=t.get(xf)}get _processor(){return this._physics.collisionProcessor}initialize(t,e){this._engine=e.engine}update(t){var e,s,r,l;if(!this._physics.config.enabled)return;let h=[];for(let A=0;A<this.query.entities.length;A++){const x=this.query.entities[A].get(Ie),E=x==null?void 0:x.get();if(x&&((e=x.owner)!=null&&e.isActive)&&E)if(x.update(),E instanceof Qe){const C=E.getColliders();E.compositeStrategy||(E.compositeStrategy=this._physics.config.colliders.compositeStrategy),h=h.concat(C)}else h.push(E)}this._processor.update(h,t);let u=this._processor.broadphase(h,t);this._currentFrameContacts.clear();let f=[];const g=this.getSolver(),m=this._physics.config.substep;for(let A=0;A<m;A++)if(A>0&&this._motionSystem.update(t),f.length&&(u=f.map(y=>new ei(y.colliderA,y.colliderB))),u.length){f=this._processor.narrowphase(u,(l=(r=(s=this._engine)==null?void 0:s.debug)==null?void 0:r.stats)==null?void 0:l.currFrame),f=g.solve(f);for(const y of f){if(y.isCanceled())continue;const x=y.id.indexOf("|");if(x>0){const E=y.id.substring(x+1);this._currentFrameContacts.set(E,y)}else this._currentFrameContacts.set(y.id,y)}}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts);for(const A of this.query.entities){const y=A.get(Ie);y&&y.processColliderRemoval()}}postupdate(){ao.SeparationPool.done()}getSolver(){return this._configDirty&&(this._configDirty=!1,this._arcadeSolver=new l0(this._physics.config.arcade),this._realisticSolver=new c0(this._physics.config.realistic)),this._physics.config.solver===hf.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t,0)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const s=e.colliderA,r=e.colliderB,l=Kt.fromDirection(e.mtv),h=Kt.getOpposite(l);s.events.emit("collisionstart",new Sd(s,r,l,e)),s.events.emit("contactstart",new X_(s,r,l,e)),r.events.emit("collisionstart",new Sd(r,s,h,e)),r.events.emit("contactstart",new X_(r,s,h,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const s=e.colliderA,r=e.colliderB,l=Kt.fromDirection(e.mtv),h=Kt.getOpposite(l);s.events.emit("collisionend",new Td(s,r,l,e)),s.events.emit("contactend",new Z_(s,r,l,e)),r.events.emit("collisionend",new Td(r,s,h,e)),r.events.emit("contactend",new Z_(r,s,h,e))}}}bf.priority=Hs.Higher;class XC{constructor(t){this.$configUpdate=new gi,this._configDirty=!1,this.config=t,this.$configUpdate.subscribe(e=>{this._configDirty=!0,$t.updateDefaultPhysicsConfig(e.bodies)}),this._config.spatialPartition===gc.SparseHashGrid?this._collisionProcessor=new o0(this._config.sparseHashGrid):this._collisionProcessor=new Md(this._config)}get config(){return Sw(this._config,t=>{this.$configUpdate.notifyAll(t)})}set config(t){this._config=t,this.$configUpdate.notifyAll(t)}get collisionProcessor(){if(this._configDirty){this._configDirty=!1;const t=this._collisionProcessor.getColliders();this._config.spatialPartition===gc.SparseHashGrid?this._collisionProcessor=new o0(this._config.sparseHashGrid):this._collisionProcessor=new Md(this._config);for(const e of t)this._collisionProcessor.track(e)}return this._collisionProcessor}rayCast(t,e){return this.collisionProcessor.rayCast(t,e)}query(t){return this._collisionProcessor.query(t)}}var ho=(o=>(o.Fixed="Fixed",o.FitContainerAndFill="FitContainerAndFill",o.FitScreenAndFill="FitScreenAndFill",o.FitContainerAndZoom="FitContainerAndZoom",o.FitScreenAndZoom="FitScreenAndZoom",o.FitScreen="FitScreen",o.FillScreen="FillScreen",o.FitContainer="FitContainer",o.FillContainer="FillContainer",o))(ho||{});class h0{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class u0{constructor(t){this.events=new ae,this._antialiasing=!0,this._canvasImageRendering="auto",this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullscreen=!1,this._isDisposed=!1,this._logger=vt.getInstance(),this._fullscreenChangeHandler=()=>{this._isDisposed||(this._isFullscreen=!this._isFullscreen,this._logger.debug("Fullscreen Change",this._isFullscreen),this.events.emit("fullscreen",{fullscreen:this.isFullscreen}))},this._pixelRatioChangeHandler=()=>{this._isDisposed||(this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport(),this.events.emit("pixelratio",{pixelRatio:this.pixelRatio}))},this._resizeHandler=()=>{if(this._isDisposed)return;const h=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(h),this.applyResolutionAndViewport(),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._contentArea=new Et,this._unsafeArea=new Et;var e,s,r,l;this.viewport=t.viewport,this.resolution=(e=t.resolution)!=null?e:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(s=t.displayMode)!=null?s:"Fixed",this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(r=t.antialiasing)!=null?r:this._antialiasing,this._canvasImageRendering=(l=t.canvasImageRendering)!=null?l:this._canvasImageRendering,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this.events.clear(),this._browser.window.off("resize",this._resizeHandler),this._browser.window.clear(),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler),this._canvas=null)}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get worldToPagePixelRatio(){if(this._canvas){const t=this.worldToPageCoordinates(z.Zero);return this.worldToPageCoordinates(I(1,0)).sub(t).x}else return 1}get pixelRatioOverride(){return this._pixelRatioOverride}set pixelRatioOverride(t){this._pixelRatioOverride=t}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case"FillContainer":case"FitContainer":case"FitContainerAndFill":case"FitContainerAndZoom":return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this._resolutionStack.length&&this._viewportStack.length&&(this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop())}applyResolutionAndViewport(){if(this.graphicsContext instanceof Fs&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&(this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`),!this.pixelRatioOverride)){let r=Math.max(1,this.pixelRatio-.5),l=!1;for(;r>1&&!l;){r=Math.max(1,r-.5);const h=this._resolution.width*r,u=this._resolution.height*r;l=this.graphicsContext.checkIfResolutionSupported({width:h,height:u})}this.pixelRatioOverride=r,this._logger.warnOnce(`Scaled resolution too big attempted recovery! Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit. Setting \`ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.\`  (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)}this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvasImageRendering==="auto"?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges"));const t=this.viewport.widthUnit==="percent"?"%":"px",e=this.viewport.heightUnit==="percent"?"%":"px";this._canvas.style.width=this.viewport.width+t,this._canvas.style.height=this.viewport.height+e,this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof zd&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio),document.documentElement.style.setProperty("--ex-pixel-ratio",this.worldToPagePixelRatio.toString())}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullscreen}get isFullscreen(){return this._isFullscreen}goFullScreen(t){return this.enterFullscreen(t)}enterFullscreen(t){var e,s,r,l,h,u;if(t){const f=document.getElementById(t);if(f!=null&&f.requestFullscreen||f!=null&&f.webkitRequestFullscreen){if(f.getAttribute("ex-fullscreen-listener")||(f.setAttribute("ex-fullscreen-listener","true"),f.addEventListener("fullscreenchange",this._fullscreenChangeHandler)),f.requestFullscreen)return(e=f.requestFullscreen())!=null?e:Promise.resolve();if(f.webkitRequestFullscreen)return(s=f.webkitRequestFullscreen())!=null?s:Promise.resolve()}}return(r=this._canvas)!=null&&r.requestFullscreen?(h=(l=this._canvas)==null?void 0:l.requestFullscreen())!=null?h:Promise.resolve():this._canvas.webkitRequestFullscreen?(u=this._canvas.webkitRequestFullscreen())!=null?u:Promise.resolve():(this._logger.warnOnce("Could not go fullscreen, is this an iPhone? Currently Apple does not support fullscreen on iPhones"),Promise.resolve())}exitFullScreen(){return this.exitFullscreen()}exitFullscreen(){return document.exitFullscreen()}_viewportToPixels(t){return{width:t.widthUnit==="percent"?this.canvas.offsetWidth:t.width,height:t.heightUnit==="percent"?this.canvas.offsetHeight:t.height}}pageToScreenCoordinates(t){let e=t.x,s=t.y;this._isFullscreen||(e-=Zl(this._canvas).x,s-=Zl(this._canvas).y);const r=this._viewportToPixels(this.viewport);if(this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const l=window.innerWidth/this.aspectRatio,h=(window.innerHeight-l)/2;s=(s-h)/l*r.height,e=e/window.innerWidth*r.width}else{const l=window.innerHeight*this.aspectRatio,h=(window.innerWidth-l)/2;e=(e-h)/l*r.width,s=s/window.innerHeight*r.height}return e=e/r.width*this.resolution.width,s=s/r.height*this.resolution.height,e=e-this.contentArea.left,s=s-this.contentArea.top,new z(e,s)}screenToPageCoordinates(t){let e=t.x,s=t.y;const r=this._viewportToPixels(this.viewport);if(e=e/this.resolution.width*r.width,s=s/this.resolution.height*r.height,this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const l=window.innerWidth/this.aspectRatio,h=(window.innerHeight-l)/2;s=s/r.height*l+h,e=e/r.width*window.innerWidth}else{const l=window.innerHeight*this.aspectRatio,h=(window.innerWidth-l)/2;e=e/r.width*l+h,s=s/r.height*window.innerHeight}return this._isFullscreen||(e+=Zl(this._canvas).x,s+=Zl(this._canvas).y),new z(e,s)}screenToWorldCoordinates(t){return t=t.add(I(this.contentArea.left,this.contentArea.top)),this._camera?this._camera.inverse.multiply(t):t.sub(I(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(I(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){return Et.fromDimension(this.resolution.width,this.resolution.height,z.Half).scale(I(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.drawPos)}getScreenBounds(){return Et.fromDimension(this.resolution.width,this.resolution.height,z.Zero,z.Zero)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get width(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get height(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return I(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}get unsafeArea(){return this._unsafeArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,s=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,s=window.innerWidth/t):(e=window.innerHeight*t,s=window.innerHeight),this.viewport={width:e,height:s},this._contentArea=Et.fromDimension(this.resolution.width,this.resolution.height,z.Zero),this._unsafeArea=Et.fromDimension(this.resolution.width,this.resolution.height,z.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndFill(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndFill(){this.canvas.style.width="100%",this.canvas.style.height="100%",this._computeFitAndFill(this.canvas.offsetWidth,this.canvas.offsetHeight,{width:100,widthUnit:"percent",height:100,heightUnit:"percent"}),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndFill(t,e,s){if(this.viewport=s??{width:t,height:e},t/e<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*e/t};const r=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new Et({top:r,left:0,right:this._contentResolution.width,bottom:this.resolution.height-r}),this._unsafeArea=new Et({top:-r,left:0,right:this._contentResolution.width,bottom:this.resolution.height+r})}else{this.resolution={width:e*this._contentResolution.height/e*t/e,height:e*this._contentResolution.height/e};const r=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new Et({top:0,left:r,right:this.resolution.width-r,bottom:this._contentResolution.height}),this._unsafeArea=new Et({top:0,left:-r,right:this.resolution.width+r,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndZoom(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndZoom(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="relative";const t=this.canvas.parentElement;t.style.overflow="hidden";const{offsetWidth:e,offsetHeight:s}=this.canvas;this._computeFitAndZoom(e,s),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndZoom(t,e){const s=this.aspectRatio;let r=0,l=0;t/s<e?(r=t,l=t/s):(r=e*s,l=e);const h=t/r,u=e/l,f=Math.max(h,u),g=r*f,m=l*f;g>t?this.canvas.style.left=-(g-t)/2+"px":this.canvas.style.left="",m>e?this.canvas.style.top=-(m-e)/2+"px":this.canvas.style.top="",this.viewport={width:g,height:m};const A=Et.fromDimension(this.viewport.width,this.viewport.height,z.Zero);if(this.viewport.width>t){const y=(this.viewport.width-t)/this.viewport.width*this.resolution.width;A.top=0,A.left=y/2,A.right=this.resolution.width-y/2,A.bottom=this.resolution.height}if(this.viewport.height>e){const y=(this.viewport.height-e)/this.viewport.height*this.resolution.height;A.top=y/2,A.left=0,A.bottom=this.resolution.height-y/2,A.right=this.resolution.width}this._contentArea=A}_computeFitContainer(){const t=this.aspectRatio;let e=0,s=0,r="pixel",l="pixel";const h=this.canvas.parentElement;h.clientWidth/t<h.clientHeight?(this.canvas.style.width="100%",e=100,r="percent",s=this.canvas.offsetWidth/t):(this.canvas.style.height="100%",s=100,l="percent",e=this.canvas.offsetHeight*t),this.viewport={width:e,widthUnit:r,height:s,heightUnit:l},this._contentArea=Et.fromDimension(this.resolution.width,this.resolution.height,z.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode==="FillContainer"&&(this.canvas.style.width="100%",this.canvas.style.height="100%",this.viewport={width:100,widthUnit:"percent",height:100,heightUnit:"percent"},this.resolution={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight}),this.displayMode==="FillScreen"&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=Et.fromDimension(this.resolution.width,this.resolution.height,z.Zero),this.displayMode==="FitScreen"&&this._computeFit(),this.displayMode==="FitContainer"&&this._computeFitContainer(),this.displayMode==="FitScreenAndFill"&&this._computeFitScreenAndFill(),this.displayMode==="FitContainerAndFill"&&this._computeFitContainerAndFill(),this.displayMode==="FitScreenAndZoom"&&this._computeFitScreenAndZoom(),this.displayMode==="FitContainerAndZoom"&&this._computeFitContainerAndZoom()}}class _c{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}function ZC(o){return!!o.playbackState}const OA=class nc{static unlock(){return new Promise((e,s)=>{if(nc._UNLOCKED||!_c.create())return e(!0);const r=setTimeout(()=>{vt.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e(!1)},200),l=_c.create();l.resume().then(()=>{const h=l.createBuffer(1,1,22050),u=l.createBufferSource();let f=!1;u.buffer=h,u.connect(l.destination),u.onended=()=>f=!0,u.start(0),setTimeout(()=>{ZC(u)?(u.playbackState===u.PLAYING_STATE||u.playbackState===u.FINISHED_STATE)&&(nc._UNLOCKED=!0):(l.currentTime>0||f)&&(nc._UNLOCKED=!0)},0),clearTimeout(r),e(!0)},()=>{s()})})}static isUnlocked(){return this._UNLOCKED}};OA._UNLOCKED=!1;let WC=OA;class UA{}UA.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class wf{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,e){const s=new wf;s.data=e;for(const r in t.states)s.states.set(r,{name:r,...t.states[r]});for(const r of s.states.values())for(const l of r.transitions)if(l!=="*"&&!s.states.has(l))throw Error(`Invalid state machine, state [${r.name}] has a transition to another state that doesn't exist [${l}]`);return s.currentState=s.startState=s.states.get(t.start),s}in(t){return this.currentState.name===t}go(t,e){var s,r;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const l=this.states.get(t);return this.currentState.onExit&&((s=this.currentState)==null?void 0:s.onExit({to:l.name,data:this.data}))===!1||l!=null&&l.onEnter&&(l==null?void 0:l.onEnter({from:this.currentState.name,eventData:e,data:this.data}))===!1?!1:(this.currentState=l,(r=this.currentState)!=null&&r.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const e=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(e.currentState),this.data=e.data}}class JC{constructor(t){this._src=t,this._audioContext=_c.create(),this._volumeNode=this._audioContext.createGain(),this._playingFuture=new bn,this._stateMachine=wf.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:e})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,e.pausedAt*this._playbackRate):this._instance.start(0,e.pausedAt*this._playbackRate,this.duration),e.startedAt=this._audioContext.currentTime-e.pausedAt,e.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:e})=>{e==="STOPPED"&&this._playingFuture.resolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:e,data:s})=>{s.pausedAt=(e??0)/this._playbackRate,s.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:e})=>{e.pausedAt=0,e.startedAt=0,this._playingFuture.resolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:e})=>{e.pausedAt=this._audioContext.currentTime-e.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)}))}get loop(){return this._loop}set volume(t){t=Bt(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!=null?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}isStopped(){return this._stateMachine.in("STOPPED")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingFuture.promise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:e}=this._stateMachine.data;return t?t*this._playbackRate:e?(this._audioContext.currentTime-e)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}class LA extends Rt{constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}stopPropagation(){}action(){}propagate(){}layPath(t){}}class jr extends LA{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class KC extends LA{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}function $C(o){try{const t=new Audio,e=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,s=o.match(e)[1];return!!t.canPlayType("audio/"+s)}catch(t){return vt.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}function tS(o){var t;return!!((t=o[0])!=null&&t.paths)}class Ud{constructor(...t){this.events=new ae,this.logger=vt.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=_c.create();let e;tS(t)?e=t[0]:e={paths:t},this._resource=new vA("",UA.type.arraybuffer);const{volume:s,position:r,playbackRate:l,loop:h,bustCache:u,duration:f}=e;this.volume=s??this.volume,this.playbackRate=l??this.playbackRate,this.loop=h??this.loop,this.duration=f??this.duration,this.bustCache=u??this.bustCache,this.position=r??this.position;for(const g of e.paths)if($C(g)){this.path=g;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",e.paths.join(", ")),this.logger.warn("Attempting to use",e.paths[0]),this.path=e.paths[0])}set loop(t){this._loop=t;for(const e of this._tracks)e.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const e of this._tracks)e.volume=this._volume;this.events.emit("volumechange",new jr(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}isLoaded(){return!!this.data}async load(){var t,e;if(this.data)return this.data;const s=await this._resource.load(),r=await this.decodeAudio(s.slice(0));return this._duration=(e=(t=this._duration)!=null?t:r==null?void 0:r.duration)!=null?e:void 0,this.events.emit("processed",new KC(this,r)),this.data=r}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}isStopped(){return this._tracks.some(t=>t.isStopped())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t??this.volume,this.isPaused()?this._resumePlayback():(this.position&&this.seek(this.position),this._startPlayback())):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.events.emit("pause",new jr(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.events.emit("stop",new jr(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(e=>{e.playbackRate=this._playbackRate})}seek(t,e=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[e].seek(t)}getTotalPlaybackDuration(){return this.isLoaded()?this.data.duration:(this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`),0)}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused()){const t=[];for(const e of this._tracks)t.push(e.play().then(()=>(this._tracks.splice(this.getTrackId(e),1),!0)));this.events.emit("resume",new jr(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=this._getTrackInstance(this.data),e=await t.play(()=>{this.events.emit("playbackstart",new jr(this,t)),this.logger.debug("Playing new instance for sound",this.path)});this.events.emit("playbackend",new jr(this,t));const s=this.getTrackId(t);return s!==-1&&this._tracks.splice(s,1),e}_getTrackInstance(t){var e;const s=new JC(t);return s.loop=this.loop,s.volume=this.volume,s.duration=(e=this.duration)!=null?e:0,s.playbackRate=this._playbackRate,this._tracks.push(s),s}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}function d0(o){var t,e;return!!(o!=null&&o.prototype)&&!!((e=(t=o==null?void 0:o.prototype)==null?void 0:t.constructor)!=null&&e.name)}class Ac{constructor(t){this.events=new ae,this.canvas=new gf({filtering:ii.Blended,smoothing:!0,cache:!1,draw:this.onDraw.bind(this)}),this._resources=[],this._numLoaded=0,this._totalTimeMs=0,this._loadingFuture=new bn;var e;t&&((e=t.loadables)!=null&&e.length)&&this.addResources(t.loadables)}get resources(){return this._resources}onInitialize(t){this.engine=t,this.canvas.width=this.engine.screen.resolution.width,this.canvas.height=this.engine.screen.resolution.height}async onUserAction(){return await Promise.resolve()}async onBeforeLoad(){}async onAfterLoad(){await Ed(500,this.engine.clock)}addResource(t){this._resources.push(t)}addResources(t){let e=0;const s=t.length;for(e;e<s;e++)this.addResource(t[e])}markResourceComplete(){this._numLoaded++}get progress(){const t=this._resources.length;return t>0?Bt(this._numLoaded,0,t)/t:1}isLoaded(){return this._numLoaded===this._resources.length}onUpdate(t,e){this._totalTimeMs+=e}onDraw(t){const e=this._totalTimeMs/1e3;t.fillStyle=$.Black.toRGBA(),t.fillRect(0,0,this.engine.screen.resolution.width,this.engine.screen.resolution.height),t.save(),t.translate(this.engine.screen.resolution.width/2,this.engine.screen.resolution.height/2);const s=e*10;t.strokeStyle="white",t.lineWidth=10,t.lineCap="round",t.arc(0,0,40,s,s+Math.PI*3/2),t.stroke(),t.fillStyle="white",t.font="16px sans-serif";const r=(this.progress*100).toFixed(0)+"%",l=t.measureText(r),h=Math.abs(l.actualBoundingBoxLeft)+Math.abs(l.actualBoundingBoxRight),u=Math.abs(l.actualBoundingBoxAscent)+Math.abs(l.actualBoundingBoxDescent);t.fillText(r,-h/2,u/2),t.restore()}areResourcesLoaded(){return this._resources.length===0?Promise.resolve():this._loadingFuture.promise}async load(){await this.onBeforeLoad(),this.events.emit("beforeload"),this.canvas.flagDirty(),await Promise.all(this._resources.map(async t=>{this.events.emit("loadresourcestart",t),await t.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty(),this.events.emit("loadresourceend",t)})}));for(const t of this._resources)t instanceof Ud&&t.wireEngine(this.engine);return this._loadingFuture.resolve(),this.canvas.flagDirty(),await this.onUserAction(),this.events.emit("useraction"),await WC.unlock(),await this.onAfterLoad(),this.events.emit("afterload"),this.data=this._resources}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}const eS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",iS=`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition:
    background 250ms ease-in-out,
    transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,FA=class NA extends Ac{constructor(t){const e=Array.isArray(t)?{loadables:t}:t;super(e),this._logger=vt.getInstance(),this._originalOptions={loadables:[]},this.events=new ae,this._playButtonShown=!1,this.logo=eS,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=$.White,this.backgroundColor="#176BAA",this._imageLoaded=new bn,this.suppressPlayButton=!1,this._playButtonStyles=iS,this.playButtonText="Play game",this.startButtonFactory=()=>{let s=document.getElementById("excalibur-play");return s||(s=document.createElement("button")),s.id="excalibur-play",s.textContent=this.playButtonText,s.style.display="none",s},this._originalOptions={...NA._DEFAULT_LOADER_OPTIONS,...e}}get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.onload=()=>this._imageLoaded.resolve(),this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}onInitialize(t){this.engine=t,this.screen=t.screen,this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height,this.screen.events.on("resize",()=>{this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height})}async showPlayButton(){var t,e;if(this.suppressPlayButton)this.hidePlayButton(),await Ed(500,(t=this.engine)==null?void 0:t.clock);else{const s=()=>{try{this._positionPlayButton()}catch{}};return(e=this.engine)!=null&&e.browser&&this.engine.browser.window.on("resize",s),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",l=>{l.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(l=>{const h=u=>{var f;if(u.stopPropagation(),this.hidePlayButton(),(f=this.engine)!=null&&f.browser&&this.engine.browser.window.off("resize",s),this._originalOptions.fullscreenAfterLoad)try{this._logger.info("requesting fullscreen"),this._originalOptions.fullscreenContainer instanceof HTMLElement?this._originalOptions.fullscreenContainer.requestFullscreen():this.engine.screen.enterFullscreen(this._originalOptions.fullscreenContainer)}catch(g){this._logger.error("could not go fullscreen",g)}l()};this._playButton.addEventListener("click",h),this._playButton.addEventListener("touchend",h),this._playButton.addEventListener("pointerup",h),this.engine&&this.engine.input.gamepads.once("button",()=>h(new Event("button")))})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}async onUserAction(){var t;await Ed(200,(t=this.engine)==null?void 0:t.clock),this.canvas.flagDirty(),await this.showPlayButton()}async onBeforeLoad(){this.screen.pushResolutionAndViewport(),this.screen.resolution={width:this.canvas.width,height:this.canvas.height},this.screen.applyResolutionAndViewport();const t=this._image;await this._imageLoaded.promise,await(t==null?void 0:t.decode())}async onAfterLoad(){this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.dispose()}_positionPlayButton(){if(this.engine){const{x:t,y:e,width:s,height:r}=this.engine.canvas.getBoundingClientRect();if(this._playButtonRootElement){const l=this._playButton.clientWidth,h=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${t+s/2-l/2}px`,this._playButtonRootElement.style.top=`${e+r/2-h/2+100}px`)}}}onDraw(t){const e=this.engine.canvasHeight/this.engine.pixelRatio,s=this.engine.canvasWidth/this.engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,s,e);let r=e/2;const l=Math.min(this.logoWidth,s*.75);let h=s/2-l/2;this.logoPosition&&(h=this.logoPosition.x,r=this.logoPosition.y);const u=Math.floor(l*(this.logoHeight/this.logoWidth)),f=this.engine.screen.antialiasing;if(this.engine.screen.antialiasing=!0,this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,h,r,l,u):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,h,r-u-20,l,u),!this.suppressPlayButton&&this._playButtonShown){this.engine.screen.antialiasing=f;return}let g=h,m=r;this.loadingBarPosition&&(g=this.loadingBarPosition.x,m=this.loadingBarPosition.y),t.lineWidth=2,t0(t,g,m,l,20,10,this.loadingBarColor);const A=l*this.progress,y=5,x=A-y*2,E=20-y*2;t0(t,g+y,m+y,x>10?x:10,E,5,null,this.loadingBarColor),this.engine.screen.antialiasing=f}};FA._DEFAULT_LOADER_OPTIONS={loadables:[],fullscreenAfterLoad:!1,fullscreenContainer:void 0};let yc=FA;const f0={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class sS{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],s=this.getBrowserFeatures();for(const r of Object.keys(f0))s[r]?(t+="(%c%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+f0[r]+`
`;e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:this._criticalTests.canvasSupport(),arraybuffer:this._criticalTests.arrayBufferSupport(),dataurl:this._criticalTests.dataUrlSupport(),objecturl:this._criticalTests.objectUrlSupport(),rgba:this._criticalTests.rgbaSupport(),webaudio:this._warningTest.webAudioSupport(),webgl:this._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),vt.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const e in this._warningTest)this._warningTest[e]()||vt.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",e);return!0}}function nS(o){return o instanceof ta}class ta extends Bi{constructor(t){var e,s;super({...t}),this.get(ot).coordPlane=_i.Screen,this.anchor=(e=t==null?void 0:t.anchor)!=null?e:I(0,0),this.body.collisionType=(s=t==null?void 0:t.collisionType)!=null?s:mt.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!(t!=null&&t.collider)&&(t==null?void 0:t.width)>0&&(t==null?void 0:t.height)>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,s=!0){if(s)return super.contains(t,e);const r=this._engine.worldToScreenCoordinates(new z(t,e));return super.contains(r.x,r.y)}}const HA=class GA{constructor(t){this._logger=vt.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null;var e;const s=(e=t.action)!=null?e:t.fcn,r=t.interval,l=t.repeats,h=t.numberOfRepeats,u=t.randomRange,f=t.random;if(h&&h>=0&&(this.maxNumberOfRepeats=h,!l))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=GA._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=r,u){if(u[0]>u[1])throw new Error("min value must be lower than max value for range");this.random=f??new J0,this.randomRange=u,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=l||this.repeats,s&&this.on(s)}get complete(){return this._complete}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(e=>{e.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,e){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}};HA._MAX_ID=0;let fd=HA;function p0(o){return o&&o._dispatchPointerEvents&&o._processPointerToObject}class rS{get events(){return this.object.events}init(t,e,s){this.object=t,this.contains=e,this.active=s}}class QA{constructor(){this._proxyPool=new Bc(()=>new rS,t=>t,100),this._objectToProxy=new Map,this._proxies=[],this._lastFrameObjectToPointers=new Map,this._currentFrameObjectToPointers=new Map}addObject(t,e,s){const r=this._proxyPool.rent(!1);r.init(t,e,s),this._proxies.push(r),this._objectToProxy.set(t,r)}_getProxy(t){const e=this._objectToProxy.get(t);if(e)return e;throw new Error("No PointerTargetProxy for object")}removeObject(t){const e=this._objectToProxy.get(t);if(e){const s=this._proxies.indexOf(e);this._objectToProxy.delete(t),s>-1&&this._proxies.splice(s,1),this._proxyPool.return(e)}}_objectCurrentlyUnderPointer(t,e){return!!(this._currentFrameObjectToPointers.has(t)&&this._currentFrameObjectToPointers.get(t).includes(e))}_objectWasUnderPointer(t,e){return!!(this._lastFrameObjectToPointers.has(t)&&this._lastFrameObjectToPointers.get(t).includes(e))}_entered(t,e){return this._objectCurrentlyUnderPointer(t,e)&&!this._lastFrameObjectToPointers.has(t)}_left(t,e){return!this._currentFrameObjectToPointers.has(t)&&this._objectWasUnderPointer(t,e)}addPointerToObject(t,e){const s=this._objectToProxy.get(t);s&&this._addPointerToProxy(s,e)}_addPointerToProxy(t,e){if(!this._currentFrameObjectToPointers.has(t)){this._currentFrameObjectToPointers.set(t,[e]);return}const s=this._currentFrameObjectToPointers.get(t);this._currentFrameObjectToPointers.set(t,s.concat(e))}dispatchEvents(t,e){const s=new Set(this._lastFrameObjectToPointers.keys()),r=new Set(this._currentFrameObjectToPointers.keys());let l,h,u;for(let f=0;f<e.length;f++){const g=e[f],m=this._getProxy(g);if(p0(g)&&g._dispatchPointerEvents(t),s.has(m)||r.has(m)){u=this._processDownAndEmit(t,m),h=this._processUpAndEmit(t,m),l=this._processMoveAndEmit(t,m);const A=[...l.values(),...u.values(),...h.values()];this._processEnterLeaveAndEmit(t,m,A),this._processCancelAndEmit(t,m),this._processWheelAndEmit(t,m)}}}processPointerToObject(t,e){for(let s=0;s<e.length;s++){const r=e[s],l=this._getProxy(r);p0(r)&&r._processPointerToObject(t);for(const[h,u]of t.currentFramePointerCoords.entries())l.contains(u)&&this._addPointerToProxy(l,h)}}clear(){this._lastFrameObjectToPointers.clear(),this._lastFrameObjectToPointers=new Map(this._currentFrameObjectToPointers),this._currentFrameObjectToPointers.clear()}_processDownAndEmit(t,e){const s=new Map;for(const r of t.currentFrameDown)r.active&&this._objectCurrentlyUnderPointer(e,r.pointerId)&&(e.events.emit("pointerdown",r),t.isDragStart(r.pointerId)&&e.events.emit("pointerdragstart",r)),s.set(r.pointerId,r);return s}_processUpAndEmit(t,e){const s=new Map;for(const r of t.currentFrameUp)r.active&&this._objectCurrentlyUnderPointer(e,r.pointerId)&&(e.events.emit("pointerup",r),t.isDragEnd(r.pointerId)&&e.events.emit("pointerdragend",r)),s.set(r.pointerId,r);return s}_processMoveAndEmit(t,e){const s=new Map;for(const r of t.currentFrameMove)r.active&&e.active()&&this._objectCurrentlyUnderPointer(e,r.pointerId)&&(e.events.emit("pointermove",r),t.isDragging(r.pointerId)&&e.events.emit("pointerdragmove",r)),s.set(r.pointerId,r);return s}_processEnterLeaveAndEmit(t,e,s){for(const r of s){if(r.active&&e.active()&&this._entered(e,r.pointerId)){e.events.emit("pointerenter",r),t.isDragging(r.pointerId)&&e.events.emit("pointerdragenter",r);break}if(r.active&&e.active()&&(this._left(e,r.pointerId)||this._objectCurrentlyUnderPointer(e,r.pointerId)&&r.type==="up")){e.events.emit("pointerleave",r),t.isDragging(r.pointerId)&&e.events.emit("pointerdragleave",r);break}}}_processCancelAndEmit(t,e){for(const s of t.currentFrameCancel)s.active&&e.active()&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&e.events.emit("pointercancel",s)}_processWheelAndEmit(t,e){for(const s of t.currentFrameWheel)s.active&&e.active()&&this._objectCurrentlyUnderPointer(e,0)&&e.events.emit("pointerwheel",s)}}class aS extends Ns{constructor(t){var e,s,r;super([],t.name),this.events=new ae,this._token=0,this.logger=vt.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this.meshingLookBehind=10,this._collidersDirty=!0,this._oldRotation=0,this._originalOffsets=new WeakMap,this.meshingLookBehind=(e=t.meshingLookBehind)!=null?e:this.meshingLookBehind,this.addComponent(new ot),this.addComponent(new Zt),this.addComponent(new $t({type:mt.Fixed})),this.addComponent(new je({onPostDraw:(h,u)=>this.draw(h,u)})),this.addComponent(new bA((h,u)=>this.debug(h,u),!1)),this.addComponent(new Ie),this.addComponent(new yo),this.pointer=this.get(yo),this._graphics=this.get(je),this.transform=this.get(ot),this._motion=this.get(Zt),this.collider=this.get(Ie),this._composite=this.collider.useCompositeCollider([]),this.transform.pos=(s=t.pos)!=null?s:z.Zero,this._oldPos=this.transform.pos.clone(),this._oldScale=this.transform.scale.clone(),this.renderFromTopOfGraphic=(r=t.renderFromTopOfGraphic)!=null?r:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this._pointerEventDispatcher=new QA,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let l=[];for(let h=0;h<this.columns;h++){for(let u=0;u<this.rows;u++){const f=new oS({x:h,y:u,map:this});f.map=this,this.tiles[h+u*this.columns]=f,this._pointerEventDispatcher.addObject(f,g=>f.bounds.contains(g.worldPos),()=>!0),l.push(f),this._rows[u]||(this._rows[u]=[]),this._rows[u].push(f)}this._cols[h]=l,l=[]}this._graphics.localBounds=new Et({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let t=0;t<this.tiles.length;t++)this.tiles[t]&&this.tiles[t].flagDirty()}get x(){var t;return(t=this.transform.pos.x)!=null?t:0}set x(t){var e;(e=this.transform)!=null&&e.pos&&(this.get(ot).pos=I(t,this.y))}get y(){var t,e;return(e=(t=this.transform)==null?void 0:t.pos.y)!=null?e:0}set y(t){var e;(e=this.transform)!=null&&e.pos&&(this.transform.pos=I(this.x,t))}get z(){var t;return(t=this.transform.z)!=null?t:0}set z(t){this.transform&&(this.transform.z=t)}get rotation(){var t,e;return(e=(t=this.transform)==null?void 0:t.rotation)!=null?e:0}set rotation(t){this.transform&&(t!==this.transform.rotation&&(this.flagCollidersDirty(),this.flagTilesDirty()),this.transform.rotation=t)}get scale(){var t,e;return(e=(t=this.transform)==null?void 0:t.scale)!=null?e:z.One}set scale(t){this.transform&&(t!=null&&t.equals(this.transform.scale)||(this.flagCollidersDirty(),this.flagTilesDirty()),this.transform.scale=t)}get pos(){return this.transform.pos}set pos(t){this.transform&&(t!=null&&t.equals(this.transform.pos)||(this.flagCollidersDirty(),this.flagTilesDirty()),this.transform.pos=t)}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}get width(){return this.tileWidth*this.columns*this.scale.x}get height(){return this.tileHeight*this.rows*this.scale.y}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_initialize(t){super._initialize(t),this._engine=t}_getOrSetColliderOriginalOffset(t){var e;if(this._originalOffsets.has(t))return(e=this._originalOffsets.get(t))!=null?e:z.Zero;{const s=t.offset;return this._originalOffsets.set(t,s),s}}_updateColliders(){this.collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const t=[];this._composite=this.collider.useCompositeCollider([]);let e=null;const s=(l,h)=>l&&h?l.top===h.top&&l.bottom===h.bottom&&l.right===h.left:!1,r=(l,h,u=this.meshingLookBehind)=>{if(!l)return!1;for(let f=h.length-1;f>=0;f--){if(u--<0)return!1;const g=h[f];if(s(g,l))return h[f]=g.combine(l),!0}return!1};for(let l=0;l<this.columns;l++){for(let h=0;h<this.rows;h++){const u=this.tiles[l+h*this.columns];if(u.solid)if(u.getColliders().length>0){for(const f of u.getColliders()){const g=this._getOrSetColliderOriginalOffset(f);f.offset=I(u.x*this.tileWidth*this.scale.x,u.y*this.tileHeight*this.scale.y).add(g),f.owner=this,this._composite.addCollider(f)}e&&!r(e,t)&&t.push(e),e=null}else e?e=e.combine(u.defaultGeometry):e=u.defaultGeometry;else e&&!r(e,t)&&t.push(e),e=null}e&&!r(e,t)&&t.push(e),e=null}for(const l of t){const h=Ze.Box(l.width,l.height,z.Zero,I(l.left-this.pos.x,l.top-this.pos.y));h.owner=this,this._composite.addCollider(h)}this.collider.update(),this.collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){var e;return(e=this.tiles[t])!=null?e:null}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const{x:e,y:s}=this._getTileCoordinates(t),r=this.getTile(e,s);return e>=0&&s>=0&&e<this.columns&&s<this.rows&&r?r:null}_getTileCoordinates(t){t=this.transform.applyInverse(t);const e=Math.floor(t.x/this.tileWidth),s=Math.floor(t.y/this.tileHeight);return{x:e,y:s}}getRows(){return this._rows}getColumns(){return this._cols}getOnScreenTiles(){const t=this._engine.screen.getWorldBounds();let e=I(0,0),s=this.transform.coordPlane===_i.Screen?this._engine.screen.getScreenBounds():t;const r=this.get(ff);if(r&&this.isInitialized){const E=z.One.sub(r.parallaxFactor);e=this._engine.currentScene.camera.pos.scale(E),s=s.translate(e.negate())}const l=this._getTileCoordinates(s.topLeft),h=this._getTileCoordinates(s.topRight),u=this._getTileCoordinates(s.bottomRight),f=this._getTileCoordinates(s.bottomLeft),g=Math.min(Bt(l.x,0,this.columns-1),Bt(h.x,0,this.columns-1)),m=Math.min(Bt(l.y,0,this.rows-1),Bt(h.y,0,this.rows-1)),A=Math.max(Bt(u.x,0,this.columns-1),Bt(f.x,0,this.columns-1)),y=Math.max(Bt(u.y,0,this.rows-1),Bt(f.y,0,this.rows-1)),x=[];for(let E=g;E<=A;E++)for(let C=m;C<=y;C++)x.push(this.getTile(E,C));return x}_processPointerToObject(t){this._pointerEventDispatcher.processPointerToObject(t,this.tiles)}_dispatchPointerEvents(t){this._pointerEventDispatcher.dispatchEvents(t,this.tiles)}update(t,e){this._initialize(t),this.onPreUpdate(t,e),this.emit("preupdate",new ia(t,e,this)),(!this._oldPos.equals(this.pos)||this._oldRotation!==this.rotation||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._pointerEventDispatcher.clear(),this._token++,this.pos.clone(this._oldPos),this._oldRotation=this.rotation,this.scale.clone(this._oldScale),this.transform.pos=this.pos,this.onPostUpdate(t,e),this.emit("postupdate",new sa(t,e,this))}draw(t,e){if(!this.isInitialized)return;this.emit("predraw",new Tc(t,e,this));let s,r,l;const h=this.getOnScreenTiles();for(let u=0;u<h.length;u++){const f=h[u],g=f.getGraphicsOffsets();for(s=f.getGraphics(),r=0,l=s.length;r<l;r++){const m=s[r],A=g[r];if(m){BA(m)&&(m==null||m.tick(e,this._token));const y=this.renderFromTopOfGraphic?0:m.height-this.tileHeight;m.draw(t,f.x*this.tileWidth+A.x,f.y*this.tileHeight-y+A.y)}}}this.emit("postdraw",new Ec(t,e,this))}debug(t,e){const{showAll:s,showGrid:r,gridColor:l,gridWidth:h,showSolidBounds:u,solidBoundsColor:f,showColliderGeometry:g}=e.tilemap,{geometryColor:m,geometryLineWidth:A,geometryPointSize:y}=e.collider,x=this.tileWidth*this.columns*this.scale.x,E=this.tileHeight*this.rows*this.scale.y,C=this.pos;if(r||s){for(let L=0;L<this.rows+1;L++){const D=I(0,L*this.tileHeight*this.scale.y);t.drawLine(C.add(D),C.add(I(x,D.y)),l,h)}for(let L=0;L<this.columns+1;L++){const D=I(L*this.tileWidth*this.scale.x,0);t.drawLine(C.add(D),C.add(I(D.x,E)),l,h)}}if(s||u||g){const L=this._composite.getColliders();t.save(),t.translate(this.pos.x,this.pos.y),t.scale(this.scale.x,this.scale.y);for(const D of L){const R=D.localBounds,P=D.worldPos.sub(this.pos);u&&t.drawRectangle(P,R.width,R.height,f)}if(t.restore(),g)for(const D of L)D.debug(t,m,{lineWidth:A,pointSize:y})}if(s||u){if(t.save(),t.z=999,u)for(let L=0;L<this.tiles.length;L++)this.tiles[L].bounds.draw(t);t.restore()}}}class oS{constructor(t){this._posDirty=!1,this.events=new ae,this._solid=!1,this._graphics=[],this._offsets=[],this._colliders=[],this.data=new Map;var e,s;this.x=t.x,this.y=t.y,this.map=t.map,this._width=t.map.tileWidth*this.map.scale.x,this._height=t.map.tileHeight*this.map.scale.y,this.solid=(e=t.solid)!=null?e:this.solid,this._graphics=(s=t.graphics)!=null?s:[],this._recalculate()}get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(t){var e;(e=this.map)==null||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}getGraphicsOffsets(){return this._offsets}addGraphic(t,e){this._graphics.push(t),e!=null&&e.offset?this._offsets.push(e.offset):this._offsets.push(z.Zero)}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&(this._graphics.splice(e,1),this._offsets.splice(e,1))}clearGraphics(){this._graphics.length=0,this._offsets.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}flagDirty(){this._posDirty=!0}_recalculate(){const t=this.map.pos.add(I(this.x*this.map.tileWidth,this.y*this.map.tileHeight));this._geometry=new Et(t.x,t.y,t.x+this.map.tileWidth,t.y+this.map.tileHeight),this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(I(this.x*this._width,this.y*this._height)),this._bounds=new Et(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this.map.rotation&&(this._bounds=this._bounds.rotate(this.map.rotation,this.map.pos)),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get defaultGeometry(){return this._geometry}get center(){return this._posDirty&&this._recalculate(),new z(this._pos.x+this._width/2,this._pos.y+this._height/2)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}class g0 extends ts{constructor(t){super(),this.elevation=0,this.columns=t.columns,this.rows=t.rows,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight}}class jA extends Yi{constructor(t){super(),this.world=t,this.systemType=Vi.Update,this.query=this.world.query([ot,g0])}update(){let t,e;for(let s=0;s<this.query.entities.length;s++){const r=this.query.entities[s];t=r.get(ot),e=r.get(g0);const h=Math.max(e.columns*e.tileWidth,e.rows*e.tileHeight)*e.elevation+t.pos.y;t.z=h}}}jA.priority=Hs.Lower;class lS{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new cS(t))}lockToActorAxis(t,e){this.camera.addStrategy(new hS(t,e))}elasticToActor(t,e,s){this.camera.addStrategy(new uS(t,e,s))}radiusAroundActor(t,e){this.camera.addStrategy(new dS(t,e))}limitCameraBounds(t){this.camera.addStrategy(new fS(t))}}class cS{constructor(t){this.target=t,this.action=(e,s,r,l)=>e.center}}class hS{constructor(t,e){this.target=t,this.axis=e,this.action=(s,r,l,h)=>{const u=s.center,f=r.getFocus();return this.axis===0?new z(u.x,f.y):new z(f.x,u.y)}}}class uS{constructor(t,e,s){this.target=t,this.cameraElasticity=e,this.cameraFriction=s,this.action=(r,l,h,u)=>{const f=r.center;let g=l.getFocus(),m=l.vel.clone();const A=f.sub(g).scale(this.cameraElasticity);m=m.add(A);const y=m.scale(-1).scale(this.cameraFriction);return m=m.add(y),g=g.add(m),g}}}class dS{constructor(t,e){this.target=t,this.radius=e,this.action=(s,r,l,h)=>{const u=s.center,f=r.getFocus(),g=u.sub(f),m=g.magnitude;if(m>=this.radius){const A=m-this.radius;return f.add(g.normalize().scale(A))}return f}}}class fS{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(e,s,r,l)=>{const h=s.getFocus();this.boundSizeChecked||((e.bottom-e.top<r.drawHeight||e.right-e.left<r.drawWidth)&&vt.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let u=h.x,f=h.y;return h.x<e.left+r.halfDrawWidth?u=e.left+r.halfDrawWidth:h.x>e.right-r.halfDrawWidth&&(u=e.right-r.halfDrawWidth),h.y<e.top+r.halfDrawHeight?f=e.top+r.halfDrawHeight:h.y>e.bottom-r.halfDrawHeight&&(f=e.bottom-r.halfDrawHeight),I(u,f)}}}class pS{constructor(){this.events=new ae,this.transform=_e.identity(),this.inverse=_e.identity(),this._cameraStrategies=[],this.strategy=new lS(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=new yn(z.Zero,()=>{this._posChanged=!0}),this.drawPos=this.pos.clone(),this._oldPos=this.pos.clone(),this.vel=z.Zero,this.acc=z.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Us.EaseInOutCubic,this._easing=Us.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1,this._snapPos=I(0,0)}get strategies(){return this._cameraStrategies}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._posChanged=!0,this._pos=new yn(t,()=>{this._posChanged=!0})}hasChanged(){return this._posChanged}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=I(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=I(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=I(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=I(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=I(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=I(this.acc.x,t)}getFocus(){return this.pos}move(t,e,s=Us.EaseInOutCubic){if(typeof s!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(r=>{this._lerpResolve=r}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=s,this._lerpPromise)}shake(t,e,s){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=s}zoomOverTime(t,e=0,s=Us.EaseInOutCubic){if(this._zoomPromise=new Promise(r=>{this._zoomResolve=r}),e)this._isZooming=!0,this._zoomEasing=s,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new Et(0,0,0,0)}addStrategy(...t){this._cameraStrategies.push(...t)}setStrategies(t){this._cameraStrategies=[...t]}removeStrategy(t){To(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.events.emit("preupdate",new ia(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.events.emit("postupdate",new sa(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.contentArea;let s=I(e.width/2,e.height/2);if(!this._engine.loadingComplete){const r=this._screen.peekResolution();r&&(s=I(r.width/2,r.height/2))}this._halfWidth=s.x,this._halfHeight=s.y,this._posChanged||(this.pos=s),this.pos.clone(this.drawPos),this.updateTransform(this.pos),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(this.pos),this.pos.clone(this._oldPos),this.onInitialize(t),this.events.emit("initialize",new Dc(t,this)),this._isInitialized=!0}}onInitialize(t){}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}runStrategies(t,e){for(const s of this._cameraStrategies)this.pos=s.action.call(s,s.target,this,t,e)}updateViewport(){this._viewport=new Et(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos.clone(this._oldPos),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const s=this._zoomEasing,r=s(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=r,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const r=Us.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=r,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const s=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(s)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(this.pos),this._postupdate(t,e),this._posChanged=!1}draw(t){if(this.pos.clone(this.drawPos),this._engine.fixedUpdateTimestep){const e=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep,s=this.pos.scale(e).add(this._oldPos.scale(1-e));s.clone(this.drawPos),this.updateTransform(s)}if(t.snapToPixel){const e=this.drawPos.clone(this._snapPos);e.x=~~(e.x+Tt*te(e.x)),e.y=~~(e.y+Tt*te(e.y)),e.clone(this.drawPos),this.updateTransform(e)}t.multiply(this.transform)}updateTransform(t){const e=this._screen.resolution.width/this.zoom,s=this._screen.resolution.height/this.zoom,r=I(-t.x+e/2+this._xShake,-t.y+s/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(e/2,s/2),this.transform.rotate(this.rotation),this.transform.translate(-e/2,-s/2),this.transform.translate(r.x,r.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}class gS extends Bi{constructor(t){var e,s,r,l;super({...t}),this.events=new ae,this.filter=(e=t.filter)!=null?e:()=>!0,this.repeat=(s=t.repeat)!=null?s:-1,this.action=(r=t.action)!=null?r:()=>{},this.target=t.target,this.graphics.isVisible=(l=t.visible)!=null?l:!1,this.body.collisionType=mt.Passive,this.events.on("collisionstart",({other:h})=>{this._matchesTarget(h.owner)&&(this.events.emit("enter",new aw(this,h.owner)),this._dispatchAction(h.owner),this.repeat===0&&this.kill())}),this.events.on("collisionend",({other:h})=>{this._matchesTarget(h.owner)&&this.events.emit("exit",new ow(this,h.owner))})}_matchesTarget(t){return this.filter(t)&&(this.target===void 0||this.target===t)}_dispatchAction(t){this.repeat!==0&&(this.action.call(this,t),this.repeat--)}}class VA extends Yi{constructor(t){super(),this.world=t,this.systemType=Vi.Draw,this.query=this.world.query([ot])}initialize(t,e){this._graphicsContext=e.engine.graphicsContext,this._camera=e.camera,this._engine=e.engine,this._collisionSystem=t.systemManager.get(bf)}update(){var t;if(!this._engine.isDebug)return;const e=this._engine.debug.filter;let s,r;const l=this._engine.debug.entity;let h;const u=this._engine.debug.transform;let f;const g=this._engine.debug.motion;let m;const A=this._engine.debug.collider,y=this._engine.debug.physics;let x;const E=this._engine.debug.graphics;let C,L;const D=this._engine.debug.body,R=this._engine.debug.camera;for(let P=0;P<this.query.entities.length;P++){const F=this.query.entities[P];if(F.hasTag("offscreen")||F instanceof RA||e.useFilter&&(!(e.ids.length===0||e.ids.includes(F.id))||!(e.nameQuery===""||F.name.includes(e.nameQuery))))continue;let Y=z.Zero;const et=I(0,16);if(s=F.id,r=F.name,h=F.get(ot),this._pushCameraTransform(h),this._graphicsContext.save(),h.coordPlane===_i.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=u.debugZIndex,this._applyTransform(F),h&&((u.showAll||u.showPosition)&&this._graphicsContext.debug.drawPoint(z.Zero,{size:4,color:u.positionColor}),(u.showAll||u.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${h.pos.toString(2)}`,Y),Y=Y.add(et)),(u.showAll||u.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${h.z.toFixed(1)})`,Y),Y=Y.add(et)),(l.showAll||l.showId)&&(this._graphicsContext.debug.drawText(`id(${s}) ${F.parent?"child of id("+((t=F.parent)==null?void 0:t.id)+")":""}`,Y),Y=Y.add(et)),(l.showAll||l.showName)&&(this._graphicsContext.debug.drawText(`name(${r})`,Y),Y=Y.add(et)),(u.showAll||u.showRotation)&&(this._graphicsContext.drawLine(z.Zero,z.fromAngle(h.rotation).scale(50).add(z.Zero),u.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${Ob(h.rotation).toFixed(2)})`,Y),Y=Y.add(et)),(u.showAll||u.showScale)&&this._graphicsContext.drawLine(z.Zero,h.scale.add(z.Zero),u.scaleColor,2)),x=F.get(je),x&&(E.showAll||E.showBounds)&&x.localBounds.draw(this._graphicsContext,E.boundsColor),C=F.get(bA),C&&(C.useTransform||this._graphicsContext.restore(),C.draw(this._graphicsContext,this._engine.debug),C.useTransform||(this._graphicsContext.save(),this._applyTransform(F))),L=F.get($t),L&&((D.showAll||D.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${L.group.name})`,Y),Y=Y.add(et)),(D.showAll||D.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${L.collisionType})`,Y),Y=Y.add(et)),(D.showAll||D.showMass)&&(this._graphicsContext.debug.drawText(`mass(${L.mass})`,Y),Y=Y.add(et)),(D.showAll||D.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${L.sleepMotion})`,Y),Y=Y.add(et)),(D.showAll||D.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${L.canSleep?L.isSleeping:"cant sleep"})`,Y),Y=Y.add(et))),this._graphicsContext.restore(),this._graphicsContext.save(),h.coordPlane===_i.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=u.debugZIndex,f=F.get(Zt),f&&((g.showAll||g.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${f.vel.toString(2)}`,Y.add(h.globalPos)),this._graphicsContext.drawLine(h.globalPos,h.globalPos.add(f.vel),g.velocityColor,2),Y=Y.add(et)),(g.showAll||g.showAcceleration)&&this._graphicsContext.drawLine(h.globalPos,h.globalPos.add(f.acc),g.accelerationColor,2)),m=F.get(Ie),m){const k=m.get();if((A.showAll||A.showGeometry)&&k&&k.debug(this._graphicsContext,A.geometryColor,{lineWidth:A.geometryLineWidth,pointSize:A.geometryPointSize}),A.showAll||A.showBounds){if(k instanceof Qe){const rt=k.getColliders();for(const gt of rt){const _t=gt.bounds,At=I(_t.left,_t.top);this._graphicsContext.debug.drawRect(At.x,At.y,_t.width,_t.height,{color:A.boundsColor}),(A.showAll||A.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${gt.owner.id})`,At)}m.bounds.draw(this._graphicsContext,A.boundsColor)}else if(k){const rt=m.bounds,gt=I(rt.left,rt.top);this._graphicsContext.debug.drawRect(gt.x,gt.y,rt.width,rt.height,{color:A.boundsColor}),(A.showAll||A.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${m.owner.id})`,gt)}}}this._graphicsContext.restore(),this._popCameraTransform(h)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(y.showAll||y.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),y.showAll||y.showCollisionContacts||y.showCollisionNormals)for(const[P,F]of this._engine.debug.stats.currFrame.physics.contacts){if(y.showAll||y.showCollisionContacts)for(const Y of F.points)this._graphicsContext.debug.drawPoint(Y,{size:y.contactSize,color:y.collisionContactColor});if(y.showAll||y.showCollisionNormals)for(const Y of F.points)this._graphicsContext.debug.drawLine(Y,F.normal.scale(30).add(Y),{color:y.collisionNormalColor})}this._graphicsContext.restore(),R&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(R.showAll||R.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,R.focusColor),(R.showAll||R.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}postupdate(t,e){this._engine.isDebug&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext),PA.flush(this._graphicsContext),this._graphicsContext.restore())}_applyTransform(t){const e=t.getAncestors();for(const s of e){const r=s==null?void 0:s.get(ot);r&&(this._graphicsContext.translate(r.pos.x,r.pos.y),this._graphicsContext.scale(r.scale.x,r.scale.y),this._graphicsContext.rotate(r.rotation))}}_pushCameraTransform(t){t.coordPlane===_i.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===_i.World&&this._graphicsContext.restore()}}VA.priority=Hs.Lowest;class Cf extends Yi{constructor(t){super(),this.world=t,this.systemType=Vi.Update,this._graphicsHashGrid=new zA({size:100}),this._graphics=[],this._entityToPointer=new Map,this._pointerEventDispatcher=new QA,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this.query=this.world.query([ot,yo]),this.query.entityAdded$.subscribe(e=>{const s=e.get(ot),r=e.get(yo);this._pointerEventDispatcher.addObject(e,h=>r&&r.localBounds?r.localBounds.transform(s.get().matrix).contains(s.coordPlane===_i.World?h.worldPos:h.screenPos):!1,()=>e.isActive),this._entityToPointer.set(e,r);const l=e.get(je);l&&(this._graphics.push(l),this._graphicsHashGrid.track(l)),this._sortedTransforms.push(s),this._sortedEntities.push(s.owner),s.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{this._pointerEventDispatcher.removeObject(e);const s=e.get(ot);this._entityToPointer.delete(e);const r=e.get(je);if(r){const h=this._graphics.indexOf(r);h>-1&&this._graphics.splice(h,1),this._graphicsHashGrid.untrack(r)}s.zIndexChanged$.unsubscribe(this._zIndexUpdate);const l=this._sortedTransforms.indexOf(s);l>-1&&(this._sortedTransforms.splice(l,1),this._sortedEntities.splice(l,1))})}initialize(t,e){this._engine=e.engine,this._scene=e}preupdate(){this._scene.camera.hasChanged()&&this._scene.camera.updateTransform(this._scene.camera.pos),this._receivers=[this._engine.input.pointers,this._scene.input.pointers],this._engineReceiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>e.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}update(){this._graphicsHashGrid.update(this._graphics);for(const[t,e]of this._engineReceiver.currentFramePointerCoords.entries()){const s=this._scene.physics.query(e.worldPos);for(let l=0;l<s.length;l++){const h=s[l],u=this._entityToPointer.get(h.owner);u&&(u.useColliderShape||this.overrideUseColliderShape)&&this._pointerEventDispatcher.addPointerToObject(h.owner,t)}const r=this._graphicsHashGrid.query(e.worldPos);for(let l=0;l<r.length;l++){const h=r[l],u=this._entityToPointer.get(h.owner);u&&(u.useGraphicsBounds||this.overrideUseGraphicsBounds)&&this._pointerEventDispatcher.addPointerToObject(h.owner,t)}}this._pointerEventDispatcher.processPointerToObject(this._engineReceiver,this._sortedEntities),this._pointerEventDispatcher.dispatchEvents(this._engineReceiver,this._sortedEntities),this._receivers.forEach(t=>t.update()),this._pointerEventDispatcher.clear(),this._receivers.forEach(t=>t.clear())}}Cf.priority=Hs.Higher;class YA extends Yi{constructor(t){super(),this.world=t,this.systemType=Vi.Update,this._actions=[],this.query=this.world.query([co]),this.query.entityAdded$.subscribe(e=>this._actions.push(e.get(co))),this.query.entityRemoved$.subscribe(e=>{const s=e.get(co),r=this._actions.indexOf(s);r>-1&&this._actions.splice(r,1)})}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}}YA.priority=Hs.Higher;class Sf{constructor(){this.events=new ae,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._enabled=!0}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}toggleEnabled(t){this._enabled=t}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(r=>typeof r!==void 0).length,s=t.buttons.filter(r=>typeof r!==void 0).length;return e>=this._minimumConfiguration.axis&&s>=this._minimumConfiguration.buttons&&t.connected}emit(t,e){this.events.emit(t,e)}on(t,e){return this._enableAndUpdate(),this.events.on(t,e)}once(t,e){return this._enableAndUpdate(),this.events.once(t,e)}off(t,e){this._enableAndUpdate(),this.events.off(t,e)}update(){var t,e;if(!this.enabled||!this.supported||!this._enabled)return;this.init();const s=this._navigator.getGamepads();for(let r=0;r<s.length;r++){if(s[r]){const h=this.at(r);!this.at(r).connected&&this._isGamepadValid(s[r])&&(h.events.pipe(this.events),this.events.emit("connect",new Wb(r,this.at(r)))),this.at(r).connected=!0}else{const h=this.at(r);h.connected&&(this.events.emit("disconnect",new Jb(r,h)),h.events.unpipe(this.events)),h.connected=!1;continue}if(this.at(r).update(),s[r].timestamp&&s[r].timestamp===this._gamePadTimeStamps[r])continue;this._gamePadTimeStamps[r]=s[r].timestamp,this.at(r).navigatorGamepad=s[r];const l=s[r];if(l){for(let h=0;h<l.buttons.length;h++){const u=l.buttons[h],f=u==null?void 0:u.value;f!==((t=this._oldPads[r])==null?void 0:t.getButton(h))&&(u!=null&&u.pressed?(this.at(r).updateButton(h,f),this.at(r).events.emit("button",new Kb(h in qA?h:-1,h,f,this.at(r)))):this.at(r).updateButton(h,0))}for(let h=0;h<l.axes.length;h++){const u=l.axes[h];u!==((e=this._oldPads[r])==null?void 0:e.getAxes(h))&&(this.at(r).updateAxes(h,u),this.at(r).events.emit("axis",new $b(h,u,this.at(r))))}}this._oldPads[r]=this._clonePad(s[r])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,s=t;e<s;e++)this._pads.push(new pd),this._oldPads.push(new pd);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let s=0,r=t.length;s<r;s++)e.push(this._clonePad(t[s]));return e}_clonePad(t){let e,s;const r=new pd;if(!t)return r;for(e=0,s=t.buttons.length;e<s;e++)t.buttons[e]&&r.updateButton(e,t.buttons[e].value);for(e=0,s=t.axes.length;e<s;e++)r.updateAxes(e,t.axes[e]);return r}}Sf.MinAxisMoveThreshold=.05;class pd{constructor(){this.events=new ae,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,e=1){return this._buttons[t]>=e}isButtonHeld(t,e=1){return this._buttons[t]>=e}wasButtonPressed(t,e=1){return this._buttonsDown[t]>=e}wasButtonReleased(t){return!!this._buttonsUp[t]}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Sf.MinAxisMoveThreshold?0:e}updateButton(t,e){e===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=e,this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}var qA=(o=>(o[o.Unknown=-1]="Unknown",o[o.Face1=0]="Face1",o[o.Face2=1]="Face2",o[o.Face3=2]="Face3",o[o.Face4=3]="Face4",o[o.LeftBumper=4]="LeftBumper",o[o.RightBumper=5]="RightBumper",o[o.LeftTrigger=6]="LeftTrigger",o[o.RightTrigger=7]="RightTrigger",o[o.Select=8]="Select",o[o.Start=9]="Start",o[o.LeftStick=10]="LeftStick",o[o.RightStick=11]="RightStick",o[o.DpadUp=12]="DpadUp",o[o.DpadDown=13]="DpadDown",o[o.DpadLeft=14]="DpadLeft",o[o.DpadRight=15]="DpadRight",o[o.CenterButton=16]="CenterButton",o[o.MiscButton1=17]="MiscButton1",o))(qA||{});class mS{constructor(t){this.inputs=t,this._handlers=new Map}execute(){for(const[t,e]of this._handlers.entries()){const s=t(this.inputs);s&&e(s)}}on(t,e){this._handlers.set(t,e)}}function XA(){try{const o=()=>{};window.top.addEventListener("blur",o),window.top.removeEventListener("blur",o)}catch{return!0}return!1}function ZA(){return window!==window.top}function WA(){let o;return XA()?(o=window,vt.getInstance().warnOnce("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):ZA()?(o=window,vt.getInstance().warnOnce("Excalibur might be in a iframe, in order to receive keyboard events it must be in focus")):o=window.top,o}var Xt=(o=>(o.Backquote="Backquote",o.Backslash="Backslash",o.BracketLeft="BracketLeft",o.BracketRight="BracketRight",o.Comma="Comma",o.Key0="Digit0",o.Key1="Digit1",o.Key2="Digit2",o.Key3="Digit3",o.Key4="Digit4",o.Key5="Digit5",o.Key6="Digit6",o.Key7="Digit7",o.Key8="Digit8",o.Key9="Digit9",o.Digit0="Digit0",o.Digit1="Digit1",o.Digit2="Digit2",o.Digit3="Digit3",o.Digit4="Digit4",o.Digit5="Digit5",o.Digit6="Digit6",o.Digit7="Digit7",o.Digit8="Digit8",o.Digit9="Digit9",o.Equal="Equal",o.IntlBackslash="IntlBackslash",o.IntlRo="IntlRo",o.IntlYen="IntlYen",o.A="KeyA",o.B="KeyB",o.C="KeyC",o.D="KeyD",o.E="KeyE",o.F="KeyF",o.G="KeyG",o.H="KeyH",o.I="KeyI",o.J="KeyJ",o.K="KeyK",o.L="KeyL",o.M="KeyM",o.N="KeyN",o.O="KeyO",o.P="KeyP",o.Q="KeyQ",o.R="KeyR",o.S="KeyS",o.T="KeyT",o.U="KeyU",o.V="KeyV",o.W="KeyW",o.X="KeyX",o.Y="KeyY",o.Z="KeyZ",o.KeyA="KeyA",o.KeyB="KeyB",o.KeyC="KeyC",o.KeyD="KeyD",o.KeyE="KeyE",o.KeyF="KeyF",o.KeyG="KeyG",o.KeyH="KeyH",o.KeyI="KeyI",o.KeyJ="KeyJ",o.KeyK="KeyK",o.KeyL="KeyL",o.KeyM="KeyM",o.KeyN="KeyN",o.KeyO="KeyO",o.KeyP="KeyP",o.KeyQ="KeyQ",o.KeyR="KeyR",o.KeyS="KeyS",o.KeyT="KeyT",o.KeyU="KeyU",o.KeyV="KeyV",o.KeyW="KeyW",o.KeyX="KeyX",o.KeyY="KeyY",o.KeyZ="KeyZ",o.Minus="Minus",o.Period="Period",o.Quote="Quote",o.Semicolon="Semicolon",o.Slash="Slash",o.AltLeft="AltLeft",o.AltRight="AltRight",o.Alt="Alt",o.AltGraph="AltGraph",o.Backspace="Backspace",o.CapsLock="CapsLock",o.ContextMenu="ContextMenu",o.ControlLeft="ControlLeft",o.ControlRight="ControlRight",o.Enter="Enter",o.MetaLeft="MetaLeft",o.MetaRight="MetaRight",o.ShiftLeft="ShiftLeft",o.ShiftRight="ShiftRight",o.Space="Space",o.Tab="Tab",o.Convert="Convert",o.KanaMode="KanaMode",o.NonConvert="NonConvert",o.Delete="Delete",o.End="End",o.Help="Help",o.Home="Home",o.Insert="Insert",o.PageDown="PageDown",o.PageUp="PageUp",o.Up="ArrowUp",o.Down="ArrowDown",o.Left="ArrowLeft",o.Right="ArrowRight",o.ArrowUp="ArrowUp",o.ArrowDown="ArrowDown",o.ArrowLeft="ArrowLeft",o.ArrowRight="ArrowRight",o.NumLock="NumLock",o.Numpad0="Numpad0",o.Numpad1="Numpad1",o.Numpad2="Numpad2",o.Numpad3="Numpad3",o.Numpad4="Numpad4",o.Numpad5="Numpad5",o.Numpad6="Numpad6",o.Numpad7="Numpad7",o.Numpad8="Numpad8",o.Numpad9="Numpad9",o.Num0="Numpad0",o.Num1="Numpad1",o.Num2="Numpad2",o.Num3="Numpad3",o.Num4="Numpad4",o.Num5="Numpad5",o.Num6="Numpad6",o.Num7="Numpad7",o.Num8="Numpad8",o.Num9="Numpad9",o.NumAdd="NumpadAdd",o.NumpadAdd="NumpadAdd",o.NumDecimal="NumpadDecimal",o.NumpadDecimal="NumpadDecimal",o.NumDivide="NumpadDivide",o.NumpadDivide="NumpadDivide",o.NumEnter="NumpadEnter",o.NumpadEnter="NumpadEnter",o.NumMultiply="NumpadMultiply",o.NumpadMultiply="NumpadMultiply",o.NumSubtract="NumpadSubtract",o.NumpadSubtract="NumpadSubtract",o.Esc="Escape",o.Escape="Escape",o.F1="F1",o.F2="F2",o.F3="F3",o.F4="F4",o.F5="F5",o.F6="F6",o.F7="F7",o.F8="F8",o.F9="F9",o.F10="F10",o.F11="F11",o.F12="F12",o.F13="F13",o.F14="F14",o.F15="F15",o.F16="F16",o.F17="F17",o.F18="F18",o.F19="F19",o.F20="F20",o.PrintScreen="PrintScreen",o.ScrollLock="ScrollLock",o.Pause="Pause",o.Unidentified="Unidentified",o))(Xt||{});class Jl extends Rt{constructor(t,e,s){super(),this.key=t,this.value=e,this.originalEvent=s}}class _S{constructor(){this.events=new ae,this._enabled=!0,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=t=>{for(const e of this._keys){const s=new Jl(e,t.key,t);this.events.emit("up",s),this.events.emit("release",s)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=t=>{if(!this._enabled)return;!t.metaKey&&(this._keys.includes("MetaLeft")||this._keys.includes("MetaRight"))&&this._releaseAllKeys(t);const e=t.code;if(this._keys.indexOf(e)===-1){this._keys.push(e),this._keysDown.push(e);const s=new Jl(e,t.key,t);this.events.emit("down",s),this.events.emit("press",s)}},this._handleKeyUp=t=>{if(!this._enabled)return;const e=t.code,s=this._keys.indexOf(e);this._keys.splice(s,1),this._keysUp.push(e);const r=new Jl(e,t.key,t);this.events.emit("up",r),this.events.emit("release",r),t.key==="Meta"&&this._releaseAllKeys(t)}}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}init(t){let{global:e}=t;const{grabWindowFocus:s}=t;e?typeof e=="function"&&(e=e()):e=WA(),s&&e.focus(),e.addEventListener("blur",()=>{this._keys.length=0}),e.addEventListener("keyup",this._handleKeyUp),e.addEventListener("keydown",this._handleKeyDown)}toggleEnabled(t){this._enabled=t}clear(){this._keysDown.length=0,this._keysUp.length=0,this._keys.length=0}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.events.emit("hold",new Jl(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._enabled?this._keysDown.indexOf(t)>-1:!1}isHeld(t){return this._enabled?this._keys.indexOf(t)>-1:!1}wasReleased(t){return this._enabled?this._keysUp.indexOf(t)>-1:!1}triggerEvent(t,e,s){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:s??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:s??null}))}}class Kl{constructor(t,e,s,r,l,h){this.type=t,this.pointerId=e,this.button=s,this.pointerType=r,this.coordinates=l,this.nativeEvent=h,this.active=!0}cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}}class AS{constructor(t,e,s,r,l,h,u,f,g,m,A,y){this.x=t,this.y=e,this.pageX=s,this.pageY=r,this.screenX=l,this.screenY=h,this.index=u,this.deltaX=f,this.deltaY=g,this.deltaZ=m,this.deltaMode=A,this.ev=y,this.active=!0}cancel(){this.active=!1}}class m0{constructor(){this.events=new ae,this.lastPagePos=z.Zero,this.lastScreenPos=z.Zero,this.lastWorldPos=z.Zero,this._onPointerMove=t=>{this.lastPagePos=new z(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new z(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new z(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new z(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new z(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new z(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_updateWorldPosition(t){const e=_o.fromPagePosition(this.lastPagePos,t);this.lastScreenPos=e.screenPos,this.lastWorldPos=e.worldPos}}var rc=(o=>(o.Pixel="Pixel",o.Line="Line",o.Page="Page",o))(rc||{}),qr=(o=>(o[o.NoButton=-1]="NoButton",o[o.Left=0]="Left",o[o.Middle=1]="Middle",o[o.Right=2]="Right",o[o.Unknown=3]="Unknown",o))(qr||{}),Yn=(o=>(o.Left="Left",o.Middle="Middle",o.Right="Right",o.Unknown="Unknown",o.NoButton="NoButton",o))(Yn||{}),qn=(o=>(o.Touch="Touch",o.Mouse="Mouse",o.Pen="Pen",o.Unknown="Unknown",o))(qn||{});function yS(o){return globalThis.TouchEvent&&o instanceof globalThis.TouchEvent}function vS(o){return globalThis.PointerEvent&&o instanceof globalThis.PointerEvent}class Tf{constructor(t,e){this.target=t,this.engine=e,this.events=new ae,this.primary=new m0,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._enabled=!0,this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}toggleEnabled(t){this._enabled=t}recreate(t,e){const s=new Tf(t,e);return s.primary=this.primary,s._pointers=this._pointers,s}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,s=t;e<s;e++)this._pointers.push(new m0);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return this._enabled&&(e=this.currentFramePointerDown.get(t))!=null?e:!1}wasDown(t){var e;return this._enabled&&(e=this.lastFramePointerDown.get(t))!=null?e:!1}isDragging(t){return this._enabled?this.isDown(t):!1}isDragStart(t){return this._enabled?this.isDown(t)&&!this.wasDown(t):!1}isDragEnd(t){return this._enabled?!this.isDown(t)&&this.wasDown(t):!1}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown){if(!t.active)continue;this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t)}for(const t of this.currentFrameUp){if(!t.active)continue;this.emit("up",t),this.at(t.pointerId).emit("up",t)}for(const t of this.currentFrameMove){if(!t.active)continue;this.emit("move",t),this.at(t.pointerId).emit("move",t)}for(const t of this.currentFrameCancel){if(!t.active)continue;this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t)}for(const t of this.currentFrameWheel)t.active&&(this.emit("pointerwheel",t),this.emit("wheel",t),this.primary.emit("pointerwheel",t),this.primary.emit("wheel",t));if(this.engine.currentScene.camera.hasChanged())for(const t of this._pointers)t._updateWorldPosition(this.engine)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[s,r]of e)r===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(s)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(t){var e;if(this.engine.isDisposed())return;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const s={passive:!(this.engine.pageScrollPreventionMode===so.All||this.engine.pageScrollPreventionMode===so.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,s):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,s):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,s),((e=t==null?void 0:t.grabWindowFocus)!=null?e:!0)&&(XA()||ZA())){const l=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",l):(this.target.addEventListener("touchstart",l),this.target.addEventListener("mousedown",l))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const s=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((r,l)=>r-l).findIndex(r=>r===t);return this._activeNativePointerIdsToNormalized.set(t,s),s}_handle(t){if(!this._enabled)return;t.preventDefault();const e=new Map;let s,r;if(yS(t)){s=Yn.Unknown,r=qn.Touch;for(let l=0;l<t.changedTouches.length;l++){const h=t.changedTouches[l],u=_o.fromPagePosition(h.pageX,h.pageY,this.engine),f=l+1,g=this._normalizePointerId(f);this.currentFramePointerCoords.set(g,u),e.set(g,u)}}else{s=this._nativeButtonToPointerButton(t.button),r=qn.Mouse;const l=_o.fromPagePosition(t.pageX,t.pageY,this.engine);let h=1;vS(t)&&(h=t.pointerId,r=this._stringToPointerType(t.pointerType));const u=this._normalizePointerId(h);this.currentFramePointerCoords.set(u,l),e.set(u,l)}for(const[l,h]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new Kl("down",l,s,r,h,t)),this.currentFramePointerDown.set(l,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new Kl("up",l,s,r,h,t)),this.currentFramePointerDown.set(l,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new Kl("move",l,s,r,h,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new Kl("cancel",l,s,r,h,t));break}}_handleWheel(t){if(!this._enabled)return;(this.engine.pageScrollPreventionMode===so.All||this.engine.pageScrollPreventionMode===so.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(I(t.pageX,t.pageY)),s=this.engine.screen.screenToWorldCoordinates(e),r=-1/40,l=t.deltaX||t.wheelDeltaX*r||0,h=t.deltaY||t.wheelDeltaY*r||t.wheelDelta*r||t.detail||0,u=t.deltaZ||0;let f=rc.Pixel;t.deltaMode&&(t.deltaMode===1?f=rc.Line:t.deltaMode===2&&(f=rc.Page));const g=new AS(s.x,s.y,t.pageX,t.pageY,e.x,e.y,0,l,h,u,f,t);this.currentFrameWheel.push(g)}triggerEvent(t,e){const s=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:s.x,clientY:s.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:s.x,clientY:s.y}));const r=this.engine.currentScene.world.get(Cf);r.preupdate(this.engine.currentScene,1),r.update(1)}_nativeButtonToPointerButton(t){switch(t){case qr.NoButton:return Yn.NoButton;case qr.Left:return Yn.Left;case qr.Middle:return Yn.Middle;case qr.Right:return Yn.Right;case qr.Unknown:return Yn.Unknown;default:return pw(t)}}_stringToPointerType(t){switch(t){case"touch":return qn.Touch;case"mouse":return qn.Mouse;case"pen":return qn.Pen;default:return qn.Unknown}}}class JA{constructor(t){this._enabled=!0;const{pointerTarget:e,grabWindowFocus:s,engine:r,global:l}=t;this.keyboard=new _S,this.pointers=new Tf(e,r),this.gamepads=new Sf,this.keyboard.init({global:l,grabWindowFocus:s}),this.pointers.init({grabWindowFocus:s}),this.gamepads.init(),this.inputMapper=new mS({keyboard:this.keyboard,pointers:this.pointers,gamepads:this.gamepads})}get enabled(){return this._enabled}toggleEnabled(t){this._enabled=t,this.keyboard.toggleEnabled(this._enabled),this.pointers.toggleEnabled(this._enabled),this.gamepads.toggleEnabled(this._enabled)}update(){this._enabled&&(this.inputMapper.execute(),this.keyboard.update(),this.gamepads.update())}clear(){this.keyboard.clear(),this.pointers.clear()}}function zs(o){var t,e;return!!(o!=null&&o.prototype)&&!!((e=(t=o==null?void 0:o.prototype)==null?void 0:t.constructor)!=null&&e.name)}class Qi{constructor(){this._logger=vt.getInstance(),this.events=new ae,this.camera=new pS,this.world=new vw(this),this.physics=new XC(xn()),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(YA),this.world.add(new xf(this.world,this.physics)),this.world.add(new bf(this.world,this.physics)),this.world.add(Cf),this.world.add(jA),this.world.add(CA),this.world.add(wA),this.world.add(VA)}get actors(){return this.world.entityManager.entities.filter(t=>t instanceof Bi)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof gS)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof aS)}get timers(){return this._timers}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}onPreLoad(t){}onTransition(t){}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}async _initialize(t){var e;if(!this.isInitialized){try{this.engine=t,this.physics.config=this.engine.physics,this.input=new JA({global:t.global,pointerTarget:t.pointerScope===po.Canvas?t.canvas:document,grabWindowFocus:t.grabWindowFocus,engine:t}),this.camera._initialize(t),this.world.systemManager.initialize(),await this.onInitialize(t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.events.emit("initialize",new Dc(t,this))}catch(s){throw this._logger.error(`Error during scene initialization for scene ${(e=t.director)==null?void 0:e.getSceneName(this)}!`),s}this._isInitialized=!0}}async _activate(t){var e,s;try{this._logger.debug("Scene.onActivate",this),this.input.toggleEnabled(!0),await this.onActivate(t)}catch(r){throw this._logger.error(`Error during scene activation for scene ${(s=(e=this.engine)==null?void 0:e.director)==null?void 0:s.getSceneName(this)}!`),r}}async _deactivate(t){return this._logger.debug("Scene.onDeactivate",this),this.input.toggleEnabled(!1),await this.onDeactivate(t)}_preupdate(t,e){this.emit("preupdate",new ia(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new sa(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new Tc(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new Ec(t,e,this)),this.onPostDraw(t,e)}update(t,e){var s;if(!this.isInitialized){this._logger.warnOnce(`Scene update called before initialize for scene ${(s=t.director)==null?void 0:s.getSceneName(this)}!`);return}this._preupdate(t,e);let r,l;for(r=0,l=this._cancelQueue.length;r<l;r++)this.removeTimer(this._cancelQueue[r]);this._cancelQueue.length=0;for(const h of this._timers)h.update(e);this.world.update(Vi.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e),this.input.update()}draw(t,e){var s;if(!this.isInitialized){this._logger.warnOnce("Scene draw called before initialize!");return}this._predraw(t,e),this.world.update(Vi.Draw,e),(s=this.engine)!=null&&s.isDebug&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new Yb(t,this)),this.emit("postdebugdraw",new qb(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),t instanceof fd){fw(this._timers,t)||this.addTimer(t);return}this.world.add(t),t.scene=this}transfer(t){let e;t instanceof Ns&&t.scene&&t.scene!==this&&(e=t.scene,t.scene.world.remove(t,!1)),t instanceof fd&&t.scene&&(e=t.scene,t.scene.removeTimer(t)),e==null||e.emit("entityremoved",{target:t}),this.add(t)}remove(t){this.emit("entityremoved",{target:t}),t instanceof Ns&&(t.isActive&&t.kill(),this.world.remove(t)),t instanceof fd&&this.removeTimer(t)}clear(t=!0){for(let e=this.entities.length-1;e>=0;e--)this.world.remove(this.entities[e],t);for(let e=this.timers.length-1;e>=0;e--)this.removeTimer(this.timers[e])}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return e!==-1&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const e=this.actors;for(let s=0;s<e.length;s++){const r=e[s];r instanceof ta&&t.stats.currFrame.actors.ui++,t.stats.currFrame.actors.alive++;for(let l=0;l<r.children.length;l++){const h=r.children[l];nS(h)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}}class xS{constructor(t){this._engine=t,this._colorBlindPostProcessor=new Zw(lo.Protanope)}correct(t){this._engine.graphicsContext instanceof Fs&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof Fs&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class bS{constructor(t){this.stats={currFrame:new vc,prevFrame:new vc},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!1,showName:!1},this.transform={showAll:!1,debugZIndex:1e7,showPosition:!1,showPositionLabel:!1,positionColor:$.Yellow,showZIndex:!1,showScale:!1,scaleColor:$.Green,showRotation:!1,rotationColor:$.Blue},this.graphics={showAll:!1,showBounds:!1,boundsColor:$.Yellow},this.collider={showAll:!1,showBounds:!1,boundsColor:$.Blue,showOwner:!1,showGeometry:!0,geometryColor:$.Green,geometryLineWidth:1,geometryPointSize:.5},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:$.Cyan,showCollisionContacts:!0,contactSize:2,collisionContactColor:$.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:$.Yellow,showAcceleration:!1,accelerationColor:$.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:$.Red,showZoom:!1},this.tilemap={showAll:!1,showGrid:!1,gridColor:$.Red,gridWidth:.5,showSolidBounds:!1,solidBoundsColor:$.fromHex("#8080807F"),showColliderGeometry:!0},this.isometric={showAll:!1,showPosition:!1,positionColor:$.Yellow,positionSize:1,showGrid:!1,gridColor:$.Red,gridWidth:1,showColliderGeometry:!0},this._engine=t,this.colorBlindMode=new xS(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const s=t.toTestClock();return e&&s.start(),this._engine.clock=s,s}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const s=t.toStandardClock();return e&&s.start(),this._engine.clock=s,s}}class vc{constructor(){this._id=0,this._elapsedMs=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Ef,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.elapsedMs=t.elapsedMs,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.elapsedMs=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new vc;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get elapsedMs(){return this._elapsedMs}set elapsedMs(t){this._elapsedMs=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Ef{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Ef;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}class _0{constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}}class wS{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new _0(this._windowGlobal),this._documentComponent=new _0(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class CS{constructor(t){this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0;var e;this._fps=t.initialFps,this._samplePeriod=(e=t.samplePeriod)!=null?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class KA{constructor(t){this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._nextScheduleId=0;var e,s,r;this._options=t,this.tick=t.tick,this._lastTime=(e=this.now())!=null?e:0,this._maxFps=(s=t.maxFps)!=null?s:this._maxFps,this._onFatalException=(r=t.onFatalException)!=null?r:this._onFatalException,this.fpsSampler=new CS({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new SS({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new $A({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0,s="preframe"){const r=this._totalElapsed+e,l=this._nextScheduleId++;return this._scheduledCbs.push([l,t,r,s]),l}clearSchedule(t){const e=this._scheduledCbs.findIndex(([s])=>s===t);e!==-1&&this._scheduledCbs.splice(e,1)}__runScheduledCbs(t="preframe"){for(let e=this._scheduledCbs.length-1;e>-1;e--){const[s,r,l,h]=this._scheduledCbs[e];t===h&&l<=this._totalElapsed&&(r(this._elapsed),this._scheduledCbs.splice(e,1))}}update(t){try{this.fpsSampler.start();const e=this.now();let s=e-this._lastTime||1;const r=1e3/this._maxFps;if(s>=r){let l=0;r!==0&&(l=s%r,s=s-l),s>200&&(s=1),this._elapsed=t||s,this._totalElapsed+=this._elapsed,this.__runScheduledCbs("preframe"),this.tick(t||s),this.__runScheduledCbs("postframe"),r!==0?this._lastTime=e-l:this._lastTime=e,this.fpsSampler.end()}}catch(e){this._onFatalException(e),this.stop()}}}class $A extends KA{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(e){throw window.cancelAnimationFrame(this._requestId),e}};t()}stop(){window.cancelAnimationFrame(this._requestId),this._running=!1}}class SS extends KA{constructor(t){super({...t}),this._logger=vt.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!=null?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=t??this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let s=0;s<t;s++)this.step(e??this._updateMs)}}const TS=`#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;

  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}

.ex-toast-message button {
  align-self: flex-start;
}
`;class ES{constructor(){this._toasterCss=TS,this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const e=document.createElement("span");return e.innerText=t,e}toast(t,e,s){this._initialize();const r=document.createElement("div");r.className="ex-toast-message";const l=t.split("[LINK]").map(m=>this._createFragment(m));if(e){const m=document.createElement("a");m.href=e,s?m.innerText=s:m.innerText=e,l.splice(1,0,m)}const h=document.createElement("div");l.forEach(m=>{h.appendChild(m)}),r.appendChild(h);const u=document.createElement("button");u.innerText="x",u.addEventListener("click",()=>{this._container.removeChild(r)}),r.appendChild(u);const f=m=>{if(m.key==="Escape")try{this._container.removeChild(r)}catch{}document.removeEventListener("keydown",f)};document.addEventListener("keydown",f);const g=this._container.firstChild;this._container.insertBefore(r,g)}}class DS{constructor(t,e){this._engine=t,this.events=new ae,this._logger=vt.getInstance(),this._initialized=!1,this.scenes={},this._sceneToInstance=new Map,this._sceneToLoader=new Map,this._sceneToTransition=new Map,this._loadedScenes=new Set,this._isTransitioning=!1,this.rootScene=this.currentScene=new Qi,this.add("root",this.rootScene),this.currentScene=this.rootScene,this.currentSceneName="root";for(const s in e){const r=e[s];this.add(s,r),s==="root"&&(this.rootScene=this.getSceneInstance("root"),this.currentScene=this.rootScene)}}get isTransitioning(){return this._isTransitioning}async onInitialize(){if(!this._initialized)if(this._initialized=!0,this._deferredGoto){const t=this._deferredGoto;this._deferredGoto=void 0;const e=this._deferredTransition;this._deferredTransition=void 0;const s=this.getSceneInstance(t);s&&e&&e._addToTargetScene(this._engine,s);const r=this._getInTransition(t),l=r==null?void 0:r.hideLoader;this.maybeLoadScene(t,l),await this.swapScene(t),s&&e&&await this.playTransition(e,s)}else await this.swapScene("root")}get isInitialized(){return this._initialized}configureStart(t,e){var s,r;const l=e==null?void 0:e.loader;l instanceof Ac?this.mainLoader=l:d0(l)?this.mainLoader=new l:this.mainLoader=new yc;let h;if(e!=null&&e.inTransition){const{inTransition:f}=e;h=f}this.startScene=t;const u=(r=(s=e==null?void 0:e.inTransition)==null?void 0:s.hideLoader)!=null?r:!1;if(this.maybeLoadScene(t,u),h){const f=this.getSceneInstance(t);f&&(h._addToTargetScene(this._engine,f),this.swapScene(t).then(()=>(f.onTransition("in"),this.playTransition(h,f))))}else this.swapScene(t);this.currentSceneName=this.startScene}_getLoader(t){return this._sceneToLoader.get(t)}_getInTransition(t){var e;const s=this.scenes[t];if(!(s instanceof Qi||zs(s)))return(e=s==null?void 0:s.transitions)==null?void 0:e.in}_getOutTransition(t){var e;const s=this.scenes[t];if(!(s instanceof Qi||zs(s)))return(e=s==null?void 0:s.transitions)==null?void 0:e.out}getDeferredScene(){const t=this.getSceneDefinition(this._deferredGoto);return this._deferredGoto&&t?t:null}getSceneDefinition(t){const e=this.scenes[t];if(e instanceof Qi||zs(e))return e;if(e)return e.scene}getSceneName(t){for(const[e,s]of Object.entries(this.scenes))if(s instanceof Qi){if(t===s)return e}else if(!zs(s)&&t===s.scene)return e;for(const[e,s]of Object.entries(this.scenes))if(zs(s)){if(t.constructor===s)return e}else if(!(s instanceof Qi)&&t.constructor===s.scene)return e;return null}assertAdded(t){return this}assertRemoved(t){return this}add(t,e){if(!(e instanceof Qi)&&!zs(e)){const{loader:s,transitions:r}=e,{in:l,out:h}=r??{};this._sceneToTransition.set(t,{in:l,out:h}),d0(s)?this._sceneToLoader.set(t,new s):s&&this._sceneToLoader.set(t,s)}return this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,this.assertAdded(t)}remove(t){if(t instanceof Qi||zs(t)){const e=t;for(const s in this.scenes)if(this.scenes.hasOwnProperty(s)){const r=this.scenes[s];let l;if(r instanceof Qi||zs(r)?l=r:l=r.scene,l===e){if(s===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${s}`);this._sceneToInstance.delete(s),this._sceneToTransition.delete(s),this._sceneToLoader.delete(s),delete this.scenes[s]}}}if(typeof t=="string"){if(t===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${t}`);this._sceneToInstance.delete(t),this._sceneToTransition.delete(t),this._sceneToLoader.delete(t),delete this.scenes[t]}}async goToScene(t,e){var s,r,l,h,u,f;const g=this.getSceneInstance(t);if(!g){this._logger.warn(`Scene ${t} does not exist! Check the name, are you sure you added it?`);return}const m=this.currentScene,A=this.currentSceneName,y=(r=(s=this._engine.input)==null?void 0:s.enabled)!=null?r:!0;this._isTransitioning=!0;const x=(l=this.getSceneInstance(A))==null?void 0:l.onTransition("out"),E=g==null?void 0:g.onTransition("in");e={sourceOut:(h=this._getOutTransition(this.currentSceneName))!=null?h:x,destinationIn:(u=this._getInTransition(t))!=null?u:E,...e};const{sourceOut:C,destinationIn:L,sceneActivationData:D}=e,R=C??this._getOutTransition(this.currentSceneName),P=L??this._getInTransition(t),F=(R==null?void 0:R.hideLoader)||(P==null?void 0:P.hideLoader);F&&this.maybeLoadScene(t,F),this._emitEvent("navigationstart",A,t),R&&await this.playTransition(R,m),await this.maybeLoadScene(t,F),P&&await P.onPreviousSceneDeactivate(this.currentScene),P&&P._addToTargetScene(this._engine,g),await this.swapScene(t,D),this._emitEvent("navigation",A,t),P&&await this.playTransition(P,g),this._emitEvent("navigationend",A,t),(f=this._engine.input)==null||f.toggleEnabled(y),this._isTransitioning=!1}getSceneInstance(t){const e=this.getSceneDefinition(t);if(!e)return;if(this._sceneToInstance.has(t))return this._sceneToInstance.get(t);if(e instanceof Qi)return this._sceneToInstance.set(t,e),e;const s=new e;return this._sceneToInstance.set(t,s),s}async maybeLoadScene(t,e=!1){var s;const r=(s=this._getLoader(t))!=null?s:new Ac,l=this.getSceneDefinition(t),h=this.getSceneInstance(t);l&&h&&!this._loadedScenes.has(h)&&(h.onPreLoad(r),h.events.emit("preload",{loader:r}),e?this._engine.load(r,e):await this._engine.load(r),this._loadedScenes.add(h))}async playTransition(t,e){var s,r,l,h,u,f,g;if(!this.isInitialized){this._deferredTransition=t;return}if(t){this.currentTransition=t;const m=(r=(s=e.input)==null?void 0:s.enabled)!=null?r:!0;(l=e.input)==null||l.toggleEnabled(!t.blockInput),(h=this._engine.input)==null||h.toggleEnabled(!t.blockInput),e.events.emit("transitionstart",t),this.currentTransition._addToTargetScene(this._engine,e),await this.currentTransition._play(),e.events.emit("transitionend",t),(u=e.input)==null||u.toggleEnabled(m)}(f=this.currentTransition)==null||f.kill(),(g=this.currentTransition)==null||g.reset(),this.currentTransition=void 0}async swapScene(t,e){const s=this._engine;if(!this.isInitialized){this._deferredGoto=t;return}const r=this.getSceneInstance(t);if(r){const l=this.currentScene,h=r;let u;if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const m={engine:s,previousScene:l,nextScene:h};u=await this.currentScene._deactivate(m),this.currentScene.events.emit("deactivate",new sw(m,this.currentScene)),this.currentScene.input.clear()}const f=this._sceneToLoader.get(t);await(f==null?void 0:f.areResourcesLoaded()),this.currentScene=h,this.currentSceneName=t,s.screen.setCurrentCamera(h.camera),await this.currentScene._initialize(s);const g={engine:s,previousScene:l,previousSceneData:u,nextScene:h,data:e};await this.currentScene._activate(g),this.currentScene.events.emit("activate",new iw(g,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}_emitEvent(t,e,s){const r=this.getSceneDefinition(e),l=this.getSceneDefinition(s);this.events.emit(t,{sourceScene:r,sourceName:e,destinationScene:l,destinationName:s})}}function RS(){const o={scope:(t,e)=>{const s=o.value;o.value=t;try{return e()}catch(r){throw r}finally{o.value=s}},value:void 0};return o}function MS(o){return o.value}const A0={textureCollectInterval:6e4};class PS{constructor(t){this.options=t,this._running=!1,this._collectionMap=new Map,this._collectors=new Map,this.collectStaleResources=e=>{if(this._running){for(const[s,[r,l]]of this._collectors.entries()){const h=this.options.getTimestamp();for(const[u,[f,g]]of this._collectionMap.entries()){if(s!==f||g+l>=h)continue;r(u)&&this._collectionMap.delete(u)}}this._collectHandle=requestIdleCallback(this.collectStaleResources)}}}registerCollector(t,e,s){this._collectors.set(t,[s,e])}addCollectableResource(t,e){this._collectionMap.set(e,[t,this.options.getTimestamp()])}touch(t){const e=this._collectionMap.get(t);e&&this._collectionMap.set(t,[e[0],this.options.getTimestamp()])}forceCollectAll(){for(const[t,[e]]of this._collectors.entries())for(const[s]of this._collectionMap.entries())e(s)&&this._collectionMap.delete(s)}running(){return this._running}start(){this._running=!0,this.collectStaleResources()}stop(){this._running=!1,cancelIdleCallback(this._collectHandle)}}W0();var so=(o=>(o[o.None=0]="None",o[o.Canvas=1]="Canvas",o[o.All=2]="All",o))(so||{});const Oc=class An{constructor(t){this.scope=Y=>An.Context.scope(this,Y),this.version=y0,this.events=new ae,this.maxFps=Number.POSITIVE_INFINITY,this._inputEnabled=!0,this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=Y=>{vt.getInstance().fatal(Y,Y.stack)},this._toaster=new ES,this._timescale=1,this._isInitialized=!1,this._hasCreatedCanvas=!1,this._originalOptions={},this._handleWebGLContextLost=Y=>{var et;Y.preventDefault(),this.clock.stop(),this._logger.fatalOnce("WebGL Graphics Lost",Y);const k=document.createElement("div");k.id="ex-webgl-graphics-context-lost",k.style.position="absolute",k.style.zIndex="99",k.style.left="50%",k.style.top="50%",k.style.display="flex",k.style.flexDirection="column",k.style.transform="translate(-50%, -50%)",k.style.backgroundColor="white",k.style.padding="10px",k.style.borderStyle="solid 1px";const rt=document.createElement("div");if(rt.innerHTML=`
      <h1>There was an issue rendering, please refresh the page.</h1>
      <div>
        <p>WebGL Graphics Context Lost</p>

        <button id="ex-webgl-graphics-reload">Refresh Page</button>

        <p>There are a few reasons this might happen:</p>
        <ul>
          <li>Two or more pages are placing a high demand on the GPU</li>
          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>
          <li>The computer has multiple GPUs and the user has switched between them</li>
          <li>Graphics driver has crashed or restarted</li>
          <li>Graphics driver was updated</li>
        </ul>
      </div>
    `,k.appendChild(rt),(et=this.canvas)!=null&&et.parentElement){this.canvas.parentElement.appendChild(k);const gt=rt.querySelector("#ex-webgl-graphics-reload");gt==null||gt.addEventListener("click",()=>location.reload())}},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._disposed=!1,this._isLoading=!1,this._hideLoader=!1,this._isReadyFuture=new bn,this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[];var e,s,r,l,h,u,f,g,m;t={...An._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,ic.freeze(),this.browser=new wS(window,document);const A=new sS;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=A.test())){const Y=document.createElement("div");if(Y.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(Y),A.failedTests.forEach(function(et){const k=document.createElement("div");k.innerText="Browser feature missing "+et,document.body.appendChild(k)}),t.canvasElementId){const et=document.getElementById(t.canvasElementId);et&&et.parentElement.removeChild(et)}return}else this._compatible=!0;if(console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${y0})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=vt.getInstance(),this._logger.defaultLevel===cf.Debug&&A.logBrowserFeatures(),this._logger.debug("Building engine..."),t.garbageCollection===!0?this.garbageCollectorConfig={...A0}:t.garbageCollection===!1?(this._logger.warn("WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted"),this.garbageCollectorConfig=null):this.garbageCollectorConfig={...A0,...t.garbageCollection},this._garbageCollector=new PS({getTimestamp:Date.now}),this.canvasElementId=t.canvasElementId,t.canvasElementId){if(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),document.getElementById(t.canvasElementId)===null)throw new Error("Cannot find existing element in the DOM, please ensure element is created prior to engine creation.");this.canvas=document.getElementById(t.canvasElementId),this._hasCreatedCanvas=!1}else t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement,this._hasCreatedCanvas=!1):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"),this._hasCreatedCanvas=!0);this.canvas&&!t.enableCanvasContextMenu&&this.canvas.addEventListener("contextmenu",Y=>{Y.preventDefault()});let y=(e=t.displayMode)!=null?e:ho.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(y=ho.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),y=ho.FitScreen);const x=t.global&&typeof t.global=="function"?t.global():t.global;this.global=x??WA(),this.grabWindowFocus=t.grabWindowFocus,this.pointerScope=t.pointerScope,this._originalDisplayMode=y;let E,C,L,D,R,P;typeof t.antialiasing=="object"?{pixelArtSampler:E,nativeContextAntialiasing:L,multiSampleAntialiasing:P,filtering:R,canvasImageRendering:D}={...t.pixelArt?kw:Iw,...t.antialiasing}:(E=!!t.pixelArt,L=!1,P=t.antialiasing,D=t.antialiasing?"auto":"pixelated",R=t.antialiasing?ii.Blended:ii.Pixel),L&&P&&this._logger.warnOnce("Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing at the same time, they are incompatible settings. If you aren't sure use multiSampleAntialiasing"),t.pixelArt&&(C=.25),(!t.antialiasing||R===ii.Pixel)&&(C=0),C=(r=(s=t.uvPadding)!=null?s:C)!=null?r:.01;let F=ic.isEnabled("use-canvas-context");if(!F)try{this.graphicsContext=new Fs({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,pixelArtSampler:E,antialiasing:L,multiSampleAntialiasing:P,uvPadding:C,powerPreference:t.powerPreference,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting,garbageCollector:this.garbageCollectorConfig?{garbageCollector:this._garbageCollector,collectionInterval:this.garbageCollectorConfig.textureCollectInterval}:null,handleContextLost:(l=t.handleContextLost)!=null?l:this._handleWebGLContextLost,handleContextRestored:t.handleContextRestored})}catch(Y){this._logger.warn(`Excalibur could not load webgl for some reason (${Y.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/performance`),F=!0}F&&(this.graphicsContext=new zd({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:L,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new u0({canvas:this.canvas,context:this.graphicsContext,antialiasing:L,canvasImageRendering:D,browser:this.browser,viewport:(h=t.viewport)!=null?h:t.width&&t.height?{width:t.width,height:t.height}:h0.SVGA,resolution:t.resolution,displayMode:y,pixelRatio:t.suppressHiDPIScaling?1:(u=t.pixelRatio)!=null?u:null}),oo.filtering=R,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=(f=t.maxFps)!=null?f:this.maxFps,this.fixedUpdateTimestep=(g=t.fixedUpdateTimestep)!=null?g:this.fixedUpdateTimestep,this.fixedUpdateFps=(m=t.fixedUpdateFps)!=null?m:this.fixedUpdateFps,this.fixedUpdateTimestep=this.fixedUpdateTimestep||1e3/this.fixedUpdateFps,this.clock=new $A({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:Y=>this.onFatalException(Y)}),this.enableCanvasTransparency=t.enableCanvasTransparency,typeof t.physics=="boolean"?this.physics={...xn(),enabled:t.physics}:(this.physics={...xn()},Dd(this.physics,t.physics)),this.debug=new bS(this),this.director=new DS(this,t.scenes),this.director.events.pipe(this.events),this._initialize(t),window.___EXCALIBUR_DEVTOOL=this,An.InstanceCount++}static useEngine(){const t=MS(An.Context);if(!t)throw new Error("Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.");return t}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get currentScene(){return this.director.currentScene}get currentSceneName(){return this.director.currentSceneName}get rootScene(){return this.director.rootScene}get scenes(){return this.director.scenes}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:e,showPlayerMessage:s}=this._originalOptions.configurePerformanceCanvas2DFallback;if(e===void 0&&(e=An._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),s===void 0&&(s=An._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!ic.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===e.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let r=0;for(let h=0;h<this._fpsSamples.length;h++)r+=this._fpsSamples[h];const l=r/this._fpsSamples.length;this._fpsSamples.length===e.numberOfFrames&&l<=e.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),s&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,e,s;const r=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(r,this.canvas),this.canvas=r;const l={...this._originalOptions,antialiasing:this.screen.antialiasing},h=this._originalDisplayMode;this.graphicsContext=new zd({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:l.antialiasing,backgroundColor:l.backgroundColor,snapToPixel:l.snapToPixel,useDrawSorting:l.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new u0({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=l.antialiasing)!=null?t:!0,browser:this.browser,viewport:(e=l.viewport)!=null?e:l.width&&l.height?{width:l.width,height:l.height}:h0.SVGA,resolution:l.resolution,displayMode:h,pixelRatio:l.suppressHiDPIScaling?1:(s=l.pixelRatio)!=null?s:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const u=l&&l.pointerScope===po.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(u,this),this.input.pointers.init()}dispose(){this._disposed||(this._disposed=!0,this.stop(),this._garbageCollector.forceCollectAll(),this.input.toggleEnabled(!1),this._hasCreatedCanvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.screen.dispose(),this.graphicsContext.dispose(),this.graphicsContext=null,An.InstanceCount--)}isDisposed(){return this._disposed}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<0){vt.getInstance().warnOnce("engine.timescale to a value less than 0 are ignored");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){return this.director.add(t,e),this}removeScene(t){this.director.remove(t)}add(t){if(arguments.length===2){this.director.add(arguments[0],arguments[1]);return}const e=this.director.getDeferredScene();e instanceof Qi?e.add(t):this.currentScene.add(t)}remove(t){t instanceof Ns&&this.currentScene.remove(t),(t instanceof Qi||zs(t))&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}async goToScene(t,e){await this.scope(async()=>{await this.director.goToScene(t,e)})}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){var e,s;this.pageScrollPreventionMode=t.scrollPreventionMode;const r=t&&t.pointerScope===po.Document?document:this.canvas,l=(s=(e=this._originalOptions)==null?void 0:e.grabWindowFocus)!=null?s:!0;this.input=new JA({global:this.global,pointerTarget:r,grabWindowFocus:l,engine:this}),this.inputMapper=this.input.inputMapper,this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new ew(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new tw(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}toggleInputEnabled(t){this._inputEnabled=t,this.input.toggleEnabled(this._inputEnabled)}onInitialize(t){}get isInitialized(){return this._isInitialized}async _overrideInitialize(t){this.isInitialized||(await this.director.onInitialize(),await this.onInitialize(t),this.events.emit("initialize",new Dc(t,this)),this._isInitialized=!0)}_update(t){var e;if(this._isLoading){(e=this._loader)==null||e.onUpdate(this,t),this.input.update();return}this.clock.__runScheduledCbs("preupdate"),this._preupdate(t),this.currentScene.update(this,t),this.graphicsContext.updatePostProcessors(t),this.clock.__runScheduledCbs("postupdate"),this._postupdate(t),this.input.update()}_preupdate(t){this.emit("preupdate",new ia(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new sa(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){var e,s;if(this.graphicsContext.backgroundColor=(e=this.currentScene.backgroundColor)!=null?e:this.backgroundColor,this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this.clock.__runScheduledCbs("predraw"),this._predraw(this.graphicsContext,t),this._isLoading){this._hideLoader||((s=this._loader)==null||s.canvas.draw(this.graphicsContext,0,0),this.clock.__runScheduledCbs("postdraw"),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle());return}this.currentScene.draw(this.graphicsContext,t),this.clock.__runScheduledCbs("postdraw"),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new Tc(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new Ec(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return!this._isLoading}get ready(){return this._isReadyFuture.isCompleted}isReady(){return this._isReadyFuture.promise}async start(t,e){await this.scope(async()=>{if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");this._isLoading=!0;let s;return t instanceof Ac?s=t:typeof t=="string"&&(this.director.configureStart(t,e),s=this.director.mainLoader),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this.garbageCollectorConfig&&this._garbageCollector.start(),this._logger.debug("Game clock started"),await this.load(s??new yc),await this._overrideInitialize(this),this._isReadyFuture.resolve(),this.emit("start",new Gb(this)),this._isReadyFuture.promise})}_mainloop(t){this.scope(()=>{this.emit("preframe",new Xb(this,this.stats.prevFrame));const e=t*this.timescale;this.currentFrameElapsedMs=e;const s=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=s,this.stats.currFrame.elapsedMs=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,Se.clear();const r=this.clock.now(),l=this.fixedUpdateTimestep;if(this.fixedUpdateTimestep)for(this._lagMs+=e;this._lagMs>=l;)this._update(l),this._lagMs-=l;else this._update(e);const h=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(e);const u=this.clock.now();this.stats.currFrame.duration.update=h-r,this.stats.currFrame.duration.draw=u-h,this.stats.currFrame.graphics.drawnImages=Se.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=Se.DrawCallCount,this.emit("postframe",new Zb(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()})}stop(){this.clock.isRunning()&&(this.emit("stop",new Qb(this)),this.browser.pause(),this.clock.stop(),this._garbageCollector.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(s=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:s})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,s=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,r=document.createElement("canvas");r.width=e,r.height=s;const l=r.getContext("2d");l.imageSmoothingEnabled=this.screen.antialiasing,l.drawImage(this.canvas,0,0,e,s);const h=new Image,u=r.toDataURL("image/png");h.onload=()=>{t.resolve(h)},h.src=u}this._screenShotRequests.length=0}async load(t,e=!1){await this.scope(async()=>{try{if(t.isLoaded())return;this._loader=t,this._isLoading=!0,this._hideLoader=e,t instanceof yc&&(t.suppressPlayButton=t.suppressPlayButton||this._suppressPlayButton),this._loader.onInitialize(this),await t.load()}catch(s){this._logger.error("Error loading resources, things may not behave properly",s),await Promise.resolve()}finally{this._isLoading=!1,this._hideLoader=!1,this._loader=null}})}};Oc.Context=RS();Oc.InstanceCount=0;Oc._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!1,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,enableCanvasContextMenu:!1,snapToPixel:!1,antialiasing:!0,pixelArt:!1,garbageCollection:!0,powerPreference:"high-performance",pointerScope:po.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:1,backgroundColor:$.fromHex("#2185d0")};let BS=Oc;const y0="0.31.0";W0();const IS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAUMCAYAAACN1eQpAAAAAXNSR0IArs4c6QAAHqhJREFUeJztnU1ys7wShY9vsRQNWAoDlsKApTDwUjRgKRpoKVRxB9BYyAI77xfUin2eqlR+bMdw0moJUjwAhBBCCCF/k5v2Blhr56ZpAABVVb3cHjc0s3xd9+Nl268aTBiK9x7ee7Rte7hNYSgxvx1S9Zu/7F+RUN4hDOAsqP+KejBbKON4+jw3NHNcFVcOpf9d9Ytf4RrMAB6hNA2MMVqb84RKMK7BbOy0BDKOSyAnFZOqlqvJPpSmaZox7t9W+kvd9087rxGKCtM0zZPFPE3TPE3TbLtunqZpds4lG+mVDbYYJIwwmGmaZtcgGYxmKGrNd2OsgMHBe48gnHn9UENnum4mbH2mmYD9GmYGADc0qPvzKfxKsgcj65ammXY/K2mqzs7WU5ybrbW7HmOtna21MoTCDxWK6DHGTjD3FgDgnFPeIAVk9pGqcQ12s5RU0dqEP3+aFiaLOQ7naeo+WM/kJuuK0hgzu8HD3wEMjyETNt+6rotY5WYPBgDcsD/F4O/L53rUP3EmqAQjOOfg2wqtX6rFe19MMFlnpfhkVF3XMHaCNe+dpMpJ7un6dnamLq4oTVTWMe+extREI5j96clCh1P2YNZDABKzLe7WVa8xZjbGFLOw02IGlpWvBFTaileL7ag5PEaSoLQ3TpN9MGs48q+Ur6QZ7NZPgPIr5dIleDPY5E6PfZt6Lsb++P/Wucm2IWFIqWCC5xURUJZ1TDPYeezb27s7fFRpOVH5y5wdE5luKKJiVP59YrpB420JIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEFIgoXBHe1uKYWchWq1EWtuibxxK8BMp6VWoS0hj3pWSXk0xFVOalLSIYH4qJc2B+lD6qZT0K0i5N0VKqr1taoReh9hsVkIwKj2mhB1/RRHN1xu3SEnXXuNb9daXn3jIhLoUEQaW4HtQqxjvPcZoSjbGLBrbbyRWSm7HR4FuUnsbAYWKMR2Avt4dC/m2ApoJxn5ptQCL1yGsjrhitLdPDZHrTBZbGOE6Rnv7hFxL7lneK+XbDHnnjjk5yNFjQnO8+nmWd7l6JRUPjRmLb3MO/L0Y1lsJlSRUv7JiUv1iGyZSOWEoJVXTlcHEveJ28lhRoQDX95hb8LER+jb7YPXbK5+cUifl27RdV8yqF8gwXR9p3mSaDhuu974Ymfqls9KZ+66ua0zTeg+UZiqux+Tk6fYdJfs2c658n5imR6WUMoSysQ6n5Icbmnm9udQMYC7BmKhFGMBTQBLSVwUU7uw7VfSTcKJgfwWVcd0Mdvb3/vBx0w0YsNz349Ud/666N61aw3tVESIiPdrxq2/WW+xMIKrb8GepofIV95AsiSxpx8NGKkF+XoK/N0ZFjQ08h1FySEXQDPZHU/VXrXmEs5CuDuTPlG10pP5ntpsQQgghhBBCCCGEEEIIIYQQQgghhBBCCLkaqiQTlKSSFIpQMQklqCSFYmRQpagkBfWKKU0lKagGU6JKUlAbSlRJHnCkkixJY5Cd0HkXqyXF96C9jSrsxICrqyoMqQTtm8pYds7N3ns0q1RH8N4DfQ0Me2+VxlX8arOSubeImy8A+M7uv7/f4YZhtl2XtYLUZiWRAfq2grETRpmuEdiH1qnbe599baMWjG8rmA5bKELb7i/Skkop5VDhUnYHjessZK0t4uBR0Gm+DWbfWRhjnobI2D/UBu39rrbQU2m+rTdosBiI4iPqZhiKOFZS6zF1b+CGGgDg74APpmiNZhujUqop36ZvK7TewHtfxHGSylCKZ5i6rmHsBGv8U2haqJ+PAfYVUwpawdxKX5doVkwRveSIIoZSSCnNVxXXYDbGzNvnbz5JFbC7WcPXn70L2ETqzjkJ5buDEQ/erloaFBVM9kOCWIgj03bfWKwn9IpQMmV98zON7fp48nUaIWV/w0DSdfYcrM/5jtMOKenfEdpDKWuPCXf21WkFbf1bsa5NQL9q1IjDke9F8/aVjrsjjsIihBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQUjIUkCYoUUAKFHTddUkCUqAQCWlpAlKgkIopTUAKFCAhTQlIS7gwXSUY59y8mVlXtv6yXmMsOtuvIeXY3ASkq0pSHnfOzbbrsssBgRJ6zFihae6LRXFwSyO+Lw/5+33rOR9vTjTGAGZ66CSbx3DCOpx8Z4G2AjoLv/afkqbyXye2f4gYUIZNuMCz1m62EBlqObc1+1Dy7aNIn6pgHGG8h+26WdSS3ns0w5C9YrIG471f5KNjBYzVtrPjOCZXvqKr9d5nV9dm7zFiYwUA0y4NVxqsBBSi4fIFNJqvfTTe5DoGuo5NNVINuEQVU/a/jDFmtvbZE1PXtUzLRVSLytG1MebJlBisVWYU4MhTWfmGbs0D1IeU/iHBSmkr2/wLvPd7iGrVFFMxpZE9mBNf71ZJzjk45w6e9qGEQkBjzBwGJSbF0tY0lyOq/aMFXWRR/B7CO+IEfs2Q7VSDygYGZF1IhTtcVVXqveNA1BZ6ud843PF3gjl77qVoTtc7G+uZvUzDbJblWOmFX3MWt+bZP9sigenlFZT1IPLVSW3TDYeP5bYo5g2mG4B7f/qcsW9vKVnpTwSmv4GatjbF17o1Q1IuTeojAxgGIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEfAr0bSYo0bdZ1AXpJfk2i3BtAuX5NoupmNJ8m6rBbM025dtUvihdLZjU7CP9xXQdjJ1wdtW+lmryUjafZuDcFAmghBF+Trk53TBsn6/YRr3m20yLF281nDUN4NtVsrk6N0O897veE3//26hcnBkPI3HjhWGEM5TpuqcQxn65GvcqNZxKMM65WXZ0EwaO1U5IOvb9dp22MWbz/AJ5pIHZh5K1dt6abFQFZ8Mlt0FRbVaSBZ2xE3xbwRu3C6UZhu15dd9nr+zsb2itfQyjg+W/MUbNsSmovLkcJCZnlb5GPX6hINAYM5t7iwbtc8X0NUyXe4sKwRjzWLzZx8e6whWZl/qKVvXouu73Q8mYcgyKpbo21SlKKRlVy3ceXceUMoSEYoIpDTXXZiw6RrSm0nZtZg8mJRiVvuMaYLLANE3J134sf8m1mbVi5PSCb6tks62q9eeDvrKWrs0D6Nos5A1TO3578TiawW7iQPnZ1c68LMG8cG1uO36kzdZQTV4aTOy48/f+aIV7e+XDkwDiqrlKNZk1GGAJJyZVEdRLEkIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCHkK6FrMwFdmy+gazMBXZsH0LWJ5wvTv961KYFgcIv3LiLl2sy5fdkJfZmuweycmzff5olr85XS4EoR6eUXZE7TtAkBdzPOOmSa5r79yK9fil5yGVqrUfGFWfG3XXlZZqUnQ+L9vu3UOHabS9Os1shw2g5fmVNEmld68eZObZXV14vFVcGseHnFVFV1i3UoIabbi+8klLZdr7uuKsjrw6F4tVlRRSkJ7KsnriRtnSSgsPI9CqQ0si/wwmpIWZ7R17k3KUn2kjXGzNZ4mA7wJjILra7NqtWXkGaHrs03oGszgq7NBHRt/pBShpBQTDClQdfmAXRtlgBdmwfQtXkAXZvH0LV5AF2bIVe5Nq8M59KDyFgpKSfAY+JqSJFybV4JXZsHZH3zVFBHhtWrrKvFcTQEcg0NQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIITmhXjJBKXrJYq+7fkcvabtudsNwSXBFBrPTSx4oJm3XzSLmuUL5VlQwclnxmV4yvCz5Su1BMcG4BrOxE5qmedJLAoBzbmvGxphN+uW9R3u///p1TUVcKOWcm42vdwJA3y5XJfrOAsASmDy2VsqVkq9iggEA4xc/lb8/Ll4PwwLyhFIMMkx2H+LhtIubU3rLmVPvo0iGchBOzu0qpvmmECmpv+cfOqryLufcthaRtctOIGgnjH0PmA7A/eC3XEMxzvAwIGHzbl4wHb9CtbOnDhJD9+8mIlVAtcccrVy1QwGUgzG+Tg4dc0/LMXKi+ldxDeYn5+Y3+zaBtHNTfJv4dtemEDo3S/FtqvaYF87N71RKBgeDRQpJNSvmVsKQOUL7WOlp5ik5rGyEM5MxJrQ/q998Sm1WWk5lup2M1Fpb1CJPhd2NYtYTUNbax7rmG//ZFt8JR05CHclJNdAYSnO13LYDwHLORbyb4c+x9JqvcW0CwcLNORefmTtUSgq5FHCqwSS24WUwZ/xmaCr3PknZ5JvBJq2K7/LblZQ1mE0GeO+TC7kz2WgsErx6SKmsY0w3ACfVEQYRf51pE/P3GHFoHnk3c28PIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEJIRujYT0LX5gndcm1dShPQiZufaVKLIijlzbeaimGBcs15rvRpZY9dmbooYSptrM2CzhfT9917c5Zx7WBKnabZdJ/ah78Vau7k0w3AkGNt18xUi41cU0WO2BtusRtaxgu/szqyYOxzVHmOtnZ9mnWZa1JJY+8yqmcy9ptHVvUWuzTCk2L2ZW0JaxFCSEHZV0ddomgbeexWpcTGuzbBCRJPt22pnCwn7zNVi0vJcm329NWFjFy22c26bmXKthItybQIAhkXPtNNMyvMzNuFiXJvhDu9kx6EI+b7IjnP4fdWCMcbMzi3VYZZbDCwK7Mfh0S1WMuVswkUcKx25NjUV+3RtHkDX5gF0bR6gvfKlazMFXZsJ6No8gK7NBHRtpvkTrk0NtgabqIz54CM7f861mcuVV4pr89YMdn7l2vxIc2JoSvSRa/Nd+2rI1SGpKCUB7EysZ/LRPFv1jMobn3k2U4+lnvdVhKHI181gZ/nQ27LCYTiEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBDyF6CANEEpAlJA/4L0JNoCUqAQG0hICQJSoKCKkZ5SgoAUKCCYTT4KoBQBKaAcTNxcm2G5BLAEAanaG0sood4tRC5S10LXambMMmzEsQksns22glhatbZNvcdsrOF44zb/HbCXAuY0tZYTDLANp2VmqtAMA5pmUbzZrstqalVbx7RtewuX/eM6C5l7u+jfZHg1E6YJs3jwckkCi1FKSr/xnd08m2FDNsbAdN2XmBMDba2wk5FGGlsgnxtPPRhgr40MP4ePAXmFgequTQwJ2aivUbXfJdXZYYx5OKnWDzGcaW+b6l8lDECEpGI4895/78o37CWxWlK7ajSDeZxmKJCiVr4lVY1WMLsdPhtSWpRSMcVNzSrBuAaYLEIZoPospM52A5jgxi8hq0t8+9DYRi1Od1oWfBJg7o3T5FQXeVZNn86pTzOoFDXPphbJYAJj2XdJSFPGxBCxJ479ofk566yV9c3e8djFHs7gtbvvrzYoZjvn2wx2Tu1MHJbpBuDE0ppLKam2qJJA3gnr6HlfBbWRhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQj4UujYT0LX5Aro2E9C1eQBdmwFbs6Vr80F4ffWRa9MNQ3aLovrldM65OeXaBFY3nvjx1mGlKSbNRuh52DxVwZX64depqrlSMak+lDaaCd64xZY4Vptv07fr12OPZhi2fhQqJt0w/Ho4RU3XxhjAPIaU937RSwIwHTZx4O5xxZnrMsQKsg0nqQZrF2PIOpxcg/TzLhxKRVWMIKJRMzhUVXUTpUqkbLq0CRehlATwNERy6iNT6Bqgfb19nfJsaqIWjDFm9vd0OOjrg1flQ61cQ8edNY/Zx9+B1ht1mZfmm+9cvrFrE9A1nakKAksUAwrlrHxBpeSOeBYqpXJ0zIlub30+6yVaVZO9ubkGs+mwHDCuyGIuJT42dlK/3UcW4tMK8ePGmDnUSn7Fv1Hig8bkcyKl5FcEgxeeTeBRUXLSKufGaXKqkwT2Z/UUtk+Np1CMMXNkMvsez2YzWNn5XSCJUIACPJtA5hNV4bFR4NZ8NRVLOJ/n2vyJ9E8kpYnzMp8XTEwc1Ni3t/hnscVVKix+/lWqyezBHMlIw8d/+js/3sN5FkrQwAkhhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYSQvwhdmwno2nzBV7s2Q7dUe79vl9WU4trMHkx4abG/358e37k2Fasm2wVQKQGXubeb727sH1e0bfIuY9RMiVneNAylaRr4tgKG1e3Q11s4wD6gcIh9JDLDbJrIQFHgnNupJMOPUFD6scRqgifpX+TaDL/W2N5s03VVVTfv/eLUbCv4zu6fELk2Q1vrWfVcZU/Muo6p6/pWVdWtHtO9zRizBBIrbFcpaTzkrhSRqi/wUgu5cRwPhYGp768QkWoKAk8f2xZ6ff0YfsbtXhcao397Wv8zrs2Uc+ZKH6dqMJPFHLqqpFKA6+2rr6Br8wC6Ng+ga/MAujYPUF/HhNC1GUDXZgBdmwno2jyArs0EdG0eQ9fmAXRtHkDXZghdmwnCHadrM4KuzTehazMBXZv/AF2bhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQ8olQMZlAUzGpfkH6O8glOq/MQr/pqyo+GDEPpfyb4VW5EogxBr8Rjppr8xWuwezxrJhMWYreraifUGTFuAazsdMSyDguOyxS0lW6E4dgum4L6DeMi8VVjHNuDi1EQFARXQeYHoh8VoC+uulyYsWk7brls8xQwWNnF7Z/FFszjUSArsGTq/PqbSmuxxhjHmpJYPm8mlzFDFK1y7WcV+kkgQKDAQK15FhtOhVjzE6XEuokrwqnCHam1lhfGwyv2OrqhuGSqiluVgIiS7QxiytvraBQiizP/VghcqparLXzUzOOBMlXblMRSctOxou2MTDNm3v70Gnj+nVLGcEE3qrQtyloLN6KmJVabyDezSfZhZJ3s4iKKdG7WUTFhLR+WcNIKFoUEcwre6KGJLCIYIDy1JLqwaxrFQBpsboWqsFM0zTHs04p4WgeEszeexi7GOSlatY1y+ceFL5g07mlfJrbsr9ZtHAa/1PSqJinnQxPJ8itPLz3wODgLrgZQ5GsU++hBDA+fflV/4E8C2c70rb4jtsIhTSDneNwRDkZ2FtVQ8naY3Z6yW4AIgkgsCzsAub1dcnfd6X/rghzojD27dlr5DlPlsUrAlKpGNmRnwr/5HVxEK9sjP9CMRUz9u3t7GAxdm1etGkbxbg236mej3dqxtChSQghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIZ8MXZsJ6Np8QUoneTVFqphCtlACyU4Oiq+YnWsz46XGRQYjIsCkazMTxQ2lM9dm3fffdSFXSMq1+XXXX8eI4i2WAsZuzStVkkJxPUYabKyVFCXc16gkhbBanj4CneTVKsni2PkzV41BPJx2q+BvG0rAswtcCKXqV/s1iwnmaPHmjYNvH/pa7z3a9gMvSD/COTfH4aSOkbbnrAu+q9Y2RSzwXIPZ+BoeLjmMngK73x+vHYb5inCKGEqxa3Ozyvt6sbKecNVRdxFDSWQXoWcTWFyb9TJibgB2N2uQqrmqCRcVjODc0nDFtfm1ElK6Nk+gazOCrs0EdG2moWszAV2bCejaTEHX5gl0bZ6QCAcoyLWZdakda9184No03XColGwGm92Bl+3NQjHgf3VtXrF9MWoHkQdaybPnx8+9dNtVFnixVlJC+sn/pq8Qj4YUcdrhJ0rJONCrwikiGOHI0xvrbr+Ko6qhoJQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEPJnoGszAV2bL6Brc2W7khZ0bQJYrqB1DWZjJxg7AdBzbRZTMYtbs9oCAbBViTEGfhyBb5OQhsKckGYYAKxV0zRZXZvqwVhrH9Ku1ZSIMSjkplk+f1OP2YUiNNOidhsr+LZ6aGszo3YpnQyf0GIWBiCzkfxstYRkQ30oAXsj4kZfo2kaeO+zh6KGeBtCsYWsbEO/5maCVkClYurewHQHdqG+3pqwTN1Hs9aVqA2lujebEHDHsHdrCjnkxiGqPSZlSxShzvY1Fhlgbrmx2spXJIB1b+CGGnhYEoHAlBgGZozJdjBZxCFB3YsOe993wtnIdt1civHsUkTKJYIu+UBCz6SBao/RtiOeoRaMhlj0JxSx8hW+ooe8ItVjsPaXnOd2j1CZlZazdHtnr7X2YX5+YX3+WHY3YVj1btba5djI6h0fqbI7cGywOe/Cg0ntbdQilo8e6iW/jZ2ZFc/BfG04TyG8EpN+BUchHLg31cgyXT+Zye79bjG3Pb53b26v0dC8ZXVtht/HAtIjtNx32d/0REB6ExNiLCz9SjEgIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEJICWS7qiO8MraqquKvJslypX6sO/kLlw9n+cuFwQBQM5X9hCyX/oUSUWMMPKDitiuOaZpmY8zshmE2xsy26+adq/dxYXoxZOkxVVXdhlUNOSQsq8ZOML6G6AxybFNpLBeiD8POgbfzPETuu9w2MyFb8xNP7xNjtfg1vYfxiwPPt9VmNsM4bpcit/f7B9pZB7e3roqFdQ3Few9/f35Z7ODMRbbpGlhnIgmneVRP6MEz9/ZRLetrxr7PWi1ARrHOztkbEK5v2na5vtoFCgOtVbKKcWhcHb3hEAm/LmHhl6XH7Dy97fPfokRpV5aKqarqFsrSzVhh9BbAI5S6roFlCKlXC5BxVvJt9XCCNw+1vlk/bNfJU4tY4GULph5x28IB0DTNZngWgiGnHk5eQeDgkrfrKDGcrLOSzDbGmNlau3usX1e44WzlvVfrOWra2rZt4ZwD/H2TBB6gEo6Ka/NMQLozQStSlIQUa2VIKNM0LVWlgEowq8HsiBuwhAJgsc5/C+GZu8DMuiPybqpP35eTulHDwVPDe7dld+RlH0rGTtsNX1402Jv3HlWVnDgvDyf7NPjDf7ztAohuGnPptmssnsKdffn+Yf/J6RnXDkYo4og6JLtScuzT2utmsE/6yNCymNuemOXNwh30kYA0eM7bvy9HSCoS0lBAKqREpLF3MyfZKiaUip49VzMMQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgrFdt3shqH466izXhMkgYj1o+77Yq9J+ufrrp1z2wXlrzS0cmF5yh1TKv+kSRENbbiTzrk5tpEdBVZ6tQD/OJSsXS/fW1W0ELFoX8PYRQkZfgYew+cv2J//mWmaZmmim4a263ZC0fDzX7Su/lOPqarq1q/VktLQAti8mfK5BOlfNlad7KNawkqZpnkbct9Iyssbfmhv37/yn+Vdvq1gxO3XJHy930osyZF1Tfi9PPevrHqBX1j5hsPFtxV8ZxeTfCj9u7fwW1n9jXXMfzYObeuSVTDaoN2J/pqmQajE/iva/V8RBG4LuVUw2sSPR4cBpVfLrxJLuRJ9JjSYFd9nfk0p2XoDe3CAWNd1aggV4+69FKmG2G8XVklQLdvs5Zoyq+dX/2Ii2nLOwbfVk1w0OhpfXrPei2DVuhVTQb/qwRPrWF0vR9nWJIfWbfNn9nW8KMwqAVQhNawQ7XDcnBMfn0kYzsmph10YUV/6XIwxLxttiWFc3uy223v4Rz/56LN4PyFe/IWPNYOdX5nONPjPf7mznRJ1m+0emn1Z6LX38fT3auve/vnNf/pXHprdvU1Svw+AfiDCr2zEuyEdeTbX0xSbQLCEcH5lKKV2JBVWHExw/wH1IGIu2SAJ6ygcCSTl11yfox5U1g141ahzbgshhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCPoO/Lvj7ryT9MRKI9x7fqoV8CkYkFZuvdxzFqflVHBqHJJR+HGGMwV8xHv4WL1VMtuvgvUfd9zm2pxiSF4Fvw+m+yHhFEWn8HRjcV7h5kxVT1/Ut3HnvPZphgOmWkGJzkBuG+dP60KEg8GmqHit44wDv4TsLjIvAwnbdLG7NT+I93dsaiohFgUWovmmWPiyUQ3bqJIudozfUXoup7NOGEXDSfI1frUAHVudxlakbY37SjCXAv9m8UxbnJ+vq6rb7wa/9U+K/lz1GpmqRb3nvN09427Y7h93J7T7m8Pf9BdLB9MswegrEexhfw3RA3T/vYNsu9ufQOI8/UiExyWDE5rz1GQANWqCv4e/pUEK899uNGjbhKPaSrj9JOCu5BssMlHD0hn5eGUrOuVleH8pFjTFFigCPSP71pmmaMVZLdYy4AZinaUo6eoVldWzffuPSnVTHwWDZ2XUqno0xhwLjEDGVxTsu1VJ6IKeEU3XgwjxVX4czE/Bzs2JpJI+VUsc+zWAx9i3quoZzE2y7vDSsHmm00zTNf93Amg7mfge67unn0kPa+wjvl6ElAWF4zD6+rbbhGLnA/8zK92kDbdfN4S067ia+/UIakYyG3t61R731vqWx28Dw9KX3fhfKuz5NABBNbSqUv7KW2TZQdrLzy8GhhPLOLBLOOHFYoXj0r4QCJEo63LH/MrVGv2c5l9MNf2a6zrKRiSr6E+EQQgghhBBCCCGEEEIIIYQQQgghhBBCCAGA/wPQ4OXCGtjIxgAAAABJRU5ErkJggg==",kS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAAgCAYAAADOmyyBAAABAGlDQ1BpY2MAABiVY2BgPMEABCwGDAy5eSVFQe5OChGRUQrsDxgYgRAMEpOLCxhwA6Cqb9cgai/r4lGHC3CmpBYnA+kPQKxSBLQcaKQIkC2SDmFrgNhJELYNiF1eUlACZAeA2EUhQc5AdgqQrZGOxE5CYicXFIHU9wDZNrk5pckIdzPwpOaFBgNpDiCWYShmCGJwZ3AC+R+iJH8RA4PFVwYG5gkIsaSZDAzbWxkYJG4hxFQWMDDwtzAwbDuPEEOESUFiUSJYiAWImdLSGBg+LWdg4I1kYBC+wMDAFQ0LCBxuUwC7zZ0hHwjTGXIYUoEingx5DMkMekCWEYMBgyGDGQCm1j8/yRb+6wAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH6QwKBDM3HA2FbAAACsxJREFUaN7tmn2MZ1dZxz/Pc869v5eZ+XVf2W67WsHUSLWsRRtMIDSSIIIvSSuSCGnU0EiC0RgRNFpf1tLWaGq00ZAgQRPiH5oYjVLollpKIIYgSldoSxuDLbtb+7Yv3Zn5/e7v3nOexz/u/c3s7Ous2+muzXwnN3Pv3HvPPef5Pu9nhEsNOeXaz/24omuuDbvUK7gsoBc/xCYuB2wS+SrBJpGvEsRLPYHzxcRNrA+bFrmJTVxOkIsf4oK+5LjOrrtv26Z7fRmw4a71DTe8gb1v3AuOt4QpEEFL/743/fBpU9Du5zQIr6Ta/b/DBhOpaDHkwIFHnTJAiFAOoDcHMuRtP/kzjlz6fOvVgI0lUpSbfuynHBlAmAMTyA1k5xfuvpcTegUXTKSccmwC2GgiNTIpF6Bc4LbfuQvmtkMY8IE77kQL4f77/nmTipcJGyvIOOR9d/65j8MQAMVIueEL+/9R5prjjKzh8X/9Muqn90tP66GebaabiRKw0Q0BNx647x9kHOZQU0xaTzoqA3PTCX2rwROb5ezF4/xEzixhJeO0dTzXwWp218dIsoi6YqLUdYI0ZRgCIZdskvjyYP0WKXB6zaer96S9N6PFANzoW4U4LZEoU6/RGNEmU1XV5U/jmVy6n0Oh14V21QGjD4TZsN3vDFTSfUG674m15ZufeVbnjpECH//kX2Ky+vHCDHUwIo5y78c+joshUlOYUeT22S9/7d8dQMoee7//ejEzVBUno26IBHLTcODrX1+zuFW8MvuM99xzz+pyRRDpOhfumBhlvyC5keuGlJ2iGOAZ1BqwjAtkHBHB3VlpeHT44sNfPCuRc/kEP/uW76WYvAi9jEsi4yzpAkd638Fy2MKn/vbveezAN5xmCjFA1aABXn/ddSIS+MZ/tvK7gBjZCtYBO0noLu3f1RRHWTR48sknHAIEcHMeOXDA9954o+RUEzOoA56RcHklre6+5ly9QaujzJEJBiIBz4skSlIYIgoFY9SmJ727KpssEfUx+bQSK3SyrDExdu7Z7YsOXgZcnelUkCqKx8jbb3mvP3bg99tXppP29V7Bo0/8l99www/JLNydnciTZKzeCR8waTsv4oAkAjW4EkypQ8mbb7nZH933B21Wk2uKXp9mWnHgP77qr997vZTZiSh1MNDLz7E2TUNRFPT7fR+FzFUs0a9ewJskTVNDKSzH7TxXfDdNNrZOv80wHV2jBDMshXne++63+TjMn6Ix2lGeWMoVDzx3jCPhSo42AsFYKIzdNJgHjqQBt97xZ3zqN3+lIyJiOYIab37HO/1r//YVwez8IepkEmcwsc4SDSShJIKDSo+qnOPWO/8YvACGNFOAPoQ+P37ze3ymO+qccfGXGqpKXdccO3aMg//zPOMwpOptIQyu8OH8gseIoxVmUxJOsW2Xhx3XeNz5Xacd/Z17/KlDhzl48ODa49DTHDz0NE8dOsyTh49RD68SW9gj81dfL7r1WpHhHiHOoxr5l/0PSDVJ/OK+P4LeNii28IHfuxsYkAcjkJbCs1tkJ2NhbX4TPLW3ZbbwQE6ZHkJQ5bOf+Yy89Z0/4bd99F4+8dG7wDI//1sf4a//9G4W6bVuxrxTgBXxXWr+1hCpqhRFIdX8AvuP47nZxvZmkWt3DSjKJbK7RxnQ6BY+d/gEU919xrF6VvGtR74pMVXUdU1ZlphlUsoURQEZfuSmmyAZAzlKahYhC0qiwHAVRktHeOT+++So9Lj59rs99iJHgHff+SeM87jrjNXri5ECrfukpm8nKLzGRTFg1DxP1ShlWVKlCvXMw/f/k8gS/NLtt7tZgpB5/4c/jOYaVJgZol5+BrkGWUp0YacQApqXefzFb7kyQW1KYMxYJ/R2XiemC2cmMi8zzV+hGS/S7w+opw2fe/BBjyGSLfP2H32XjHVEIZGe1QzyFM0BEyOrYQ7zXpF9kROeeWj/ZyVpm5NENwZpAl0z5bxEqrXWYgJ9G7OrfoY5O47RWuWepUOkfp/DE4XedkYOvZ6RC+VLn/4bSdOXCJJxFRQj4GQ1cO2y4fVhTcJ/qpvYIPRzzVX1ceqUmCsgD4bSjyWIYRpY8IJq+gLOsZNmt+pdhETPKrQXEXUeeuhBtwwS24Xf/+Dn/bXvulViKNhdH2eYJ1iXPAYHwZBySkoTXtMb0eSXmFZt1RA8UVji2Vyvj8jZxNSNTGQc5j0rgBE88XPvfw8f+6u/k7Kv9EpQb5DmBNM6YymjeZlSanpeUaqChJWRTZQRkDEmM+F1k3JW860M1LN3Np6/FURLlGlMr9djuVpG3LFGMAmYBsAYekWQU7WqlVkWhcEC46ri8/s/7eLtZk9CyAgUfZbivJcapNElTNo2pmJYWztyYmmR0WiITY8RLNAjIqZEEuLds6yj17rvd/etaFetkePlyKdaoiSGeYmd+UVed9VriPM7ObFc0eREKAtScoogIImhHad87nGZt+VOKdqx3TPmzrjczuHiGmIo2DX9b+ZtEQmR3CS2XDHwRe9zpPxOXvIR0zoIHpEu8/vlX/3ghtK7psHBOXtbpyP0eeNP38oP3PiD/snbPwRpAtmgCLBtB+/79X2M2UFpJlfWzzFKx+lZq7J1GOACd+z7bRBnpiuOrJwrTu7Oz2ORa5OQLCVj2SLLYYiSaOiza+sVfPOZQ95Uz9Pv92lyJhaRnDIhCskTQ53yPdt2u0hN6Hy6iyIYhcLUekgdJKUp2acM5/o+yVDOj5jEgrH1+PbzLzBJFVu3XQ0eO5PdePu081yfExIZhyFHbAD9Hdz2ax/kE394Bwjc9qGPQIwwraTM1iWRtvIFF+vqdUVs9auyZi6rMeYcRK7GxraAV8qc2F6/yJYmtiUHNXHaY2E4Ep9ry4nSjRgiKSdiiLg73hvxwAuVx/4cgQoXqEIJQKjHlFZx7dXbfZAXaew6DkehpuDxw8c5JluAyGu3lLLNwD2uLPSVIPJiUdeJhiHv+I27eEYyt9z1FwzzmANfeFjCtOFNb3kr6kbfJ62b7MqJ4IaIIb6+NV5AZ0cJbsynqhNgewziApOcSCkhIqjEVgm81aYowlIN/R3XyER6mCeyQqMtkeoNpS3y9FNP+JCqjR2xhxeKb32d9OauJjpMTxwk5jExxG5xs77vZUymJwZpmce++iWxWJLJqFXMW8WVGuiFioVmCcQIktvaeibtdRJ4XiK1E9AsnmXRNdfQ7mZMqgSUxLA6lBvE0EYTE6MnY3blZ8lE3GXFZUCbfUVqytGCKHM0UmJERIScGvqLzyJu9KRGoiF0jXZvFeZi29cbS2TFtnSEkSySLeJulKnrV1ODGAUVaq3nM0C7ZNA9Iw7S1WrnW+P6LNJ1xTmbrg5psNJQ1zXNYgPp1Euc4EbMYyCSPCCuxJlVzdyHgKNIR07AiF7TszZ2uJ68NwAmbZy8bEnsxDBnEyRNqbOACaW1RGW1lVJjFXqW8/PjrETabLCT+oImkHX1CZklHCt7lSfVULMisUuxXAQjkgm0KlivWD3aWbp0moqu/rdkN6Z4YDWt75RI7RWrKf8vUKDwgJtQemh3SkTb3aJu7bWWbbPF08rfViQs61fUdcdIoS1Ecyd+ZbVNd+YldDfd22sLmCpJpY0FHQEmp+pha6ne7RBopyQ+G7fbF82XT1fv3HITQXK7xWUh4NquOdA2RRIRugw+nORKXS5sgf8LPnsit6njABcAAAAedEVYdGljYzpjb3B5cmlnaHQAR29vZ2xlIEluYy4gMjAxNqwLMzgAAAAUdEVYdGljYzpkZXNjcmlwdGlvbgBzUkdCupBzBwAAAABJRU5ErkJggg==",zS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAAkCAYAAAAq23xmAAAAAXNSR0IArs4c6QAAAUpJREFUaIHtmEEOgzAMBNOqz+XAU3Loc5HoCSmELrbjJUGt94bkbuzBsVFTCoVCoVAoFAqFQqFQ6GZ6+C2mdf/8Jni2a8l5l89rnkfmM617QPVzXy05ryWg+rmzEIwxkBCMQZAkCH0hSRA8kIr7aS1ImjU+P2tB0qxp9atMy6KuHrbyWWVRVw9bdBY49EpQdu8rQUnehmviBeX3YoIiQ/cOXe7Q9m4m8mZjFcfxYRVH8mGva58f+5tG43dy97ZCrOtcG2+bQ1sh1nWujUdxwhZDRSAoWlg2SFIRCIoW1pn/lx+g5Fs7BcXrIKHkWzsFxaNzhKTVULa4xo47/1A0dkQ9Uw4xUseBD0U0PMVrUP5OcWV056DhKXRK/aKEF9d8jllrOr65O8id15OUyB0ldo9GvwqIAiel3wREg8MyEbdGR6F5M/R/8tA/6wPeVhatu8NaOAAAAABJRU5ErkJggg==",OS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAAAAXNSR0IArs4c6QAADlRJREFUeJztXUGyqywTPf7lUhiwFAYuxYFLycClMHApDFiKVf6D2KRt0WgC5H3vcapS916T2A3dfWga5AIVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRV/GZpE91kKyqqoqEiE/134zMJeu+vGmKXve/R9D+ccjDEwxsBai77vkytMUEotfd8vSqmYbhVpsVx4ZQezdbU3AGtt8P/1Z3r0fb/0fR86nv52zi3GmEUptRhjFmPMYq1dnHPLPM+Lc26x1i7W2uQGo+C31v5xJED6ZDPIdSyCJL+6F1bbW2uDvZ1zwR+MMacDReT6LXBH569v7vkJhL/9zO+4DlmJkYKZhJADkEBh+MNridVarLXLPM/BAf8Eo1CAUGD8kASWA5L8+H5E5pLgiQxoIOCkADFofCOft4n/XpIIyOfI75jsonamkZ/HZDZS5GkGmCG4cOyDPTsBkKPJNOhXREC6zPP8k/QYwj4UdPM8p8jC3hK8HBRIplIqkMY38pVS4Z7UNk5uuUmAZHCf44NPSRLisUf+li0b5kwee5Hh5UjAfyZV6IkN89GUhEYpmRGUMA7pgOO+yoUoMVPACL2+lnH04gEfGzDW92+Dt4NkcFIrQQJcBx74YD6IAkTP20nBz6fZOTKSQyc+SPNLTAF2zoV1VOCpGV0TU4RsOMg+stUoJMFRgMgpSKIaTJTYifRxbPNNP3zaTt4Ocnru/DwwRLu/BmUw8v7yJwoQALfzPM+LJCYASXW5E8BvR4gUCp3otQkCsMDjZJBYj51eMQLIMVflo5CcExMJSj3wnR2uEDx/L/q9TwTLrIbm4PQ7n/vyTJD64sP2Bsh0n9fDUrTvCiTBU+DzLCgyFf8aqW6YWrEoAdArwsqb4lEC+VGQvFgNILH8TdDze8emP5HXbXkXX1e++xH4nJc7Pc/4KDip3pAq6+NzfiKfSLuy+BaXx23N28zf+0SP030AzjnM84x5nj9vRSasOtHmougmI6VUdj3IEZ1zcAbw3sM5B+dcVh2UUvDew3uPaZrQ9z2GYcA4jvDeZ5G5ouEvay35STZy9d43ANB1HYZhAABM0wStNQDAGINpmgA8+4U+kwLjODbTNMFaCwBo23b3GYqRVNMO4OlX3ntoraGUCvtrxnEEsG0z+QFDGj2ITY+My5eDjr4fKYx9rdNJVTkwolwayZEB8GUh6ofZYnEGm3aLZbFvsRnluQ6RUSB5+s/f4LY48JMUBciYDruVDqoJyCXIBLJ3OvB+5kujrDj5NciefOoRWe6Tc/607ZYGlgpK5481QhBAEp3OSAnCQXKm/2z0D+lp6BOzTdsS1gA2hS5uAx5svO+/XYLDgVNRm3nxkb/P9wx8If9UB+mjTI9sBMDuudsfkZIA5NSDV/tv6HiKfT4j8C6FjaQfALBJCZ1z0Fp//SzAWoAJcoFQpIFSCm3bUmq6eO9DukQ/cyC0f03HgA5+BJSdYVi6uur7bR8swLM9fd+D9wWzQZChlEoxfWvwJBGStXBbKibbGxO+xG2VE9z3yA9oasCwIM+zKA2maQG2bbfWLl3XfSWvbVv0fb+ZelD7aEo0z/NCtl/lNdgG/tt2X3kWIMCZLascBr/NV2wjuVrrhgc/sCEd6oxsoFGNgr8bx6dxlAMeDm3bYhxHTj5J9aH7eu/hx/FJQCsJzfO8YGqDbVZi/BjOuXhdYZqghwFKKXSkQx4E/df59su/1nb7be1j194MNYoFwKbtqWsv4zhCa72pO/DgJ/lKKV5/aKgGRXWoM7wlgKeDt8DUQtk5kMBR8AMAzBy+AyDJ6B/06doQ8CVGmFOszqeUgmUPPokRqCGjfQnpwA0A+HEM5NON43NU6NqnDYbdSPg92D15u6188GvQSQPCWhtGQ9+1IQB42/0202vo8wBS6BJsSIVPGgQsZWOMhBNMBYI8CuYzP+KxwAfFdzidAmitG2ewwK7pX/f8OGcfDrruuydZAAC6t7OMy1BeA3YODhBSz10a/kqPWDAmIyHn3KK8hnrMmIbhmYKNI011Uom5DAo+StNVj0DYPkH/a60b59wSBoGuXYJ9xxFeKcB7mMcD8+OxBPtPLTzSTP+6rtvowEnAj+OegPD0zyuj4A00u0yi7wHKwgCYxwOYWkywse/flkcks07nFsrmpmEAjNnFYIJ6yxbzPC+zxfNFhT/+O79m8SrIrNXwlKmXlC2LUJbtNuPFsVTyCc650DbefuRdG35VnYXstd0728gp2zcIMsnGMR/g8tefKXWQ96afABbLVgNCUdRg4yfJ9BByZHw4g2TyqMgpi9+WbQziBWhnXqtQSXx/5+gi4HeBL15fKyB0kc4XDX5yvlSdIPWg6rYICmQkAOkEUbswO+RoO8kMuggfkP2eMvilDpvgE/3AAyAHEQGMBOxWHwr+lIQj20LXOQns/OLlk6e4lJrxNOQKKDVPOfff6bHWF2BElXtqQw3CK5dVD+A5LZlgYYwBq8gCiYt+G5nrJiDlt9MNai8hR7vlKoyEfD+1DsBr5SfIZP3gRwCPVz+QHt9W5WOYLRYYNs1a5aaW6ZxbMOgwrdr5PLCNh/Uzvmuhp3M/vDRBDHPAC8hpeO/9i4TM/Px7Ek1gHYCu3ThDDkywm6Lk+nvWtvuuhe8tIAKeiCFH3wMvPzgrMhEJqrF763yfouu6zQqQB+uHx0sP/vkcerQdGmfaxfevAYCQskCttW7Cyo5yUMAr4Fd45V7+oRxwIfiBG8uAWuvmtPIvPnv1vndAhiQdlFLPQOcvrB2wFoty6BLuGamyZ96G+6yu968CEwXBz1dEBHIFP4EHteyDEsEfZK/F0CnfEmi4v+eLHMLv5Z6Qq/1/ax/AO2R3/hvwY16jeO+fm33QbYIvJ/l57zfB/wtcGQj+FDLKHfwxbLLUhOi6rvG9fRtjbFPQJdwiAHLumBKlg/9IhzAFmdDkdAClVGBlIprco0DXdY0c+X4JSQQ5p39X8as+kXJz9EHXdQ1/CEzikxi8nQEor8MmD/4CAAw6u/GPGsmvl3DAwPQPF8igNGRfeO/zbP4R0Fo3XI70gWKIbDbaTA8LQW7CyTkYct+Oybnb7vtTADND9S8iAAAMGsprdD5/p78b1UuNPgbdxgGLOtzYPeUDOxJW+U5if8lXalE9gt3phaGMDwQ91rbu+mDsdiskucCJnwiYbPNfwO1gmed5od1u7sFG3eFpeOfc13vP38EZLFTdl4xbigCUUot7+OeDP+SIY/7iF8m2ykeDXQ+vh0Vyyn/3mdw6kB7u4bfLn4OG6svZwhks3P6qz28DuSIXYmBte9tdb/ctJZ3BslbWz5TLTgD0sJFc81Ve32r8N6AgcM7Bd20Y+Uo4Pu33j422iZ46PIQzWK6M8lZdr0R/CqXU4r3HLOqiVC1Xds7ui4GMRVzk9IPZYon5PnCf+G5tFOeNlPMPSoG11ps9yzmgB4UwAspNIIWhtYZzM+wakKtTZnU6KRPYzX2z6/Br8Cyk7cK18L5V+YvSic53uA09KLiHh19HfODp+y9ivt72j58U4euOv6i8dl4B7OQn5xwwtkUC8E9E7uLTGbz3za+CgfCr6n/p0Z/6mc6ckNn4XR9Iug+A8Isn4jhKOCM3stbPbZo06uSW771vpEzxfjbZV4t8pYqBscCPBWUplBh8DkinzDJgBM0P9gDsNqOcBURGPYrJuoo/Uacc4M/6HyH3SFyaaE7qDeH3u48/390IdOvmJXBEAqVT0l8Q0L+M9RQc+nMX6H/r6B+RCQCbE4DuPPl4iwB4A/kJLc45iNNXinbED0e94tnPEWKOkAPy3vS3tHlOHTistbcc/r+Oziv4rpXHzr/6np4azIXY8965nwGPgR+UwP91E52iyo7mzgp+VHNJufLk4aSHQJxAnkNA9nZmfyhGTj1iMmVf5JTNn71X678PyymPQH4W2rrK5X2RXRcSJo2f+gSgUx0iR07zTikRDMD+fwOUkrs7lYadwpRbNne2nU6FdAjyePsLDkQxm5e0e0xmzkNwokpwB8h5BFcMgXSEPNlBOXXgxzAV6/wVUmZJ2UcnPuU6CepMD3YS04uYIuSUSz4/magk8QmiW4BNBphVjyUS7LFrWbE5BmvtBHlcVG4d+Ogf/iNQydHPYtv+wn2PvaOVJIDd0WsyKyqhg5yGFJC5Izrz2P1j0Dx6cEHENCfXcmKT+pH8TVAUcoCcZyC+kytG/bzGF/IPZJXS4cjhS2ZiG78rNfoSONGZh939Q9jkMWgeNso0sevsWlYdeAHQPOwmEHlqlFoPhqDHyaiYTa6QlX8EeC8nqw4xX6O6T7FRcNWDF53J9/gAmMv/wUgHrJ2SBK7Kv7wMOA3Px3DNw0avnyicDFKW1hpd10H1D0zD9vFYnfHxfDIwP4aqbVu0bYt5nsEcMqlM/pMh6BK7nkqPo3ud6HX4nU9B9udHgKn+sbF/TLfUmIauIbnee0xDh7Ztd3sPUrWf34f7G38fwLMvmE9ekf3Rer152MWPA1T/2Fzn1xhhLGck8Y18AFze7nPhsE6hU0o9jmTfIcq78vw4xPY+NPR0HNchldxp6BouHwAFXsMdLfZe6n4nnej3WP+vn6H3c+1LiQZYTrnk+9LOJE/0y1v5XykYM24ug8dk87+5E8jAX99PphMLfHLws49nIZ0jJ5DESMjRfnn/s+uZfSLIpayAy88l9Gi3aQny4/bng81deX/NU3OxrADI6wBk4LNtx+QMOWRHsqDbI8C3OsRkcoLMKZ90APaZh9Qxp2yJUplPrM135f41BPArnDkB/0yBNLiR10sE4J+CSEb4s7b/MAv+Z+xdcQEFlmP/WPzLba+oqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKio+Hvxf9INUyW2N+RDAAAAAElFTkSuQmCC",US="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAAAfCAYAAAAcGRgRAAAAAXNSR0IArs4c6QAAAppJREFUaIHdWjGSqzAMfcnkKBQcRYWPQsFRUnAUCo6iIkfRjH+RL1Z48WCyBuyo0TLJ4veQniTH3PClRkT+agwxm6bpdjWGU0xEvIh4IirSi8ivJNkVGabutCxrp+HjrCEiP44jHo/HTUR8ad4595kqmDovIv4K/0kg7D30uhRvce0mxMyz/8vCqd6u9wlwIvoI6xmemf2u/mWDcDXwvcEgoiKwx7gkByJnEHKUiL3BEBGfk0MObzkkJ1VJBEIiKfjtdFIClzAISYrIDTxn00wNhiUbBuOsoNj17DPQJNnikP3h5fSp5cmSnR/MxZOfxbOmiMUsy8we/YBmfGabwZ1zyDnTv1wPPDu0bRudw2PrnrkPUmunIfo8ov/EzIs6VqIXkbnMxGxNEaWU1yRFaMRKt62Myq1Eps6HmZ2jQkQJqiLshqgkr5n+jYpYmH7JThwlkVBser3FI9e6aw33L0HYwr9QRM4MyE3iGxVx1z9ExKMfoD1imiaIiC/JA3jj64eZ2JqN4wjnHFJqdooHkH2KDG1uGCLiX68XmqaBcw5d18V4XmbDMGAcRyjOtYZnyeYcmY8a6Rfg7e7P9ojSzPYIu1tW07JVQ49QnAuCYQ0sORBh7dbPjqjlZ973rlllZVOy2doP/Iy3uuM+4lQNyNcjFvd9dm/cwHrEa1LEXD4O/DHvyN/eFPc9zKSqFGEz6v8kVZMiRN6TKoD1RlSLIoAf/NUrQi9qVMRiaqpeESsvBtSgiBD3VygCANq2vTFzFYpgZv/rPKIfFsquQRF6/jNbzYqwn9e4j1gQtDKvYWcdliVrRzy0nDtr9dHTwt1vGVxg4dsZse9deT6d6kPMc5219arHq8g3lonIP9G8LzbOra84n061tfd6/wFeqC7zjwVHnwAAAABJRU5ErkJggg==",LS="data:audio/wav;base64,UklGRjQKAABXQVZFZm10IBAAAAABAAEAcBcAAOAuAAACABAAZGF0YRAKAAAAFQDeALMAjACTABAAHgAVACAA5wAAABIAaQAFAO4AZAA4AG0AawA0ALMA9wAFANkA6wDQAKAApwClALEA1ADpAO4A1wDUAPcALADwAPkA5AACAPUAtQC+AMgA+QA2AFQAYAB+AH4AfgB+ACAAXQC3AMoAwQCQAKUAlQC8AM4A4AAZABcA6wDSALwArgDBANkAwwDyAPAA+QDrAM4AzAC3AMUAugDIAOcAAgA0AEkAcgB+AH4AfgB+AH4AfgB+AGsAYABdAB4A+QDbALEApwC3AKwA4gDbAN4AygCsAJ4AkACqAMMA4ADrAPcABwD5AOQAvgCeAJMAhQCcALcAwwDDAMMA4ADyAPIABQDwAPAA8ADrAOcA6wDgANQAvgDQAMEAygAeADYAZgB+AH4AfgB+AH4AewBrAHkAfgB+AHQAVgBNACUAFQAeAAkAEgAuADQATwBEAFYATQBgADQAFwDnAMEAvgCxALEAvAC6ALcAngCOAIkAgQCDAJoAoACqAJ4AswDBANIAvgCcAJoAqgCBAI4AtQC6AMUAtQDSAMwA2wAHAAcA9QAVACwALgAXAC4AIgDUAMoA1wDuAJcA2wDnABAAJwDbAGIANgA4AH4AfgB+AGkAbQB+AD8AfgAiAC4AOAALAD0AaQBZAGYAPwBUACUA+QD7AP4AvADSAOAAtwDFANIA0AAFACwAIgA2AFIAEgA4ABAAIgAHAOcA7gDbAMEAxQDDAKUAyACFAL4AgQC1AK4AvADpALEAEACsANcAEAAiACUAAAAVAPkAwwDwAPIAzACMANcA0ACTAPIAwQDyAMgA4ADwACcAEADrALwA8AAwAOQAAABSAPsAYABCAD8ALgBCAH0A6QA2ABwAFQBpANQANAAwAKMA5AClAP4A/gCjAPAAKQAiAMwARgAHAO4APQDIADYA0gD7AGYASwASAO4AaQCzAC4ABwCnAAcA6wB+AHcAMAB+APsALAAiACIAVAB0AAcATQAwAKAA8gDiAAAA3gBLAOsAugAnAOAArgD3AIkABQDiABIA+wDeANQAqgDQANIA2wDBAP4AowCjALcAmgDFAM4AsQCuALcAkACaAAcAswC+AM4AlQDDAAkApwDyAM4AsQApAOcA8gAeACkAEgBkAPsAVAAJACwAfgA4ABwAawAiAAkAVgD7ABwAGQAHACwALgA/APsAPQB0ABkANABLAAAAOwAyADIAUgA0ABIAFQA9APAAGQDwAMEA6QDIAOcAFwAFANsAEAAJAK4A/gAZAOcAEgBJAPIABwAXANQA8gDwAPIAtQAJANcAHAAcAMMAEgCqAP4AEgDnANAA9QDgAJcA6wAQALwAJwDIANAA8ADpALMAngDXALoAEgCeANkA3gDpAMoABQDSABkA8AASAD0APwDXAAkAPwBNADYATwD1AD8AUgDIAAcAEgD1ACwA4gD+ABIA+QD7ACkA5AAVAEQAEADbABwAzgDSAB4A0AAQAN4AEgDbANkAJQDgAFIA/gAyACIA7gBCANsAHgDZAEIAHAD+ABIA0AAVACAA5AA/AB4A5wAHAPUAAgAlAOAA+wA7APUABwBWAM4A1wAiAPIAFwD1AIcA0gD+AMoAAAD3AJwAiQC8APUAzgApAAsA6QDeAEIA0AD+AAsAswAsAPUA1AACAAkAugAAAPAA9QDyAOkA9wDeAAAAJwAnACwA6wB3AAcABwAQABAABwDuAD8A7gALAAIAAgAFAN4ACQD5AOAA6wDpAEQA6wAlAOcARAAlACkAMgDUANIADgD+AM4ATwDSAPUACQDFAMgAwQALAOkA4AAJABkABwDeABUAPwDbAAcAFwA7APIADgD1ABAA2wD+ABwA9wAVAPcAtwASAPsAEADpAB4A2QDnAOIAEABJAAkABQAuAOcAHgAJABkAOwBSAC4A9QBNADsAFQAOAB4ABQA9AOsABwBNAOsA4AAFAOsA3gCuAN4ApwDKAJoAxQD7AKMAwwAOAMgArADiAMMAwwD5APUAzADpANIAugDrANAAyAAJAAIA9wDwANkAugASAOkA6QBGANsA+QAAABkANAAyADAAzgAwAE0AEAA4AEkANgAXADIANgAnACwAFQBJACkASQBNAPUAFQAHABkAIAApAPcAJwAcAPAADgD+ABcAygAAAAIA/gCMAP4AtQC1APcAzgALAMgAzgDnAOQAFQDyABUA+wALAAcA9QAHAP4ACQASABwAGQD3ADAAHADrADAABwAgAB4A9wAHAOQA6QD3AO4A6wDkANkA+QDeAOsA2wDiANQAAADIALoA4ADeANcA3gAJAMwAwQDOAOQAxQAGAMMABgDgAPIAEQDhAPIAFgDYABQANgABAA8ABgAcABEAEQAvACcA9wAlAD4ADQBEADIADQArAB8AMAAfADcAKwApADYAPAAKAAAAIwAjAEsA7wAVAAkA4wATAB4A8wAdAAQA5AD+AAQA8QD7ANgAAADnANUA9gDfAO8A6wDMAAkA5QDfAA4AxgAHANcAugDyANgAzwC9AOoA5gCoAM8A7QDeAOcA6gD0AOAA6ADXAAUADQDUABwA6gARAOsA7gArANEA5QDjAN4A+gAJAAAAEgDZAAgAAQDzABsA8wAWAP4AAQATAO8AFwABAPoALwAZADIA9wA2AC4AHAATAB4ARwAaAEgAGgAcADwAJABXADcAJwAjAC0AKgBEACoALwAPABEA/gAeAPQA6ADtAPoA3wDAAAoA6ADFAA8A6QDoALkAyADKANcApADQAMgApgC7AMsAzQC4AMgA5QDQALsA3gD7ANUA7wDVAOoA5QDdAOgAAwD1AOwA5gAcAPMACQASABIAHQABACEAKAASACUAHQA9ACwALAAvACMADQAzABMAMgD7AC0AFwAFABEAHAAhAP4AIAAgAAAAAwAVAA0AHAAnAPAADQDmAA0A5wAFAB0A2gDuAAgA1QAJAOIA/ADiAOIA6gDqAOQA+wD2AOsA+wDyAPoAEgDxAO0AAADoAAAA+wAAAOgA6QDkAOoA7gDlAOwA9QDiAAkA7AADABAA7wAYAP0AGwAJAP0AGADuAO8AAAD2AOsA9wANAPAABAD7APQACAADAPQACgAAAPEACwAHAO8A7wD9AAUA+AAFAAgA8AD7AAUA+gD5AAcAAgAKAAAA/AAPAAAADAADAAIACwAEABMAHQAAAAYACAATAAIAHAATAAkACQAGAAgAAgANAAAAAwAAAAYA/AD8AP0A/AD5APkABADsAP0A7wD4APIA7AAEAN8AAAD0AN8A9AD6APEAAQD0AO4A/wDpAPYA+QDmAPwA7QD3AAAA+QD9AP4ABwD/AP0AAAADAPwA9wD+AAIACQD6AAwACwAEABAAAwAEAPcADwACAAwABQACAAcA9wAJAAYAAAD5AAYA+QAHAAcA9QAKAPsA/gD9AAEADA==",FS="data:audio/wav;base64,UklGRjQKAABXQVZFZm10IBAAAAABAAEAiBMAABAnAAACABAAZGF0YRAKAAAAFQDeALMAjACTABAAHgAVACAA5wAAABIAaQAFAO4AZAA4AG0AawA0ALMA9wAFANkA6wDQAKAApwClALEA1ADpAO4A1wDUAPcALADwAPkA5AACAPUAtQC+AMgA+QA2AFQAYAB+AH4AfgB+ACAAXQC3AMoAwQCQAKUAlQC8AM4A4AAZABcA6wDSALwArgDBANkAwwDyAPAA+QDrAM4AzAC3AMUAugDIAOcAAgA0AEkAcgB+AH4AfgB+AH4AfgB+AGsAYABdAB4A+QDbALEApwC3AKwA4gDbAN4AygCsAJ4AkACqAMMA4ADrAPcABwD5AOQAvgCeAJMAhQCcALcAwwDDAMMA4ADyAPIABQDwAPAA8ADrAOcA6wDgANQAvgDQAMEAygAeADYAZgB+AH4AfgB+AH4AewBrAHkAfgB+AHQAVgBNACUAFQAeAAkAEgAuADQATwBEAFYATQBgADQAFwDnAMEAvgCxALEAvAC6ALcAngCOAIkAgQCDAJoAoACqAJ4AswDBANIAvgCcAJoAqgCBAI4AtQC6AMUAtQDSAMwA2wAHAAcA9QAVACwALgAXAC4AIgDUAMoA1wDuAJcA2wDnABAAJwDbAGIANgA4AH4AfgB+AGkAbQB+AD8AfgAiAC4AOAALAD0AaQBZAGYAPwBUACUA+QD7AP4AvADSAOAAtwDFANIA0AAFACwAIgA2AFIAEgA4ABAAIgAHAOcA7gDbAMEAxQDDAKUAyACFAL4AgQC1AK4AvADpALEAEACsANcAEAAiACUAAAAVAPkAwwDwAPIAzACMANcA0ACTAPIAwQDyAMgA4ADwACcAEADrALwA8AAwAOQAAABSAPsAYABCAD8ALgBCAH0A6QA2ABwAFQBpANQANAAwAKMA5AClAP4A/gCjAPAAKQAiAMwARgAHAO4APQDIADYA0gD7AGYASwASAO4AaQCzAC4ABwCnAAcA6wB+AHcAMAB+APsALAAiACIAVAB0AAcATQAwAKAA8gDiAAAA3gBLAOsAugAnAOAArgD3AIkABQDiABIA+wDeANQAqgDQANIA2wDBAP4AowCjALcAmgDFAM4AsQCuALcAkACaAAcAswC+AM4AlQDDAAkApwDyAM4AsQApAOcA8gAeACkAEgBkAPsAVAAJACwAfgA4ABwAawAiAAkAVgD7ABwAGQAHACwALgA/APsAPQB0ABkANABLAAAAOwAyADIAUgA0ABIAFQA9APAAGQDwAMEA6QDIAOcAFwAFANsAEAAJAK4A/gAZAOcAEgBJAPIABwAXANQA8gDwAPIAtQAJANcAHAAcAMMAEgCqAP4AEgDnANAA9QDgAJcA6wAQALwAJwDIANAA8ADpALMAngDXALoAEgCeANkA3gDpAMoABQDSABkA8AASAD0APwDXAAkAPwBNADYATwD1AD8AUgDIAAcAEgD1ACwA4gD+ABIA+QD7ACkA5AAVAEQAEADbABwAzgDSAB4A0AAQAN4AEgDbANkAJQDgAFIA/gAyACIA7gBCANsAHgDZAEIAHAD+ABIA0AAVACAA5AA/AB4A5wAHAPUAAgAlAOAA+wA7APUABwBWAM4A1wAiAPIAFwD1AIcA0gD+AMoAAAD3AJwAiQC8APUAzgApAAsA6QDeAEIA0AD+AAsAswAsAPUA1AACAAkAugAAAPAA9QDyAOkA9wDeAAAAJwAnACwA6wB3AAcABwAQABAABwDuAD8A7gALAAIAAgAFAN4ACQD5AOAA6wDpAEQA6wAlAOcARAAlACkAMgDUANIADgD+AM4ATwDSAPUACQDFAMgAwQALAOkA4AAJABkABwDeABUAPwDbAAcAFwA7APIADgD1ABAA2wD+ABwA9wAVAPcAtwASAPsAEADpAB4A2QDnAOIAEABJAAkABQAuAOcAHgAJABkAOwBSAC4A9QBNADsAFQAOAB4ABQA9AOsABwBNAOsA4AAFAOsA3gCuAN4ApwDKAJoAxQD7AKMAwwAOAMgArADiAMMAwwD5APUAzADpANIAugDrANAAyAAJAAIA9wDwANkAugASAOkA6QBGANsA+QAAABkANAAyADAAzgAwAE0AEAA4AEkANgAXADIANgAnACwAFQBJACkASQBNAPUAFQAHABkAIAApAPcAJwAcAPAADgD+ABcAygAAAAIA/gCMAP4AtQC1APcAzgALAMgAzgDnAOQAFQDyABUA+wALAAcA9QAHAP4ACQASABwAGQD3ADAAHADrADAABwAgAB4A9wAHAOQA6QD3AO4A6wDkANkA+QDeAOsA2wDiANQAAADIALoA4ADeANcA3gAJAMwAwQDOAOQAxQAGAMMABgDgAPIAEQDhAPIAFgDYABQANgABAA8ABgAcABEAEQAvACcA9wAlAD4ADQBEADIADQArAB8AMAAfADcAKwApADYAPAAKAAAAIwAjAEsA7wAVAAkA4wATAB4A8wAdAAQA5AD+AAQA8QD7ANgAAADnANUA9gDfAO8A6wDMAAkA5QDfAA4AxgAHANcAugDyANgAzwC9AOoA5gCoAM8A7QDeAOcA6gD0AOAA6ADXAAUADQDUABwA6gARAOsA7gArANEA5QDjAN4A+gAJAAAAEgDZAAgAAQDzABsA8wAWAP4AAQATAO8AFwABAPoALwAZADIA9wA2AC4AHAATAB4ARwAaAEgAGgAcADwAJABXADcAJwAjAC0AKgBEACoALwAPABEA/gAeAPQA6ADtAPoA3wDAAAoA6ADFAA8A6QDoALkAyADKANcApADQAMgApgC7AMsAzQC4AMgA5QDQALsA3gD7ANUA7wDVAOoA5QDdAOgAAwD1AOwA5gAcAPMACQASABIAHQABACEAKAASACUAHQA9ACwALAAvACMADQAzABMAMgD7AC0AFwAFABEAHAAhAP4AIAAgAAAAAwAVAA0AHAAnAPAADQDmAA0A5wAFAB0A2gDuAAgA1QAJAOIA/ADiAOIA6gDqAOQA+wD2AOsA+wDyAPoAEgDxAO0AAADoAAAA+wAAAOgA6QDkAOoA7gDlAOwA9QDiAAkA7AADABAA7wAYAP0AGwAJAP0AGADuAO8AAAD2AOsA9wANAPAABAD7APQACAADAPQACgAAAPEACwAHAO8A7wD9AAUA+AAFAAgA8AD7AAUA+gD5AAcAAgAKAAAA/AAPAAAADAADAAIACwAEABMAHQAAAAYACAATAAIAHAATAAkACQAGAAgAAgANAAAAAwAAAAYA/AD8AP0A/AD5APkABADsAP0A7wD4APIA7AAEAN8AAAD0AN8A9AD6APEAAQD0AO4A/wDpAPYA+QDmAPwA7QD3AAAA+QD9AP4ABwD/AP0AAAADAPwA9wD+AAIACQD6AAwACwAEABAAAwAEAPcADwACAAwABQACAAcA9wAJAAYAAAD5AAYA+QAHAAcA9QAKAPsA/gD9AAEADA==",NS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAADBQTFRFkPz82NjYkJCQSEhIJCQk2JAAtGwAAAAAJCSQAABsJEgAACQAkCQAkAAAtGxsbEgkLZt4egAAABB0Uk5TAP///////////////////8BQi0MAAAAtSURBVBiVY2AAAkYoYIAARiQA4bPDAVgEiQ8UQVUAVjJAAhgOw3Q6hufQvA8ANm4EKWDQUP8AAAAASUVORK5CYII=",HS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQsAAABYCAYAAADiONK/AAAAAXNSR0IArs4c6QAAC95JREFUeJztnUuSrCgUhv+qyKUwqKUwqKU4yKXkwKXkgKXk4CylI24PFKUQ5KmQ5vkiuq0rz5/HERDMLyHEPyKCEAI1rj4GAJACUkiocYQSAnL2P3rCPB6PyX0clzSEEJBSQikFpdQavxSTX0VLuFzu9zuGYfC6CyF2w++VQwzjOBZr2GMvfzFph/SFymePUNnHUFI/Ncr+fr//aY8aKeXSdoloadNa7/1+d8b3lHO8JPAQa3xK+ftOSf/1ud2KSiURCQJohJSAIkDOhTAqt3+lFKSUiwidcX3fNBZ2OIE5DNwNh2hKXAi1uafT8kIKBBFMowRbmyutXI1C7Hd2UmOUPt0pzUbmyntq/kuNrR3eTEeAgvU1ju52Yd7zxb+H2WbNNg24ywyYH7KYDIMZvcf7oXyfmZgtUP/b9xwhok0hhgp38ReoOF/Fp3CEkaiZXqnGUHp2p0zp5EcaWhel6dRoL7ahMO/vlZ3Z1EfI5d++UcVRfAPrE8Eevtn3Y68utLBp6LQ+wWtaSGPEtzRGH+Yo4l0IabI5WmPqdEN32LMNRQ1Sy1KVDY4WTINARBBzh4kxFCX91+V2k3I79CYiuO6bkfnu7c4HMY0ihFJQ1n0XUgDKHlJaQ1+NXTnmMNqFEGrTAPTTo3AUbMQXLi/fPRc5IwufxhroaWFyuAgdtcsuBVcZ5ZTbpk0a625mXokIUgBjpXYHoKj/usICwBeAf/WyGEZPOUbrbxe5jUOL3VvX2At3v9//FNjZ6DUZk1QtPkLxuNKuTWi9qXXZPx6PorL2hc1tzwPOn3K4OHXNAphEj8bfIYZh2KyOu+49Ho/NKvZew9Mr07b/mEZihjujYfs6l0tDyL2mPv2UtO+F4qxh9FJIrS87fznl7GqPsW3ZjkcY8bjiPYvTjYUtVuyIJ6LldZL247oHTKMB16un0FM0B9MInfEk3HsKhzTkaEzR51rkdPk/20BoTEObOzqLKWPbj90edVu93+9LmbnumZjurn+fzenTEOD4QijtvD0MhVul/8naa6XfyjAezan7LDS2UWhlKRmGief0aQjDMO8JGwuGYaJgY8EwTBRsLBiGiYKNBcMwUbCxYBgmiksaC6XUcpT9U+hJc095OYtP0Hw7YgNMDxtrNDkfUlFKFX+ApYSc9Es1l6RdMy/vWPY6nEnr9n9E+pccWTAMUx82FgzDRMHGgmGYKNhYMAwTBRsLhmGiaHLq9EzGMf0bQ1LKrHC1KE2/JGxt7alxvXvZX5nLG4vHsP2oyM9vxY8dNuD13H6N6sd4cxf6LmZpZ0h5tfiJ5X9VeBrCMEwUlx9ZEFyf7Ps9PR81eSdN75TXWK6oKQYeWTAME8XlRxau320EgNfrtfgx3X9/f7t392lKwbfuoNczQu6xcPlfh8uPLFw/8Pp6vTa/n6qvz+eze/eUH6R2sbdAGfo0feq5CS7/6/Alpaz+de8eDpINw4BxHP88Ia7Mz8/PornlQSwASx4+tfwBPkj2VuhKU/qXvS909bn1tD+Ay/96fD2fz+oji9/fXzyfz9rRJqWvrXwLC99iZGWOplqWPcDlD6B5+z8i/csvcLYYkrf4JkOvH13h8r8Ol52GMAxTFzYWDMNEwcaCYZgo2FgwDBMFGwuGYaK4HfFuuKdvArTIR2v9vZQ98Jnlf9X0v15P8Q9ifidL1sk53/2A+6gkBpn+KmmkFwbxkxxuE09s+pn6Qu65+lMQNIAUQUgBEn8bRp7+BzAqYJjDjRIYJCBEsf69vB7BFeq/pC9UaX8Obd+1DUUuunBGOml78EEN5Syo9PCSnX8hIKSY7ovn/He6odijOM816bj+T+8LNh5tt/UQzHpG/+/hmO3Z/ZA7oDxn/v0QEe70BEAgkRY2Nf1SfUfoT0XMnZsUgQY7rXT9gmh6+mN6IpEiQJAznmT9Ss2jCgGiY8vFmb5F7/Vf3hfy09/TlrzAGXMct+UhmlD6ofyXuofSrwURLU9qO0dZ+k3jM08Z4PCbql/7phNPZ35C/R+Rfkjbt+lJX3Wl2veFmBrQrrsjcZd7btjYa3b+S90L9Sdd9d/GNxWy9dNqJLTRgMtfon6hDYQQ9fXnlPGb1H+T8AFtNz3sWG5KCZp/5NW+D+BPA3Kd64+5TtFYbmp96pTETY78hfJf6l5Ff+ZVd2wBtansFH0w4pr8T9MG3byS9QMQSq0Lm4bmmvqvWP+A4UfmhN/Pnxk+WjsRvl6v13rqVDcce7jou+/hTyOM5D7qpAQGWTZc3aQfyn+peyj9IyFa1xukAEmZp1+pKZ654QilpmmO/m8v/CZLBGnmyYzjBN69/ke1dvpHxnm4pPRjtcNcs5hvbl64WPeVEdh3rj/G3b5niyv97kBM/kvda+rPvkoJknIdYcyjwlR9zs5sdPIU/dIyXmo2QIfov2j9T0mXha9dNjclBMzlEEm0VrrjviQCxLRmrv823ZSY5qlLvI5GuPloiDKG1QOgsI0z5qrzQnPcOv/Kyr+tz6XlaP05+navQkBILFMSEgLQnTRGv5k3rG9DdP6j9OvRSWBEcYj+K9X/IIBx6hOjmvuEwyBH6feln6gdQuDr9d9//3QgEzMy3z3pCUdKLfOgmK0h6r4OgeRjK86Vzp4fEZF+SMuZ+kPE6gfRsk4AYH2yOxrMRotrGmKF9emXnnR1pyrlE+s/1CdsUvTnaAeAr8dsLEIeXRHuVURKIemC0SOL1LhS8hbj39cIjtK/R6p+8+kO4M8T3nxqbBqH0eGXhc5hnUL4wphrJmZ6qtLrw0+tfxrXt5IhY5GqPzWsvnfbC5iTmdSKMplW0UWU3z0/PTeUkoqM8bN0bmEajckAyHlq4tLyZ53BnEY40pAAYBglwmokyIo/R1OK36vWf+yelBL9KdolDGNRy1Ds4QtrvvKJSSfFz57/IxpKSvqlfvf8+IwGRoXBMdowX50uIwtBkOb83BpFmEZilLIr/TH+e65/zd5bjRL9qdoV5mlITUORY3FT52eh+HL812ooZ0xNcuJzdXaNOYrQm6jMf3v9W1Mb7OSpuf6A/97qv8Y6Xqz/GO0AcIs1FEhMLMU9lRYNBTtxvIV+883EgGVtA8A66lj+jz//FnIK51uLeAv9ie6Xq/8EN5//zQJnKjlDOxu9mONa4Czl6Iqsof9IgvqNEYeLzXQlEP/b6Q+4p8ZfS3+tPlGyvmKTZCyOqPgjDUUqZz8hzo5/N22lgFFBPaeThvL3/udtSFQcqNvxzqa39Gv3jVJ9m1OnvqZxVEHqhc2zTiT6+GRDAWBZ4JTzVm3fqVMfbCjqp1+zb5To0zYh69Xp1fh4QwGsp07nnNg7OPdgQ9F3+qWGQs3Xb/tmzYRiOO3AlQc2FDMi7nsWNmwojk+/pI/UMBSYr997EZ5RkC2nH2woDMj/PQsfbCjOST+3j9QyFJpv1+qty3P8MlceZ48wQvqO1n92+YYQRJuRhe8NCVCe/9b63yH9miOKFH2+sDfXa54Wr7/srd5Hkvq66+j35K2fcCZ6T8Uepflvrf9d0q81okjR5wsrUWGfRSk9vTr9ZPTJ0XH+9fFhHL0nVplz6K1vNP1Fst4K46OxtnXHrFkwxyKG9dwUdfC7UW2NRSd7LBgU77NgjqGnPnILe2E+goJ9Fsxn0MUPI7fea8Ege58Fcyw99Y0ujEUPQ6yPJ2OfBXM8PfWNptMQ10dvmDYIIsD63RA2Fv3QwwijqbFgQ9EfMfssmPM5cx+Sj6bTEPOn0Zi26K96j8Ow7LWgSh/dZfLpqY80Mxa8x6IzeJ9Fl/S016Kdsejo/TED3mfRMb30lWZrFry42Rm8z6J7Wk9FmhkLNhSdIdy/os70Q+tFzub7LFpbS2aG91l0Sy99pPl279bWkpngfRb90ssovLmxYPqC91kwPppNQ3p6f8zwPoue6aWvNDEWvMeiQ3ifRbf0steijbHo5L0xY8D7LLqmhz7DaxbMBO+zYAI0GVm0nnsxDvh7Fm9By77TdBrCdATvs3gLPnYawiOMfuB9Fn3Tw/GI5t+z4A1ZfcH7LPqktaEAeM2CmeF9Fu9By77zP8ZBdzPJEQyJAAAAAElFTkSuQmCC",GS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAMAAADKd1bWAAAAAXNSR0IArs4c6QAAADBQTFRFJPz8/Pz8AAAA/Pz82AD8AAAAbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxswe3CpAAAABB0Uk5TAP//////////////////AO1SZM4AAAT6SURBVGiB3VkLltswCAQ2uf+VG0vMMEhKdrdN+9o6cbBkJMGInx2zNx0fbzrM/fF9nNfHjedvPwI0QAM0QAM0QAM0oMAd9A56B72D3kHvoHfQu18SeMQDhHh8DCcOX9AY7XcAhDkwPxbyvPC88LzwvEjqAOAGegO9gd5Ab6A30BvobQjiYQnAAwgblHJGNHVHu27/BwBcklwABD/WAUiD8Nz8yTpd5VdM4W8B4NpxApC7P/qs5CIq01JmewHqnwUgI831jRGQQCFfBM1jYjXbl8uYAPXt428Jgp9uVMxdyhiZ7bhCQbwlFvzs8fGm49OFcjvGd1qKGa9+CQDafM+7NHlb0o37NvDbS9b8nKD5GiQolzMl0hb+L669sfs0oMu2pl1N+YaRD5MDR+e/KC4WzT6XYcx5Jf0pURjbY11qlnyji/KMBvk5T98nAqWipV5bSTEBuLwpCukYoS5srt0GhI6TC4Mqn+ofyjp/I9voyQ2pDYfNT1Awvi0pG5IAhBiUgWeRkDuaPCOyzN/A3jR+ewbAFGwBfjNRd+jaAJimkDswUR83AjstrsGNCiDUJJSoHYziZQOrQpUAEp5uARu7HfSe8A3OaZzcCaaPrv8OgHOcKEyZafICYLYjkZIVWqMsYHHdI7+VBYyZcyfscCwAENiDa/RRIYMUiwkMbkbU2s3U+yCXlfy0LvD3LeNvinBI+mEWW2sQlIGqUgHLBfyANLlgwnaK7gEJFlNPquOLv2zzKG4Fqu3OOWih8nnFcSCisK0AhMhRztkrLHHa3lZqtvc/XfeZvi3dVpBp+bZ2Zs2/zownwcnxpOKyUZbtbCzzv247Xw6s8zRK7tmw+l0vO05wIDhVy6twQM9skFTyr7ijhJcMWOUZA4xIrWKd/1kbicAkJT6lGUFbTiw/OJUJkGwMDkYVTpiOj/My3KS4f0hjPRpCjkxTviiyKratHzK7Z70v+d8SLJMiATEhur6RprUgkI+Vc1FIKhmlhCorYzdd4ghASK/P57fxXRSu9aQNFzBbAShjWBfSMFyuUNVFdkSPDaOXBYWa4ApAcHrJRGmqkpHEAqwBYAlAukLteIQoBJdjKbwBIJUh2uV5QpyJz1BHnaJAsqkPyg61hc2amTUflC65x97GvwJQOJso2VTXiQMWnvNM82+RqAaXCTAGbAiInFkzS171Ruf9MimNARK94YLiIhtgMq+aKHaVrtB8L9vRAm1bX12SGR8ArJafSyONWj5n97x6egOCYbO/Bi9E5guZP/ll3j5ftPs94Z/k7euzjpCSJxfoG7/W5gTmZCO7xez3+hVbZ8f7IwdNK6r1nA+NQ/3Y+hAM93uhV9V/mvE7x08DyKee/hR45LTmwtqW7NCiOnxI+VXkDAEc4CzmZKF1vWQoxmI4nI5/j6wKRXXtNQi+2Ih0rbXwK4oCsOEQdSoymkhaEPf5FrMqvcM6E2nDm5/Ku5qMav4qhJgk+OLGt2ei16bUAjAnkzYtgWo13g0Ab4/FIrDk8v3UPH6ugxYADFlnGV/60gJePhwpinW2hVkwnAA7WkBX4AkAku3aPOc6CMjqfFLBiv7fcQEq5F0gCtaf3owCRhfM1P/DKNgBAFGE2a3PIybkJZ9YiI3/g1gIQZ6SkFngCwZgzIvH9HvI2xBQaoFWkq/9ka/yrW6qQdVe74/30sGkn3NIHcJ1ZaAMf/KnwQ/8LxozvwU0ugAAAABJRU5ErkJggg==",QS=()=>({SpriteSheet:new pi(IS),GlovesSheet:new pi(kS),StarsSheet:new pi(zS),StanleySheet:new pi(OS),GoalNetsSheet:new pi(US),PunchHiSound:new Ud(LS),PunchLowSound:new Ud(FS),FramerSheet:new pi(NS),RinkSheet:new pi(HS),SmallFontSheet:new pi(GS)}),Dt=3,v0=70,gd=76,Ld=57,Fd=32,x0=36,b0=36,jS=32,VS=64,YS=267,qS=88,md=8,XS=50,ZS=40,w0=.8,WS=.9,ty=8,ce={THROW_GLOVES:[0,1,2,3],READY:3,GRAB_REACH:4,HIGH_WINDUP:5,HIGH_CONNECT:6,LOW_CONNECT:7,HIT_LOW:13,HIT_HIGH:14,FALL_1:15,FALL_2:16,WIN:[0,1,2,3,4,5,6,7]},me=16.6,$l={idle:{frames:[ce.READY],durations:[9999],loop:!0},ready:{frames:[ce.READY],durations:[9999],loop:!0},throw_gloves:{frames:[ce.THROW_GLOVES[0],...ce.THROW_GLOVES],durations:[60*me,16*me,16*me,8*me,6*me],loop:!1,next:"ready",dropFrame:3},high_punch:{frames:[ce.HIGH_WINDUP,ce.HIGH_CONNECT,ce.READY],durations:[5*me,12*me,8*me],loop:!1,next:"ready",hitFrame:1,hitType:"high"},low_punch:{frames:[ce.HIGH_WINDUP,ce.LOW_CONNECT,ce.READY],durations:[5*me,12*me,8*me],loop:!1,next:"ready",hitFrame:1,hitType:"low"},grab:{frames:[ce.GRAB_REACH,ce.READY],durations:[20*me,6*me],loop:!1,next:"ready",hitFrame:0,hitType:"grab"},hit_high:{frames:[ce.HIT_HIGH,ce.READY],durations:[16*me,8*me],loop:!1,next:"ready"},hit_low:{frames:[ce.HIT_LOW,ce.READY],durations:[16*me,8*me],loop:!1,next:"ready"},held:{frames:[ce.GRAB_REACH,ce.READY],durations:[30*me,4*me],loop:!1,next:"ready"},falling:{frames:[ce.FALL_1,ce.FALL_2],durations:[12*me,20*me],loop:!1,next:"down"},down:{frames:[ce.FALL_2],durations:[9999],loop:!0},win:{frames:ce.WIN,durations:[300,300,300,300,300,300,300,300],loop:!0,isStanley:!0}};class xc extends Bi{constructor(t,e,s,r=!1){if(super({pos:I(t,e),width:3,height:3,color:$.fromHex("#b91c1c"),z:20}),this.currentZ=0,this.gravity=800,this.landed=!1,this.toCamera=!1,this.toCamera=r,this.toCamera){const l=Math.random()*1e3-500,h=Math.random()*800-500;this.velocity=I(l,h),this.zVelocity=-(Math.random()*600+400),this.targetZ=-200,this.gravity=200}else{const l=(Math.random()*300+50)*s,h=-(Math.random()*400+100);this.velocity=I(l,h),this.zVelocity=Math.random()*450+50,this.targetZ=150}this.floorY=360+(Math.random()*20-10)}onPreUpdate(t,e){if(this.landed){this.toCamera&&(this.graphics.opacity-=e/1e3*.8,this.graphics.opacity<=0&&this.kill());return}const s=e/1e3;if(this.velocity.y+=this.gravity*s,this.pos.x+=this.velocity.x*s,this.pos.y+=this.velocity.y*s,this.currentZ+=this.zVelocity*s,this.toCamera){const l=.5+Math.min(Math.abs(this.currentZ)/Math.abs(this.targetZ),1)*.5;this.scale=I(l,l),this.currentZ<=this.targetZ&&this.stickToSurface()}else{if(this.currentZ>=this.targetZ){this.stickToSurface();return}this.pos.y>=this.floorY&&(this.pos.y=this.floorY,this.velocity.y>50?(this.velocity.x=Math.random()*300-150,this.velocity.y*=-.4):(this.velocity.y=0,this.velocity.x*=.8),Math.abs(this.velocity.y)<10&&Math.abs(this.velocity.x)<10&&this.stickToSurface())}}stickToSurface(){if(this.landed=!0,this.velocity=I(0,0),this.zVelocity=0,this.color=$.fromHex("#7f1d1d"),this.toCamera){this.z=9999;const t=.5+Math.random()*.7;this.scale=I(t,t)}else{this.z=-1;const e=1-Math.min(Math.max(this.currentZ/this.targetZ,0),1)*.6;this.scale=I(e,e)}}}class C0 extends Bi{constructor(t,e,s){super({pos:I(t,e),width:v0*Dt,height:gd*Dt,anchor:I(.5,.5)}),this.isLocal=!0,this.health=5,this.maxHealth=5,this.state="idle",this.opponent=null,this.animations=new Map,this.animLocked=!0,this.hitDealt=!1,this.glovesDropped=!1,this.vx=0,this.isPlayer1=s,this.facingRight=s}onInitialize(t){const e=t;this.spriteSheet=$i.fromImageSource({image:e.resources.SpriteSheet,grid:{rows:17,columns:1,spriteWidth:v0,spriteHeight:gd}}),Object.keys($l).forEach(s=>{const r=s,l=$l[r];let h;if(l.isStanley){const f=$i.fromImageSource({image:e.resources.StanleySheet,grid:{rows:1,columns:8,spriteWidth:jS,spriteHeight:VS}});h=l.frames.map((g,m)=>{const A=f.getSprite(g,0);return{graphic:new Cn({members:[{graphic:A,offset:I(0,-12)}]}),duration:l.durations[m]||300}})}else h=l.frames.map((f,g)=>({graphic:this.spriteSheet.getSprite(0,f),duration:l.durations[g]||100}));const u=new fA({frames:h,strategy:l.loop?Pd.Loop:Pd.Freeze});u.scale=I(Dt,Dt),this.animations.set(r,u)}),this.setupStarIndicator(e),this.setState("throw_gloves")}setupStarIndicator(t){const e=new Bi({pos:I(0,gd*Dt/2-115),width:x0*Dt,height:b0*Dt,anchor:I(.5,.5),z:-1}),r=$i.fromImageSource({image:t.resources.StarsSheet,grid:{rows:1,columns:2,spriteWidth:x0,spriteHeight:b0}}).getSprite(this.isPlayer1?0:1,0);r&&(r.scale=I(Dt,Dt),e.graphics.use(r)),this.addChild(e)}onPreUpdate(t,e){t.isReplaying||(this.isLocal&&this.handleInput(t),this.applyPhysics(),this.checkCollisions(),this.updateAnimationLogic(),this.updateGraphics())}getSyncState(){return{x:this.pos.x,y:this.pos.y,vx:this.vx,state:this.state,facingRight:this.facingRight,health:this.health}}syncFromNetwork(t){this.pos.x=t.x,this.pos.y=t.y,this.vx=t.vx,this.facingRight=t.facingRight,this.health=t.health,this.state!==t.state&&this.setState(t.state)}getSnapshot(){const t=this.graphics.current,e=t?t.currentFrameIndex:0;return{x:this.pos.x,y:this.pos.y,state:this.state,frameIndex:e,facingRight:this.facingRight,health:this.health,visible:this.graphics.visible}}setFromSnapshot(t){if(this.pos.x=t.x,this.pos.y=t.y,this.facingRight=t.facingRight,this.health=t.health,this.graphics.visible=t.visible,this.state!==t.state){this.state=t.state;const s=this.animations.get(this.state);s&&this.graphics.use(s)}const e=this.graphics.current;e&&(e.currentFrameIndex!==t.frameIndex&&e.goToFrame(t.frameIndex),e.pause()),e&&(e.flipHorizontal=!this.facingRight)}setState(t){if(this.state==="down"||this.state===t)return;this.state=t,this.hitDealt=!1,this.glovesDropped=!1,t==="win"&&(this.vx=0);const e=$l[t];this.animLocked=!e.loop;const s=this.animations.get(t);if(s){if(s.reset(),t==="win"){const r=this.isPlayer1?3:7;s.goToFrame(r)}s.play(),this.graphics.use(s)}}handleInput(t){if(this.animLocked||this.state==="held"||this.state==="falling"||this.state==="down"||this.state==="win")return;const e=t.input.keyboard,r=t.networkManager!==null;let l=!1,h=!1,u=!1,f=!1,g=!1;r?((e.isHeld(Xt.A)||e.isHeld(Xt.Left))&&(l=!0),(e.isHeld(Xt.D)||e.isHeld(Xt.Right))&&(h=!0),(e.wasPressed(Xt.J)||e.wasPressed(Xt.Num1)||e.wasPressed(Xt.Numpad1))&&(u=!0),(e.wasPressed(Xt.K)||e.wasPressed(Xt.Num2)||e.wasPressed(Xt.Numpad2))&&(f=!0),(e.wasPressed(Xt.L)||e.wasPressed(Xt.Num3)||e.wasPressed(Xt.Numpad3))&&(g=!0)):this.isPlayer1?(l=e.isHeld(Xt.A),h=e.isHeld(Xt.D),u=e.wasPressed(Xt.J),f=e.wasPressed(Xt.K),f=e.wasPressed(Xt.K),g=e.wasPressed(Xt.L)):(l=e.isHeld(Xt.Left),h=e.isHeld(Xt.Right),u=e.wasPressed(Xt.Num1)||e.wasPressed(Xt.Numpad1),f=e.wasPressed(Xt.Num2)||e.wasPressed(Xt.Numpad2),g=e.wasPressed(Xt.Num3)||e.wasPressed(Xt.Numpad3)),l&&(this.vx-=w0),h&&(this.vx+=w0),u&&this.setState("high_punch"),f&&this.setState("low_punch"),g&&this.setState("grab")}applyPhysics(){this.transform.pos.x+=this.vx,this.vx*=WS;const t=100;this.transform.pos.x<t&&(this.transform.pos.x=t),this.transform.pos.x>800-t&&(this.transform.pos.x=800-t)}checkCollisions(){if(!this.opponent||this.state==="down"||this.state==="falling")return;const t=ZS;Math.abs(this.transform.pos.x-this.opponent.transform.pos.x)<t&&(this.transform.pos.x<this.opponent.transform.pos.x?this.transform.pos.x=this.opponent.transform.pos.x-t:this.transform.pos.x=this.opponent.transform.pos.x+t,this.vx=0),this.facingRight=this.transform.pos.x<this.opponent.transform.pos.x}updateAnimationLogic(){const t=this.animations.get(this.state);if(!t)return;const e=$l[this.state],s=t.currentFrameIndex;t.done&&!e.loop&&e.next&&(this.setState(e.next),this.animLocked=!1),e.dropFrame!==void 0&&s===e.dropFrame&&!this.glovesDropped&&(this.dropGloves(),this.glovesDropped=!0),this.isLocal&&e.hitFrame!==void 0&&s===e.hitFrame&&!this.hitDealt&&this.opponent&&this.checkHit(e.hitType)}checkHit(t){var s,r;if(!this.opponent)return;if(Math.abs(this.transform.pos.x-this.opponent.transform.pos.x)<=XS){this.hitDealt=!0;const l=(s=this.scene)==null?void 0:s.engine,h=l==null?void 0:l.networkManager;let u=!1;if(t==="grab")this.opponent.canBeGrabbed()&&(this.opponent.setState("held"),u=!0);else if(this.opponent.canBeHit()){const f=this.opponent.health-1<=0;this.opponent.takeDamage(t);const g=this.transform.pos.x<this.opponent.transform.pos.x?1:-1;if(this.opponent.vx+=g*ty,this.scene&&this.scene.engine&&(l.shake(200,5),l.playHitSound(t)),t==="high"){const m=6+Math.floor(Math.random()*4),A=f?m*10:m;for(let y=0;y<A;y++){const x=this.opponent.pos.x,E=this.opponent.pos.y-70+(Math.random()*20-10),C=f&&Math.random()<.6,L=new xc(x,E,g,C);(r=this.scene)==null||r.add(L)}}u=!0}h&&u&&t!=="grab"&&l.sendHit(t,!this.isPlayer1)}}canBeGrabbed(){return!this.animLocked||this.state==="ready"}canBeHit(){return["idle","ready","held","high_punch","low_punch","grab"].includes(this.state)}takeDamage(t){this.health--,this.health<=0?this.setState("falling"):this.setState(t==="high"?"hit_high":"hit_low")}dropGloves(){var t;(t=this.scene)==null||t.emit("glovesDropped",{x:this.transform.pos.x+(this.isPlayer1?-20:20),y:this.transform.pos.y+60,isPlayer1:this.isPlayer1})}updateGraphics(){const t=this.animations.get(this.state);t&&(this.state==="win"&&!this.isPlayer1?t.flipHorizontal=!1:t.flipHorizontal=!this.facingRight)}}class Nd extends Bi{constructor(t,e,s){super({pos:I(t,e),width:Ld*Dt,height:Fd*Dt,anchor:I(.5,.5)}),this.landed=!1,this.isPlayer1=s,this.targetY=e+20}onInitialize(t){const e=t,r=$i.fromImageSource({image:e.resources.GlovesSheet,grid:{rows:1,columns:2,spriteWidth:Ld,spriteHeight:Fd}}).getSprite(this.isPlayer1?0:1,0);r&&(r.scale=I(Dt,Dt),this.graphics.use(r))}onPreUpdate(t,e){var s;this.pos.y<this.targetY&&(this.pos.y+=30*(e/1e3),this.pos.y>=this.targetY&&(this.pos.y=this.targetY,this.landed||(this.landed=!0,(s=this.scene)==null||s.emit("glovesLanded",{}))))}}class JS{constructor(t){this.shakeTimer=0,this.shakeStrength=0,this.game=t}shake(t,e){this.shakeTimer=t,this.shakeStrength=e}reset(){this.shakeTimer=0,this.shakeStrength=0;const t=this.game.currentScene;t.camera.zoom=1,t.camera.pos=new z(400,200)}update(t){const e=this.game.player1,s=this.game.player2;if(!e||!s)return;const r=800,l=400;let h=1,u=400,f=l/2;const g=this.game.winner==="PLAYER 2"?e:s,m=(g==null?void 0:g.state)==="falling";if(!this.game.glovesLanded)h=1,u=400,f=200;else if(this.game.isGameOver&&this.game.winner&&!m){const xt=g.opponent;if(this.game.koTimer<2e3){h=3.5;const O=g.pos.x<((xt==null?void 0:xt.pos.x)??0)?1:-1;u=g.pos.x+-25*O,f=g.pos.y-20}else h=1,u=400,f=200}else{const xt=e.pos.x,O=s.pos.x,K=(xt+O)/2,X=Math.abs(xt-O),T=1,b=1.4,st=X+250;h=r/st,h=Math.max(T,Math.min(h,b)),u=K,f=l/2}const A=.02,y=this.game.currentScene.camera.zoom,x=y+(h-y)*A;this.game.currentScene.camera.zoom=x;const E=r/x,C=l/x,L=E/2,D=C/2,R=L,P=800-L,F=D,Y=400-D;u=Math.max(R,Math.min(u,P)),f=Math.max(F,Math.min(f,Y));const et=this.game.currentScene.camera.pos.x,k=this.game.currentScene.camera.pos.y,rt=et+(u-et)*A,gt=k+(f-k)*A;let _t=0,At=0;this.shakeTimer>0&&(this.shakeTimer-=t,this.shakeTimer<0&&(this.shakeTimer=0),_t=Math.random()*this.shakeStrength*2-this.shakeStrength,At=Math.random()*this.shakeStrength*2-this.shakeStrength),this.game.currentScene.camera.pos=new z(rt+_t,gt+At)}}class KS{constructor(t){this.isReplaying=!1,this.replayBuffer=[],this.replayIndex=0,this.playbackSpeed=1,this.currentFrameSounds=[],this.replayPool=[],this.game=t,this.bloodRect=new Ro({width:3,height:3,color:$.White})}init(){const t=$i.fromImageSource({image:this.game.resources.GlovesSheet,grid:{rows:1,columns:2,spriteWidth:Ld,spriteHeight:Fd}});this.gloveSpriteP1=t.getSprite(0,0),this.gloveSpriteP1.scale=I(Dt,Dt),this.gloveSpriteP2=t.getSprite(1,0),this.gloveSpriteP2.scale=I(Dt,Dt)}reset(){this.isReplaying=!1,this.replayBuffer=[],this.replayIndex=0,this.playbackSpeed=1,this.replayPool=[],this.currentFrameSounds=[]}toggleReplay(t){this.isReplaying=t,t?(this.replayIndex=0,this.playbackSpeed=1,this.game.currentScene.actors.forEach(e=>{(e instanceof xc||e instanceof Nd)&&e.kill()})):this.replayBuffer.length>0&&this.applySnapshot(this.replayBuffer[this.replayBuffer.length-1])}setPlaybackSpeed(t){this.playbackSpeed=t}seekTo(t){this.replayBuffer.length&&(this.replayIndex=Math.floor(Math.max(0,Math.min(1,t))*(this.replayBuffer.length-1)))}recordFrame(){if(this.game.isGameOver&&this.game.koTimer>5e3||!this.game.player1||!this.game.player2)return;const t=[];this.game.currentScene.actors.forEach(e=>{e instanceof xc?t.push({type:"blood",x:e.pos.x,y:e.pos.y,scale:e.scale.x,color:e.color.toHex(),zIndex:e.z}):e instanceof Nd&&t.push({type:"glove",x:e.pos.x,y:e.pos.y,scale:e.scale.x,zIndex:e.z,isPlayer1:e.isPlayer1})}),this.replayBuffer.push({p1:this.game.player1.getSnapshot(),p2:this.game.player2.getSnapshot(),cameraPos:{x:this.game.currentScene.camera.pos.x,y:this.game.currentScene.camera.pos.y},cameraZoom:this.game.currentScene.camera.zoom,entities:t,sounds:[...this.currentFrameSounds]}),this.currentFrameSounds=[]}recordSound(t){this.isReplaying||this.currentFrameSounds.push(t)}update(){if(this.replayBuffer.length===0)return;const t=Math.floor(this.replayIndex);this.replayIndex+=this.playbackSpeed,this.replayIndex>=this.replayBuffer.length-1&&(this.replayIndex=this.replayBuffer.length-1,this.playbackSpeed=0),this.replayIndex<0&&(this.replayIndex=0,this.playbackSpeed=0);const e=Math.floor(this.replayIndex);if(this.playbackSpeed>0&&e>t)for(let r=t+1;r<=e;r++){const l=this.replayBuffer[r];if(l&&l.sounds){const h=this.game.sfxVolume;l.sounds.forEach(u=>{u==="high"?this.game.resources.PunchHiSound.play(h):u==="low"&&this.game.resources.PunchLowSound.play(h)})}}const s=this.replayBuffer[e];s&&this.applySnapshot(s)}applySnapshot(t){if(!this.game.player1||!this.game.player2)return;this.game.player1.setFromSnapshot(t.p1),this.game.player2.setFromSnapshot(t.p2),this.game.currentScene.camera.pos=new z(t.cameraPos.x,t.cameraPos.y),this.game.currentScene.camera.zoom=t.cameraZoom;let e=0;for(const s of t.entities){let r;e>=this.replayPool.length?(r=new Bi({anchor:I(.5,.5)}),this.game.currentScene.add(r),this.replayPool.push(r)):r=this.replayPool[e],r.pos.x=s.x,r.pos.y=s.y,r.z=s.zIndex,r.scale=I(s.scale,s.scale),r.graphics.visible=!0,s.type==="blood"?(r.graphics.use(this.bloodRect),r.color=$.fromHex(s.color)):s.type==="glove"&&(r.graphics.use(s.isPlayer1?this.gloveSpriteP1:this.gloveSpriteP2),r.color=$.White),e++}for(let s=e;s<this.replayPool.length;s++)this.replayPool[s].graphics.visible=!1}}class S0 extends ta{constructor(t,e,s,r){super({pos:I(t,e),width:s*md*Dt,height:r*md*Dt,anchor:I(.5,.5),z:5}),this.cols=Math.max(2,s),this.rows=Math.max(2,r)}onInitialize(t){const s=t.resources.FramerSheet,r=new qe({image:s,sourceView:{x:0,y:0,width:8,height:8}}),l=new qe({image:s,sourceView:{x:8,y:0,width:8,height:8}}),h=new qe({image:s,sourceView:{x:0,y:8,width:8,height:8}}),u=new qe({image:s,sourceView:{x:8,y:8,width:8,height:8}}),f=new qe({image:s,sourceView:{x:7,y:0,width:1,height:8}}),g=new qe({image:s,sourceView:{x:7,y:8,width:1,height:8}}),m=new qe({image:s,sourceView:{x:0,y:7,width:8,height:1}}),A=new qe({image:s,sourceView:{x:8,y:7,width:8,height:1}}),y=new qe({image:s,sourceView:{x:7,y:7,width:1,height:1}}),x=I(Dt,Dt);r.scale=x,l.scale=x,h.scale=x,u.scale=x,f.scale=I(Dt*8,Dt),g.scale=I(Dt*8,Dt),m.scale=I(Dt,Dt*8),A.scale=I(Dt,Dt*8),y.scale=I(Dt*8,Dt*8);const E=[],C=md*Dt,L=this.cols*C,D=this.rows*C,R=-L/2,P=-D/2;for(let Y=0;Y<this.rows;Y++)for(let et=0;et<this.cols;et++){let k;const rt=et===0,gt=et===this.cols-1,_t=Y===0,At=Y===this.rows-1;rt&&_t?k=r:gt&&_t?k=l:rt&&At?k=h:gt&&At?k=u:_t?k=f:At?k=g:rt?k=m:gt?k=A:k=y,E.push({graphic:k,offset:I(R+et*C,P+Y*C)})}const F=new Cn({members:E});this.graphics.use(F)}}class $S extends Bi{constructor(t,e){super({pos:I(t,e),width:YS*Dt,height:qS*Dt,anchor:I(0,0),z:-20})}onInitialize(t){const s=t.resources.RinkSheet.toSprite();s.scale=I(Dt,Dt),this.graphics.use(s)}}class T0 extends ta{constructor(t,e,s){super({pos:I(t,e),anchor:I(.5,.5),z:10}),this.segments=[],this.lastHealth=-1,this.player=s;const r=4*Dt,l=5*Dt,h=2*Dt,u=[];for(let f=0;f<5;f++){const g=new Ro({width:r,height:l,color:$.fromHex("#1a1a1a"),strokeColor:$.White,lineWidth:1,filtering:ii.Pixel}),m=(f-2)*(r+h);u.push({graphic:g,offset:I(m,0)}),this.segments.push(g)}this.segmentGraphics=new Cn({members:u}),this.graphics.use(this.segmentGraphics)}onPreUpdate(t){this.player.health!==this.lastHealth&&(this.updateSegments(),this.lastHealth=this.player.health)}updateSegments(){const t=$.fromHex("#22c55e"),e=$.fromHex("#ef4444");this.segments.forEach((s,r)=>{r<this.player.health?s.color=t:s.color=e})}}class t1 extends BS{constructor(t){super(t),this.isGameOver=!1,this.winner=null,this.koTimer=0,this.glovesLanded=!1,this.winTriggered=!1,this.networkManager=null,this.isHost=!1,this.opponentDisconnected=!1,this.sfxVolume=.15,this.handlePostUpdate=e=>{this.replayManager.isReplaying?this.replayManager.update():this.player1&&this.player2&&(this.replayManager.recordFrame(),this.checkGameOver(),this.isGameOver&&this.winner&&this.timescale>=1&&(this.koTimer+=e.elapsed),this.cameraManager.update(e.elapsed),this.networkManager&&this.broadcastState()),this.updateUI()},this.onGlovesDropped=e=>{const s=new Nd(e.x,e.y,e.isPlayer1);this.currentScene.add(s)},this.onGlovesLanded=()=>{this.glovesLanded=!0},this.resources=QS(),this.cameraManager=new JS(this),this.replayManager=new KS(this)}get isReplaying(){return this.replayManager.isReplaying}async start(){const t=new yc([this.resources.SpriteSheet,this.resources.GlovesSheet,this.resources.StarsSheet,this.resources.StanleySheet,this.resources.GoalNetsSheet,this.resources.PunchHiSound,this.resources.PunchLowSound,this.resources.FramerSheet,this.resources.RinkSheet,this.resources.SmallFontSheet]);return t.suppressPlayButton=!0,super.start(t).then(()=>{this.replayManager.init()})}setupGame(t){this.uiCallback=t,this.updateUI()}setSFXVolume(t){this.sfxVolume=Math.max(0,Math.min(1,t)),this.updateUI()}playHitSound(t){if(!this.replayManager.isReplaying){const e=this.sfxVolume;t==="high"?this.resources.PunchHiSound.play(e):this.resources.PunchLowSound.play(e),this.replayManager.recordSound(t)}}setupNetwork(t,e){this.networkManager=t,this.isHost=e,this.opponentDisconnected=!1,this.networkManager.onMessage=s=>{if(!(!this.player1||!this.player2))if(s.type==="SYNC"){const r=this.isHost?this.player2:this.player1;r==null||r.syncFromNetwork(s.payload)}else if(s.type==="HIT"){const r=s.payload.targetP1,l=s.payload.damageType,h=r?this.player1:this.player2,u=r?this.player2:this.player1;if(!h||!u)return;h.takeDamage(l);const f=u.pos.x<h.pos.x?1:-1;if(h.vx+=f*ty,this.shake(200,5),this.playHitSound(l),l==="high"){const g=6+Math.floor(Math.random()*4);for(let m=0;m<g;m++){const A=h.pos.x,y=h.pos.y-70+(Math.random()*20-10),x=new xc(A,y,f);this.currentScene.add(x)}}}else s.type==="RESTART"&&this.reset()},this.networkManager.onDisconnect=()=>{this.opponentDisconnected=!0,this.isGameOver=!0,this.updateUI()},this.reset()}sendHit(t,e){this.networkManager&&this.networkManager.send({type:"HIT",payload:{damageType:t,targetP1:e}})}broadcastState(){var e;if(!this.player1||!this.player2)return;const t=this.isHost?this.player1:this.player2;(e=this.networkManager)==null||e.send({type:"SYNC",payload:t.getSyncState()})}restartGame(){this.reset(),this.networkManager&&this.networkManager.send({type:"RESTART",payload:{}})}shake(t,e){this.cameraManager.shake(t,e)}reset(){const t=this.currentScene;t.clear(),this.timescale=1;const e=new $S(0,0);t.add(e);const s=new S0(130,390,5,3);t.add(s);const r=new S0(790,390,5,3);t.add(r);const l=$i.fromImageSource({image:this.resources.SmallFontSheet,grid:{rows:3,columns:32,spriteWidth:8,spriteHeight:8},spacing:{originOffset:{x:0,y:8}}}),h=" !\"#%&'()+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",u=new Ic({alphabet:h,caseInsensitive:!1,spriteSheet:l});this.p1StateDisplay=new Ao({text:"READY",font:u});const f=new ta({pos:I(70,340),anchor:I(.5,.5),z:100});f.graphics.use(this.p1StateDisplay),t.add(f),this.p2StateDisplay=new Ao({text:"READY",font:u});const g=new ta({pos:I(730,340),anchor:I(.5,.5),z:100});g.graphics.use(this.p2StateDisplay),t.add(g),this.isGameOver=!1,this.winner=null,this.koTimer=0,this.glovesLanded=!1,this.winTriggered=!1,this.replayManager.reset(),this.cameraManager.reset();const m=400/2+50;this.player1=new C0(250,m,!0),this.player2=new C0(550,m,!1),this.networkManager?this.isHost?(this.player1.isLocal=!0,this.player2.isLocal=!1):(this.player1.isLocal=!1,this.player2.isLocal=!0):(this.player1.isLocal=!0,this.player2.isLocal=!0),this.player1.opponent=this.player2,this.player2.opponent=this.player1,t.add(this.player1),t.add(this.player2);const A=new T0(105,365,this.player1);t.add(A);const y=new T0(765,365,this.player2);t.add(y),t.off("glovesDropped",this.onGlovesDropped),t.off("glovesLanded",this.onGlovesLanded),t.on("glovesDropped",this.onGlovesDropped),t.on("glovesLanded",this.onGlovesLanded),this.off("postupdate",this.handlePostUpdate),this.on("postupdate",this.handlePostUpdate)}toggleReplay(t){this.replayManager.toggleReplay(t)}setPlaybackSpeed(t){this.replayManager.setPlaybackSpeed(t)}seekTo(t){this.replayManager.seekTo(t)}checkGameOver(){if(!(!this.player1||!this.player2)){if(this.isGameOver||((this.player1.state==="falling"||this.player2.state==="falling")&&(this.timescale=.25),this.player1.state==="down"||this.player1.state==="falling"?(this.isGameOver=!0,this.winner="PLAYER 2"):(this.player2.state==="down"||this.player2.state==="falling")&&(this.isGameOver=!0,this.winner="PLAYER 1")),this.isGameOver&&this.timescale<1){const t=this.winner==="PLAYER 1"?this.player2:this.player1;t&&t.state==="down"&&(this.timescale=1)}this.isGameOver&&!this.winTriggered&&this.winner&&this.koTimer>500&&(this.winTriggered=!0,this.winner==="PLAYER 1"?this.player1.setState("win"):this.player2.setState("win"))}}updateUI(){var t,e,s,r;if(this.p1StateDisplay&&this.player1&&(this.p1StateDisplay.text=this.player1.state.toUpperCase().replace("_"," ")),this.p2StateDisplay&&this.player2&&(this.p2StateDisplay.text=this.player2.state.toUpperCase().replace("_"," ")),this.uiCallback){const l=this.replayManager.replayBuffer.length,h=l>0?this.replayManager.replayIndex/l:0;this.uiCallback({p1Health:((t=this.player1)==null?void 0:t.health)??5,p2Health:((e=this.player2)==null?void 0:e.health)??5,p1State:((s=this.player1)==null?void 0:s.state.toUpperCase().replace("_"," "))??"READY",p2State:((r=this.player2)==null?void 0:r.state.toUpperCase().replace("_"," "))??"READY",gameOver:this.isGameOver,showGameOver:this.isGameOver&&this.koTimer>3e3,winner:this.winner,isReplaying:this.replayManager.isReplaying,replayProgress:h,replaySpeed:this.replayManager.playbackSpeed,isMultiplayer:!!this.networkManager,connectionStatus:this.networkManager?"connected":"disconnected",roomId:this.networkManager?"...":void 0,isHost:this.isHost,opponentDisconnected:this.opponentDisconnected,sfxVolume:this.sfxVolume})}}}class e1{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(t){this.flush(),this._parts.push(t)}append(t){this._pieces.push(t)}flush(){if(this._pieces.length>0){const t=new Uint8Array(this._pieces);this._parts.push(t),this._pieces=[]}}toArrayBuffer(){const t=[];for(const e of this._parts)t.push(e);return i1(t).buffer}}function i1(o){let t=0;for(const r of o)t+=r.byteLength;const e=new Uint8Array(t);let s=0;for(const r of o){const l=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);e.set(l,s),s+=r.byteLength}return e}function ey(o){return new s1(o).unpack()}function iy(o){const t=new n1,e=t.pack(o);return e instanceof Promise?e.then(()=>t.getBuffer()):t.getBuffer()}class s1{constructor(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const t=this.unpack_uint8();if(t<128)return t;if((t^224)<32)return(t^224)-32;let e;if((e=t^160)<=15)return this.unpack_raw(e);if((e=t^176)<=15)return this.unpack_string(e);if((e=t^144)<=15)return this.unpack_array(e);if((e=t^128)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}}unpack_uint8(){const t=this.dataView[this.index]&255;return this.index++,t}unpack_uint16(){const t=this.read(2),e=(t[0]&255)*256+(t[1]&255);return this.index+=2,e}unpack_uint32(){const t=this.read(4),e=((t[0]*256+t[1])*256+t[2])*256+t[3];return this.index+=4,e}unpack_uint64(){const t=this.read(8),e=((((((t[0]*256+t[1])*256+t[2])*256+t[3])*256+t[4])*256+t[5])*256+t[6])*256+t[7];return this.index+=8,e}unpack_int8(){const t=this.unpack_uint8();return t<128?t:t-256}unpack_int16(){const t=this.unpack_uint16();return t<32768?t:t-65536}unpack_int32(){const t=this.unpack_uint32();return t<2**31?t:t-2**32}unpack_int64(){const t=this.unpack_uint64();return t<2**63?t:t-2**64}unpack_raw(t){if(this.length<this.index+t)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${t} ${this.length}`);const e=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,e}unpack_string(t){const e=this.read(t);let s=0,r="",l,h;for(;s<t;)l=e[s],l<160?(h=l,s++):(l^192)<32?(h=(l&31)<<6|e[s+1]&63,s+=2):(l^224)<16?(h=(l&15)<<12|(e[s+1]&63)<<6|e[s+2]&63,s+=3):(h=(l&7)<<18|(e[s+1]&63)<<12|(e[s+2]&63)<<6|e[s+3]&63,s+=4),r+=String.fromCodePoint(h);return this.index+=t,r}unpack_array(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]=this.unpack();return e}unpack_map(t){const e={};for(let s=0;s<t;s++){const r=this.unpack();e[r]=this.unpack()}return e}unpack_float(){const t=this.unpack_uint32(),e=t>>31,s=(t>>23&255)-127,r=t&8388607|8388608;return(e===0?1:-1)*r*2**(s-23)}unpack_double(){const t=this.unpack_uint32(),e=this.unpack_uint32(),s=t>>31,r=(t>>20&2047)-1023,h=(t&1048575|1048576)*2**(r-20)+e*2**(r-52);return(s===0?1:-1)*h}read(t){const e=this.index;if(e+t<=this.length)return this.dataView.subarray(e,e+t);throw new Error("BinaryPackFailure: read index out of range")}}class n1{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(t){if(typeof t=="string")this.pack_string(t);else if(typeof t=="number")Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if(typeof t=="boolean")t===!0?this._bufferBuilder.append(195):t===!1&&this._bufferBuilder.append(194);else if(t===void 0)this._bufferBuilder.append(192);else if(typeof t=="object")if(t===null)this._bufferBuilder.append(192);else{const e=t.constructor;if(t instanceof Array){const s=this.pack_array(t);if(s instanceof Promise)return s.then(()=>this._bufferBuilder.flush())}else if(t instanceof ArrayBuffer)this.pack_bin(new Uint8Array(t));else if("BYTES_PER_ELEMENT"in t){const s=t;this.pack_bin(new Uint8Array(s.buffer,s.byteOffset,s.byteLength))}else if(t instanceof Date)this.pack_string(t.toString());else{if(t instanceof Blob)return t.arrayBuffer().then(s=>{this.pack_bin(new Uint8Array(s)),this._bufferBuilder.flush()});if(e==Object||e.toString().startsWith("class")){const s=this.pack_object(t);if(s instanceof Promise)return s.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${e.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof t}" not yet supported`);this._bufferBuilder.flush()}pack_bin(t){const e=t.length;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this._bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_string(t){const e=this._textEncoder.encode(t),s=e.length;if(s<=15)this.pack_uint8(176+s);else if(s<=65535)this._bufferBuilder.append(216),this.pack_uint16(s);else if(s<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(s);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_array(t){const e=t.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this._bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");const s=r=>{if(r<e){const l=this.pack(t[r]);return l instanceof Promise?l.then(()=>s(r+1)):s(r+1)}};return s(0)}pack_integer(t){if(t>=-32&&t<=127)this._bufferBuilder.append(t&255);else if(t>=0&&t<=255)this._bufferBuilder.append(204),this.pack_uint8(t);else if(t>=-128&&t<=127)this._bufferBuilder.append(208),this.pack_int8(t);else if(t>=0&&t<=65535)this._bufferBuilder.append(205),this.pack_uint16(t);else if(t>=-32768&&t<=32767)this._bufferBuilder.append(209),this.pack_int16(t);else if(t>=0&&t<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(t);else if(t>=-2147483648&&t<=2147483647)this._bufferBuilder.append(210),this.pack_int32(t);else if(t>=-9223372036854776e3&&t<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(t);else if(t>=0&&t<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(t);else throw new Error("Invalid integer")}pack_double(t){let e=0;t<0&&(e=1,t=-t);const s=Math.floor(Math.log(t)/Math.LN2),r=t/2**s-1,l=Math.floor(r*2**52),h=2**32,u=e<<31|s+1023<<20|l/h&1048575,f=l%h;this._bufferBuilder.append(203),this.pack_int32(u),this.pack_int32(f)}pack_object(t){const e=Object.keys(t),s=e.length;if(s<=15)this.pack_uint8(128+s);else if(s<=65535)this._bufferBuilder.append(222),this.pack_uint16(s);else if(s<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(s);else throw new Error("Invalid length");const r=l=>{if(l<e.length){const h=e[l];if(t.hasOwnProperty(h)){this.pack(h);const u=this.pack(t[h]);if(u instanceof Promise)return u.then(()=>r(l+1))}return r(l+1)}};return r(0)}pack_uint8(t){this._bufferBuilder.append(t)}pack_uint16(t){this._bufferBuilder.append(t>>8),this._bufferBuilder.append(t&255)}pack_uint32(t){const e=t&4294967295;this._bufferBuilder.append((e&4278190080)>>>24),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_uint64(t){const e=t/4294967296,s=t%2**32;this._bufferBuilder.append((e&4278190080)>>>24),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255),this._bufferBuilder.append((s&4278190080)>>>24),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255)}pack_int8(t){this._bufferBuilder.append(t&255)}pack_int16(t){this._bufferBuilder.append((t&65280)>>8),this._bufferBuilder.append(t&255)}pack_int32(t){this._bufferBuilder.append(t>>>24&255),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_int64(t){const e=Math.floor(t/4294967296),s=t%2**32;this._bufferBuilder.append((e&4278190080)>>>24),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255),this._bufferBuilder.append((s&4278190080)>>>24),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255)}constructor(){this._bufferBuilder=new e1,this._textEncoder=new TextEncoder}}let sy=!0,ny=!0;function no(o,t,e){const s=o.match(t);return s&&s.length>=e&&parseFloat(s[e],10)}function ir(o,t,e){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,r=s.addEventListener;s.addEventListener=function(h,u){if(h!==t)return r.apply(this,arguments);const f=g=>{const m=e(g);m&&(u.handleEvent?u.handleEvent(m):u(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,f),r.apply(this,[h,f])};const l=s.removeEventListener;s.removeEventListener=function(h,u){if(h!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(u))return l.apply(this,arguments);const f=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[h,f])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function r1(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(sy=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function a1(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(ny=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function ry(){if(typeof window=="object"){if(sy)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Df(o,t){ny&&console.warn(o+" is deprecated, please use "+t+" instead.")}function o1(o){const t={browser:null,version:null};if(typeof o>"u"||!o.navigator||!o.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:e}=o;if(e.mozGetUserMedia)t.browser="firefox",t.version=parseInt(no(e.userAgent,/Firefox\/(\d+)\./,1));else if(e.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(no(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(o.RTCPeerConnection&&e.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(no(e.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype,t._safariVersion=no(e.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function E0(o){return Object.prototype.toString.call(o)==="[object Object]"}function ay(o){return E0(o)?Object.keys(o).reduce(function(t,e){const s=E0(o[e]),r=s?ay(o[e]):o[e],l=s&&!Object.keys(r).length;return r===void 0||l?t:Object.assign(t,{[e]:r})},{}):o}function Hd(o,t,e){!t||e.has(t.id)||(e.set(t.id,t),Object.keys(t).forEach(s=>{s.endsWith("Id")?Hd(o,o.get(t[s]),e):s.endsWith("Ids")&&t[s].forEach(r=>{Hd(o,o.get(r),e)})}))}function D0(o,t,e){const s=e?"outbound-rtp":"inbound-rtp",r=new Map;if(t===null)return r;const l=[];return o.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&l.push(h)}),l.forEach(h=>{o.forEach(u=>{u.type===s&&u.trackId===h.id&&Hd(o,u,r)})}),r}const R0=ry;function oy(o,t){const e=o&&o.navigator;if(!e.mediaDevices)return;const s=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const f={};return Object.keys(u).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const m=typeof u[g]=="object"?u[g]:{ideal:u[g]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const A=function(y,x){return y?y+x.charAt(0).toUpperCase()+x.slice(1):x==="deviceId"?"sourceId":x};if(m.ideal!==void 0){f.optional=f.optional||[];let y={};typeof m.ideal=="number"?(y[A("min",g)]=m.ideal,f.optional.push(y),y={},y[A("max",g)]=m.ideal,f.optional.push(y)):(y[A("",g)]=m.ideal,f.optional.push(y))}m.exact!==void 0&&typeof m.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[A("",g)]=m.exact):["min","max"].forEach(y=>{m[y]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[A(y,g)]=m[y])})}),u.advanced&&(f.optional=(f.optional||[]).concat(u.advanced)),f},r=function(u,f){if(t.version>=61)return f(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const g=function(m,A,y){A in m&&!(y in m)&&(m[y]=m[A],delete m[A])};u=JSON.parse(JSON.stringify(u)),g(u.audio,"autoGainControl","googAutoGainControl"),g(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=s(u.audio)}if(u&&typeof u.video=="object"){let g=u.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const m=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&!(e.mediaDevices.getSupportedConstraints&&e.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete u.video.facingMode;let A;if(g.exact==="environment"||g.ideal==="environment"?A=["back","rear"]:(g.exact==="user"||g.ideal==="user")&&(A=["front"]),A)return e.mediaDevices.enumerateDevices().then(y=>{y=y.filter(E=>E.kind==="videoinput");let x=y.find(E=>A.some(C=>E.label.toLowerCase().includes(C)));return!x&&y.length&&A.includes("back")&&(x=y[y.length-1]),x&&(u.video.deviceId=g.exact?{exact:x.deviceId}:{ideal:x.deviceId}),u.video=s(u.video),R0("chrome: "+JSON.stringify(u)),f(u)})}u.video=s(u.video)}return R0("chrome: "+JSON.stringify(u)),f(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},h=function(u,f,g){r(u,m=>{e.webkitGetUserMedia(m,f,A=>{g&&g(l(A))})})};if(e.getUserMedia=h.bind(e),e.mediaDevices.getUserMedia){const u=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(f){return r(f,g=>u(g).then(m=>{if(g.audio&&!m.getAudioTracks().length||g.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(A=>{A.stop()}),new DOMException("","NotFoundError");return m},m=>Promise.reject(l(m))))}}}function l1(o,t){if(!(o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices)&&o.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}o.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(r=>{const l=s.video&&s.video.width,h=s.video&&s.video.height,u=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:u||3}},l&&(s.video.mandatory.maxWidth=l),h&&(s.video.mandatory.maxHeight=h),o.navigator.mediaDevices.getUserMedia(s)})}}}function ly(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function cy(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",r=>{let l;o.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===r.track.id):l={track:r.track};const h=new Event("track");h.track=r.track,h.receiver=l,h.transceiver={receiver:l},h.streams=[s.stream],this.dispatchEvent(h)}),s.stream.getTracks().forEach(r=>{let l;o.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===r.id):l={track:r};const h=new Event("track");h.track=r,h.receiver=l,h.transceiver={receiver:l},h.streams=[s.stream],this.dispatchEvent(h)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ir(o,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function hy(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const t=function(r,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=r.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:r}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(u,f){let g=r.apply(this,arguments);return g||(g=t(this,u),this._senders.push(g)),g};const l=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const f=this._senders.indexOf(u);f!==-1&&this._senders.splice(f,1)}}const e=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],e.apply(this,[l]),l.getTracks().forEach(h=>{this._senders.push(t(this,h))})};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],s.apply(this,[l]),l.getTracks().forEach(h=>{const u=this._senders.find(f=>f.track===h);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof o=="object"&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const t=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function uy(o){if(!o.RTCPeerConnection)return;const t=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[s,r,l]=arguments;if(arguments.length>0&&typeof s=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof s!="function"))return t.apply(this,[]);const h=function(f){const g={};return f.result().forEach(A=>{const y={id:A.id,timestamp:A.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[A.type]||A.type};A.names().forEach(x=>{y[x]=A.stat(x)}),g[y.id]=y}),g},u=function(f){return new Map(Object.keys(f).map(g=>[g,f[g]]))};if(arguments.length>=2){const f=function(g){r(u(h(g)))};return t.apply(this,[f,s])}return new Promise((f,g)=>{t.apply(this,[function(m){f(u(h(m)))},g])}).then(r,l)}}function dy(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const e=o.RTCPeerConnection.prototype.getSenders;e&&(o.RTCPeerConnection.prototype.getSenders=function(){const l=e.apply(this,[]);return l.forEach(h=>h._pc=this),l});const s=o.RTCPeerConnection.prototype.addTrack;s&&(o.RTCPeerConnection.prototype.addTrack=function(){const l=s.apply(this,arguments);return l._pc=this,l}),o.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(h=>D0(h,l.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const e=o.RTCPeerConnection.prototype.getReceivers;e&&(o.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(l=>l._pc=this),r}),ir(o,"track",s=>(s.receiver._pc=s.srcElement,s)),o.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(l=>D0(l,r.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype&&"getStats"in o.RTCRtpReceiver.prototype))return;const t=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const s=arguments[0];let r,l,h;return this.getSenders().forEach(u=>{u.track===s&&(r?h=!0:r=u)}),this.getReceivers().forEach(u=>(u.track===s&&(l?h=!0:l=u),u.track===s)),h||r&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function fy(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(h=>this._shimmedLocalStreams[h][0])};const t=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(h,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(f)===-1&&this._shimmedLocalStreams[u.id].push(f):this._shimmedLocalStreams[u.id]=[u,f],f};const e=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(h){this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(g=>{if(this.getSenders().find(A=>A.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();e.apply(this,arguments);const f=this.getSenders().filter(g=>u.indexOf(g)===-1);this._shimmedLocalStreams[h.id]=[h].concat(f)};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],s.apply(this,arguments)};const r=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const f=this._shimmedLocalStreams[u].indexOf(h);f!==-1&&this._shimmedLocalStreams[u].splice(f,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),r.apply(this,arguments)}}function py(o,t){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&t.version>=65)return fy(o);const e=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const m=e.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(A=>this._reverseStreams[A.id])};const s=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(A=>{if(this.getSenders().find(x=>x.track===A))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const A=new o.MediaStream(m.getTracks());this._streams[m.id]=A,this._reverseStreams[A.id]=m,m=A}s.apply(this,[m])};const r=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},o.RTCPeerConnection.prototype.addTrack=function(m,A){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(C=>C===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[A.id];if(E)E.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new o.MediaStream([m]);this._streams[A.id]=C,this._reverseStreams[C.id]=A,this.addStream(C)}return this.getSenders().find(C=>C.track===m)};function l(g,m){let A=m.sdp;return Object.keys(g._reverseStreams||[]).forEach(y=>{const x=g._reverseStreams[y],E=g._streams[x.id];A=A.replace(new RegExp(E.id,"g"),x.id)}),new RTCSessionDescription({type:m.type,sdp:A})}function h(g,m){let A=m.sdp;return Object.keys(g._reverseStreams||[]).forEach(y=>{const x=g._reverseStreams[y],E=g._streams[x.id];A=A.replace(new RegExp(x.id,"g"),E.id)}),new RTCSessionDescription({type:m.type,sdp:A})}["createOffer","createAnswer"].forEach(function(g){const m=o.RTCPeerConnection.prototype[g],A={[g](){const y=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[E=>{const C=l(this,E);y[0].apply(null,[C])},E=>{y[1]&&y[1].apply(null,E)},arguments[2]]):m.apply(this,arguments).then(E=>l(this,E))}};o.RTCPeerConnection.prototype[g]=A[g]});const u=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=h(this,arguments[0]),u.apply(this,arguments))};const f=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const g=f.get.apply(this);return g.type===""?g:l(this,g)}}),o.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(m._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let y;Object.keys(this._streams).forEach(x=>{this._streams[x].getTracks().find(C=>m.track===C)&&(y=this._streams[x])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Gd(o,t){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const s=o.RTCPeerConnection.prototype[e],r={[e](){return arguments[0]=new(e==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};o.RTCPeerConnection.prototype[e]=r[e]})}function gy(o,t){ir(o,"negotiationneeded",e=>{const s=e.target;if(!((t.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return e})}const M0=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:gy,shimAddTrackRemoveTrack:py,shimAddTrackRemoveTrackWithNative:fy,shimGetDisplayMedia:l1,shimGetSendersWithDtmf:hy,shimGetStats:uy,shimGetUserMedia:oy,shimMediaStream:ly,shimOnTrack:cy,shimPeerConnection:Gd,shimSenderReceiverGetStats:dy},Symbol.toStringTag,{value:"Module"}));function my(o,t){const e=o&&o.navigator,s=o&&o.MediaStreamTrack;if(e.getUserMedia=function(r,l,h){Df("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(r).then(l,h)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const r=function(h,u,f){u in h&&!(f in h)&&(h[f]=h[u],delete h[u])},l=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),r(h.audio,"autoGainControl","mozAutoGainControl"),r(h.audio,"noiseSuppression","mozNoiseSuppression")),l(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const u=h.apply(this,arguments);return r(u,"mozAutoGainControl","autoGainControl"),r(u,"mozNoiseSuppression","noiseSuppression"),u}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),r(u,"autoGainControl","mozAutoGainControl"),r(u,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[u])}}}}function c1(o,t){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return s.video===!0?s.video={mediaSource:t}:s.video.mediaSource=t,o.navigator.mediaDevices.getUserMedia(s)})}function _y(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qd(o,t){if(typeof o!="object"||!(o.RTCPeerConnection||o.mozRTCPeerConnection))return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const l=o.RTCPeerConnection.prototype[r],h={[r](){return arguments[0]=new(r==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};o.RTCPeerConnection.prototype[r]=h[r]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[l,h,u]=arguments;return s.apply(this,[l||null]).then(f=>{if(t.version<53&&!h)try{f.forEach(g=>{g.type=e[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;f.forEach((m,A)=>{f.set(A,Object.assign({},m,{type:e[m.type]||m.type}))})}return f}).then(h,u)}}function Ay(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender)||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const t=o.RTCPeerConnection.prototype.getSenders;t&&(o.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(l=>l._pc=this),r});const e=o.RTCPeerConnection.prototype.addTrack;e&&(o.RTCPeerConnection.prototype.addTrack=function(){const r=e.apply(this,arguments);return r._pc=this,r}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function yy(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender)||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const t=o.RTCPeerConnection.prototype.getReceivers;t&&(o.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s}),ir(o,"track",e=>(e.receiver._pc=e.srcElement,e)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vy(o){!o.RTCPeerConnection||"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(e){Df("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&e.getTracks().includes(s.track)&&this.removeTrack(s)})})}function xy(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function by(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.addTransceiver;t&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const r=s.length>0;r&&s.forEach(h=>{if("rid"in h&&!/^[a-z0-9]{0,16}$/i.test(h.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in h&&!(parseFloat(h.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in h&&!(parseFloat(h.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=t.apply(this,arguments);if(r){const{sender:h}=l,u=h.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=s,h.sendEncodings=s,this.setParametersPromises.push(h.setParameters(u).then(()=>{delete h.sendEncodings}).catch(()=>{delete h.sendEncodings})))}return l})}function wy(o){if(!(typeof o=="object"&&o.RTCRtpSender))return;const t=o.RTCRtpSender.prototype.getParameters;t&&(o.RTCRtpSender.prototype.getParameters=function(){const s=t.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Cy(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Sy(o){if(!(typeof o=="object"&&o.RTCPeerConnection))return;const t=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const P0=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:by,shimCreateAnswer:Sy,shimCreateOffer:Cy,shimGetDisplayMedia:c1,shimGetParameters:wy,shimGetUserMedia:my,shimOnTrack:_y,shimPeerConnection:Qd,shimRTCDataChannel:xy,shimReceiverGetStats:yy,shimRemoveStream:vy,shimSenderGetStats:Ay},Symbol.toStringTag,{value:"Module"}));function Ty(o){if(!(typeof o!="object"||!o.RTCPeerConnection)){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const t=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(r=>t.call(this,r,s)),s.getVideoTracks().forEach(r=>t.call(this,r,s))},o.RTCPeerConnection.prototype.addTrack=function(s,...r){return r&&r.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(e);if(s===-1)return;this._localStreams.splice(s,1);const r=e.getTracks();this.getSenders().forEach(l=>{r.includes(l.track)&&this.removeTrack(l)})})}}function Ey(o){if(!(typeof o!="object"||!o.RTCPeerConnection)&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const l=new Event("addstream");l.stream=r,this.dispatchEvent(l)})})}});const t=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(l=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(l)>=0)return;s._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,s.dispatchEvent(h)})}),t.apply(s,arguments)}}}function Dy(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const t=o.RTCPeerConnection.prototype,e=t.createOffer,s=t.createAnswer,r=t.setLocalDescription,l=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(g,m){const A=arguments.length>=2?arguments[2]:arguments[0],y=e.apply(this,[A]);return m?(y.then(g,m),Promise.resolve()):y},t.createAnswer=function(g,m){const A=arguments.length>=2?arguments[2]:arguments[0],y=s.apply(this,[A]);return m?(y.then(g,m),Promise.resolve()):y};let u=function(f,g,m){const A=r.apply(this,[f]);return m?(A.then(g,m),Promise.resolve()):A};t.setLocalDescription=u,u=function(f,g,m){const A=l.apply(this,[f]);return m?(A.then(g,m),Promise.resolve()):A},t.setRemoteDescription=u,u=function(f,g,m){const A=h.apply(this,[f]);return m?(A.then(g,m),Promise.resolve()):A},t.addIceCandidate=u}function Ry(o){const t=o&&o.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,s=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=r=>s(My(r))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(s,r,l){t.mediaDevices.getUserMedia(s).then(r,l)}).bind(t))}function My(o){return o&&o.video!==void 0?Object.assign({},o,{video:ay(o.video)}):o}function Py(o){if(!o.RTCPeerConnection)return;const t=o.RTCPeerConnection;o.RTCPeerConnection=function(s,r){if(s&&s.iceServers){const l=[];for(let h=0;h<s.iceServers.length;h++){let u=s.iceServers[h];u.urls===void 0&&u.url?(Df("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,l.push(u)):l.push(s.iceServers[h])}s.iceServers=l}return new t(s,r)},o.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function By(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Iy(o){const t=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const r=this.getTransceivers().find(h=>h.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const l=this.getTransceivers().find(h=>h.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):s.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ky(o){typeof o!="object"||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}const B0=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:ky,shimCallbacksAPI:Dy,shimConstraints:My,shimCreateOfferLegacy:Iy,shimGetUserMedia:Ry,shimLocalStreamsAPI:Ty,shimRTCIceServerUrls:Py,shimRemoteStreamsAPI:Ey,shimTrackEventTransceiver:By},Symbol.toStringTag,{value:"Module"}));var _d={exports:{}},I0;function h1(){return I0||(I0=1,(function(o){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(s=>s.trim())},t.splitSections=function(e){return e.split(`
m=`).map((r,l)=>(l>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(e){const s=t.splitSections(e);return s&&s[0]},t.getMediaSections=function(e){const s=t.splitSections(e);return s.shift(),s},t.matchPrefix=function(e,s){return t.splitLines(e).filter(r=>r.indexOf(s)===0)},t.parseCandidate=function(e){let s;e.indexOf("a=candidate:")===0?s=e.substring(12).split(" "):s=e.substring(10).split(" ");const r={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let l=8;l<s.length;l+=2)switch(s[l]){case"raddr":r.relatedAddress=s[l+1];break;case"rport":r.relatedPort=parseInt(s[l+1],10);break;case"tcptype":r.tcpType=s[l+1];break;case"ufrag":r.ufrag=s[l+1],r.usernameFragment=s[l+1];break;default:r[s[l]]===void 0&&(r[s[l]]=s[l+1]);break}return r},t.writeCandidate=function(e){const s=[];s.push(e.foundation);const r=e.component;r==="rtp"?s.push(1):r==="rtcp"?s.push(2):s.push(r),s.push(e.protocol.toUpperCase()),s.push(e.priority),s.push(e.address||e.ip),s.push(e.port);const l=e.type;return s.push("typ"),s.push(l),l!=="host"&&e.relatedAddress&&e.relatedPort&&(s.push("raddr"),s.push(e.relatedAddress),s.push("rport"),s.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(s.push("ufrag"),s.push(e.usernameFragment||e.ufrag)),"candidate:"+s.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let s=e.substring(9).split(" ");const r={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),r.name=s[0],r.clockRate=parseInt(s[1],10),r.channels=s.length===3?parseInt(s[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let s=e.payloadType;e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+s+" "+e.name+"/"+e.clockRate+(r!==1?"/"+r:"")+`\r
`},t.parseExtmap=function(e){const s=e.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+`\r
`},t.parseFmtp=function(e){const s={};let r;const l=e.substring(e.indexOf(" ")+1).split(";");for(let h=0;h<l.length;h++)r=l[h].trim().split("="),s[r[0].trim()]=r[1];return s},t.writeFmtp=function(e){let s="",r=e.payloadType;if(e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const l=[];Object.keys(e.parameters).forEach(h=>{e.parameters[h]!==void 0?l.push(h+"="+e.parameters[h]):l.push(h)}),s+="a=fmtp:"+r+" "+l.join(";")+`\r
`}return s},t.parseRtcpFb=function(e){const s=e.substring(e.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},t.writeRtcpFb=function(e){let s="",r=e.payloadType;return e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(l=>{s+="a=rtcp-fb:"+r+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),s},t.parseSsrcMedia=function(e){const s=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,s),10)},l=e.indexOf(":",s);return l>-1?(r.attribute=e.substring(s+1,l),r.value=e.substring(l+1)):r.attribute=e.substring(s+1),r},t.parseSsrcGroup=function(e){const s=e.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(r=>parseInt(r,10))}},t.getMid=function(e){const s=t.matchPrefix(e,"a=mid:")[0];if(s)return s.substring(6)},t.parseFingerprint=function(e){const s=e.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},t.getDtlsParameters=function(e,s){return{role:"auto",fingerprints:t.matchPrefix(e+s,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,s){let r="a=setup:"+s+`\r
`;return e.fingerprints.forEach(l=>{r+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),r},t.parseCryptoLine=function(e){const s=e.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;const s=e.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,s){return t.matchPrefix(e+s,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,s){const r=t.matchPrefix(e+s,"a=ice-ufrag:")[0],l=t.matchPrefix(e+s,"a=ice-pwd:")[0];return r&&l?{usernameFragment:r.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(e){let s="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(s+=`a=ice-lite\r
`),s},t.parseRtpParameters=function(e){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=t.splitLines(e)[0].split(" ");s.profile=l[2];for(let u=3;u<l.length;u++){const f=l[u],g=t.matchPrefix(e,"a=rtpmap:"+f+" ")[0];if(g){const m=t.parseRtpMap(g),A=t.matchPrefix(e,"a=fmtp:"+f+" ");switch(m.parameters=A.length?t.parseFmtp(A[0]):{},m.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),s.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(m.name.toUpperCase());break}}}t.matchPrefix(e,"a=extmap:").forEach(u=>{s.headerExtensions.push(t.parseExtmap(u))});const h=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return s.codecs.forEach(u=>{h.forEach(f=>{u.rtcpFeedback.find(m=>m.type===f.type&&m.parameter===f.parameter)||u.rtcpFeedback.push(f)})}),s},t.writeRtpDescription=function(e,s){let r="";r+="m="+e+" ",r+=s.codecs.length>0?"9":"0",r+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=s.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(h=>{r+=t.writeRtpMap(h),r+=t.writeFmtp(h),r+=t.writeRtcpFb(h)});let l=0;return s.codecs.forEach(h=>{h.maxptime>l&&(l=h.maxptime)}),l>0&&(r+="a=maxptime:"+l+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(h=>{r+=t.writeExtmap(h)}),r},t.parseRtpEncodingParameters=function(e){const s=[],r=t.parseRtpParameters(e),l=r.fecMechanisms.indexOf("RED")!==-1,h=r.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(e,"a=ssrc:").map(y=>t.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),f=u.length>0&&u[0].ssrc;let g;const m=t.matchPrefix(e,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(E=>parseInt(E,10)));m.length>0&&m[0].length>1&&m[0][0]===f&&(g=m[0][1]),r.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let x={ssrc:f,codecPayloadType:parseInt(y.parameters.apt,10)};f&&g&&(x.rtx={ssrc:g}),s.push(x),l&&(x=JSON.parse(JSON.stringify(x)),x.fec={ssrc:f,mechanism:h?"red+ulpfec":"red"},s.push(x))}}),s.length===0&&f&&s.push({ssrc:f});let A=t.matchPrefix(e,"b=");return A.length&&(A[0].indexOf("b=TIAS:")===0?A=parseInt(A[0].substring(7),10):A[0].indexOf("b=AS:")===0?A=parseInt(A[0].substring(5),10)*1e3*.95-2e3*8:A=void 0,s.forEach(y=>{y.maxBitrate=A})),s},t.parseRtcpParameters=function(e){const s={},r=t.matchPrefix(e,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];r&&(s.cname=r.value,s.ssrc=r.ssrc);const l=t.matchPrefix(e,"a=rtcp-rsize");s.reducedSize=l.length>0,s.compound=l.length===0;const h=t.matchPrefix(e,"a=rtcp-mux");return s.mux=h.length>0,s},t.writeRtcpParameters=function(e){let s="";return e.reducedSize&&(s+=`a=rtcp-rsize\r
`),e.mux&&(s+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(s+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),s},t.parseMsid=function(e){let s;const r=t.matchPrefix(e,"a=msid:");if(r.length===1)return s=r[0].substring(7).split(" "),{stream:s[0],track:s[1]};const l=t.matchPrefix(e,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");if(l.length>0)return s=l[0].value.split(" "),{stream:s[0],track:s[1]}},t.parseSctpDescription=function(e){const s=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let l;r.length>0&&(l=parseInt(r[0].substring(19),10)),isNaN(l)&&(l=65536);const h=t.matchPrefix(e,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:l};const u=t.matchPrefix(e,"a=sctpmap:");if(u.length>0){const f=u[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:l}}},t.writeSctpDescription=function(e,s){let r=[];return e.protocol!=="DTLS/SCTP"?r=["m="+e.kind+" 9 "+e.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:r=["m="+e.kind+" 9 "+e.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&r.push("a=max-message-size:"+s.maxMessageSize+`\r
`),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,s,r){let l;const h=s!==void 0?s:2;return e?l=e:l=t.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+l+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(e,s){const r=t.splitLines(e);for(let l=0;l<r.length;l++)switch(r[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[l].substring(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){const r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;const s=t.splitLines(e);for(let r=0;r<s.length;r++)if(s[r].length<2||s[r].charAt(1)!=="=")return!1;return!0},o.exports=t})(_d)),_d.exports}var zy=h1();const Jr=af(zy),u1=vb({__proto__:null,default:Jr},[zy]);function ac(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const t=o.RTCIceCandidate;o.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const r=new t(s),l=Jr.parseCandidate(s.candidate);for(const h in l)h in r||Object.defineProperty(r,h,{value:l[h]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(s)},o.RTCIceCandidate.prototype=t.prototype,ir(o,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new o.RTCIceCandidate(e.candidate),writable:"false"}),e))}function jd(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||ir(o,"icecandidate",t=>{if(t.candidate){const e=Jr.parseCandidate(t.candidate.candidate);e.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t})}function oc(o,t){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const e=function(u){if(!u||!u.sdp)return!1;const f=Jr.splitSections(u.sdp);return f.shift(),f.some(g=>{const m=Jr.parseMLine(g);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},s=function(u){const f=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const g=parseInt(f[1],10);return g!==g?-1:g},r=function(u){let f=65536;return t.browser==="firefox"&&(t.version<57?u===-1?f=16384:f=2147483637:t.version<60?f=t.version===57?65535:65536:f=2147483637),f},l=function(u,f){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const m=Jr.matchPrefix(u.sdp,"a=max-message-size:");return m.length>0?g=parseInt(m[0].substring(19),10):t.browser==="firefox"&&f!==-1&&(g=2147483637),g},h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const f=s(arguments[0]),g=r(f),m=l(arguments[0],f);let A;g===0&&m===0?A=Number.POSITIVE_INFINITY:g===0||m===0?A=Math.max(g,m):A=Math.min(g,m);const y={};Object.defineProperty(y,"maxMessageSize",{get(){return A}}),this._sctp=y}return h.apply(this,arguments)}}function lc(o){if(!(o.RTCPeerConnection&&"createDataChannel"in o.RTCPeerConnection.prototype))return;function t(s,r){const l=s.send;s.send=function(){const u=arguments[0],f=u.length||u.size||u.byteLength;if(s.readyState==="open"&&r.sctp&&f>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return l.apply(s,arguments)}}const e=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const r=e.apply(this,arguments);return t(r,this),r},ir(o,"datachannel",s=>(t(s.channel,s.target),s))}function Vd(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const t=o.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const s=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const l=r.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const h=new Event("connectionstatechange",r);l.dispatchEvent(h)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function Yd(o,t){if(!o.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const e=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=r.sdp.split(`
`).filter(h=>h.trim()!=="a=extmap-allow-mixed").join(`
`);o.RTCSessionDescription&&r instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:r.type,sdp:l}):r.sdp=l}return e.apply(this,arguments)}}function cc(o,t){if(!(o.RTCPeerConnection&&o.RTCPeerConnection.prototype))return;const e=o.RTCPeerConnection.prototype.addIceCandidate;!e||e.length===0||(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function hc(o,t){if(!(o.RTCPeerConnection&&o.RTCPeerConnection.prototype))return;const e=o.RTCPeerConnection.prototype.setLocalDescription;!e||e.length===0||(o.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return e.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?e.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(h=>e.apply(this,[h]))})}const d1=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Yd,shimAddIceCandidateNullOrEmpty:cc,shimConnectionState:Vd,shimMaxMessageSize:oc,shimParameterlessSetLocalDescription:hc,shimRTCIceCandidate:ac,shimRTCIceCandidateRelayProtocol:jd,shimSendThrowTypeError:lc},Symbol.toStringTag,{value:"Module"}));function f1({window:o}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const e=ry,s=o1(o),r={browserDetails:s,commonShim:d1,extractVersion:no,disableLog:r1,disableWarnings:a1,sdp:u1};switch(s.browser){case"chrome":if(!M0||!Gd||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),r;if(s.version===null)return e("Chrome shim can not determine version, not shimming."),r;e("adapter.js shimming chrome."),r.browserShim=M0,cc(o,s),hc(o),oy(o,s),ly(o),Gd(o,s),cy(o),py(o,s),hy(o),uy(o),dy(o),gy(o,s),ac(o),jd(o),Vd(o),oc(o,s),lc(o),Yd(o,s);break;case"firefox":if(!P0||!Qd||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),r;e("adapter.js shimming firefox."),r.browserShim=P0,cc(o,s),hc(o),my(o,s),Qd(o,s),_y(o),vy(o),Ay(o),yy(o),xy(o),by(o),wy(o),Cy(o),Sy(o),ac(o),Vd(o),oc(o,s),lc(o);break;case"safari":if(!B0||!t.shimSafari)return e("Safari shim is not included in this adapter release."),r;e("adapter.js shimming safari."),r.browserShim=B0,cc(o,s),hc(o),Py(o),Iy(o),Dy(o),Ty(o),Ey(o),By(o),Ry(o),ky(o),ac(o),jd(o),oc(o,s),lc(o),Yd(o,s);break;default:e("Unsupported browser!");break}return r}const k0=f1({window:typeof window>"u"?void 0:window});let qd;try{qd=new TextDecoder}catch{}let ht,Wn,W=0;const p1=105,g1=57342,m1=57343,z0=57337,O0=6,Vr={};let Ut={},de,bc,wc=0,vo=0,Re,Ji,Te=[],Xd=[],mi,ti,ro,U0={useRecords:!1,mapsAsObjects:!0},xo=!1,Oy=2;try{new Function("")}catch{Oy=1/0}class bo{constructor(t){if(t&&((t.keyMap||t._keyMap)&&!t.useRecords&&(t.useRecords=!1,t.mapsAsObjects=!0),t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.getStructures&&(t.getShared=t.getStructures),t.getShared&&!t.structures&&((t.structures=[]).uninitialized=!0),t.keyMap)){this.mapKey=new Map;for(let[e,s]of Object.entries(t.keyMap))this.mapKey.set(s,e)}Object.assign(this,t)}decodeKey(t){return this.keyMap&&this.mapKey.get(t)||t}encodeKey(t){return this.keyMap&&this.keyMap.hasOwnProperty(t)?this.keyMap[t]:t}encodeKeys(t){if(!this._keyMap)return t;let e=new Map;for(let[s,r]of Object.entries(t))e.set(this._keyMap.hasOwnProperty(s)?this._keyMap[s]:s,r);return e}decodeKeys(t){if(!this._keyMap||t.constructor.name!="Map")return t;if(!this._mapKey){this._mapKey=new Map;for(let[s,r]of Object.entries(this._keyMap))this._mapKey.set(r,s)}let e={};return t.forEach((s,r)=>e[ji(this._mapKey.has(r)?this._mapKey.get(r):r)]=s),e}mapDecode(t,e){let s=this.decode(t);if(this._keyMap)switch(s.constructor.name){case"Array":return s.map(r=>this.decodeKeys(r))}return s}decode(t,e){if(ht)return Ny(()=>(Kd(),this?this.decode(t,e):bo.prototype.decode.call(U0,t,e)));Wn=e>-1?e:t.length,W=0,vo=0,bc=null,Re=null,ht=t;try{ti=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(s){throw ht=null,t instanceof Uint8Array?s:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof bo){if(Ut=this,mi=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return de=this.structures,tc();(!de||de.length>0)&&(de=[])}else Ut=U0,(!de||de.length>0)&&(de=[]),mi=null;return tc()}decodeMultiple(t,e){let s,r=0;try{let l=t.length;xo=!0;let h=this?this.decode(t,l):Pf.decode(t,l);if(e){if(e(h)===!1)return;for(;W<l;)if(r=W,e(tc())===!1)return}else{for(s=[h];W<l;)r=W,s.push(tc());return s}}catch(l){throw l.lastPosition=r,l.values=s,l}finally{xo=!1,Kd()}}}function tc(){try{let o=Ot();if(Re){if(W>=Re.postBundlePosition){let t=new Error("Unexpected bundle position");throw t.incomplete=!0,t}W=Re.postBundlePosition,Re=null}if(W==Wn)de=null,ht=null,Ji&&(Ji=null);else if(W>Wn){let t=new Error("Unexpected end of CBOR data");throw t.incomplete=!0,t}else if(!xo)throw new Error("Data read, but end of buffer not reached");return o}catch(o){throw Kd(),(o instanceof RangeError||o.message.startsWith("Unexpected end of buffer"))&&(o.incomplete=!0),o}}function Ot(){let o=ht[W++],t=o>>5;if(o=o&31,o>23)switch(o){case 24:o=ht[W++];break;case 25:if(t==7)return v1();o=ti.getUint16(W),W+=2;break;case 26:if(t==7){let e=ti.getFloat32(W);if(Ut.useFloat32>2){let s=Mf[(ht[W]&127)<<1|ht[W+1]>>7];return W+=4,(s*e+(e>0?.5:-.5)>>0)/s}return W+=4,e}o=ti.getUint32(W),W+=4;break;case 27:if(t==7){let e=ti.getFloat64(W);return W+=8,e}if(t>1){if(ti.getUint32(W)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");o=ti.getUint32(W+4)}else Ut.int64AsNumber?(o=ti.getUint32(W)*4294967296,o+=ti.getUint32(W+4)):o=ti.getBigUint64(W);W+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let e=[],s,r=0;for(;(s=Ot())!=Vr;)e[r++]=s;return t==4?e:t==3?e.join(""):Buffer.concat(e);case 5:let l;if(Ut.mapsAsObjects){let h={};if(Ut.keyMap)for(;(l=Ot())!=Vr;)h[ji(Ut.decodeKey(l))]=Ot();else for(;(l=Ot())!=Vr;)h[ji(l)]=Ot();return h}else{ro&&(Ut.mapsAsObjects=!0,ro=!1);let h=new Map;if(Ut.keyMap)for(;(l=Ot())!=Vr;)h.set(Ut.decodeKey(l),Ot());else for(;(l=Ot())!=Vr;)h.set(l,Ot());return h}case 7:return Vr;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+o)}switch(t){case 0:return o;case 1:return~o;case 2:return y1(o);case 3:if(vo>=W)return bc.slice(W-wc,(W+=o)-wc);if(vo==0&&Wn<140&&o<32){let r=o<16?Uy(o):A1(o);if(r!=null)return r}return _1(o);case 4:let e=new Array(o);for(let r=0;r<o;r++)e[r]=Ot();return e;case 5:if(Ut.mapsAsObjects){let r={};if(Ut.keyMap)for(let l=0;l<o;l++)r[ji(Ut.decodeKey(Ot()))]=Ot();else for(let l=0;l<o;l++)r[ji(Ot())]=Ot();return r}else{ro&&(Ut.mapsAsObjects=!0,ro=!1);let r=new Map;if(Ut.keyMap)for(let l=0;l<o;l++)r.set(Ut.decodeKey(Ot()),Ot());else for(let l=0;l<o;l++)r.set(Ot(),Ot());return r}case 6:if(o>=z0){let r=de[o&8191];if(r)return r.read||(r.read=Zd(r)),r.read();if(o<65536){if(o==m1){let l=Zr(),h=Ot(),u=Ot();Jd(h,u);let f={};if(Ut.keyMap)for(let g=2;g<l;g++){let m=Ut.decodeKey(u[g-2]);f[ji(m)]=Ot()}else for(let g=2;g<l;g++){let m=u[g-2];f[ji(m)]=Ot()}return f}else if(o==g1){let l=Zr(),h=Ot();for(let u=2;u<l;u++)Jd(h++,Ot());return Ot()}else if(o==z0)return T1();if(Ut.getShared&&(Rf(),r=de[o&8191],r))return r.read||(r.read=Zd(r)),r.read()}}let s=Te[o];if(s)return s.handlesRead?s(Ot):s(Ot());{let r=Ot();for(let l=0;l<Xd.length;l++){let h=Xd[l](o,r);if(h!==void 0)return h}return new $n(r,o)}case 7:switch(o){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let r=(mi||Xn())[o];if(r!==void 0)return r;throw new Error("Unknown token "+o)}default:if(isNaN(o)){let r=new Error("Unexpected end of CBOR data");throw r.incomplete=!0,r}throw new Error("Unknown CBOR token "+o)}}const L0=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Zd(o){function t(){let e=ht[W++];if(e=e&31,e>23)switch(e){case 24:e=ht[W++];break;case 25:e=ti.getUint16(W),W+=2;break;case 26:e=ti.getUint32(W),W+=4;break;default:throw new Error("Expected array header, but got "+ht[W-1])}let s=this.compiledReader;for(;s;){if(s.propertyCount===e)return s(Ot);s=s.next}if(this.slowReads++>=Oy){let l=this.length==e?this:this.slice(0,e);return s=Ut.keyMap?new Function("r","return {"+l.map(h=>Ut.decodeKey(h)).map(h=>L0.test(h)?ji(h)+":r()":"["+JSON.stringify(h)+"]:r()").join(",")+"}"):new Function("r","return {"+l.map(h=>L0.test(h)?ji(h)+":r()":"["+JSON.stringify(h)+"]:r()").join(",")+"}"),this.compiledReader&&(s.next=this.compiledReader),s.propertyCount=e,this.compiledReader=s,s(Ot)}let r={};if(Ut.keyMap)for(let l=0;l<e;l++)r[ji(Ut.decodeKey(this[l]))]=Ot();else for(let l=0;l<e;l++)r[ji(this[l])]=Ot();return r}return o.slowReads=0,t}function ji(o){return o==="__proto__"?"__proto_":o}let _1=Wd;function Wd(o){let t;if(o<16&&(t=Uy(o)))return t;if(o>64&&qd)return qd.decode(ht.subarray(W,W+=o));const e=W+o,s=[];for(t="";W<e;){const r=ht[W++];if((r&128)===0)s.push(r);else if((r&224)===192){const l=ht[W++]&63;s.push((r&31)<<6|l)}else if((r&240)===224){const l=ht[W++]&63,h=ht[W++]&63;s.push((r&31)<<12|l<<6|h)}else if((r&248)===240){const l=ht[W++]&63,h=ht[W++]&63,u=ht[W++]&63;let f=(r&7)<<18|l<<12|h<<6|u;f>65535&&(f-=65536,s.push(f>>>10&1023|55296),f=56320|f&1023),s.push(f)}else s.push(r);s.length>=4096&&(t+=Be.apply(String,s),s.length=0)}return s.length>0&&(t+=Be.apply(String,s)),t}let Be=String.fromCharCode;function A1(o){let t=W,e=new Array(o);for(let s=0;s<o;s++){const r=ht[W++];if((r&128)>0){W=t;return}e[s]=r}return Be.apply(String,e)}function Uy(o){if(o<4)if(o<2){if(o===0)return"";{let t=ht[W++];if((t&128)>1){W-=1;return}return Be(t)}}else{let t=ht[W++],e=ht[W++];if((t&128)>0||(e&128)>0){W-=2;return}if(o<3)return Be(t,e);let s=ht[W++];if((s&128)>0){W-=3;return}return Be(t,e,s)}else{let t=ht[W++],e=ht[W++],s=ht[W++],r=ht[W++];if((t&128)>0||(e&128)>0||(s&128)>0||(r&128)>0){W-=4;return}if(o<6){if(o===4)return Be(t,e,s,r);{let l=ht[W++];if((l&128)>0){W-=5;return}return Be(t,e,s,r,l)}}else if(o<8){let l=ht[W++],h=ht[W++];if((l&128)>0||(h&128)>0){W-=6;return}if(o<7)return Be(t,e,s,r,l,h);let u=ht[W++];if((u&128)>0){W-=7;return}return Be(t,e,s,r,l,h,u)}else{let l=ht[W++],h=ht[W++],u=ht[W++],f=ht[W++];if((l&128)>0||(h&128)>0||(u&128)>0||(f&128)>0){W-=8;return}if(o<10){if(o===8)return Be(t,e,s,r,l,h,u,f);{let g=ht[W++];if((g&128)>0){W-=9;return}return Be(t,e,s,r,l,h,u,f,g)}}else if(o<12){let g=ht[W++],m=ht[W++];if((g&128)>0||(m&128)>0){W-=10;return}if(o<11)return Be(t,e,s,r,l,h,u,f,g,m);let A=ht[W++];if((A&128)>0){W-=11;return}return Be(t,e,s,r,l,h,u,f,g,m,A)}else{let g=ht[W++],m=ht[W++],A=ht[W++],y=ht[W++];if((g&128)>0||(m&128)>0||(A&128)>0||(y&128)>0){W-=12;return}if(o<14){if(o===12)return Be(t,e,s,r,l,h,u,f,g,m,A,y);{let x=ht[W++];if((x&128)>0){W-=13;return}return Be(t,e,s,r,l,h,u,f,g,m,A,y,x)}}else{let x=ht[W++],E=ht[W++];if((x&128)>0||(E&128)>0){W-=14;return}if(o<15)return Be(t,e,s,r,l,h,u,f,g,m,A,y,x,E);let C=ht[W++];if((C&128)>0){W-=15;return}return Be(t,e,s,r,l,h,u,f,g,m,A,y,x,E,C)}}}}}function y1(o){return Ut.copyBuffers?Uint8Array.prototype.slice.call(ht,W,W+=o):ht.subarray(W,W+=o)}let Ly=new Float32Array(1),ec=new Uint8Array(Ly.buffer,0,4);function v1(){let o=ht[W++],t=ht[W++],e=(o&127)>>2;if(e===31)return t||o&3?NaN:o&128?-1/0:1/0;if(e===0){let s=((o&3)<<8|t)/16777216;return o&128?-s:s}return ec[3]=o&128|(e>>1)+56,ec[2]=(o&7)<<5|t>>3,ec[1]=t<<5,ec[0]=0,Ly[0]}new Array(4096);class $n{constructor(t,e){this.value=t,this.tag=e}}Te[0]=o=>new Date(o);Te[1]=o=>new Date(Math.round(o*1e3));Te[2]=o=>{let t=BigInt(0);for(let e=0,s=o.byteLength;e<s;e++)t=BigInt(o[e])+t<<BigInt(8);return t};Te[3]=o=>BigInt(-1)-Te[2](o);Te[4]=o=>+(o[1]+"e"+o[0]);Te[5]=o=>o[1]*Math.exp(o[0]*Math.log(2));const Jd=(o,t)=>{o=o-57344;let e=de[o];e&&e.isShared&&((de.restoreStructures||(de.restoreStructures=[]))[o]=e),de[o]=t,t.read=Zd(t)};Te[p1]=o=>{let t=o.length,e=o[1];Jd(o[0],e);let s={};for(let r=2;r<t;r++){let l=e[r-2];s[ji(l)]=o[r]}return s};Te[14]=o=>Re?Re[0].slice(Re.position0,Re.position0+=o):new $n(o,14);Te[15]=o=>Re?Re[1].slice(Re.position1,Re.position1+=o):new $n(o,15);let x1={Error,RegExp};Te[27]=o=>(x1[o[0]]||Error)(o[1],o[2]);const Fy=o=>{if(ht[W++]!=132)throw new Error("Packed values structure must be followed by a 4 element array");let t=o();return mi=mi?t.concat(mi.slice(t.length)):t,mi.prefixes=o(),mi.suffixes=o(),o()};Fy.handlesRead=!0;Te[51]=Fy;Te[O0]=o=>{if(!mi)if(Ut.getShared)Rf();else return new $n(o,O0);if(typeof o=="number")return mi[16+(o>=0?2*o:-2*o-1)];throw new Error("No support for non-integer packed references yet")};Te[28]=o=>{Ji||(Ji=new Map,Ji.id=0);let t=Ji.id++,e=ht[W],s;e>>5==4?s=[]:s={};let r={target:s};Ji.set(t,r);let l=o();return r.used?Object.assign(s,l):(r.target=l,l)};Te[28].handlesRead=!0;Te[29]=o=>{let t=Ji.get(o);return t.used=!0,t.target};Te[258]=o=>new Set(o);(Te[259]=o=>(Ut.mapsAsObjects&&(Ut.mapsAsObjects=!1,ro=!0),o())).handlesRead=!0;function Yr(o,t){return typeof o=="string"?o+t:o instanceof Array?o.concat(t):Object.assign({},o,t)}function Xn(){if(!mi)if(Ut.getShared)Rf();else throw new Error("No packed values available");return mi}const b1=1399353956;Xd.push((o,t)=>{if(o>=225&&o<=255)return Yr(Xn().prefixes[o-224],t);if(o>=28704&&o<=32767)return Yr(Xn().prefixes[o-28672],t);if(o>=1879052288&&o<=2147483647)return Yr(Xn().prefixes[o-1879048192],t);if(o>=216&&o<=223)return Yr(t,Xn().suffixes[o-216]);if(o>=27647&&o<=28671)return Yr(t,Xn().suffixes[o-27639]);if(o>=1811940352&&o<=1879048191)return Yr(t,Xn().suffixes[o-1811939328]);if(o==b1)return{packedValues:mi,structures:de.slice(0),version:t};if(o==55799)return t});const w1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,F0=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],C1=[64,68,69,70,71,72,77,78,79,85,86];for(let o=0;o<F0.length;o++)S1(F0[o],C1[o]);function S1(o,t){let e="get"+o.name.slice(0,-5),s;typeof o=="function"?s=o.BYTES_PER_ELEMENT:o=null;for(let r=0;r<2;r++){if(!r&&s==1)continue;let l=s==2?1:s==4?2:3;Te[r?t:t-4]=s==1||r==w1?h=>{if(!o)throw new Error("Could not find typed array for code "+t);return new o(Uint8Array.prototype.slice.call(h,0).buffer)}:h=>{if(!o)throw new Error("Could not find typed array for code "+t);let u=new DataView(h.buffer,h.byteOffset,h.byteLength),f=h.length>>l,g=new o(f),m=u[e];for(let A=0;A<f;A++)g[A]=m.call(u,A<<l,r);return g}}}function T1(){let o=Zr(),t=W+Ot();for(let s=2;s<o;s++){let r=Zr();W+=r}let e=W;return W=t,Re=[Wd(Zr()),Wd(Zr())],Re.position0=0,Re.position1=0,Re.postBundlePosition=W,W=e,Ot()}function Zr(){let o=ht[W++]&31;if(o>23)switch(o){case 24:o=ht[W++];break;case 25:o=ti.getUint16(W),W+=2;break;case 26:o=ti.getUint32(W),W+=4;break}return o}function Rf(){if(Ut.getShared){let o=Ny(()=>(ht=null,Ut.getShared()))||{},t=o.structures||[];Ut.sharedVersion=o.version,mi=Ut.sharedValues=o.packedValues,de===!0?Ut.structures=de=t:de.splice.apply(de,[0,t.length].concat(t))}}function Ny(o){let t=Wn,e=W,s=wc,r=vo,l=bc,h=Ji,u=Re,f=new Uint8Array(ht.slice(0,Wn)),g=de,m=Ut,A=xo,y=o();return Wn=t,W=e,wc=s,vo=r,bc=l,Ji=h,Re=u,ht=f,xo=A,de=g,Ut=m,ti=new DataView(ht.buffer,ht.byteOffset,ht.byteLength),y}function Kd(){ht=null,Ji=null,de=null}const Mf=new Array(147);for(let o=0;o<256;o++)Mf[o]=+("1e"+Math.floor(45.15-o*.30103));let Pf=new bo({useRecords:!1});Pf.decode;Pf.decodeMultiple;let uc;try{uc=new TextEncoder}catch{}let $d,Hy;const Uc=typeof globalThis=="object"&&globalThis.Buffer,Mo=typeof Uc<"u",Ad=Mo?Uc.allocUnsafeSlow:Uint8Array,N0=Mo?Uc:Uint8Array,H0=256,G0=Mo?4294967296:2144337920;let yd,G,ne,M=0,mn,De=null;const E1=61440,D1=/[\u0080-\uFFFF]/,Di=Symbol("record-id");class R1 extends bo{constructor(t){super(t),this.offset=0;let e,s,r,l,h;t=t||{};let u=N0.prototype.utf8Write?function(O,K,X){return G.utf8Write(O,K,X)}:uc&&uc.encodeInto?function(O,K){return uc.encodeInto(O,G.subarray(K)).written}:!1,f=this,g=t.structures||t.saveStructures,m=t.maxSharedStructures;if(m==null&&(m=g?128:0),m>8190)throw new Error("Maximum maxSharedStructure is 8190");let A=t.sequential;A&&(m=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let y,x,E=t.sharedValues,C;if(E){C=Object.create(null);for(let O=0,K=E.length;O<K;O++)C[E[O]]=O}let L=[],D=0,R=0;this.mapEncode=function(O,K){if(this._keyMap&&!this._mapped)switch(O.constructor.name){case"Array":O=O.map(X=>this.encodeKeys(X));break}return this.encode(O,K)},this.encode=function(O,K){if(G||(G=new Ad(8192),ne=new DataView(G.buffer,0,8192),M=0),mn=G.length-10,mn-M<2048?(G=new Ad(G.length),ne=new DataView(G.buffer,0,G.length),mn=G.length-10,M=0):K===Y0&&(M=M+7&2147483640),e=M,f.useSelfDescribedHeader&&(ne.setUint32(M,3654940416),M+=3),h=f.structuredClone?new Map:null,f.bundleStrings&&typeof O!="string"?(De=[],De.size=1/0):De=null,s=f.structures,s){if(s.uninitialized){let T=f.getShared()||{};f.structures=s=T.structures||[],f.sharedVersion=T.version;let b=f.sharedValues=T.packedValues;if(b){C={};for(let tt=0,st=b.length;tt<st;tt++)C[b[tt]]=tt}}let X=s.length;if(X>m&&!A&&(X=m),!s.transitions){s.transitions=Object.create(null);for(let T=0;T<X;T++){let b=s[T];if(!b)continue;let tt,st=s.transitions;for(let at=0,w=b.length;at<w;at++){st[Di]===void 0&&(st[Di]=T);let j=b[at];tt=st[j],tt||(tt=st[j]=Object.create(null)),st=tt}st[Di]=T|1048576}}A||(s.nextId=X)}if(r&&(r=!1),l=s||[],x=C,t.pack){let X=new Map;if(X.values=[],X.encoder=f,X.maxValues=t.maxPrivatePackedValues||(C?16:1/0),X.objectMap=C||!1,X.samplingPackedValues=y,dc(O,X),X.values.length>0){G[M++]=216,G[M++]=51,ls(4);let T=X.values;P(T),ls(0),ls(0),x=Object.create(C||null);for(let b=0,tt=T.length;b<tt;b++)x[T[b]]=b}}yd=K&xd;try{if(yd)return;if(P(O),De&&V0(e,P),f.offset=M,h&&h.idsToInsert){M+=h.idsToInsert.length*2,M>mn&&Y(M),f.offset=M;let X=B1(G.subarray(e,M),h.idsToInsert);return h=null,X}return K&Y0?(G.start=e,G.end=M,G):G.subarray(e,M)}finally{if(s){if(R<10&&R++,s.length>m&&(s.length=m),D>1e4)s.transitions=null,R=0,D=0,L.length>0&&(L=[]);else if(L.length>0&&!A){for(let X=0,T=L.length;X<T;X++)L[X][Di]=void 0;L=[]}}if(r&&f.saveShared){f.structures.length>m&&(f.structures=f.structures.slice(0,m));let X=G.subarray(e,M);return f.updateSharedData()===!1?f.encode(O):X}K&I1&&(M=e)}},this.findCommonStringsToPack=()=>(y=new Map,C||(C=Object.create(null)),O=>{let K=O&&O.threshold||4,X=this.pack?O.maxPrivatePackedValues||16:0;E||(E=this.sharedValues=[]);for(let[T,b]of y)b.count>K&&(C[T]=X++,E.push(T),r=!0);for(;this.saveShared&&this.updateSharedData()===!1;);y=null});const P=O=>{M>mn&&(G=Y(M));var K=typeof O,X;if(K==="string"){if(x){let st=x[O];if(st>=0){st<16?G[M++]=st+224:(G[M++]=198,st&1?P(15-st>>1):P(st-16>>1));return}else if(y&&!t.pack){let at=y.get(O);at?at.count++:y.set(O,{count:1})}}let T=O.length;if(De&&T>=4&&T<1024){if((De.size+=T)>E1){let at,w=(De[0]?De[0].length*3+De[1].length:0)+10;M+w>mn&&(G=Y(M+w)),G[M++]=217,G[M++]=223,G[M++]=249,G[M++]=De.position?132:130,G[M++]=26,at=M-e,M+=4,De.position&&V0(e,P),De=["",""],De.size=0,De.position=at}let st=D1.test(O);De[st?0:1]+=O,G[M++]=st?206:207,P(T);return}let b;T<32?b=1:T<256?b=2:T<65536?b=3:b=5;let tt=T*3;if(M+tt>mn&&(G=Y(M+tt)),T<64||!u){let st,at,w,j=M+b;for(st=0;st<T;st++)at=O.charCodeAt(st),at<128?G[j++]=at:at<2048?(G[j++]=at>>6|192,G[j++]=at&63|128):(at&64512)===55296&&((w=O.charCodeAt(st+1))&64512)===56320?(at=65536+((at&1023)<<10)+(w&1023),st++,G[j++]=at>>18|240,G[j++]=at>>12&63|128,G[j++]=at>>6&63|128,G[j++]=at&63|128):(G[j++]=at>>12|224,G[j++]=at>>6&63|128,G[j++]=at&63|128);X=j-M-b}else X=u(O,M+b,tt);X<24?G[M++]=96|X:X<256?(b<2&&G.copyWithin(M+2,M+1,M+1+X),G[M++]=120,G[M++]=X):X<65536?(b<3&&G.copyWithin(M+3,M+2,M+2+X),G[M++]=121,G[M++]=X>>8,G[M++]=X&255):(b<5&&G.copyWithin(M+5,M+3,M+3+X),G[M++]=122,ne.setUint32(M,X),M+=4),M+=X}else if(K==="number")if(!this.alwaysUseFloat&&O>>>0===O)O<24?G[M++]=O:O<256?(G[M++]=24,G[M++]=O):O<65536?(G[M++]=25,G[M++]=O>>8,G[M++]=O&255):(G[M++]=26,ne.setUint32(M,O),M+=4);else if(!this.alwaysUseFloat&&O>>0===O)O>=-24?G[M++]=31-O:O>=-256?(G[M++]=56,G[M++]=~O):O>=-65536?(G[M++]=57,ne.setUint16(M,~O),M+=2):(G[M++]=58,ne.setUint32(M,~O),M+=4);else{let T;if((T=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){G[M++]=250,ne.setFloat32(M,O);let b;if(T<4||(b=O*Mf[(G[M]&127)<<1|G[M+1]>>7])>>0===b){M+=4;return}else M--}G[M++]=251,ne.setFloat64(M,O),M+=8}else if(K==="object")if(!O)G[M++]=246;else{if(h){let b=h.get(O);if(b){if(G[M++]=216,G[M++]=29,G[M++]=25,!b.references){let tt=h.idsToInsert||(h.idsToInsert=[]);b.references=[],tt.push(b)}b.references.push(M-e),M+=2;return}else h.set(O,{offset:M-e})}let T=O.constructor;if(T===Object)F(O,!0);else if(T===Array){X=O.length,X<24?G[M++]=128|X:ls(X);for(let b=0;b<X;b++)P(O[b])}else if(T===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(G[M++]=217,G[M++]=1,G[M++]=3),X=O.size,X<24?G[M++]=160|X:X<256?(G[M++]=184,G[M++]=X):X<65536?(G[M++]=185,G[M++]=X>>8,G[M++]=X&255):(G[M++]=186,ne.setUint32(M,X),M+=4),f.keyMap)for(let[b,tt]of O)P(f.encodeKey(b)),P(tt);else for(let[b,tt]of O)P(b),P(tt);else{for(let b=0,tt=$d.length;b<tt;b++){let st=Hy[b];if(O instanceof st){let at=$d[b],w=at.tag;w==null&&(w=at.getTag&&at.getTag.call(this,O)),w<24?G[M++]=192|w:w<256?(G[M++]=216,G[M++]=w):w<65536?(G[M++]=217,G[M++]=w>>8,G[M++]=w&255):w>-1&&(G[M++]=218,ne.setUint32(M,w),M+=4),at.encode.call(this,O,P,Y);return}}if(O[Symbol.iterator]){if(yd){let b=new Error("Iterable should be serialized as iterator");throw b.iteratorNotHandled=!0,b}G[M++]=159;for(let b of O)P(b);G[M++]=255;return}if(O[Symbol.asyncIterator]||vd(O)){let b=new Error("Iterable/blob should be serialized as iterator");throw b.iteratorNotHandled=!0,b}if(this.useToJSON&&O.toJSON){const b=O.toJSON();if(b!==O)return P(b)}F(O,!O.hasOwnProperty)}}else if(K==="boolean")G[M++]=O?245:244;else if(K==="bigint"){if(O<BigInt(1)<<BigInt(64)&&O>=0)G[M++]=27,ne.setBigUint64(M,O);else if(O>-(BigInt(1)<<BigInt(64))&&O<0)G[M++]=59,ne.setBigUint64(M,-O-BigInt(1));else if(this.largeBigIntToFloat)G[M++]=251,ne.setFloat64(M,Number(O));else throw new RangeError(O+" was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64");M+=8}else if(K==="undefined")G[M++]=247;else throw new Error("Unknown type: "+K)},F=this.useRecords===!1?this.variableMapSize?O=>{let K=Object.keys(O),X=Object.values(O),T=K.length;if(T<24?G[M++]=160|T:T<256?(G[M++]=184,G[M++]=T):T<65536?(G[M++]=185,G[M++]=T>>8,G[M++]=T&255):(G[M++]=186,ne.setUint32(M,T),M+=4),f.keyMap)for(let b=0;b<T;b++)P(f.encodeKey(K[b])),P(X[b]);else for(let b=0;b<T;b++)P(K[b]),P(X[b])}:(O,K)=>{G[M++]=185;let X=M-e;M+=2;let T=0;if(f.keyMap)for(let b in O)(K||O.hasOwnProperty(b))&&(P(f.encodeKey(b)),P(O[b]),T++);else for(let b in O)(K||O.hasOwnProperty(b))&&(P(b),P(O[b]),T++);G[X+++e]=T>>8,G[X+e]=T&255}:(O,K)=>{let X,T=l.transitions||(l.transitions=Object.create(null)),b=0,tt=0,st,at;if(this.keyMap){at=Object.keys(O).map(j=>this.encodeKey(j)),tt=at.length;for(let j=0;j<tt;j++){let nt=at[j];X=T[nt],X||(X=T[nt]=Object.create(null),b++),T=X}}else for(let j in O)(K||O.hasOwnProperty(j))&&(X=T[j],X||(T[Di]&1048576&&(st=T[Di]&65535),X=T[j]=Object.create(null),b++),T=X,tt++);let w=T[Di];if(w!==void 0)w&=65535,G[M++]=217,G[M++]=w>>8|224,G[M++]=w&255;else if(at||(at=T.__keys__||(T.__keys__=Object.keys(O))),st===void 0?(w=l.nextId++,w||(w=0,l.nextId=1),w>=H0&&(l.nextId=(w=m)+1)):w=st,l[w]=at,w<m){G[M++]=217,G[M++]=w>>8|224,G[M++]=w&255,T=l.transitions;for(let j=0;j<tt;j++)(T[Di]===void 0||T[Di]&1048576)&&(T[Di]=w),T=T[at[j]];T[Di]=w|1048576,r=!0}else{if(T[Di]=w,ne.setUint32(M,3655335680),M+=3,b&&(D+=R*b),L.length>=H0-m&&(L.shift()[Di]=void 0),L.push(T),ls(tt+2),P(57344+w),P(at),K===null)return;for(let j in O)(K||O.hasOwnProperty(j))&&P(O[j]);return}if(tt<24?G[M++]=128|tt:ls(tt),K!==null)for(let j in O)(K||O.hasOwnProperty(j))&&P(O[j])},Y=O=>{let K;if(O>16777216){if(O-e>G0)throw new Error("Encoded buffer would be larger than maximum buffer size");K=Math.min(G0,Math.round(Math.max((O-e)*(O>67108864?1.25:2),4194304)/4096)*4096)}else K=(Math.max(O-e<<2,G.length-1)>>12)+1<<12;let X=new Ad(K);return ne=new DataView(X.buffer,0,K),G.copy?G.copy(X,0,e,O):X.set(G.slice(e,O)),M-=e,e=0,mn=X.length-10,G=X};let et=100,k=1e3;this.encodeAsIterable=function(O,K){return At(O,K,rt)},this.encodeAsAsyncIterable=function(O,K){return At(O,K,xt)};function*rt(O,K,X){let T=O.constructor;if(T===Object){let b=f.useRecords!==!1;b?F(O,null):Q0(Object.keys(O).length,160);for(let tt in O){let st=O[tt];b||P(tt),st&&typeof st=="object"?K[tt]?yield*rt(st,K[tt]):yield*gt(st,K,tt):P(st)}}else if(T===Array){let b=O.length;ls(b);for(let tt=0;tt<b;tt++){let st=O[tt];st&&(typeof st=="object"||M-e>et)?K.element?yield*rt(st,K.element):yield*gt(st,K,"element"):P(st)}}else if(O[Symbol.iterator]){G[M++]=159;for(let b of O)b&&(typeof b=="object"||M-e>et)?K.element?yield*rt(b,K.element):yield*gt(b,K,"element"):P(b);G[M++]=255}else vd(O)?(Q0(O.size,64),yield G.subarray(e,M),yield O,_t()):O[Symbol.asyncIterator]?(G[M++]=159,yield G.subarray(e,M),yield O,_t(),G[M++]=255):P(O);X&&M>e?yield G.subarray(e,M):M-e>et&&(yield G.subarray(e,M),_t())}function*gt(O,K,X){let T=M-e;try{P(O),M-e>et&&(yield G.subarray(e,M),_t())}catch(b){if(b.iteratorNotHandled)K[X]={},M=e+T,yield*rt.call(this,O,K[X]);else throw b}}function _t(){et=k,f.encode(null,xd)}function At(O,K,X){return K&&K.chunkThreshold?et=k=K.chunkThreshold:et=100,O&&typeof O=="object"?(f.encode(null,xd),X(O,f.iterateProperties||(f.iterateProperties={}),!0)):[f.encode(O)]}async function*xt(O,K){for(let X of rt(O,K,!0)){let T=X.constructor;if(T===N0||T===Uint8Array)yield X;else if(vd(X)){let b=X.stream().getReader(),tt;for(;!(tt=await b.read()).done;)yield tt.value}else if(X[Symbol.asyncIterator])for await(let b of X)_t(),b?yield*xt(b,K.async||(K.async={})):yield f.encode(b);else yield X}}}useBuffer(t){G=t,ne=new DataView(G.buffer,G.byteOffset,G.byteLength),M=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let t=this.sharedVersion||0;this.sharedVersion=t+1;let e=this.structures.slice(0),s=new Gy(e,this.sharedValues,this.sharedVersion),r=this.saveShared(s,l=>(l&&l.version||0)==t);return r===!1?(s=this.getShared()||{},this.structures=s.structures||[],this.sharedValues=s.packedValues,this.sharedVersion=s.version,this.structures.nextId=this.structures.length):e.forEach((l,h)=>this.structures[h]=l),r}}function Q0(o,t){o<24?G[M++]=t|o:o<256?(G[M++]=t|24,G[M++]=o):o<65536?(G[M++]=t|25,G[M++]=o>>8,G[M++]=o&255):(G[M++]=t|26,ne.setUint32(M,o),M+=4)}class Gy{constructor(t,e,s){this.structures=t,this.packedValues=e,this.version=s}}function ls(o){o<24?G[M++]=128|o:o<256?(G[M++]=152,G[M++]=o):o<65536?(G[M++]=153,G[M++]=o>>8,G[M++]=o&255):(G[M++]=154,ne.setUint32(M,o),M+=4)}const M1=typeof Blob>"u"?function(){}:Blob;function vd(o){if(o instanceof M1)return!0;let t=o[Symbol.toStringTag];return t==="Blob"||t==="File"}function dc(o,t){switch(typeof o){case"string":if(o.length>3){if(t.objectMap[o]>-1||t.values.length>=t.maxValues)return;let s=t.get(o);if(s)++s.count==2&&t.values.push(o);else if(t.set(o,{count:1}),t.samplingPackedValues){let r=t.samplingPackedValues.get(o);r?r.count++:t.samplingPackedValues.set(o,{count:1})}}break;case"object":if(o)if(o instanceof Array)for(let s=0,r=o.length;s<r;s++)dc(o[s],t);else{let s=!t.encoder.useRecords;for(var e in o)o.hasOwnProperty(e)&&(s&&dc(e,t),dc(o[e],t))}break;case"function":console.log(o)}}const P1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;Hy=[Date,Set,Error,RegExp,$n,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,Gy];$d=[{tag:1,encode(o,t){let e=o.getTime()/1e3;(this.useTimestamp32||o.getMilliseconds()===0)&&e>=0&&e<4294967296?(G[M++]=26,ne.setUint32(M,e),M+=4):(G[M++]=251,ne.setFloat64(M,e),M+=8)}},{tag:258,encode(o,t){let e=Array.from(o);t(e)}},{tag:27,encode(o,t){t([o.name,o.message])}},{tag:27,encode(o,t){t(["RegExp",o.source,o.flags])}},{getTag(o){return o.tag},encode(o,t){t(o.value)}},{encode(o,t,e){j0(o,e)}},{getTag(o){if(o.constructor===Uint8Array&&(this.tagUint8Array||Mo&&this.tagUint8Array!==!1))return 64},encode(o,t,e){j0(o,e)}},rs(68,1),rs(69,2),rs(70,4),rs(71,8),rs(72,1),rs(77,2),rs(78,4),rs(79,8),rs(85,4),rs(86,8),{encode(o,t){let e=o.packedValues||[],s=o.structures||[];if(e.values.length>0){G[M++]=216,G[M++]=51,ls(4);let r=e.values;t(r),ls(0),ls(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let l=0,h=r.length;l<h;l++)packedObjectMap[r[l]]=l}if(s){ne.setUint32(M,3655335424),M+=3;let r=s.slice(0);r.unshift(57344),r.push(new $n(o.version,1399353956)),t(r)}else t(new $n(o.version,1399353956))}}];function rs(o,t){return!P1&&t>1&&(o-=4),{tag:o,encode:function(s,r){let l=s.byteLength,h=s.byteOffset||0,u=s.buffer||s;r(Mo?Uc.from(u,h,l):new Uint8Array(u,h,l))}}}function j0(o,t){let e=o.byteLength;e<24?G[M++]=64+e:e<256?(G[M++]=88,G[M++]=e):e<65536?(G[M++]=89,G[M++]=e>>8,G[M++]=e&255):(G[M++]=90,ne.setUint32(M,e),M+=4),M+e>=G.length&&t(M+e),G.set(o.buffer?o:new Uint8Array(o),M),M+=e}function B1(o,t){let e,s=t.length*2,r=o.length-s;t.sort((l,h)=>l.offset>h.offset?1:-1);for(let l=0;l<t.length;l++){let h=t[l];h.id=l;for(let u of h.references)o[u++]=l>>8,o[u]=l&255}for(;e=t.pop();){let l=e.offset;o.copyWithin(l+s,l,r),s-=2;let h=l+s;o[h++]=216,o[h++]=28,r=l}return o}function V0(o,t){ne.setUint32(De.position+o,M-De.position-o+1);let e=De;De=null,t(e[0]),t(e[1])}let Bf=new R1({useRecords:!1});Bf.encode;Bf.encodeAsIterable;Bf.encodeAsAsyncIterable;const Y0=512,I1=1024,xd=2048;function sr(o,t,e,s){Object.defineProperty(o,t,{get:e,set:s,enumerable:!0,configurable:!0})}class Qy{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=t=>{const e=[],s=t.byteLength,r=Math.ceil(s/this.chunkedMTU);let l=0,h=0;for(;h<s;){const u=Math.min(s,h+this.chunkedMTU),f=t.slice(h,u),g={__peerData:this._dataCount,n:l,data:f,total:r};e.push(g),h=u,l++}return this._dataCount++,e}}}function k1(o){let t=0;for(const r of o)t+=r.byteLength;const e=new Uint8Array(t);let s=0;for(const r of o)e.set(r,s),s+=r.byteLength;return e}const bd=k0.default||k0,eo=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const o=this.getBrowser(),t=this.getVersion();return this.supportedBrowsers.includes(o)?o==="chrome"?t>=this.minChromeVersion:o==="firefox"?t>=this.minFirefoxVersion:o==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1}getBrowser(){return bd.browserDetails.browser}getVersion(){return bd.browserDetails.version||0}isUnifiedPlanSupported(){const o=this.getBrowser(),t=bd.browserDetails.version||0;if(o==="chrome"&&t<this.minChromeVersion)return!1;if(o==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e,s=!1;try{e=new RTCPeerConnection,e.addTransceiver("audio"),s=!0}catch{}finally{e&&e.close()}return s}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},z1=o=>!o||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(o),jy=()=>Math.random().toString(36).slice(2),q0={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class O1 extends Qy{noop(){}blobToArrayBuffer(t,e){const s=new FileReader;return s.onload=function(r){r.target&&e(r.target.result)},s.readAsArrayBuffer(t),s}binaryStringToArrayBuffer(t){const e=new Uint8Array(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s)&255;return e.buffer}isSecure(){return location.protocol==="https:"}constructor(...t){super(...t),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=q0,this.browser=eo.getBrowser(),this.browserVersion=eo.getVersion(),this.pack=iy,this.unpack=ey,this.supports=(function(){const e={browser:eo.isBrowserSupported(),webRTC:eo.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;let s;try{s=new RTCPeerConnection(q0),e.audioVideo=!0;let r;try{r=s.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!r.ordered;try{r.binaryType="blob",e.binaryBlob=!eo.isIOS}catch{}}catch{}finally{r&&r.close()}}catch{}finally{s&&s.close()}return e})(),this.validateId=z1,this.randomToken=jy}}const fi=new O1,U1="PeerJS: ";var X0;(function(o){o[o.Disabled=0]="Disabled",o[o.Errors=1]="Errors",o[o.Warnings=2]="Warnings",o[o.All=3]="All"})(X0||(X0={}));class L1{get logLevel(){return this._logLevel}set logLevel(t){this._logLevel=t}log(...t){this._logLevel>=3&&this._print(3,...t)}warn(...t){this._logLevel>=2&&this._print(2,...t)}error(...t){this._logLevel>=1&&this._print(1,...t)}setLogFunction(t){this._print=t}_print(t,...e){const s=[U1,...e];for(const r in s)s[r]instanceof Error&&(s[r]="("+s[r].name+") "+s[r].message);t>=3?console.log(...s):t>=2?console.warn("WARNING",...s):t>=1&&console.error("ERROR",...s)}constructor(){this._logLevel=0}}var ut=new L1,If={},F1=Object.prototype.hasOwnProperty,ni="~";function wo(){}Object.create&&(wo.prototype=Object.create(null),new wo().__proto__||(ni=!1));function N1(o,t,e){this.fn=o,this.context=t,this.once=e||!1}function Vy(o,t,e,s,r){if(typeof e!="function")throw new TypeError("The listener must be a function");var l=new N1(e,s||o,r),h=ni?ni+t:t;return o._events[h]?o._events[h].fn?o._events[h]=[o._events[h],l]:o._events[h].push(l):(o._events[h]=l,o._eventsCount++),o}function fc(o,t){--o._eventsCount===0?o._events=new wo:delete o._events[t]}function Je(){this._events=new wo,this._eventsCount=0}Je.prototype.eventNames=function(){var t=[],e,s;if(this._eventsCount===0)return t;for(s in e=this._events)F1.call(e,s)&&t.push(ni?s.slice(1):s);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};Je.prototype.listeners=function(t){var e=ni?ni+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,l=s.length,h=new Array(l);r<l;r++)h[r]=s[r].fn;return h};Je.prototype.listenerCount=function(t){var e=ni?ni+t:t,s=this._events[e];return s?s.fn?1:s.length:0};Je.prototype.emit=function(t,e,s,r,l,h){var u=ni?ni+t:t;if(!this._events[u])return!1;var f=this._events[u],g=arguments.length,m,A;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),g){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,s),!0;case 4:return f.fn.call(f.context,e,s,r),!0;case 5:return f.fn.call(f.context,e,s,r,l),!0;case 6:return f.fn.call(f.context,e,s,r,l,h),!0}for(A=1,m=new Array(g-1);A<g;A++)m[A-1]=arguments[A];f.fn.apply(f.context,m)}else{var y=f.length,x;for(A=0;A<y;A++)switch(f[A].once&&this.removeListener(t,f[A].fn,void 0,!0),g){case 1:f[A].fn.call(f[A].context);break;case 2:f[A].fn.call(f[A].context,e);break;case 3:f[A].fn.call(f[A].context,e,s);break;case 4:f[A].fn.call(f[A].context,e,s,r);break;default:if(!m)for(x=1,m=new Array(g-1);x<g;x++)m[x-1]=arguments[x];f[A].fn.apply(f[A].context,m)}}return!0};Je.prototype.on=function(t,e,s){return Vy(this,t,e,s,!1)};Je.prototype.once=function(t,e,s){return Vy(this,t,e,s,!0)};Je.prototype.removeListener=function(t,e,s,r){var l=ni?ni+t:t;if(!this._events[l])return this;if(!e)return fc(this,l),this;var h=this._events[l];if(h.fn)h.fn===e&&(!r||h.once)&&(!s||h.context===s)&&fc(this,l);else{for(var u=0,f=[],g=h.length;u<g;u++)(h[u].fn!==e||r&&!h[u].once||s&&h[u].context!==s)&&f.push(h[u]);f.length?this._events[l]=f.length===1?f[0]:f:fc(this,l)}return this};Je.prototype.removeAllListeners=function(t){var e;return t?(e=ni?ni+t:t,this._events[e]&&fc(this,e)):(this._events=new wo,this._eventsCount=0),this};Je.prototype.off=Je.prototype.removeListener;Je.prototype.addListener=Je.prototype.on;Je.prefixed=ni;Je.EventEmitter=Je;If=Je;var nr={};sr(nr,"ConnectionType",()=>us);sr(nr,"PeerErrorType",()=>he);sr(nr,"BaseConnectionErrorType",()=>Co);sr(nr,"DataConnectionErrorType",()=>So);sr(nr,"SerializationType",()=>ea);sr(nr,"SocketEventType",()=>cs);sr(nr,"ServerMessageType",()=>ke);var us;(function(o){o.Data="data",o.Media="media"})(us||(us={}));var he;(function(o){o.BrowserIncompatible="browser-incompatible",o.Disconnected="disconnected",o.InvalidID="invalid-id",o.InvalidKey="invalid-key",o.Network="network",o.PeerUnavailable="peer-unavailable",o.SslUnavailable="ssl-unavailable",o.ServerError="server-error",o.SocketError="socket-error",o.SocketClosed="socket-closed",o.UnavailableID="unavailable-id",o.WebRTC="webrtc"})(he||(he={}));var Co;(function(o){o.NegotiationFailed="negotiation-failed",o.ConnectionClosed="connection-closed"})(Co||(Co={}));var So;(function(o){o.NotOpenYet="not-open-yet",o.MessageToBig="message-too-big"})(So||(So={}));var ea;(function(o){o.Binary="binary",o.BinaryUTF8="binary-utf8",o.JSON="json",o.None="raw"})(ea||(ea={}));var cs;(function(o){o.Message="message",o.Disconnected="disconnected",o.Error="error",o.Close="close"})(cs||(cs={}));var ke;(function(o){o.Heartbeat="HEARTBEAT",o.Candidate="CANDIDATE",o.Offer="OFFER",o.Answer="ANSWER",o.Open="OPEN",o.Error="ERROR",o.IdTaken="ID-TAKEN",o.InvalidKey="INVALID-KEY",o.Leave="LEAVE",o.Expire="EXPIRE"})(ke||(ke={}));var kf={};kf=JSON.parse('{"name":"peerjs","version":"1.5.2","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-cbor":"dist/serializer.cbor.mjs","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-cbor":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/Cbor.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","cbor-x":"1.5.4","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^8.0.0"},"alias":{"process":false,"buffer":false}}');class H1 extends If.EventEmitter{constructor(t,e,s,r,l,h=5e3){super(),this.pingInterval=h,this._disconnected=!0,this._messagesQueue=[];const u=t?"wss://":"ws://";this._baseUrl=u+e+":"+s+r+"peerjs?key="+l}start(t,e){this._id=t;const s=`${this._baseUrl}&id=${t}&token=${e}`;this._socket||!this._disconnected||(this._socket=new WebSocket(s+"&version="+kf.version),this._disconnected=!1,this._socket.onmessage=r=>{let l;try{l=JSON.parse(r.data),ut.log("Server message received:",l)}catch{ut.log("Invalid server message",r.data);return}this.emit(cs.Message,l)},this._socket.onclose=r=>{this._disconnected||(ut.log("Socket closed.",r),this._cleanup(),this._disconnected=!0,this.emit(cs.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),ut.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){ut.log("Cannot send heartbeat, because socket closed");return}const t=JSON.stringify({type:ke.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const t=[...this._messagesQueue];this._messagesQueue=[];for(const e of t)this.send(e)}send(t){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(cs.Error,"Invalid message");return}if(!this._wsOpen())return;const e=JSON.stringify(t);this._socket.send(e)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class Yy{constructor(t){this.connection=t}startConnection(t){const e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===us.Media&&t._stream&&this._addTracksToConnection(t._stream,e),t.originator){const s=this.connection,r={ordered:!!t.reliable},l=e.createDataChannel(s.label,r);s._initializeDataChannel(l),this._makeOffer()}else this.handleSDP("OFFER",t.sdp)}_startPeerConnection(){ut.log("Creating RTCPeerConnection.");const t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t}_setupListeners(t){const e=this.connection.peer,s=this.connection.connectionId,r=this.connection.type,l=this.connection.provider;ut.log("Listening for ICE candidates."),t.onicecandidate=h=>{!h.candidate||!h.candidate.candidate||(ut.log(`Received ICE candidates for ${e}:`,h.candidate),l.socket.send({type:ke.Candidate,payload:{candidate:h.candidate,type:r,connectionId:s},dst:e}))},t.oniceconnectionstatechange=()=>{switch(t.iceConnectionState){case"failed":ut.log("iceConnectionState is failed, closing connections to "+e),this.connection.emitError(Co.NegotiationFailed,"Negotiation of connection to "+e+" failed."),this.connection.close();break;case"closed":ut.log("iceConnectionState is closed, closing connections to "+e),this.connection.emitError(Co.ConnectionClosed,"Connection to "+e+" closed."),this.connection.close();break;case"disconnected":ut.log("iceConnectionState changed to disconnected on the connection with "+e);break;case"completed":t.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",t.iceConnectionState)},ut.log("Listening for data channel"),t.ondatachannel=h=>{ut.log("Received data channel");const u=h.channel;l.getConnection(e,s)._initializeDataChannel(u)},ut.log("Listening for remote stream"),t.ontrack=h=>{ut.log("Received remote stream");const u=h.streams[0],f=l.getConnection(e,s);if(f.type===us.Media){const g=f;this._addStreamToMediaConnection(u,g)}}}cleanup(){ut.log("Cleaning up PeerConnection to "+this.connection.peer);const t=this.connection.peerConnection;if(!t)return;this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=()=>{};const e=t.signalingState!=="closed";let s=!1;const r=this.connection.dataChannel;r&&(s=!!r.readyState&&r.readyState!=="closed"),(e||s)&&t.close()}async _makeOffer(){const t=this.connection.peerConnection,e=this.connection.provider;try{const s=await t.createOffer(this.connection.options.constraints);ut.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp);try{await t.setLocalDescription(s),ut.log("Set localDescription:",s,`for:${this.connection.peer}`);let r={sdp:s,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===us.Data){const l=this.connection;r={...r,label:l.label,reliable:l.reliable,serialization:l.serialization}}e.socket.send({type:ke.Offer,payload:r,dst:this.connection.peer})}catch(r){r!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(e.emitError(he.WebRTC,r),ut.log("Failed to setLocalDescription, ",r))}}catch(s){e.emitError(he.WebRTC,s),ut.log("Failed to createOffer, ",s)}}async _makeAnswer(){const t=this.connection.peerConnection,e=this.connection.provider;try{const s=await t.createAnswer();ut.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp);try{await t.setLocalDescription(s),ut.log("Set localDescription:",s,`for:${this.connection.peer}`),e.socket.send({type:ke.Answer,payload:{sdp:s,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(r){e.emitError(he.WebRTC,r),ut.log("Failed to setLocalDescription, ",r)}}catch(s){e.emitError(he.WebRTC,s),ut.log("Failed to create answer, ",s)}}async handleSDP(t,e){e=new RTCSessionDescription(e);const s=this.connection.peerConnection,r=this.connection.provider;ut.log("Setting remote description",e);const l=this;try{await s.setRemoteDescription(e),ut.log(`Set remoteDescription:${t} for:${this.connection.peer}`),t==="OFFER"&&await l._makeAnswer()}catch(h){r.emitError(he.WebRTC,h),ut.log("Failed to setRemoteDescription, ",h)}}async handleCandidate(t){ut.log("handleCandidate:",t);try{await this.connection.peerConnection.addIceCandidate(t),ut.log(`Added ICE candidate for:${this.connection.peer}`)}catch(e){this.connection.provider.emitError(he.WebRTC,e),ut.log("Failed to handleCandidate, ",e)}}_addTracksToConnection(t,e){if(ut.log(`add tracks from stream ${t.id} to peer connection`),!e.addTrack)return ut.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(s=>{e.addTrack(s,t)})}_addStreamToMediaConnection(t,e){ut.log(`add stream ${t.id} to media connection ${e.connectionId}`),e.addStream(t)}}class qy extends If.EventEmitter{emitError(t,e){ut.error("Error:",e),this.emit("error",new G1(`${t}`,e))}}class G1 extends Error{constructor(t,e){typeof e=="string"?super(e):(super(),Object.assign(this,e)),this.type=t}}class Xy extends qy{get open(){return this._open}constructor(t,e,s){super(),this.peer=t,this.provider=e,this.options=s,this._open=!1,this.metadata=s.metadata}}var ef;const uo=class uo extends Xy{get type(){return us.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(t,e,s){super(t,e,s),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||uo.ID_PREFIX+fi.randomToken(),this._negotiator=new Yy(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{ut.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{ut.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(t){ut.log("Receiving stream",t),this._remoteStream=t,super.emit("stream",t)}handleMessage(t){const e=t.type,s=t.payload;switch(t.type){case ke.Answer:this._negotiator.handleSDP(e,s.sdp),this._open=!0;break;case ke.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:ut.warn(`Unrecognized message type:${e} from peer:${this.peer}`);break}}answer(t,e={}){if(this._localStream){ut.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,e&&e.sdpTransform&&(this.options.sdpTransform=e.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:t});const s=this.provider._getMessages(this.connectionId);for(const r of s)this.handleMessage(r);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};ef=new WeakMap,Ka(uo,ef,uo.ID_PREFIX="mc_");let Cc=uo;class Q1{constructor(t){this._options=t}_buildRequest(t){const e=this._options.secure?"https":"http",{host:s,port:r,path:l,key:h}=this._options,u=new URL(`${e}://${s}:${r}${l}${h}/${t}`);return u.searchParams.set("ts",`${Date.now()}${Math.random()}`),u.searchParams.set("version",kf.version),fetch(u.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const t=await this._buildRequest("id");if(t.status!==200)throw new Error(`Error. Status:${t.status}`);return t.text()}catch(t){ut.error("Error retrieving ID",t);let e="";throw this._options.path==="/"&&this._options.host!==fi.CLOUD_HOST&&(e=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+e)}}async listAllPeers(){try{const t=await this._buildRequest("peers");if(t.status!==200){if(t.status===401){let e="";throw this._options.host===fi.CLOUD_HOST?e="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":e="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)}throw new Error(`Error. Status:${t.status}`)}return t.json()}catch(t){throw ut.error("Error retrieving list peers",t),new Error("Could not get list peers from the server."+t)}}}var sf,nf;const Zn=class Zn extends Xy{get type(){return us.Data}constructor(t,e,s){super(t,e,s),this.connectionId=this.options.connectionId||Zn.ID_PREFIX+jy(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new Yy(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{ut.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=e=>{ut.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{ut.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(t,e=!1){if(!this.open){this.emitError(So.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(t,e)}async handleMessage(t){const e=t.payload;switch(t.type){case ke.Answer:await this._negotiator.handleSDP(t.type,e.sdp);break;case ke.Candidate:await this._negotiator.handleCandidate(e.candidate);break;default:ut.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}}};sf=new WeakMap,nf=new WeakMap,Ka(Zn,sf,Zn.ID_PREFIX="dc_"),Ka(Zn,nf,Zn.MAX_BUFFERED_AMOUNT=8388608);let Sc=Zn;class zf extends Sc{get bufferSize(){return this._bufferSize}_initializeDataChannel(t){super._initializeDataChannel(t),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",e=>this._handleDataMessage(e))}_bufferedSend(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)}_trySend(t){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Sc.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(e){return ut.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...t){super(...t),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class wd extends zf{close(t){super.close(t),this._chunkedData={}}constructor(t,e,s){super(t,e,s),this.chunker=new Qy,this.serialization=ea.Binary,this._chunkedData={}}_handleDataMessage({data:t}){const e=ey(t),s=e.__peerData;if(s){if(s.type==="close"){this.close();return}this._handleChunk(e);return}this.emit("data",e)}_handleChunk(t){const e=t.__peerData,s=this._chunkedData[e]||{data:[],count:0,total:t.total};if(s.data[t.n]=new Uint8Array(t.data),s.count++,this._chunkedData[e]=s,s.total===s.count){delete this._chunkedData[e];const r=k1(s.data);this._handleDataMessage({data:r})}}_send(t,e){const s=iy(t);if(s instanceof Promise)return this._send_blob(s);if(!e&&s.byteLength>this.chunker.chunkedMTU){this._sendChunks(s);return}this._bufferedSend(s)}async _send_blob(t){const e=await t;if(e.byteLength>this.chunker.chunkedMTU){this._sendChunks(e);return}this._bufferedSend(e)}_sendChunks(t){const e=this.chunker.chunk(t);ut.log(`DC#${this.connectionId} Try to send ${e.length} chunks...`);for(const s of e)this.send(s,!0)}}class j1 extends zf{_handleDataMessage({data:t}){super.emit("data",t)}_send(t,e){this._bufferedSend(t)}constructor(...t){super(...t),this.serialization=ea.None}}class V1 extends zf{_handleDataMessage({data:t}){const e=this.parse(this.decoder.decode(t)),s=e.__peerData;if(s&&s.type==="close"){this.close();return}this.emit("data",e)}_send(t,e){const s=this.encoder.encode(this.stringify(t));if(s.byteLength>=fi.chunkedMTU){this.emitError(So.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(s)}constructor(...t){super(...t),this.serialization=ea.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var rf;const fo=class fo extends qy{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const t=Object.create(null);for(const[e,s]of this._connections)t[e]=s;return t}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(t,e){super(),this._serializers={raw:j1,json:V1,binary:wd,"binary-utf8":wd,default:wd},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let s;if(t&&t.constructor==Object?e=t:t&&(s=t.toString()),e={debug:0,host:fi.CLOUD_HOST,port:fi.CLOUD_PORT,path:"/",key:fo.DEFAULT_KEY,token:fi.randomToken(),config:fi.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...e},this._options=e,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==fi.CLOUD_HOST?this._options.secure=fi.isSecure():this._options.host==fi.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&ut.setLogFunction(this._options.logFunction),ut.logLevel=this._options.debug||0,this._api=new Q1(e),this._socket=this._createServerConnection(),!fi.supports.audioVideo&&!fi.supports.data){this._delayedAbort(he.BrowserIncompatible,"The current browser does not support WebRTC");return}if(s&&!fi.validateId(s)){this._delayedAbort(he.InvalidID,`ID "${s}" is invalid`);return}s?this._initialize(s):this._api.retrieveId().then(r=>this._initialize(r)).catch(r=>this._abort(he.ServerError,r))}_createServerConnection(){const t=new H1(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(cs.Message,e=>{this._handleMessage(e)}),t.on(cs.Error,e=>{this._abort(he.SocketError,e)}),t.on(cs.Disconnected,()=>{this.disconnected||(this.emitError(he.Network,"Lost connection to server."),this.disconnect())}),t.on(cs.Close,()=>{this.disconnected||this._abort(he.SocketClosed,"Underlying socket is already closed.")}),t}_initialize(t){this._id=t,this.socket.start(t,this._options.token)}_handleMessage(t){const e=t.type,s=t.payload,r=t.src;switch(e){case ke.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case ke.Error:this._abort(he.ServerError,s.msg);break;case ke.IdTaken:this._abort(he.UnavailableID,`ID "${this.id}" is taken`);break;case ke.InvalidKey:this._abort(he.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case ke.Leave:ut.log(`Received leave message from ${r}`),this._cleanupPeer(r),this._connections.delete(r);break;case ke.Expire:this.emitError(he.PeerUnavailable,`Could not connect to peer ${r}`);break;case ke.Offer:{const l=s.connectionId;let h=this.getConnection(r,l);if(h&&(h.close(),ut.warn(`Offer received for existing Connection ID:${l}`)),s.type===us.Media){const f=new Cc(r,this,{connectionId:l,_payload:s,metadata:s.metadata});h=f,this._addConnection(r,h),this.emit("call",f)}else if(s.type===us.Data){const f=new this._serializers[s.serialization](r,this,{connectionId:l,_payload:s,metadata:s.metadata,label:s.label,serialization:s.serialization,reliable:s.reliable});h=f,this._addConnection(r,h),this.emit("connection",f)}else{ut.warn(`Received malformed connection type:${s.type}`);return}const u=this._getMessages(l);for(const f of u)h.handleMessage(f);break}default:{if(!s){ut.warn(`You received a malformed message from ${r} of type ${e}`);return}const l=s.connectionId,h=this.getConnection(r,l);h&&h.peerConnection?h.handleMessage(t):l?this._storeMessage(l,t):ut.warn("You received an unrecognized message:",t);break}}}_storeMessage(t,e){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(e)}_getMessages(t){const e=this._lostMessages.get(t);return e?(this._lostMessages.delete(t),e):[]}connect(t,e={}){if(e={serialization:"default",...e},this.disconnected){ut.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(he.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const s=new this._serializers[e.serialization](t,this,e);return this._addConnection(t,s),s}call(t,e,s={}){if(this.disconnected){ut.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(he.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!e){ut.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const r=new Cc(t,this,{...s,_stream:e});return this._addConnection(t,r),r}_addConnection(t,e){ut.log(`add connection ${e.type}:${e.connectionId} to peerId:${t}`),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(e)}_removeConnection(t){const e=this._connections.get(t.peer);if(e){const s=e.indexOf(t);s!==-1&&e.splice(s,1)}this._lostMessages.delete(t.connectionId)}getConnection(t,e){const s=this._connections.get(t);if(!s)return null;for(const r of s)if(r.connectionId===e)return r;return null}_delayedAbort(t,e){setTimeout(()=>{this._abort(t,e)},0)}_abort(t,e){ut.error("Aborting!"),this.emitError(t,e),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(ut.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const t of this._connections.keys())this._cleanupPeer(t),this._connections.delete(t);this.socket.removeAllListeners()}_cleanupPeer(t){const e=this._connections.get(t);if(e)for(const s of e)s.close()}disconnect(){if(this.disconnected)return;const t=this.id;ut.log(`Disconnect peer with ID:${t}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}reconnect(){if(this.disconnected&&!this.destroyed)ut.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)ut.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(t=e=>{}){this._api.listAllPeers().then(e=>t(e)).catch(e=>this._abort(he.ServerError,e))}};rf=new WeakMap,Ka(fo,rf,fo.DEFAULT_KEY="peerjs");let tf=fo;var Y1=tf;class Z0{constructor(){this.peer=null,this.conn=null,this.onMessage=()=>{},this.onConnection=()=>{},this.onDisconnect=()=>{}}init(){return new Promise((t,e)=>{this.peer=new Y1,this.peer.on("open",s=>{console.log("My peer ID is: "+s),t(s)}),this.peer.on("error",s=>{console.error(s),e(s)}),this.peer.on("connection",s=>{this.setupConnection(s)})})}connect(t){if(!this.peer)return;const e=this.peer.connect(t);this.setupConnection(e)}setupConnection(t){this.conn=t,this.conn.on("open",()=>{console.log("Connected to peer!"),this.onConnection()}),this.conn.on("data",e=>{this.onMessage(e)}),this.conn.on("close",()=>{console.log("Connection closed"),this.conn=null,this.onDisconnect()}),this.conn.on("error",e=>{console.error("Connection error:",e),this.conn=null,this.onDisconnect()})}send(t){this.conn&&this.conn.open&&this.conn.send(t)}destroy(){this.conn&&this.conn.close(),this.peer&&this.peer.destroy()}}const q1=()=>{const o=Bs.useRef(null),t=Bs.useRef(null),e=Bs.useRef(null),[s,r]=Bs.useState({p1Health:5,p2Health:5,p1State:"READY",p2State:"READY",gameOver:!1,showGameOver:!1,winner:null,isReplaying:!1,replayProgress:0,replaySpeed:1,isMultiplayer:!1,connectionStatus:"disconnected",opponentDisconnected:!1,sfxVolume:.15,crtScanlines:!0,crtFlicker:!0,crtVignette:!0}),[l,h]=Bs.useState("main"),[u,f]=Bs.useState(""),[g,m]=Bs.useState("");Bs.useEffect(()=>{if(!o.current)return;const P=new t1({canvasElement:o.current,width:800,height:400,displayMode:ho.Fixed,backgroundColor:$.fromHex("#90fcfc"),pixelArt:!0,fixedUpdateFps:60,antialiasing:!1});P.start().then(()=>{P.setupGame(Y=>{r(et=>({...et,...Y}))})}),t.current=P;const F=Y=>{P.opponentDisconnected||!P.isReplaying&&P.isGameOver&&(Y.key===" "||Y.key==="Enter")&&P.restartGame()};return window.addEventListener("keydown",F),()=>{window.removeEventListener("keydown",F),P.stop&&P.stop(),P.dispose&&P.dispose(),e.current&&e.current.destroy()}},[]);const A=()=>{h("game"),t.current&&t.current.restartGame()},y=async()=>{const P=new Z0;try{const F=await P.init();f(F),h("host"),P.onConnection=()=>{h("game"),t.current&&t.current.setupNetwork(P,!0)},e.current=P}catch{alert("Failed to connect to matchmaking server.")}},x=async()=>{if(!g)return;const P=new Z0;try{await P.init(),P.connect(g),P.onConnection=()=>{h("game"),t.current&&t.current.setupNetwork(P,!1)},e.current=P}catch{alert("Connection failed")}},E=P=>{t.current&&(t.current.seekTo(parseFloat(P.target.value)),t.current.setPlaybackSpeed(0))},C=P=>{t.current&&t.current.setPlaybackSpeed(P)},L=()=>{t.current&&t.current.toggleReplay(!s.isReplaying)},D=P=>{const F=parseFloat(P.target.value);r(Y=>({...Y,sfxVolume:F})),t.current&&t.current.setSFXVolume(F)},R=P=>{r(F=>({...F,[P]:!F[P]}))};return it.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen font-sans",children:[it.jsx("h1",{className:"text-4xl mb-8 text-[#e94560] drop-shadow-md font-bold",style:{textShadow:"0 0 10px rgba(233,69,96,0.5)"},children:" HOCKEY FIGHT "}),it.jsxs("div",{className:"tv-case",children:[it.jsx("div",{className:"tv-screen-bezel",children:it.jsxs("div",{className:"tv-glass-container relative",style:{width:"800px",height:"400px"},children:[it.jsx("canvas",{ref:o,id:"gameCanvas",className:"image-pixelated",onContextMenu:P=>P.preventDefault()}),l!=="game"&&it.jsxs("div",{className:"absolute inset-0 bg-[#1a1a2e]/95 flex flex-col items-center justify-center z-20",children:[l==="main"&&it.jsxs("div",{className:"flex flex-col gap-4 items-center",children:[it.jsx("button",{onClick:A,className:"bg-[#4ecdc4] text-[#1a1a2e] px-8 py-3 rounded-lg font-bold text-xl hover:bg-[#3dbdb4] transition shadow-[0_0_15px_rgba(78,205,196,0.4)]",children:"LOCAL 2 PLAYER"}),it.jsxs("div",{className:"flex gap-4",children:[it.jsx("button",{onClick:y,className:"bg-[#e94560] text-white px-6 py-2 rounded-lg font-bold hover:bg-[#d13650] shadow-[0_0_15px_rgba(233,69,96,0.4)]",children:"HOST ONLINE"}),it.jsx("button",{onClick:()=>h("join"),className:"bg-[#16213e] border-2 border-[#e94560] text-white px-6 py-2 rounded-lg font-bold hover:bg-[#1f2b4d]",children:"JOIN ONLINE"})]}),it.jsx("button",{onClick:()=>h("settings"),className:"text-gray-400 hover:text-white mt-4 font-bold tracking-widest text-sm border-b border-transparent hover:border-white transition-all",children:" SETTINGS"})]}),l==="host"&&it.jsxs("div",{className:"flex flex-col items-center gap-4 text-center p-6",children:[it.jsx("h2",{className:"text-2xl text-[#4ecdc4] font-bold",children:"WAITING FOR PLAYER..."}),it.jsxs("div",{className:"bg-[#16213e] p-4 rounded border border-gray-600",children:[it.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"SHARE THIS ROOM ID:"}),it.jsx("p",{className:"text-2xl font-mono text-white tracking-widest select-all",children:u})]}),it.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mt-4"}),it.jsx("button",{onClick:()=>h("main"),className:"text-gray-400 hover:text-white mt-4 underline",children:"Cancel"})]}),l==="join"&&it.jsxs("div",{className:"flex flex-col items-center gap-4",children:[it.jsx("h2",{className:"text-2xl text-[#e94560] font-bold",children:"JOIN GAME"}),it.jsx("input",{type:"text",placeholder:"ENTER ROOM ID",className:"bg-[#16213e] border border-gray-600 p-3 rounded text-white text-center font-mono uppercase focus:border-[#4ecdc4] outline-none",value:g,onChange:P=>m(P.target.value)}),it.jsxs("div",{className:"flex gap-4",children:[it.jsx("button",{onClick:()=>h("main"),className:"text-gray-400 hover:text-white",children:"Back"}),it.jsx("button",{onClick:x,className:"bg-[#4ecdc4] text-[#1a1a2e] px-6 py-2 rounded font-bold hover:bg-[#3dbdb4]",children:"CONNECT"})]})]}),l==="settings"&&it.jsxs("div",{className:"flex flex-col items-center gap-6 p-8 bg-[#16213e] rounded-xl border-2 border-[#e94560] shadow-2xl min-w-[320px]",children:[it.jsx("h2",{className:"text-3xl text-[#e94560] font-bold tracking-wider",children:"SETTINGS"}),it.jsxs("div",{className:"w-full",children:[it.jsxs("label",{className:"flex justify-between text-[#4ecdc4] mb-3 font-bold text-lg",children:[it.jsx("span",{children:"SFX VOLUME"}),it.jsxs("span",{children:[Math.round(s.sfxVolume*100),"%"]})]}),it.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.sfxVolume,onChange:D,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#e94560] hover:accent-[#ff6b81]"})]}),it.jsxs("div",{className:"w-full flex flex-col gap-3",children:[it.jsx("div",{className:"text-[#4ecdc4] font-bold text-lg mb-1",children:"VISUALS"}),it.jsxs("label",{className:"flex items-center justify-between cursor-pointer group",children:[it.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"Scanlines"}),it.jsx("input",{type:"checkbox",checked:s.crtScanlines,onChange:()=>R("crtScanlines"),className:"w-5 h-5 accent-[#e94560]"})]}),it.jsxs("label",{className:"flex items-center justify-between cursor-pointer group",children:[it.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"Vignette"}),it.jsx("input",{type:"checkbox",checked:s.crtVignette,onChange:()=>R("crtVignette"),className:"w-5 h-5 accent-[#e94560]"})]}),it.jsxs("label",{className:"flex items-center justify-between cursor-pointer group",children:[it.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"Flicker"}),it.jsx("input",{type:"checkbox",checked:s.crtFlicker,onChange:()=>R("crtFlicker"),className:"w-5 h-5 accent-[#e94560]"})]})]}),it.jsxs("div",{className:"flex gap-4 w-full mt-2",children:[it.jsx("button",{onClick:()=>{t.current&&t.current.playHitSound("high")},className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded font-bold transition-colors",children:" TEST"}),it.jsx("button",{onClick:()=>h("main"),className:"flex-1 bg-[#4ecdc4] hover:bg-[#3dbdb4] text-[#1a1a2e] py-2 rounded font-bold transition-colors",children:"DONE"})]})]})]}),s.isReplaying&&it.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80 p-4 border-t-2 border-[#e94560] z-30",children:it.jsxs("div",{className:"flex flex-col gap-2",children:[it.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:s.replayProgress,onChange:E,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#e94560]"}),it.jsxs("div",{className:"flex justify-center items-center gap-4 mt-2",children:[it.jsx("button",{onClick:()=>C(-2),className:`px-3 py-1 rounded ${s.replaySpeed===-2?"bg-[#e94560]":"bg-gray-700"}`,children:""}),it.jsx("button",{onClick:()=>C(0),className:`px-3 py-1 rounded ${s.replaySpeed===0?"bg-[#e94560]":"bg-gray-700"}`,children:""}),it.jsx("button",{onClick:()=>C(1),className:`px-3 py-1 rounded ${s.replaySpeed===1?"bg-[#e94560]":"bg-gray-700"}`,children:""}),it.jsx("button",{onClick:()=>C(2),className:`px-3 py-1 rounded ${s.replaySpeed===2?"bg-[#e94560]":"bg-gray-700"}`,children:""}),it.jsx("button",{onClick:L,className:"px-3 py-1 rounded bg-red-600 text-white font-bold ml-4 hover:bg-red-500",children:"EXIT REPLAY"})]})]})}),s.showGameOver&&!s.isReplaying&&!s.opponentDisconnected&&it.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/60 z-10",children:[it.jsxs("div",{className:"text-4xl text-[#feca57] drop-shadow-md font-bold mb-4 animate-bounce",children:[" ",s.winner," WINS! "]}),it.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[it.jsx("div",{className:"text-white text-lg",children:s.isMultiplayer?s.isHost?"Press SPACE to rematch":"Waiting for Host to rematch...":"Press SPACE to fight again"}),it.jsx("button",{onClick:L,className:"mt-2 bg-[#e94560] text-white px-6 py-2 rounded-full font-bold shadow-lg hover:bg-[#d43750] transition-transform hover:scale-105",children:" WATCH REPLAY"}),s.isMultiplayer&&it.jsx("button",{onClick:()=>window.location.reload(),className:"text-sm text-gray-400 hover:text-white mt-4 underline",children:"DISCONNECT"}),it.jsx("button",{onClick:()=>h("main"),className:"text-sm text-gray-400 hover:text-white mt-2 underline",children:"MAIN MENU"})]})]}),s.opponentDisconnected&&it.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/85 z-50",children:[it.jsx("div",{className:"text-4xl text-[#e94560] drop-shadow-md font-bold mb-6",children:" OPPONENT DISCONNECTED"}),it.jsx("button",{onClick:()=>window.location.reload(),className:"bg-[#4ecdc4] text-[#1a1a2e] px-8 py-3 rounded-lg font-bold text-xl hover:bg-[#3dbdb4] transition hover:scale-105",children:"RETURN TO MENU"})]}),it.jsx("div",{className:`crt-overlay ${s.crtScanlines?"crt-scanlines":""} ${s.crtVignette?"crt-vignette":""} ${s.crtFlicker?"crt-flicker":""}`}),it.jsx("div",{className:"screen-reflection"})]})}),it.jsxs("div",{className:"tv-controls",children:[it.jsx("div",{className:"speaker-grill"}),it.jsxs("div",{className:"flex flex-col items-center",children:[it.jsx("div",{className:"tv-brand",children:"POLYTRON"}),it.jsxs("div",{className:"flex gap-2 mt-1",children:[it.jsx("div",{className:"w-8 h-2 bg-gray-800 rounded"}),it.jsx("div",{className:"w-8 h-2 bg-gray-800 rounded"})]})]}),it.jsxs("div",{className:"tv-buttons",children:[it.jsx("div",{className:"power-led"}),it.jsx("div",{className:"power-btn"})]})]})]}),it.jsx("div",{className:"flex justify-center w-[800px] mt-8",children:s.isMultiplayer?it.jsxs("div",{className:"text-center text-sm text-gray-400",children:[it.jsxs("span",{className:"block font-bold text-[#e94560]",children:["YOU ARE ",s.isHost?"PLAYER 1":"PLAYER 2"]}),it.jsx("span",{children:"WASD / ARROWS to Move  J / 1 High  K / 2 Low  L / 3 Grab"})]}):it.jsx("div",{className:"text-center text-sm text-gray-400",children:"P1: WASD+J/K/L | P2: ARROWS+1/2/3"})})]})},Zy=document.getElementById("root");if(!Zy)throw new Error("Could not find root element to mount to");const X1=Bb.createRoot(Zy);X1.render(it.jsx(Cb.StrictMode,{children:it.jsx(q1,{})}));
